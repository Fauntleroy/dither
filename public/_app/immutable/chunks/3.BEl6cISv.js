const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./filmstrip.D8sxdZnC.js","./disclose-version.Bo9HnLYn.js","./runtime.CQ81CuDx.js","./render.DQGzWiBa.js","./this.CgtAJvLj.js","./store.kYhZgm38.js","./index.DLODF9zi.js","./canvas.CVWb7qMF.js","./preload-helper.ii-2ED8s.js","./store.svelte.DBc1b8wm.js","./constants.CRYFBpvt.js","../assets/filmstrip.ZpbFyg6i.css","./new-message.DpdQU8IQ.js","./if.Ogru3AK2.js","./attributes.Bg6YOHw9.js","../assets/new-message.-5hMX9CA.css"])))=>i.map(i=>d[i]);
import{H as ht}from"./control.CYgJF_JY.js";import{_ as st,c as it}from"./preload-helper.ii-2ED8s.js";import{c as dt,a as F,t as $}from"./disclose-version.Bo9HnLYn.js";import{j as Q,u as ct,B as ft,a5 as _t,ai as gt,a2 as pt,ax as yt,ay as wt,az as bt,q as xt,E as L,aA as Rt,T as Et,aB as kt,aC as It,r as Tt,k as ut,w as z,e as N,o as B,F as lt,b,n as U,G as D,l as mt,an as q,t as Ct,$ as Mt,d as At,a4 as W}from"./runtime.CQ81CuDx.js";import{b as Nt,h as Ot,e as Y}from"./render.DQGzWiBa.js";import{p as O,i as K}from"./if.Ogru3AK2.js";import{d as St,e as qt,s as J,b as X}from"./constants.CRYFBpvt.js";import{b as Ft}from"./this.CgtAJvLj.js";import{c as Bt,f as j,d as G,o as Z,q as Ut,b as Dt,l as Lt,u as Pt,r as zt,e as Ht,g as $t,h as Vt,i as jt,s as Gt}from"./firebase.D0YEaysK.js";import{p as Kt}from"./store.svelte.DBc1b8wm.js";function Qt(t,e,r){Q(()=>{var a=ct(()=>e(t,r==null?void 0:r())||{});if(a!=null&&a.destroy)return()=>a.destroy()})}function Wt(t){ft&&_t(t)!==null&&gt(t)}let tt=!1;function Yt(){tt||(tt=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const r of t.target.elements)(e=r.__on_r)==null||e.call(r)})},{capture:!0}))}const Jt=requestAnimationFrame,Xt=()=>performance.now(),M={tick:t=>Jt(t),now:()=>Xt(),tasks:new Set};function vt(t){M.tasks.forEach(e=>{e.c(t)||(M.tasks.delete(e),e.f())}),M.tasks.size!==0&&M.tick(vt)}function Zt(t){let e;return M.tasks.size===0&&M.tick(vt),{promise:new Promise(r=>{M.tasks.add(e={c:t,f:r})}),abort(){M.tasks.delete(e)}}}function P(t,e){t.dispatchEvent(new CustomEvent(e))}function te(t){const e=t.split("-");return e.length===1?e[0]:e[0]+e.slice(1).map(r=>r[0].toUpperCase()+r.slice(1)).join("")}function et(t){const e={},r=t.split(";");for(const a of r){const[o,f]=a.split(":");if(!o||f===void 0)break;const i=te(o.trim());e[i]=f.trim()}return e}const ee=t=>t;function re(t,e,r){var a=St,o,f,i,u=null;a.a??(a.a={element:t,measure(){o=this.element.getBoundingClientRect()},apply(){if(i==null||i.abort(),f=this.element.getBoundingClientRect(),o.left!==f.left||o.right!==f.right||o.top!==f.top||o.bottom!==f.bottom){const l=e()(this.element,{from:o,to:f},r==null?void 0:r());i=H(this.element,l,void 0,1,()=>{i==null||i.abort(),i=void 0})}},fix(){if(!t.getAnimations().length){var{position:l,width:m,height:c}=getComputedStyle(t);if(l!=="absolute"&&l!=="fixed"){var s=t.style;u={position:s.position,width:s.width,height:s.height,transform:s.transform},s.position="absolute",s.width=m,s.height=c;var d=t.getBoundingClientRect();if(o.left!==d.left||o.top!==d.top){var p=`translate(${o.left-d.left}px, ${o.top-d.top}px)`;s.transform=s.transform?`${s.transform} ${p}`:p}}}},unfix(){if(u){var l=t.style;l.position=u.position,l.width=u.width,l.height=u.height,l.transform=u.transform}}}),a.a.element=t}function rt(t,e,r,a){var o=(t&Rt)!==0,f=(t&kt)!==0,i=o&&f,u=(t&It)!==0,l=i?"both":o?"in":"out",m,c=e.inert,s,d;function p(){return m??(m=r()(e,(a==null?void 0:a())??{},{direction:l}))}var w={is_global:u,in(){var h;if(e.inert=c,!o){d==null||d.abort(),(h=d==null?void 0:d.reset)==null||h.call(d);return}f||s==null||s.abort(),P(e,"introstart"),s=H(e,p(),d,1,()=>{P(e,"introend"),s==null||s.abort(),s=m=void 0})},out(h){if(!f){h==null||h(),m=void 0;return}e.inert=!0,P(e,"outrostart"),d=H(e,p(),s,0,()=>{P(e,"outroend"),h==null||h()})},stop:()=>{s==null||s.abort(),d==null||d.abort()}},g=Et;if((g.transitions??(g.transitions=[])).push(w),o&&Nt){var x=u;if(!x){for(var y=g.parent;y&&y.f&pt;)for(;(y=y.parent)&&!(y.f&yt););x=!y||(y.f&wt)!==0}x&&Q(()=>{ct(()=>w.in())})}}function H(t,e,r,a,o){var f=a===1;if(bt(e)){var i,u=!1;return xt(()=>{if(!u){var x=e({direction:f?"in":"out"});i=H(t,x,r,a,o)}}),{abort:()=>{u=!0,i==null||i.abort()},deactivate:()=>i.deactivate(),reset:()=>i.reset(),t:()=>i.t()}}if(r==null||r.deactivate(),!(e!=null&&e.duration))return o(),{abort:L,deactivate:L,reset:L,t:()=>a};const{delay:l=0,css:m,tick:c,easing:s=ee}=e;var d=[];if(f&&r===void 0&&(c&&c(0,1),m)){var p=et(m(0,1));d.push(p,p)}var w=()=>1-a,g=t.animate(d,{duration:l});return g.onfinish=()=>{var x=(r==null?void 0:r.t())??1-a;r==null||r.abort();var y=a-x,h=e.duration*Math.abs(y),R=[];if(h>0){if(m)for(var A=Math.ceil(h/16.666666666666668),C=0;C<=A;C+=1){var E=x+y*s(C/A),S=m(E,1-E);R.push(et(S))}w=()=>{var n=g.currentTime;return x+y*s(n/h)},c&&Zt(()=>{if(g.playState!=="running")return!1;var n=w();return c(n,1-n),!0})}g=t.animate(R,{duration:h,fill:"forwards"}),g.onfinish=()=>{w=()=>a,c==null||c(a,1-a),o()}},{abort:()=>{g&&(g.cancel(),g.effect=null)},deactivate:()=>{o=L},reset:()=>{a===0&&(c==null||c(1,0))},t:()=>w()}}function ae(t,e,r,a=r){t.addEventListener(e,r);const o=t.__on_r;o?t.__on_r=()=>{o(),a()}:t.__on_r=a,Yt()}function ne(t,e,r){ae(t,"input",()=>{r(at(t)?nt(t.value):t.value)}),Tt(()=>{var a=e();if(ft&&t.defaultValue!==t.value){r(t.value);return}at(t)&&a===nt(t.value)||t.type==="date"&&!a&&!t.value||(t.value=a??"")})}function at(t){var e=t.type;return e==="number"||e==="range"}function nt(t){return t===""?null:+t}function oe(t,e){throw new ht(t,e)}new TextEncoder;function se({params:t}){if(!t.roomId)throw oe(404,"Room not found");return{roomId:t.roomId}}const Te=Object.freeze(Object.defineProperty({__proto__:null,load:se},Symbol.toStringTag,{value:"Module"}));function ie(t){const e=t-1;return e*e*e+1}function de(t){return--t*t*t*t*t+1}function ce(t){const e=t-1;return e*e*e+1}function ot(t,e){for(const r in e)t[r]=e[r];return t}function fe({fallback:t,...e}){const r=new Map,a=new Map;function o(i,u,l){const{delay:m=0,duration:c=E=>Math.sqrt(E)*30,easing:s=ce}=ot(ot({},e),l),d=i.getBoundingClientRect(),p=u.getBoundingClientRect(),w=d.left-p.left,g=d.top-p.top,x=d.width/p.width,y=d.height/p.height,h=Math.sqrt(w*w+g*g),R=getComputedStyle(u),A=R.transform==="none"?"":R.transform,C=+R.opacity;return{delay:m,duration:typeof c=="function"?c(h):c,easing:s,css:(E,S)=>`
			   opacity: ${E*C};
			   transform-origin: top left;
			   transform: ${A} translate(${S*w}px,${S*g}px) scale(${E+(1-E)*x}, ${E+(1-E)*y});
		   `}}function f(i,u,l){return(m,c)=>(i.set(c.key,m),()=>{if(u.has(c.key)){const s=u.get(c.key);return u.delete(c.key),o(s,m,c)}return i.delete(c.key),t&&t(m,c,l)})}return[f(a,r,!1),f(r,a,!0)]}function ue(t,{from:e,to:r},a={}){const o=getComputedStyle(t),f=o.transform==="none"?"":o.transform,[i,u]=o.transformOrigin.split(" ").map(parseFloat),l=e.left+e.width*i/r.width-(r.left+i),m=e.top+e.height*u/r.height-(r.top+u),{delay:c=0,duration:s=p=>Math.sqrt(p)*120,easing:d=ie}=a;return{delay:c,duration:typeof s=="function"?s(Math.sqrt(l*l+m*m)):s,easing:d,css:(p,w)=>{const g=w*l,x=w*m,y=p+w*e.width/r.width,h=p+w*e.height/r.height;return`transform: ${f} translate(${g}px, ${x}px) scale(${y}, ${h});`}}}var le=$('<div class="message svelte-1h024vu"><div class="image svelte-1h024vu"><!></div> <div class="text svelte-1h024vu"></div></div>');function me(t,e){ut(e,!0);let r=q(null);z(()=>{st(()=>import("./filmstrip.D8sxdZnC.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url).then(l=>{N(r,O(l.default))})});const a=e.text||"…";var o=le(),f=B(o),i=B(f);K(i,()=>b(r),l=>{var m=dt(),c=lt(m);it(c,()=>b(r),(s,d)=>{d(s,{get src(){return e.imageUrl},fileName:a})}),F(l,m)}),U(f);var u=D(f,2);u.textContent=a,U(o),F(t,o),mt()}var ve=$("<p>Nothing has been said.</p> <p>Click ➪ to say something</p>",1),he=$("<li><!></li>"),_e=$('<div class="content svelte-nw37d"><div class="room-name-container svelte-nw37d">— <textarea class="room-name svelte-nw37d" rows="1" maxlength="55"></textarea> —</div> <!> <ul class="messages svelte-nw37d"><!> <!></ul></div>');function Ce(t,e){ut(e,!0);const r=Bt(j,`rooms/${e.data.roomId}/messages`);let a=q(0),o,f=q(O(e.data.roomId)),i=q(void 0),u=q(O([])),l=At(()=>{var n;return((n=b(i))==null?void 0:n.name)||e.data.roomId});const[m,c]=fe({duration:n=>Math.sqrt(n*100),fallback(n,_){const v=getComputedStyle(n),I=v.transform==="none"?"":v.transform;return{duration:125,easing:de,css:k=>`
					transform: ${I} scale(${k});
					opacity: ${k}
				`}}});function s(){var v;const _={...J.get(X),[e.data.roomId]:{lastSeen:Date.now(),name:(v=b(i))==null?void 0:v.name}};J.set(X,_)}let d=q(void 0);z(()=>{(async function(){try{const n=await st(()=>import("./new-message.DpdQU8IQ.js"),__vite__mapDeps([12,1,2,3,13,5,6,9,10,7,8,14,4,15]),import.meta.url);N(d,O(n.default))}catch(n){console.error("Error importing NewMessage component",n)}})()}),z(()=>{if(!e.data.roomId)return;const n=G(j,"rooms",e.data.roomId),_=Z(n,v=>{v.exists()&&(N(i,O(v.data())),N(f,O(b(i).name)),s())});return()=>{_()}}),z(()=>{const n=Ut(r,Lt(10),Dt("createdAt","desc")),_=Z(n,v=>{N(u,O(v.docs.map(I=>{const{createdAt:k,imageUrl:T,text:V}=I.data();return{id:I.id,createdAt:k,imageUrl:T,text:V}})))});return()=>{_()}}),Kt.subscribe(()=>{N(a,0)});async function p({text:n,imageDataBlob:_}){try{const v=G(r),I=v.id,k=zt(Ht,`messages/${I}/filmstrip.png`);await $t(k,_);const T=await Vt(k);await jt(v,{createdAt:Gt(),imageUrl:T,text:n})}catch(v){console.error("Error adding message to room",v)}}async function w(){const n=G(j,"rooms",e.data.roomId);await Pt(n,{name:b(f)})}function g(n){n.key==="Enter"&&(o==null||o.blur())}function x(n){let _;function v(){n.style.width="1px",n.style.width=+n.scrollWidth+"px",_=window.requestAnimationFrame(v)}return _=window.requestAnimationFrame(v),{destroy:()=>window.cancelAnimationFrame(_)}}var y=_e();Ot(n=>{Ct(()=>Mt.title=b(a)?`[${b(a)}] ${b(l)} - Dither`:`${b(l)} - Dither`)});var h=B(y),R=D(B(h));Ft(R,n=>o=n,()=>o),Wt(R),W(),U(h);var A=D(h,2);K(A,()=>b(d),n=>{var _=dt(),v=lt(_);it(v,()=>b(d),(I,k)=>{k(I,{onCreateMessage:p})}),F(n,_)});var C=D(A,2),E=B(C);K(E,()=>b(u).length===0,n=>{var _=ve();W(2),F(n,_)});var S=D(E,2);qt(S,27,()=>b(u),({id:n,text:_,imageUrl:v})=>n,(n,_)=>{let v=()=>b(_).id,I=()=>b(_).text,k=()=>b(_).imageUrl;var T=he(),V=B(T);me(V,{get text(){return I()},get imageUrl(){return k()}}),U(T),re(T,()=>ue,()=>({duration:200})),rt(1,T,()=>c,()=>({key:v()})),rt(2,T,()=>m,()=>({key:v()})),F(n,T)}),U(C),U(y),Q(()=>ne(R,()=>b(f),n=>N(f,n))),Qt(R,n=>x(n)),Y("blur",R,w),Y("keypress",R,g),F(t,y),mt()}export{Te as _,Ce as a,ne as b,Wt as r};
