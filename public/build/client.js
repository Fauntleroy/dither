!function(){"use strict";function noop(){}const identity=t=>t;function assign(t,e){for(const n in e)t[n]=e[n];return t}function run(t){return t()}function blank_object(){return Object.create(null)}function run_all(t){t.forEach(run)}function is_function(t){return"function"==typeof t}function safe_not_equal(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function subscribe(t,...e){if(null==t)return noop;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function get_store_value(t){let e;return subscribe(t,t=>e=t)(),e}function component_subscribe(t,e,n){t.$$.on_destroy.push(subscribe(e,n))}function create_slot(t,e,n,r){if(t){const i=get_slot_context(t,e,n,r);return t[0](i)}}function get_slot_context(t,e,n,r){return t[1]&&r?assign(n.ctx.slice(),t[1](r(e))):n.ctx}function get_slot_changes(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(void 0===e.dirty)return i;if("object"==typeof i){const t=[],n=Math.max(e.dirty.length,i.length);for(let r=0;r<n;r+=1)t[r]=e.dirty[r]|i[r];return t}return e.dirty|i}return e.dirty}const is_client="undefined"!=typeof window;let now=is_client?()=>window.performance.now():()=>Date.now(),raf=is_client?t=>requestAnimationFrame(t):noop;const tasks=new Set;function run_tasks(t){tasks.forEach(e=>{e.c(t)||(tasks.delete(e),e.f())}),0!==tasks.size&&raf(run_tasks)}function loop(t){let e;return 0===tasks.size&&raf(run_tasks),{promise:new Promise(n=>{tasks.add(e={c:t,f:n})}),abort(){tasks.delete(e)}}}function append(t,e){t.appendChild(e)}function insert(t,e,n){t.insertBefore(e,n||null)}function detach(t){t.parentNode.removeChild(t)}function element(t){return document.createElement(t)}function text(t){return document.createTextNode(t)}function space(){return text(" ")}function empty(){return text("")}function listen(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function prevent_default(t){return function(e){return e.preventDefault(),t.call(this,e)}}function attr(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function children(t){return Array.from(t.childNodes)}function set_data(t,e){e=""+e,t.data!==e&&(t.data=e)}function set_input_value(t,e){(null!=e||t.value)&&(t.value=e)}function toggle_class(t,e,n){t.classList[n?"add":"remove"](e)}function custom_event(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}const active_docs=new Set;let active=0,current_component;function hash(t){let e=5381,n=t.length;for(;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function create_rule(t,e,n,r,i,o,s,a=0){const u=16.666/r;let c="{\n";for(let t=0;t<=1;t+=u){const r=e+(n-e)*o(t);c+=100*t+`%{${s(r,1-r)}}\n`}const h=c+`100% {${s(n,1-n)}}\n}`,l=`__svelte_${hash(h)}_${a}`,f=t.ownerDocument;active_docs.add(f);const p=f.__svelte_stylesheet||(f.__svelte_stylesheet=f.head.appendChild(element("style")).sheet),d=f.__svelte_rules||(f.__svelte_rules={});d[l]||(d[l]=!0,p.insertRule(`@keyframes ${l} ${h}`,p.cssRules.length));const g=t.style.animation||"";return t.style.animation=`${g?`${g}, `:""}${l} ${r}ms linear ${i}ms 1 both`,active+=1,l}function delete_rule(t,e){const n=(t.style.animation||"").split(", "),r=n.filter(e?t=>t.indexOf(e)<0:t=>-1===t.indexOf("__svelte")),i=n.length-r.length;i&&(t.style.animation=r.join(", "),active-=i,active||clear_rules())}function clear_rules(){raf(()=>{active||(active_docs.forEach(t=>{const e=t.__svelte_stylesheet;let n=e.cssRules.length;for(;n--;)e.deleteRule(n);t.__svelte_rules={}}),active_docs.clear())})}function create_animation(t,e,n,r){if(!e)return noop;const i=t.getBoundingClientRect();if(e.left===i.left&&e.right===i.right&&e.top===i.top&&e.bottom===i.bottom)return noop;const{delay:o=0,duration:s=300,easing:a=identity,start:u=now()+o,end:c=u+s,tick:h=noop,css:l}=n(t,{from:e,to:i},r);let f,p=!0,d=!1;function g(){l&&delete_rule(t,f),p=!1}return loop(t=>{if(!d&&t>=u&&(d=!0),d&&t>=c&&(h(1,0),g()),!p)return!1;if(d){const e=0+1*a((t-u)/s);h(e,1-e)}return!0}),l&&(f=create_rule(t,0,1,s,o,a,l)),o||(d=!0),h(0,1),g}function fix_position(t){const e=getComputedStyle(t);if("absolute"!==e.position&&"fixed"!==e.position){const{width:n,height:r}=e,i=t.getBoundingClientRect();t.style.position="absolute",t.style.width=n,t.style.height=r,add_transform(t,i)}}function add_transform(t,e){const n=t.getBoundingClientRect();if(e.left!==n.left||e.top!==n.top){const r=getComputedStyle(t),i="none"===r.transform?"":r.transform;t.style.transform=`${i} translate(${e.left-n.left}px, ${e.top-n.top}px)`}}function set_current_component(t){current_component=t}function get_current_component(){if(!current_component)throw new Error("Function called outside component initialization");return current_component}function onMount(t){get_current_component().$$.on_mount.push(t)}function createEventDispatcher(){const t=get_current_component();return(e,n)=>{const r=t.$$.callbacks[e];if(r){const i=custom_event(e,n);r.slice().forEach(e=>{e.call(t,i)})}}}const dirty_components=[],binding_callbacks=[],render_callbacks=[],flush_callbacks=[],resolved_promise=Promise.resolve();let update_scheduled=!1;function schedule_update(){update_scheduled||(update_scheduled=!0,resolved_promise.then(flush))}function add_render_callback(t){render_callbacks.push(t)}let flushing=!1;const seen_callbacks=new Set;function flush(){if(!flushing){flushing=!0;do{for(let t=0;t<dirty_components.length;t+=1){const e=dirty_components[t];set_current_component(e),update(e.$$)}for(dirty_components.length=0;binding_callbacks.length;)binding_callbacks.pop()();for(let t=0;t<render_callbacks.length;t+=1){const e=render_callbacks[t];seen_callbacks.has(e)||(seen_callbacks.add(e),e())}render_callbacks.length=0}while(dirty_components.length);for(;flush_callbacks.length;)flush_callbacks.pop()();update_scheduled=!1,flushing=!1,seen_callbacks.clear()}}function update(t){if(null!==t.fragment){t.update(),run_all(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(add_render_callback)}}let promise;function wait(){return promise||(promise=Promise.resolve(),promise.then(()=>{promise=null})),promise}function dispatch(t,e,n){t.dispatchEvent(custom_event(`${e?"intro":"outro"}${n}`))}const outroing=new Set;let outros;function group_outros(){outros={r:0,c:[],p:outros}}function check_outros(){outros.r||run_all(outros.c),outros=outros.p}function transition_in(t,e){t&&t.i&&(outroing.delete(t),t.i(e))}function transition_out(t,e,n,r){if(t&&t.o){if(outroing.has(t))return;outroing.add(t),outros.c.push(()=>{outroing.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}const null_transition={duration:0};function create_in_transition(t,e,n){let r,i,o=e(t,n),s=!1,a=0;function u(){r&&delete_rule(t,r)}function c(){const{delay:e=0,duration:n=300,easing:c=identity,tick:h=noop,css:l}=o||null_transition;l&&(r=create_rule(t,0,1,n,e,c,l,a++)),h(0,1);const f=now()+e,p=f+n;i&&i.abort(),s=!0,add_render_callback(()=>dispatch(t,!0,"start")),i=loop(e=>{if(s){if(e>=p)return h(1,0),dispatch(t,!0,"end"),u(),s=!1;if(e>=f){const t=c((e-f)/n);h(t,1-t)}}return s})}let h=!1;return{start(){h||(delete_rule(t),is_function(o)?(o=o(),wait().then(c)):c())},invalidate(){h=!1},end(){s&&(u(),s=!1)}}}function create_out_transition(t,e,n){let r,i=e(t,n),o=!0;const s=outros;function a(){const{delay:e=0,duration:n=300,easing:a=identity,tick:u=noop,css:c}=i||null_transition;c&&(r=create_rule(t,1,0,n,e,a,c));const h=now()+e,l=h+n;add_render_callback(()=>dispatch(t,!1,"start")),loop(e=>{if(o){if(e>=l)return u(0,1),dispatch(t,!1,"end"),--s.r||run_all(s.c),!1;if(e>=h){const t=a((e-h)/n);u(1-t,t)}}return o})}return s.r+=1,is_function(i)?wait().then(()=>{i=i(),a()}):a(),{end(e){e&&i.tick&&i.tick(1,0),o&&(r&&delete_rule(t,r),o=!1)}}}function destroy_block(t,e){t.d(1),e.delete(t.key)}function outro_and_destroy_block(t,e){transition_out(t,1,1,()=>{e.delete(t.key)})}function fix_and_outro_and_destroy_block(t,e){t.f(),outro_and_destroy_block(t,e)}function update_keyed_each(t,e,n,r,i,o,s,a,u,c,h,l){let f=t.length,p=o.length,d=f;const g={};for(;d--;)g[t[d].key]=d;const m=[],v=new Map,y=new Map;for(d=p;d--;){const t=l(i,o,d),a=n(t);let u=s.get(a);u?r&&u.p(t,e):(u=c(a,t),u.c()),v.set(a,m[d]=u),a in g&&y.set(a,Math.abs(d-g[a]))}const b=new Set,w=new Set;function _(t){transition_in(t,1),t.m(a,h,s.has(t.key)),s.set(t.key,t),h=t.first,p--}for(;f&&p;){const e=m[p-1],n=t[f-1],r=e.key,i=n.key;e===n?(h=e.first,f--,p--):v.has(i)?!s.has(r)||b.has(r)?_(e):w.has(i)?f--:y.get(r)>y.get(i)?(w.add(r),_(e)):(b.add(i),f--):(u(n,s),f--)}for(;f--;){const e=t[f];v.has(e.key)||u(e,s)}for(;p;)_(m[p-1]);return m}function create_component(t){t&&t.c()}function mount_component(t,e,n){const{fragment:r,on_mount:i,on_destroy:o,after_update:s}=t.$$;r&&r.m(e,n),add_render_callback(()=>{const e=i.map(run).filter(is_function);o?o.push(...e):run_all(e),t.$$.on_mount=[]}),s.forEach(add_render_callback)}function destroy_component(t,e){const n=t.$$;null!==n.fragment&&(run_all(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function make_dirty(t,e){-1===t.$$.dirty[0]&&(dirty_components.push(t),schedule_update(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function init(t,e,n,r,i,o,s=[-1]){const a=current_component;set_current_component(t);const u=e.props||{},c=t.$$={fragment:null,ctx:null,props:o,update:noop,not_equal:i,bound:blank_object(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:blank_object(),dirty:s};let h=!1;if(c.ctx=n?n(t,u,(e,n,...r)=>{const o=r.length?r[0]:n;return c.ctx&&i(c.ctx[e],c.ctx[e]=o)&&(c.bound[e]&&c.bound[e](o),h&&make_dirty(t,e)),n}):[],c.update(),h=!0,run_all(c.before_update),c.fragment=!!r&&r(c.ctx),e.target){if(e.hydrate){const t=children(e.target);c.fragment&&c.fragment.l(t),t.forEach(detach)}else c.fragment&&c.fragment.c();e.intro&&transition_in(t.$$.fragment),mount_component(t,e.target,e.anchor),flush()}set_current_component(a)}class SvelteComponent{$destroy(){destroy_component(this,1),this.$destroy=noop}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const subscriber_queue=[];function readable(t,e){return{subscribe:writable(t,e).subscribe}}function writable(t,e=noop){let n;const r=[];function i(e){if(safe_not_equal(t,e)&&(t=e,n)){const e=!subscriber_queue.length;for(let e=0;e<r.length;e+=1){const n=r[e];n[1](),subscriber_queue.push(n,t)}if(e){for(let t=0;t<subscriber_queue.length;t+=2)subscriber_queue[t][0](subscriber_queue[t+1]);subscriber_queue.length=0}}}return{set:i,update:function(e){i(e(t))},subscribe:function(o,s=noop){const a=[o,s];return r.push(a),1===r.length&&(n=e(i)||noop),o(t),()=>{const t=r.indexOf(a);-1!==t&&r.splice(t,1),0===r.length&&(n(),n=null)}}}}function derived(t,e,n){const r=!Array.isArray(t),i=r?[t]:t,o=e.length<2;return readable(n,t=>{let n=!1;const s=[];let a=0,u=noop;const c=()=>{if(a)return;u();const n=e(r?s[0]:s,t);o?t(n):u=is_function(n)?n:noop},h=i.map((t,e)=>subscribe(t,t=>{s[e]=t,a&=~(1<<e),n&&c()},()=>{a|=1<<e}));return n=!0,c(),function(){run_all(h),u()}})}var store=Object.freeze({__proto__:null,derived:derived,readable:readable,writable:writable,get:get_store_value}),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function unwrapExports(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}function getCjsExportFromNamespace(t){return t&&t.default||t}var require$$0=getCjsExportFromNamespace(store);const writable$1=require$$0.writable,router=writable$1({});function set(t){router.set(t)}function remove(){router.set({})}const activeRoute={subscribe:router.subscribe,set:set,remove:remove};var store$1={activeRoute:activeRoute},store_1=store$1.activeRoute;const UrlParser=(t,e="")=>{const n=new URL(t);function r(){return o(e).reduce((t,e,n)=>(":"===e[0]&&t.push({value:e.slice(1),index:n}),t),[])}function i(){return o(n.pathname)}function o(t){return"/"===t||0===t.trim().length?[t]:("/"===t.slice(-1)&&(t=t.slice(0,-1)),"/"===t[0]&&(t=t.slice(1)),t.split("/"))}return Object.freeze({host:n.host,hostname:n.hostname,namedParams:function(){const t=i();return r().reduce((e,n)=>(e[n.value]=t[n.index],e),{})}(),namedParamsKeys:r().reduce((t,e)=>(t.push(e.value),t),[]),namedParamsValues:function(){const t=i();return r().reduce((e,n)=>(e.push(t[n.index]),e),[])}(),pathNames:i(),port:n.port,pathname:n.pathname,protocol:n.protocol,search:n.search,queryParams:function(){const t={};return n.searchParams.forEach((e,n)=>{t[n]=e}),t}(),queryParamsKeys:function(){const t=[];return n.searchParams.forEach((e,n)=>{t.push(n)}),t}(),queryParamsValues:function(){const t=[];return n.searchParams.forEach(e=>{t.push(e)}),t}()})};var url_parser={UrlParser:UrlParser};const UrlParser$1=url_parser.UrlParser;var urlParamsParser={UrlParser:UrlParser$1};function anyEmptyNestedRoutes(t){let e=!1;return 0===Object.keys(t).length||(t.childRoute&&0===Object.keys(t.childRoute).length?e=!0:t.childRoute&&(e=anyEmptyNestedRoutes(t.childRoute)),e)}function compareRoutes(t,e){return(e=removeSlash(e)).includes(":")?e.includes(t):e.startsWith(t)}function findLocalisedRoute(t,e,n){let r=!1;if(n)return{exists:e.lang&&e.lang[n]&&e.lang[n].includes(t),language:n};if(r=compareRoutes(t,e.name),!r&&e.lang&&"object"==typeof e.lang)for(const[i,o]of Object.entries(e.lang))compareRoutes(t,o)&&(r=!0,n=i);return{exists:r,language:n}}function getNamedParams(t=""){if(0===t.trim().length)return[];return getPathNames(t).reduce((t,e)=>(":"===e[0]&&t.push(e.slice(1)),t),[])}function getPathNames(t){return"/"===t||0===t.trim().length?[t]:(t=removeSlash(t,"both")).split("/")}function nameToPath(t=""){let e;return"/"===t||0===t.trim().length?t:(e=(t=removeSlash(t,"lead")).split(":")[0],e=removeSlash(e,"trail"),e.toLowerCase())}function pathWithoutQueryParams(t){return t.path.split("?")[0]}function pathWithQueryParams(t){let e=[];if(t.queryParams)for(let[n,r]of Object.entries(t.queryParams))e.push(`${n}=${r}`);return e.length>0?`${t.path}?${e.join("&")}`:t.path}function removeExtraPaths(t,e){const n=e.split("/");return n.length>1&&n.forEach((function(e,n){e.length>0&&n>0&&t.shift()})),t}function removeSlash(t,e="lead"){return t.trim().length<1?"":("trail"!==e&&"both"!==e||"/"===t.slice(-1)&&(t=t.slice(0,-1)),"lead"!==e&&"both"!==e||"/"===t[0]&&(t=t.slice(1)),t)}function routeNameLocalised(t,e=null){return e&&t.lang&&t.lang[e]?t.lang[e]:t.name}function updateRoutePath(t,e,n,r,i=!1){if("/"===t||0===t.trim().length)return{result:t,language:null};let o=t,s=n.name,a=r;if(i&&(a=""),s=removeSlash(s),o=removeSlash(o),n.childRoute)return{result:t,language:a};{let t=findLocalisedRoute(o,n,a);t.exists&&i&&(o=routeNameLocalised(n,r));let u=s.split(":")[0];return u=removeSlash(u,"trail"),u=u.split("/"),u.shift(),u.forEach(()=>{const s=e[0];if(t=findLocalisedRoute(`${o}/${s}`,n,a),!s||!t.exists)return{result:o,language:t.language};o=i?routeNameLocalised(n,r):`${o}/${s}`,e.shift()}),{result:o,language:t.language}}}var utils={anyEmptyNestedRoutes:anyEmptyNestedRoutes,compareRoutes:compareRoutes,findLocalisedRoute:findLocalisedRoute,getNamedParams:getNamedParams,getPathNames:getPathNames,nameToPath:nameToPath,pathWithQueryParams:pathWithQueryParams,pathWithoutQueryParams:pathWithoutQueryParams,removeExtraPaths:removeExtraPaths,removeSlash:removeSlash,routeNameLocalised:routeNameLocalised,updateRoutePath:updateRoutePath};const{UrlParser:UrlParser$2}=urlParamsParser,{pathWithQueryParams:pathWithQueryParams$1,removeSlash:removeSlash$1}=utils;function RouterCurrent(t){const e=t||!1;let n="";return Object.freeze({active:function(){return n},isActive:function(t,e=!1){"/"!==t[0]&&(t="/"+t);let r=UrlParser$2(`http://fake.com${t}`).pathname,i=UrlParser$2(`http://fake.com${n}`).pathname;return r=removeSlash$1(r,"trail"),i=removeSlash$1(i,"trail"),e?i.includes(r):i===r},setActive:function(t){n=t.path,function(t){if("undefined"!=typeof window){const r=pathWithQueryParams$1(t);window.history.pushState({page:r},"",r),e&&(n=r,"undefined"!=typeof ga&&(ga("set","page",n),ga("send","pageview")))}var n}(t)}})}var current={RouterCurrent:RouterCurrent};function RouterGuard(t){const e=t;return Object.freeze({valid:function(){return e&&e.guard&&"function"==typeof e.guard},redirect:function(){return!e.guard()},redirectPath:function(){let t="/";return e.redirect&&e.redirect.length>0&&(t=e.redirect),t}})}var guard={RouterGuard:RouterGuard};const{RouterGuard:RouterGuard$1}=guard;function RouterRedirect(t,e){const n=RouterGuard$1(t.onlyIf);return Object.freeze({path:function(){let r=e;return t.redirectTo&&t.redirectTo.length>0&&(r=t.redirectTo),n.valid()&&n.redirect()&&(r=n.redirectPath()),r}})}var redirect={RouterRedirect:RouterRedirect};const{UrlParser:UrlParser$3}=urlParamsParser;function RouterRoute({routeInfo:t,path:e,routeNamedParams:n,urlParser:r,namedPath:i,language:o}){function s(){const t=UrlParser$3(`https://fake.com${r.pathname}`,i).namedParams;return{...n,...t}}return Object.freeze({get:function(){return{name:e,component:t.component,layout:t.layout,queryParams:r.queryParams,namedParams:s(),path:e,language:o}},namedParams:s})}var route={RouterRoute:RouterRoute};const{updateRoutePath:updateRoutePath$1,getNamedParams:getNamedParams$1,nameToPath:nameToPath$1,removeExtraPaths:removeExtraPaths$1,routeNameLocalised:routeNameLocalised$1}=utils;function RouterPath({basePath:t,basePathName:e,pathNames:n,convert:r,currentLanguage:i}){let o,s,a=i;function u(){return routeNameLocalised$1(s,a)}function c(){return nameToPath$1(u())}function h(){return nameToPath$1(o.result)}return Object.freeze({basePathSameAsLocalised:function(){return h()===c()},updatedPath:function(t){return s=t,o=updateRoutePath$1(e,n,s,a,r),a=r?i:o.language,o},basePathNameWithoutNamedParams:h,localisedPathName:u,localisedRouteWithoutNamedParams:c,namedPath:function(){const e=u();return t?`${t}/${e}`:e},pathNames:n,routeLanguage:function(){return a},routePath:function(){let e=`${t}/${h()}`;"//"===e&&(e="/"),a&&(n=removeExtraPaths$1(n,c()));const r=getNamedParams$1(u());return r&&r.length>0&&r.forEach((function(){n.length>0&&(e+=`/${n.shift()}`)})),e}})}var path={RouterPath:RouterPath};const{UrlParser:UrlParser$4}=urlParamsParser,{RouterRedirect:RouterRedirect$1}=redirect,{RouterRoute:RouterRoute$1}=route,{RouterPath:RouterPath$1}=path,{anyEmptyNestedRoutes:anyEmptyNestedRoutes$1,pathWithoutQueryParams:pathWithoutQueryParams$1}=utils,NotFoundPage="/404.html";function RouterFinder({routes:t,currentUrl:e,routerOptions:n,convert:r}){const i=n.defaultLanguage,o=UrlParser$4(e);let s="",a={};return Object.freeze({findActiveRoute:function(){let e=function t(e,n,r,u,c){let h={},l=r.shift().toLowerCase();const f=RouterPath$1({basePath:n,basePathName:l,pathNames:r,convert:c,currentLanguage:u});e.forEach((function(e){if(f.updatedPath(e),f.basePathSameAsLocalised()){let n=f.routePath();if(s=RouterRedirect$1(e,s).path(),h.name!==n&&(h=function({route:t,routePath:e,routeLanguage:n,urlParser:r,namedPath:o}){const s=RouterRoute$1({routeInfo:t,urlParser:r,path:e,routeNamedParams:a,namedPath:o,language:n||i});return a=s.namedParams(),s.get()}({route:e,routePath:n,routeLanguage:f.routeLanguage(),urlParser:o,namedPath:f.namedPath()})),e.nestedRoutes&&e.nestedRoutes.length>0&&f.pathNames.length>0)h.childRoute=t(e.nestedRoutes,n,f.pathNames,f.routeLanguage(),c),h.path=h.childRoute.path,h.language=h.childRoute.language;else if(function(t,e){return t.nestedRoutes&&t.nestedRoutes.length>0&&0===e.length}(e,f.pathNames)){const r=t(e.nestedRoutes,n,["index"],f.routeLanguage(),c);r&&Object.keys(r).length>0&&(h.childRoute=r,h.language=h.childRoute.language)}}})),s&&(h.redirectTo=s);return h}(t,"",o.pathNames,n.lang,r);return e&&Object.keys(e).length&&!anyEmptyNestedRoutes$1(e)?e.path=pathWithoutQueryParams$1(e):"undefined"!=typeof window&&(e={name:"404",component:"",path:"404",redirectTo:NotFoundPage}),e}})}var finder={RouterFinder:RouterFinder};const{activeRoute:activeRoute$1}=store$1,{RouterCurrent:RouterCurrent$1}=current,{RouterFinder:RouterFinder$1}=finder,{removeSlash:removeSlash$2}=utils,NotFoundPage$1="/404.html";let userDefinedRoutes=[],routerOptions={},routerCurrent;function SpaRouter(t,e,n={}){function r(){let n=!1;return routerOptions.langConvertTo&&(routerOptions.lang=routerOptions.langConvertTo,n=!0),RouterFinder$1({routes:t,currentUrl:e,routerOptions:routerOptions,convert:n}).findActiveRoute()}return routerOptions={...n},void 0!==e&&""!==e||(e=document.location.href),routerCurrent=RouterCurrent$1(routerOptions.gaPageviews),e=removeSlash$2(e,"trail"),userDefinedRoutes=t,Object.freeze({setActiveRoute:function(){const t=r();return t.redirectTo?(e=t.redirectTo,"undefined"!=typeof window&&(e===NotFoundPage$1?routerCurrent.setActive({path:NotFoundPage$1}):navigateTo(e)),e):(routerCurrent.setActive(t),activeRoute$1.set(t),t);var e},findActiveRoute:r})}function localisedRoute(t,e){return t=removeSlash$2(t,"lead"),routerOptions.langConvertTo=e,SpaRouter(userDefinedRoutes,"http://fake.com/"+t,routerOptions).findActiveRoute()}function navigateTo(t,e=null){return t=removeSlash$2(t,"lead"),e&&(routerOptions.langConvertTo=e),SpaRouter(userDefinedRoutes,"http://fake.com/"+t,routerOptions).setActiveRoute()}function routeIsActive(t,e=!1){return routerCurrent.isActive(t,e)}"undefined"!=typeof window&&(window.addEventListener("click",t=>{t.target.pathname&&t.target.hostname===window.location.hostname&&"a"===t.target.localName&&(t.preventDefault(),navigateTo(t.target.pathname+t.target.search))}),window.onpopstate=function(t){navigateTo(window.location.pathname+window.location.search)});var spa_router={SpaRouter:SpaRouter,localisedRoute:localisedRoute,navigateTo:navigateTo,routeIsActive:routeIsActive},spa_router_1=spa_router.SpaRouter,spa_router_2=spa_router.localisedRoute,spa_router_3=spa_router.navigateTo,spa_router_4=spa_router.routeIsActive;function create_if_block_2(t){let e;const n=new Route({props:{currentRoute:t[0].childRoute,params:t[1]}});return{c(){create_component(n.$$.fragment)},m(t,r){mount_component(n,t,r),e=!0},p(t,e){const r={};1&e&&(r.currentRoute=t[0].childRoute),2&e&&(r.params=t[1]),n.$set(r)},i(t){e||(transition_in(n.$$.fragment,t),e=!0)},o(t){transition_out(n.$$.fragment,t),e=!1},d(t){destroy_component(n,t)}}}function create_if_block_1(t){let e,n;var r=t[0].component;function i(t){return{props:{currentRoute:{...t[0],component:""},params:t[1]}}}if(r)var o=new r(i(t));return{c(){o&&create_component(o.$$.fragment),e=empty()},m(t,r){o&&mount_component(o,t,r),insert(t,e,r),n=!0},p(t,n){const s={};if(1&n&&(s.currentRoute={...t[0],component:""}),2&n&&(s.params=t[1]),r!==(r=t[0].component)){if(o){group_outros();const t=o;transition_out(t.$$.fragment,1,0,()=>{destroy_component(t,1)}),check_outros()}r?(create_component((o=new r(i(t))).$$.fragment),transition_in(o.$$.fragment,1),mount_component(o,e.parentNode,e)):o=null}else r&&o.$set(s)},i(t){n||(o&&transition_in(o.$$.fragment,t),n=!0)},o(t){o&&transition_out(o.$$.fragment,t),n=!1},d(t){t&&detach(e),o&&destroy_component(o,t)}}}function create_if_block(t){let e,n;var r=t[0].layout;function i(t){return{props:{currentRoute:{...t[0],layout:""},params:t[1]}}}if(r)var o=new r(i(t));return{c(){o&&create_component(o.$$.fragment),e=empty()},m(t,r){o&&mount_component(o,t,r),insert(t,e,r),n=!0},p(t,n){const s={};if(1&n&&(s.currentRoute={...t[0],layout:""}),2&n&&(s.params=t[1]),r!==(r=t[0].layout)){if(o){group_outros();const t=o;transition_out(t.$$.fragment,1,0,()=>{destroy_component(t,1)}),check_outros()}r?(create_component((o=new r(i(t))).$$.fragment),transition_in(o.$$.fragment,1),mount_component(o,e.parentNode,e)):o=null}else r&&o.$set(s)},i(t){n||(o&&transition_in(o.$$.fragment,t),n=!0)},o(t){o&&transition_out(o.$$.fragment,t),n=!1},d(t){t&&detach(e),o&&destroy_component(o,t)}}}function create_fragment(t){let e,n,r,i;const o=[create_if_block,create_if_block_1,create_if_block_2],s=[];function a(t,e){return t[0].layout?0:t[0].component?1:t[0].childRoute?2:-1}return~(e=a(t))&&(n=s[e]=o[e](t)),{c(){n&&n.c(),r=empty()},m(t,n){~e&&s[e].m(t,n),insert(t,r,n),i=!0},p(t,[i]){let u=e;e=a(t),e===u?~e&&s[e].p(t,i):(n&&(group_outros(),transition_out(s[u],1,1,()=>{s[u]=null}),check_outros()),~e?(n=s[e],n||(n=s[e]=o[e](t),n.c()),transition_in(n,1),n.m(r.parentNode,r)):n=null)},i(t){i||(transition_in(n),i=!0)},o(t){transition_out(n),i=!1},d(t){~e&&s[e].d(t),t&&detach(r)}}}function instance(t,e,n){let{currentRoute:r={}}=e,{params:i={}}=e;return t.$set=t=>{"currentRoute"in t&&n(0,r=t.currentRoute),"params"in t&&n(1,i=t.params)},[r,i]}class Route extends SvelteComponent{constructor(t){super(),init(this,t,instance,create_fragment,safe_not_equal,{currentRoute:0,params:1})}}var route$1=Object.freeze({__proto__:null,default:Route});function create_fragment$1(t){let e;const n=new Route({props:{currentRoute:t[0]}});return{c(){create_component(n.$$.fragment)},m(t,r){mount_component(n,t,r),e=!0},p(t,[e]){const r={};1&e&&(r.currentRoute=t[0]),n.$set(r)},i(t){e||(transition_in(n.$$.fragment,t),e=!0)},o(t){transition_out(n.$$.fragment,t),e=!1},d(t){destroy_component(n,t)}}}function instance$1(t,e,n){let r;component_subscribe(t,store_1,t=>n(0,r=t));let{routes:i=[]}=e,{options:o={}}=e;return onMount((function(){spa_router_1(i,document.location.href,o).setActiveRoute()})),t.$set=t=>{"routes"in t&&n(1,i=t.routes),"options"in t&&n(2,o=t.options)},[r,i,o]}class Router extends SvelteComponent{constructor(t){super(),init(this,t,instance$1,create_fragment$1,safe_not_equal,{routes:1,options:2})}}var router$1=Object.freeze({__proto__:null,default:Router});function create_fragment$2(t){let e,n,r;const i=t[6].default,o=create_slot(i,t,t[5],null);return{c(){e=element("a"),o&&o.c(),attr(e,"href",t[0]),attr(e,"title",t[1]),attr(e,"class",t[2]),toggle_class(e,"active",spa_router_4(t[0]))},m(i,s,a){insert(i,e,s),o&&o.m(e,null),n=!0,a&&r(),r=listen(e,"click",t[3])},p(t,[r]){o&&o.p&&32&r&&o.p(get_slot_context(i,t,t[5],null),get_slot_changes(i,t[5],r,null)),(!n||1&r)&&attr(e,"href",t[0]),(!n||2&r)&&attr(e,"title",t[1]),(!n||4&r)&&attr(e,"class",t[2]),5&r&&toggle_class(e,"active",spa_router_4(t[0]))},i(t){n||(transition_in(o,t),n=!0)},o(t){transition_out(o,t),n=!1},d(t){t&&detach(e),o&&o.d(t),r()}}}function instance$2(t,e,n){let{to:r="/"}=e,{title:i=""}=e,{styles:o=""}=e,{lang:s=null}=e;onMount((function(){if(s){const t=spa_router_2(r,s);t&&n(0,r=t.path)}}));let{$$slots:a={},$$scope:u}=e;return t.$set=t=>{"to"in t&&n(0,r=t.to),"title"in t&&n(1,i=t.title),"styles"in t&&n(2,o=t.styles),"lang"in t&&n(4,s=t.lang),"$$scope"in t&&n(5,u=t.$$scope)},[r,i,o,function(t){t.preventDefault(),t.stopPropagation(),spa_router_3(r)},s,u,a]}class Navigate extends SvelteComponent{constructor(t){super(),init(this,t,instance$2,create_fragment$2,safe_not_equal,{to:0,title:1,styles:2,lang:4})}}var navigate=Object.freeze({__proto__:null,default:Navigate}),Route$1=getCjsExportFromNamespace(route$1),Router$1=getCjsExportFromNamespace(router$1),Navigate$1=getCjsExportFromNamespace(navigate);const{SpaRouter:SpaRouter$1,navigateTo:navigateTo$1,localisedRoute:localisedRoute$1,routeIsActive:routeIsActive$1}=spa_router;var src={SpaRouter:SpaRouter$1,localisedRoute:localisedRoute$1,navigateTo:navigateTo$1,routeIsActive:routeIsActive$1,Route:Route$1,Router:Router$1,Navigate:Navigate$1},src_3=src.navigateTo,src_5=src.Route,src_6=src.Router,extendStatics=function(t,e){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var __assign=function(){return(__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function __rest(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function __decorate(t,e,n,r){var i,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,r);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(s=(o<3?i(s):o>3?i(e,n,s):i(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function __param(t,e){return function(n,r){e(n,r,t)}}function __metadata(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function __awaiter(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function __generator(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function __exportStar(t,e){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}function __values(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function __read(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}function __asyncGenerator(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(t,e||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(t){i[t]&&(r[t]=function(e){return new Promise((function(n,r){o.push([t,e,n,r])>1||a(t,e)}))})}function a(t,e){try{!function(t){t.value instanceof __await?Promise.resolve(t.value.v).then(u,c):h(o[0][2],t)}(i[t](e))}catch(t){h(o[0][3],t)}}function u(t){a("next",t)}function c(t){a("throw",t)}function h(t,e){t(e),o.shift(),o.length&&a(o[0][0],o[0][1])}}function __asyncDelegator(t){var e,n;return e={},r("next"),r("throw",(function(t){throw t})),r("return"),e[Symbol.iterator]=function(){return this},e;function r(r,i){e[r]=t[r]?function(e){return(n=!n)?{value:__await(t[r](e)),done:"return"===r}:i?i(e):e}:i}}function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,i){(function(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)})(r,i,(e=t[n](e)).done,e.value)}))}}}function __makeTemplateObject(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function __importStar(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function __importDefault(t){return t&&t.__esModule?t:{default:t}}function __classPrivateFieldGet(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function __classPrivateFieldSet(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n}var tslib_es6=Object.freeze({__proto__:null,__extends:__extends,get __assign(){return __assign},__rest:__rest,__decorate:__decorate,__param:__param,__metadata:__metadata,__awaiter:__awaiter,__generator:__generator,__exportStar:__exportStar,__values:__values,__read:__read,__spread:__spread,__spreadArrays:__spreadArrays,__await:__await,__asyncGenerator:__asyncGenerator,__asyncDelegator:__asyncDelegator,__asyncValues:__asyncValues,__makeTemplateObject:__makeTemplateObject,__importStar:__importStar,__importDefault:__importDefault,__classPrivateFieldGet:__classPrivateFieldGet,__classPrivateFieldSet:__classPrivateFieldSet}),index_cjs=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var n={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},r=function(t,e){if(!t)throw i(e)},i=function(t){return new Error("Firebase Database ("+n.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},o=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,u=i+2<t.length,c=u?t[i+2]:0,h=o>>2,l=(3&o)<<4|a>>4,f=(15&a)<<2|c>>6,p=63&c;u||(p=64,s||(f=64)),r.push(n[h],n[l],n[f],n[p])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(o(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,u=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var c=o<<2|s>>4;if(r.push(c),64!==a){var h=s<<4&240|a>>2;if(r.push(h),64!==u){var l=a<<6&192|u;r.push(l)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},a=function(t){try{return s.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function u(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=u(t[n],e[n]));return t}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var c=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch((function(){})),1===t.length?t(n):t(n,r))}},t}();
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var l=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name="FirebaseError",Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,f.prototype.create),i}return tslib_es6.__extends(e,t),e}(Error),f=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?p(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new l(i,a),c=0,h=Object.keys(r);c<h.length;c++){var f=h[c];"_"!==f.slice(-1)&&(f in u&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),u[f]=r[f])}return u},t}();function p(t,e){return t.replace(d,(function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"}))}var d=/\{\$([^}]+)}/g;
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function g(t){return JSON.parse(t)}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var m=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=g(a(o[0])||""),n=g(a(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(t){}return{header:e,claims:n,data:r,signature:i}};
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var v=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],c=this.chain_[2],h=this.chain_[3],l=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(o=h^u&(c^h),s=1518500249):(o=u^c^h,s=1859775393):r<60?(o=u&c|h&(u|c),s=2400959708):(o=u^c^h,s=3395469782);i=(a<<5|a>>>27)+o+l+s+n[r]&4294967295;l=h,h=c,c=4294967295&(u<<30|u>>>2),u=a,a=i}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+h&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();var y=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((function(){t(n)})).catch((function(t){n.error(t)}))}return t.prototype.next=function(t){this.forEachObserver((function(e){e.next(t)}))},t.prototype.error=function(t){this.forEachObserver((function(e){e.error(t)})),this.close(t)},t.prototype.complete=function(){this.forEachObserver((function(t){t.complete()})),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=b),void 0===r.error&&(r.error=b),void 0===r.complete&&(r.complete=b);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}})),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((function(){e.observers=void 0,e.onNoObservers=void 0})))},t}();function b(){}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function w(t,e,n){var r="";switch(e){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=t+" failed: ";return i+=r+" argument "}e.CONSTANTS=n,e.Deferred=c,e.ErrorFactory=f,e.FirebaseError=l,e.Sha1=v,e.assert=r,e.assertionError=i,e.async=function(t,e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];Promise.resolve(!0).then((function(){t.apply(void 0,n)})).catch((function(t){e&&e(t)}))}},e.base64=s,e.base64Decode=a,e.base64Encode=function(t){var e=o(t);return s.encodeByteArray(e,!0)},e.contains=
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.createSubscribe=function(t,e){var n=new y(t,e);return n.subscribe.bind(n)},e.decode=m,e.deepCopy=
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(t){return u(void 0,t)},e.deepExtend=u,e.errorPrefix=w,e.getUA=h,e.isAdmin=function(t){var e=m(t).claims;return"object"==typeof e&&!0===e.admin},e.isBrowser=function(){return"object"==typeof self&&self.self===self},e.isBrowserExtension=function(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id},e.isElectron=function(){return h().indexOf("Electron/")>=0},e.isEmpty=function(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0},e.isIE=function(){var t=h();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0},e.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(h())},e.isNode=function(){try{return"[object process]"===Object.prototype.toString.call(commonjsGlobal.process)}catch(t){return!1}},e.isNodeSdk=function(){return!0===n.NODE_CLIENT||!0===n.NODE_ADMIN},e.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},e.isUWP=function(){return h().indexOf("MSAppHost/")>=0},e.isValidFormat=function(t){var e=m(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},e.isValidTimestamp=function(t){var e=m(t).claims,n=Math.floor((new Date).getTime()/1e3),r=0,i=0;return"object"==typeof e&&(e.hasOwnProperty("nbf")?r=e.nbf:e.hasOwnProperty("iat")&&(r=e.iat),i=e.hasOwnProperty("exp")?e.exp:r+86400),!!n&&!!r&&!!i&&n>=r&&n<=i},e.issuedAtTime=function(t){var e=m(t).claims;return"object"==typeof e&&e.hasOwnProperty("iat")?e.iat:null},e.jsonEval=g,e.map=function(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */,e.querystring=function(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach((function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))})):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""},e.querystringDecode=function(t){var e={};return t.replace(/^\?/,"").split("&").forEach((function(t){if(t){var n=t.split("=");e[n[0]]=n[1]}})),e},e.safeGet=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0},e.stringLength=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e},e.stringToByteArray=function(t){for(var e=[],n=0,i=0;i<t.length;i++){var o=t.charCodeAt(i);if(o>=55296&&o<=56319){var s=o-55296;i++,r(i<t.length,"Surrogate pair missing trail surrogate."),o=65536+(s<<10)+(t.charCodeAt(i)-56320)}o<128?e[n++]=o:o<2048?(e[n++]=o>>6|192,e[n++]=63&o|128):o<65536?(e[n++]=o>>12|224,e[n++]=o>>6&63|128,e[n++]=63&o|128):(e[n++]=o>>18|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128,e[n++]=63&o|128)}return e},e.stringify=function(t){return JSON.stringify(t)},e.validateArgCount=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")},e.validateCallback=function(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(w(t,e,r)+"must be a valid function.")},e.validateContextObject=function(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(w(t,e,r)+"must be a valid context object.")}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */,e.validateNamespace=function(t,e,n,r){if((!r||n)&&"string"!=typeof n)throw new Error(w(t,e,r)+"must be a valid firebase namespace.")}}));unwrapExports(index_cjs);var index_cjs_1=index_cjs.CONSTANTS,index_cjs_2=index_cjs.Deferred,index_cjs_3=index_cjs.ErrorFactory,index_cjs_4=index_cjs.FirebaseError,index_cjs_5=index_cjs.Sha1,index_cjs_6=index_cjs.assert,index_cjs_7=index_cjs.assertionError,index_cjs_8=index_cjs.async,index_cjs_9=index_cjs.base64,index_cjs_10=index_cjs.base64Decode,index_cjs_11=index_cjs.base64Encode,index_cjs_12=index_cjs.contains,index_cjs_13=index_cjs.createSubscribe,index_cjs_14=index_cjs.decode,index_cjs_15=index_cjs.deepCopy,index_cjs_16=index_cjs.deepExtend,index_cjs_17=index_cjs.errorPrefix,index_cjs_18=index_cjs.getUA,index_cjs_19=index_cjs.isAdmin,index_cjs_20=index_cjs.isBrowser,index_cjs_21=index_cjs.isBrowserExtension,index_cjs_22=index_cjs.isElectron,index_cjs_23=index_cjs.isEmpty,index_cjs_24=index_cjs.isIE,index_cjs_25=index_cjs.isMobileCordova,index_cjs_26=index_cjs.isNode,index_cjs_27=index_cjs.isNodeSdk,index_cjs_28=index_cjs.isReactNative,index_cjs_29=index_cjs.isUWP,index_cjs_30=index_cjs.isValidFormat,index_cjs_31=index_cjs.isValidTimestamp,index_cjs_32=index_cjs.issuedAtTime,index_cjs_33=index_cjs.jsonEval,index_cjs_34=index_cjs.map,index_cjs_35=index_cjs.querystring,index_cjs_36=index_cjs.querystringDecode,index_cjs_37=index_cjs.safeGet,index_cjs_38=index_cjs.stringLength,index_cjs_39=index_cjs.stringToByteArray,index_cjs_40=index_cjs.stringify,index_cjs_41=index_cjs.validateArgCount,index_cjs_42=index_cjs.validateCallback,index_cjs_43=index_cjs.validateContextObject,index_cjs_44=index_cjs.validateNamespace,index_cjs$1=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),r=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return t.prototype.get=function(t){void 0===t&&(t="[DEFAULT]");var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new index_cjs.Deferred;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e=tslib_es6.__assign({identifier:"[DEFAULT]",optional:!1},t),n=e.identifier,r=e.optional,i=this.normalizeInstanceIdentifier(n);try{var o=this.getOrInitializeService(i);if(!o){if(r)return null;throw Error("Service "+this.name+" is not available")}return o}catch(t){if(r)return null;throw t}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,function(t){return"EAGER"===t.instantiationMode}
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t))try{this.getOrInitializeService("[DEFAULT]")}catch(t){}try{for(var r=tslib_es6.__values(this.instancesDeferred.entries()),i=r.next();!i.done;i=r.next()){var o=tslib_es6.__read(i.value,2),s=o[0],a=o[1],u=this.normalizeInstanceIdentifier(s);try{var c=this.getOrInitializeService(u);a.resolve(c)}catch(t){}}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.clearInstance=function(t){void 0===t&&(t="[DEFAULT]"),this.instancesDeferred.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t;return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter((function(t){return"INTERNAL"in t})).map((function(t){return t.INTERNAL.delete()})))];case 1:return e.sent(),[2]}}))}))},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.getOrInitializeService=function(t){var e=this.instances.get(t);return!e&&this.component&&(e=this.component.instanceFactory(this.container,function(t){return"[DEFAULT]"===t?void 0:t}(t)),this.instances.set(t,e)),e||null},t.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:"[DEFAULT]":t},t}();
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var i=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new r(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}();e.Component=n,e.ComponentContainer=i,e.Provider=r}));unwrapExports(index_cjs$1);var index_cjs_1$1=index_cjs$1.Component,index_cjs_2$1=index_cjs$1.ComponentContainer,index_cjs_3$1=index_cjs$1.Provider,_a;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
function __spreadArrays$1(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var instances=[],LogLevel;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(LogLevel||(LogLevel={}));var levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod=(_a={},_a[LogLevel.DEBUG]="log",_a[LogLevel.VERBOSE]="log",_a[LogLevel.INFO]="info",_a[LogLevel.WARN]="warn",_a[LogLevel.ERROR]="error",_a),defaultLogHandler=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=ConsoleMethod[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,__spreadArrays$1(["["+i+"]  "+t.name+":"],n))}},Logger=function(){function t(t){this.name=t,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null,instances.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in LogLevel))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays$1([this,LogLevel.DEBUG],t)),this._logHandler.apply(this,__spreadArrays$1([this,LogLevel.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays$1([this,LogLevel.VERBOSE],t)),this._logHandler.apply(this,__spreadArrays$1([this,LogLevel.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays$1([this,LogLevel.INFO],t)),this._logHandler.apply(this,__spreadArrays$1([this,LogLevel.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays$1([this,LogLevel.WARN],t)),this._logHandler.apply(this,__spreadArrays$1([this,LogLevel.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,__spreadArrays$1([this,LogLevel.ERROR],t)),this._logHandler.apply(this,__spreadArrays$1([this,LogLevel.ERROR],t))},t}();function setLogLevel(t){var e="string"==typeof t?levelStringToEnum[t]:t;instances.forEach((function(t){t.logLevel=e}))}function setUserLogHandler(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=levelStringToEnum[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((function(t){return t})).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:LogLevel[n].toLowerCase(),message:s,args:i,type:e.name})}},r=0,i=instances;r<i.length;r++){n(i[r])}}var index_esm=Object.freeze({__proto__:null,get LogLevel(){return LogLevel},Logger:Logger,setLogLevel:setLogLevel,setUserLogHandler:setUserLogHandler}),index_cjs$2=createCommonjsModule((function(t,e){
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var n;Object.defineProperty(e,"__esModule",{value:!0});var r,i=((n={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",n["bad-app-name"]="Illegal App name: '{$appName}",n["duplicate-app"]="Firebase App named '{$appName}' already exists",n["app-deleted"]="Firebase App named '{$appName}' already deleted",n["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",n["invalid-log-argument"]="First argument to `onLog` must be null or a function.",n),o=new index_cjs.ErrorFactory("app","Firebase",i),s=((r={})["@firebase/app"]="fire-core",r["@firebase/analytics"]="fire-analytics",r["@firebase/auth"]="fire-auth",r["@firebase/database"]="fire-rtdb",r["@firebase/functions"]="fire-fn",r["@firebase/installations"]="fire-iid",r["@firebase/messaging"]="fire-fcm",r["@firebase/performance"]="fire-perf",r["@firebase/remote-config"]="fire-rc",r["@firebase/storage"]="fire-gcs",r["@firebase/firestore"]="fire-fst",r["fire-js"]="fire-js",r["firebase-wrapper"]="fire-js-all",r),a=new index_esm.Logger("@firebase/app"),u=function(){function t(t,e,n){var r,i,o=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=index_cjs.deepCopy(t),this.container=new index_cjs$1.ComponentContainer(e.name),this._addComponent(new index_cjs$1.Component("app",(function(){return o}),"PUBLIC"));try{for(var s=tslib_es6.__values(this.firebase_.INTERNAL.components.values()),a=s.next();!a.done;a=s.next()){var u=a.value;this._addComponent(u)}}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise((function(e){t.checkDestroyed_(),e()})).then((function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map((function(t){return t.delete()})))})).then((function(){t.isDeleted_=!0}))},t.prototype._getService=function(t,e){return void 0===e&&(e="[DEFAULT]"),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e="[DEFAULT]"),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){a.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw o.create("app-deleted",{appName:this.name_})},t}();u.prototype.name&&u.prototype.options||u.prototype.delete||console.log("dc");var c=
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function t(){var e=
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={});if("object"!=typeof i||null===i){i={name:i}}var s=i;void 0===s.name&&(s.name="[DEFAULT]");var a=s.name;if("string"!=typeof a||!a)throw o.create("bad-app-name",{appName:String(a)});if(index_cjs.contains(e,a))throw o.create("duplicate-app",{appName:a});var u=new t(n,s,r);return e[a]=u,u},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=s[t])&&void 0!==r?r:t;n&&(i+="-"+n);var o=i.match(/\s|\//),c=e.match(/\s|\//);if(o||c){var h=['Unable to register library "'+i+'" with version "'+e+'":'];return o&&h.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),o&&c&&h.push("and"),c&&h.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void a.warn(h.join(" "))}u(new index_cjs$1.Component(i+"-version",(function(){return{library:i,version:e}}),"VERSION"))},setLogLevel:index_esm.setLogLevel,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw o.create("invalid-log-argument",{appName:name});index_esm.setUserLogHandler(t,e)},apps:null,SDK_VERSION:"7.13.2",INTERNAL:{registerComponent:u,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){if("serverAuth"===e)return null;return e}}};function i(t){if(t=t||"[DEFAULT]",!index_cjs.contains(e,t))throw o.create("no-app",{appName:t});return e[t]}function u(s){var u,c,h=s.name;if(n.has(h))return a.debug("There were multiple attempts to register component "+h+"."),"PUBLIC"===s.type?r[h]:null;if(n.set(h,s),"PUBLIC"===s.type){var l=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[h])throw o.create("invalid-app-argument",{appName:h});return t[h]()};void 0!==s.serviceProps&&index_cjs.deepExtend(l,s.serviceProps),r[h]=l,t.prototype[h]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._getService.bind(this,h);return n.apply(this,s.multipleInstances?t:[])}}try{for(var f=tslib_es6.__values(Object.keys(e)),p=f.next();!p.done;p=f.next()){var d=p.value;e[d]._addComponent(s)}}catch(t){u={error:t}}finally{try{p&&!p.done&&(c=f.return)&&c.call(f)}finally{if(u)throw u.error}}return"PUBLIC"===s.type?r[h]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map((function(t){return e[t]}))}}),i.App=t,r}(u);return e.INTERNAL=tslib_es6.__assign(tslib_es6.__assign({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){index_cjs.deepExtend(e,t)},createSubscribe:index_cjs.createSubscribe,ErrorFactory:index_cjs.ErrorFactory,deepExtend:index_cjs.deepExtend}),e}(),h=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null})).filter((function(t){return t})).join(" ")},t}();
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
if(index_cjs.isBrowser()&&void 0!==self.firebase){a.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var l=self.firebase.SDK_VERSION;l&&l.indexOf("LITE")>=0&&a.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var f=c.initializeApp;c.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return index_cjs.isNode()&&a.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),f.apply(void 0,t)};var p=c;!function(t,e){t.INTERNAL.registerComponent(new index_cjs$1.Component("platform-logger",(function(t){return new h(t)}),"PRIVATE")),t.registerVersion("@firebase/app","0.6.1",e),t.registerVersion("fire-js","")}(p),e.default=p,e.firebase=p}));unwrapExports(index_cjs$2);var index_cjs_1$2=index_cjs$2.firebase;function _interopDefault(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var firebase=_interopDefault(index_cjs$2),name$1="firebase",version="7.13.2";
/**
     * @license
     * Copyright 2018 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
firebase.registerVersion(name$1,version,"app");var index_cjs$3=firebase,global$1="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(t,0);try{return cachedSetTimeout(t,0)}catch(e){try{return cachedSetTimeout.call(null,t,0)}catch(e){return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(t);try{return cachedClearTimeout(t)}catch(e){try{return cachedClearTimeout.call(null,t)}catch(e){return cachedClearTimeout.call(this,t)}}}"function"==typeof global$1.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$1.clearTimeout&&(cachedClearTimeout=clearTimeout);var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var t=runTimeout(cleanUpNextTick);draining=!0;for(var e=queue.length;e;){for(currentQueue=queue,queue=[];++queueIndex<e;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,e=queue.length}currentQueue=null,draining=!1,runClearTimeout(t)}}function nextTick(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];queue.push(new Item(t,e)),1!==queue.length||draining||runTimeout(drainQueue)}function Item(t,e){this.fun=t,this.array=e}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser$1=!0,env={},argv=[],version$1="",versions={},release={},config={};function noop$1(){}var on=noop$1,addListener=noop$1,once=noop$1,off=noop$1,removeListener=noop$1,removeAllListeners=noop$1,emit=noop$1;function binding(t){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(t){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$1.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(t){var e=.001*performanceNow.call(performance),n=Math.floor(e),r=Math.floor(e%1*1e9);return t&&(n-=t[0],(r-=t[1])<0&&(n--,r+=1e9)),[n,r]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var process={nextTick:nextTick,title:title,browser:browser$1,env:env,argv:argv,version:version$1,versions:versions,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime},commonjsGlobal$1="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global$1?global$1:"undefined"!=typeof self?self:{},g,goog=goog||{},k=commonjsGlobal$1;function m(t){return"string"==typeof t}function aa(t){return"number"==typeof t}function n(t,e){t=t.split("."),e=e||k;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function ba(){}function p(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function q(t){return"array"==p(t)}function ca(t){var e=p(t);return"array"==e||"object"==e&&"number"==typeof t.length}function r(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var t="closure_uid_"+(1e9*Math.random()>>>0),da=0;function ea(t,e,n){return t.call.apply(t.bind,arguments)}function fa(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ea:fa).apply(null,arguments)}function v(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var w=Date.now||function(){return+new Date};function x(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function y(){this.j=this.j,this.i=this.i}var ha=0;y.prototype.j=!1,y.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0!=ha))this[t]||(this[t]=++da)},y.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var ja=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(m(t))return m(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},la=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=m(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function ma(t){t:{for(var e=na,n=t.length,r=m(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:m(t)?t.charAt(e):t[e]}function oa(t){return Array.prototype.concat.apply([],arguments)}function pa(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function qa(t){return/^[\s\xa0]*$/.test(t)}var ra=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},A;function z(t,e){return-1!=t.indexOf(e)}function sa(t,e){return t<e?-1:t>e?1:0}t:{var ta=k.navigator;if(ta){var ua=ta.userAgent;if(ua){A=ua;break t}}A=""}function va(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function wa(t){var e,n={};for(e in t)n[e]=t[e];return n}var xa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ya(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<xa.length;o++)n=xa[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function za(t){return za[" "](t),t}function Aa(t,e){var n=Ba;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}za[" "]=ba;var Ca=z(A,"Opera"),B=z(A,"Trident")||z(A,"MSIE"),Da=z(A,"Edge"),Ea=Da||B,Fa=z(A,"Gecko")&&!(z(A.toLowerCase(),"webkit")&&!z(A,"Edge"))&&!(z(A,"Trident")||z(A,"MSIE"))&&!z(A,"Edge"),Ga=z(A.toLowerCase(),"webkit")&&!z(A,"Edge"),Ia,a;function Ha(){var t=k.document;return t?t.documentMode:void 0}t:{var Ja="",Ka=(a=A,Fa?/rv:([^\);]+)(\)|;)/.exec(a):Da?/Edge\/([\d\.]+)/.exec(a):B?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a):Ga?/WebKit\/(\S+)/.exec(a):Ca?/(?:Version)[ \/]?(\S+)/.exec(a):void 0);if(Ka&&(Ja=Ka?Ka[1]:""),B){var La=Ha();if(null!=La&&La>parseFloat(Ja)){Ia=String(La);break t}}Ia=Ja}var Ba={},Na;function Ma(t){return Aa(t,(function(){for(var e=0,n=ra(String(Ia)).split("."),r=ra(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=sa(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||sa(0==s[2].length,0==a[2].length)||sa(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}var Oa=k.document;Na=Oa&&B?Ha()||("CSS1Compat"==Oa.compatMode?parseInt(Ia,10):5):void 0;var Pa=!B||9<=Number(Na),Qa=B&&!Ma("9"),Ra=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",ba,e),k.removeEventListener("test",ba,e)}catch(t){}return t}();function C(t,e){this.type=t,this.a=this.target=e,this.Ia=!0}function D(t,e){if(C.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Fa){t:{try{za(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=m(t.pointerType)?t.pointerType:Sa[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}C.prototype.b=function(){this.Ia=!1},x(D,C);var Sa={2:"touch",3:"pen",4:"mouse"};D.prototype.b=function(){D.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Qa)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var F="closure_listenable_"+(1e6*Math.random()|0),Ta=0;function Ua(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++Ta,this.X=this.Z=!1}function Va(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function Wa(t){this.src=t,this.a={},this.b=0}function Ya(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=ja(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Va(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Xa(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}Wa.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Xa(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Ua(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Za="closure_lm_"+(1e6*Math.random()|0),$a={};function bb(t,e,n,i,o){if(i&&i.once)return cb(t,e,n,i,o);if(q(e)){for(var s=0;s<e.length;s++)bb(t,e[s],n,i,o);return null}return n=db(n),t&&t[F]?t.za(e,n,r(i)?!!i.capture:!!i,o):eb(t,e,n,!1,i,o)}function eb(t,e,n,i,o,s){if(!e)throw Error("Invalid event type");var a=r(o)?!!o.capture:!!o;if(a&&!Pa)return null;var u=fb(t);if(u||(t[Za]=u=new Wa(t)),(n=u.add(e,n,i,a,s)).proxy)return n;if(i=gb(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)Ra||(o=a),void 0===o&&(o=!1),t.addEventListener(e.toString(),i,o);else if(t.attachEvent)t.attachEvent(hb(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function gb(){var t=ib,e=Pa?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}function cb(t,e,n,i,o){if(q(e)){for(var s=0;s<e.length;s++)cb(t,e[s],n,i,o);return null}return n=db(n),t&&t[F]?t.Aa(e,n,r(i)?!!i.capture:!!i,o):eb(t,e,n,!0,i,o)}function jb(t,e,n,i,o){if(q(e))for(var s=0;s<e.length;s++)jb(t,e[s],n,i,o);else i=r(i)?!!i.capture:!!i,n=db(n),t&&t[F]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=Xa(s=t.a[e],n,i,o))&&(Va(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.a[e],t.b--)))):t&&(t=fb(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Xa(e,n,i,o)),(n=-1<t?e[t]:null)&&kb(n))}function kb(t){if(!aa(t)&&t&&!t.X){var e=t.src;if(e&&e[F])Ya(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(hb(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=fb(e))?(Ya(n,t),0==n.b&&(n.src=null,e[Za]=null)):Va(t)}}}function hb(t){return t in $a?$a[t]:$a[t]="on"+t}function lb(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&kb(t),n.call(r,e)}function ib(t,e){return!!t.X||(Pa?lb(t,new D(e,this)):lb(t,e=new D(e||n("window.event"),this)))}function fb(t){return(t=t[Za])instanceof Wa?t:null}var mb="__closure_events_fn_"+(1e9*Math.random()>>>0);function db(t){return"function"==p(t)?t:(t[mb]||(t[mb]=function(e){return t.handleEvent(e)}),t[mb])}function G(){y.call(this),this.c=new Wa(this),this.J=this,this.B=null}function nb(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.X&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&Ya(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&0!=r.Ia}x(G,y),G.prototype[F]=!0,g=G.prototype,g.addEventListener=function(t,e,n,r){bb(this,t,e,n,r)},g.removeEventListener=function(t,e,n,r){jb(this,t,e,n,r)},g.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(m(t))t=new C(t,n);else if(t instanceof C)t.target=t.target||n;else{var i=t;ya(t=new C(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=nb(s,r,!0,t)&&i}if(i=nb(s=t.a=n,r,!0,t)&&i,i=nb(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=nb(s=t.a=e[o],r,!1,t)&&i;return i},g.G=function(){if(G.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Va(n[r]);delete e.a[t],e.b--}}this.B=null},g.za=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},g.Aa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var ob=k.JSON.stringify;function pb(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function qb(){this.b=this.a=null}pb.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var sb=new pb((function(){return new rb}),(function(t){t.reset()})),xb;function tb(){var t=ub,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function rb(){this.next=this.b=this.a=null}function vb(t){k.setTimeout((function(){throw t}),0)}function wb(t,e){xb||yb(),zb||(xb(),zb=!0),ub.add(t,e)}function yb(){var t=k.Promise.resolve(void 0);xb=function(){t.then(Ab)}}qb.prototype.add=function(t,e){var n=sb.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},rb.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},rb.prototype.reset=function(){this.next=this.b=this.a=null};var zb=!1,ub=new qb;function Ab(){for(var t;t=tb();){try{t.a.call(t.b)}catch(t){vb(t)}var e=sb;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}zb=!1}function Cb(t,e){G.call(this),this.b=t||1,this.a=e||k,this.f=u(this.gb,this),this.g=w()}function Db(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Eb(t,e,n){if("function"==p(t))n&&(t=u(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=u(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}function Fb(t,e,n){y.call(this),this.f=null!=n?u(t,n):t,this.c=e,this.b=u(this.$a,this),this.a=[]}function Gb(t){t.U=Eb(t.b,t.c),t.f.apply(null,t.a)}function H(t){y.call(this),this.b=t,this.a={}}x(Cb,G),g=Cb.prototype,g.ba=!1,g.L=null,g.gb=function(){if(this.ba){var t=w()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(Db(this),this.start()))}},g.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=w())},g.G=function(){Cb.N.G.call(this),Db(this),delete this.a},x(Fb,y),g=Fb.prototype,g.ea=!1,g.U=null,g.Ta=function(t){this.a=arguments,this.U?this.ea=!0:Gb(this)},g.G=function(){Fb.N.G.call(this),this.U&&(k.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},g.$a=function(){this.U=null,this.ea&&(this.ea=!1,Gb(this))},x(H,y);var Hb=[];function Ib(t,e,n,r){q(n)||(n&&(Hb[0]=n.toString()),n=Hb);for(var i=0;i<n.length;i++){var o=bb(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Jb(t){va(t.a,(function(t,e){this.a.hasOwnProperty(e)&&kb(t)}),t),t.a={}}function Kb(){}H.prototype.G=function(){H.N.G.call(this),Jb(this)},H.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var I=new G;function Lb(t){C.call(this,"serverreachability",t)}function J(t){I.dispatchEvent(new Lb(I,t))}function Mb(t){C.call(this,"statevent",t)}function K(t){I.dispatchEvent(new Mb(I,t))}function Nb(t){C.call(this,"timingevent",t)}function Ob(t,e){if("function"!=p(t))throw Error("Fn must not be null and must be a function");return k.setTimeout((function(){t()}),e)}x(Lb,C),x(Mb,C),x(Nb,C);var Pb={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,La:7,TIMEOUT:8,sb:9},Qb={jb:"complete",wb:"success",Ma:"error",La:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function Rb(){}function Sb(t){var e;return(e=t.a)||(e=t.a={}),e}function Tb(){}Rb.prototype.a=null;var L={OPEN:"a",ib:"b",Ma:"c",rb:"d"},Wb;function Ub(){C.call(this,"d")}function Vb(){C.call(this,"c")}function Xb(){}function M(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new H(this),this.O=Yb,t=Ea?125:void 0,this.P=new Cb(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}x(Ub,C),x(Vb,C),x(Xb,Rb),Wb=new Xb;var Yb=45e3,Zb={},$b={};function ac(t,e,n){t.F=1,t.f=bc(N(e)),t.l=n,t.H=!0,cc(t,null)}function dc(t,e,n,r){t.F=1,t.f=bc(N(e)),t.l=null,t.H=n,cc(t,r)}function cc(t,e){t.v=w(),ec(t),t.D=N(t.f),fc(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Fb(u(t.Ja,t,t.a),t.J)),Ib(t.I,t.a,"readystatechange",t.cb),e=t.h?wa(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),J(1)}function kc(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=lc(t,n);if(i==$b){4==e&&(t.c=4,K(14),r=!1);break}if(i==Zb){t.c=4,K(15),r=!1;break}ic(t,i)}4==e&&0==n.length&&(t.c=1,K(16),r=!1),t.b=t.b&&r,r||(P(t),jc(t))}function lc(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?$b:(n=Number(e.substring(n,r)),isNaN(n)?Zb:(r+=1)+n>e.length?$b:(e=e.substr(r,n),t.A=r+n,e))}function ec(t){t.R=w()+t.O,mc(t,t.O)}function mc(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=Ob(u(t.ab,t),e)}function gc(t){t.i&&(k.clearTimeout(t.i),t.i=null)}function jc(t){t.g.Ca()||t.m||t.g.na(t)}function P(t){gc(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,Db(t.P),Jb(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function ic(t,e){try{t.g.Fa(t,e),J(4)}catch(t){}}function nc(t){if(t.C&&"function"==typeof t.C)return t.C();if(m(t))return t.split("");if(ca(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function oc(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ca(t)||m(t))la(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(ca(t)||m(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=nc(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Q(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Q)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qc(t){t.b={},t.a.length=0,t.c=0}function rc(t,e){R(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&pc(t))}function pc(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];R(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)R(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}g=M.prototype,g.setTimeout=function(t){this.O=t},g.cb=function(t){t=t.target;var e=this.B;e&&3==O(t)?e.Ta():this.Ja(t)},g.Ja=function(t){try{if(t==this.a)t:{var e=O(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!Ea&&!this.a.aa())){this.m||4!=e||7==n||J(8==n||0>=r?3:2),gc(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var s=hc(this.a,"X-HTTP-Initial-Response");if(s&&!qa(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,K(12),P(this),jc(this);break t}this.s=!0,ic(this,a)}this.H?(kc(this,e,o),Ea&&this.b&&3==e&&(Ib(this.I,this.P,"tick",this.bb),this.P.start())):ic(this,o),4==e&&P(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,ec(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,K(12)):(this.c=0,K(13)),P(this),jc(this)}}}catch(t){}},g.bb=function(){if(this.a){var t=O(this.a),e=this.a.aa();this.A<e.length&&(gc(this),kc(this,t,e),this.b&&4!=t&&ec(this))}},g.cancel=function(){this.m=!0,P(this)},g.ab=function(){this.i=null;var t=w();0<=t-this.R?(2!=this.F&&(J(3),K(17)),P(this),this.c=2,jc(this)):mc(this,this.R-t)},g=Q.prototype,g.C=function(){pc(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},g.K=function(){return pc(this),this.a.concat()},g.get=function(t,e){return R(this.b,t)?this.b[t]:e},g.set=function(t,e){R(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},g.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var sc=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function tc(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function S(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof S?(this.h=void 0!==e?e:t.h,uc(this,t.f),this.j=t.j,vc(this,t.b),wc(this,t.i),this.a=t.a,xc(this,yc(t.c)),this.g=t.g):t&&(n=String(t).match(sc))?(this.h=!!e,uc(this,n[1]||"",!0),this.j=zc(n[2]||""),vc(this,n[3]||"",!0),wc(this,n[4]),this.a=zc(n[5]||"",!0),xc(this,n[6]||"",!0),this.g=zc(n[7]||"")):(this.h=!!e,this.c=new Ac(null,this.h))}function N(t){return new S(t)}function uc(t,e,n){t.f=n?zc(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function vc(t,e,n){t.b=n?zc(e,!0):e}function wc(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function xc(t,e,n){e instanceof Ac?(t.c=e,Gc(t.c,t.h)):(n||(e=Bc(e,Hc)),t.c=new Ac(e,t.h))}function T(t,e,n){t.c.set(e,n)}function fc(t,e,n){q(n)||(n=[String(n)]),Ic(t.c,e,n)}function bc(t){return T(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^w()).toString(36)),t}function Jc(t){return t instanceof S?N(t):new S(t,void 0)}function Kc(t,e,n,r){var i=new S(null,void 0);return t&&uc(i,t),e&&vc(i,e),n&&wc(i,n),r&&(i.a=r),i}function zc(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Bc(t,e,n){return m(t)?(t=encodeURI(t).replace(e,Lc),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Lc(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}S.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Bc(e,Cc,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Bc(e,Cc,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Bc(n,"/"==n.charAt(0)?Dc:Ec,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Bc(n,Fc)),t.join("")},S.prototype.resolve=function(t){var e=N(this),n=!!t.f;n?uc(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?vc(e,t.b):n=null!=t.i;var r=t.a;if(n)wc(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(z(i,"./")||z(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],s=0;s<i.length;){var a=i[s++];"."==a?r&&s==i.length&&o.push(""):".."==a?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&s==i.length&&o.push("")):(o.push(a),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?xc(e,yc(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Cc=/[#\/\?@]/g,Ec=/[#\?:]/g,Dc=/[#\?]/g,Hc=/[#\?@]/g,Fc=/#/g;function Ac(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function U(t){t.a||(t.a=new Q,t.b=0,t.c&&tc(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Mc(t,e){U(t),e=V(t,e),R(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,rc(t.a,e))}function Nc(t,e){return U(t),e=V(t,e),R(t.a.b,e)}function Ic(t,e,n){Mc(t,e),0<n.length&&(t.c=null,t.a.set(V(t,e),pa(n)),t.b+=n.length)}function yc(t){var e=new Ac;return e.c=t.c,t.a&&(e.a=new Q(t.a),e.b=t.b),e}function V(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function Gc(t,e){e&&!t.f&&(U(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Mc(this,e),Ic(this,n,t))}),t)),t.f=e}function Qc(){}function Rc(){}function Sc(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function Uc(t){var e=t.a.F.a;if(null!=e)K(4),e?(K(10),Vc(t.a,t,!1)):(K(11),Vc(t.a,t,!0));else{t.b=new M(t,void 0,void 0),t.b.h=t.h,e=Wc(e=t.a,e.Y()?t.f:null,t.i),K(4),fc(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&T(e,n,r),dc(t.b,e,!1,t.f)}}function Xc(){this.a=this.b=null}function Yc(){this.a=new Q}function Zc(e){var n=typeof e;return"object"==n&&e||"function"==n?"o"+(e[t]||(e[t]=++da)):n.charAt(0)+e}function $c(t,e){this.b=t,this.a=e}function ad(t){this.g=t||bd,k.PerformanceNavigationTiming?t=0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(k.ka&&k.ka.Da&&k.ka.Da()&&k.ka.Da().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Yc),this.b=null,this.c=[]}g=Ac.prototype,g.add=function(t,e){U(this),this.c=null,t=V(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},g.forEach=function(t,e){U(this),this.a.forEach((function(n,r){la(n,(function(n){t.call(e,n,r,this)}),this)}),this)},g.K=function(){U(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},g.C=function(t){U(this);var e=[];if(m(t))Nc(this,t)&&(e=oa(e,this.a.get(V(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=oa(e,t[n])}return e},g.set=function(t,e){return U(this),this.c=null,Nc(this,t=V(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},g.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},g.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")},x(Rc,Qc),g=Sc.prototype,g.M=null,g.$=function(t){return this.a.$(t)},g.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},g.Ca=function(){return!1},g.Fa=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=hc(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=hc(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void W(e,2)}this.f=r[0]}else(e=this.a).m=this.c,W(e,2)}else 1==this.M&&(this.g?K(6):"11111"==e?(K(5),this.g=!0,(!B||10<=Number(Na))&&(this.c=200,this.b.cancel(),K(11),Vc(this.a,this,!0))):(K(7),this.g=!1))},g.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,Uc(this)):1==this.M&&(this.g?(K(11),Vc(this.a,this,!0)):(K(10),Vc(this.a,this,!1)));else{0==this.M?K(8):1==this.M&&K(9);var t=this.a;t.m=this.c,W(t,2)}},g.Y=function(){return this.a.Y()},g.ma=function(){return this.a.ma()},Yc.prototype.add=function(t){this.a.set(Zc(t),t)},Yc.prototype.C=function(){return this.a.C()};var bd=10;function cd(t,e){!t.a&&(z(e,"spdy")||z(e,"quic")||z(e,"h2"))&&(t.f=t.g,t.a=new Yc,t.b&&(dd(t,t.b),t.b=null))}function ed(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function fd(t){return t.b?1:t.a?t.a.a.c:0}function gd(t,e){return t.b?t=t.b==e:t.a?(e=Zc(e),t=R(t.a.a.b,e)):t=!1,t}function dd(t,e){t.a?t.a.add(e):t.b=e}function hd(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=Zc(e),n=R(t.a.a.b,n)),n&&rc(t.a.a,Zc(e)))}function id(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return la(t.a.C(),(function(t){e=e.concat(t.j)})),e}return pa(t.c)}function jd(){}function kd(){this.a=new jd}function ld(t,e,n){var i=n||"";try{oc(t,(function(t,n){var o=t;r(t)&&(o=ob(t)),e.push(i+n+"="+encodeURIComponent(o))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function md(t,e){var n=new Kb;if(k.Image){var r=new Image;r.onload=v(nd,n,r,"TestLoadImage: loaded",!0,e),r.onerror=v(nd,n,r,"TestLoadImage: error",!1,e),r.onabort=v(nd,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=v(nd,n,r,"TestLoadImage: timeout",!1,e),k.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}function nd(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}ad.prototype.cancel=function(){this.c=id(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(la(this.a.C(),(function(t){t.cancel()})),qc(this.a.a))},jd.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},jd.prototype.parse=function(t){return k.JSON.parse(t,void 0)};var od=k.JSON.parse;function X(t){G.call(this),this.headers=new Q,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=pd,this.D=this.F=!1}x(X,G);var pd="",qd=/^https?$/i,rd=["POST","PUT"];function ud(t){return B&&Ma(9)&&aa(t.timeout)&&void 0!==t.ontimeout}function na(t){return"content-type"==t.toLowerCase()}function sd(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,vd(t),wd(t)}function vd(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function xd(t){if(t.b&&void 0!==goog&&(!t.s[1]||4!=O(t)||2!=t.T()))if(t.l&&4==O(t))Eb(t.Ea,0,t);else if(t.dispatchEvent("readystatechange"),4==O(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(sc)[1]||null;if(!o&&k.self&&k.self.location){var s=k.self.location.protocol;o=s.substr(0,s.length-1)}i=!qd.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<O(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.T()+"]",vd(t)}}finally{wd(t)}}}function wd(t,e){if(t.a){td(t);var n=t.a,r=t.s[0]?ba:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function td(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(k.clearTimeout(t.m),t.m=null)}function O(t){return t.a?t.a.readyState:0}function hc(t,e){return t.a?t.a.getResponseHeader(e):null}function yd(t){var e="";return va(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function zd(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=yd(n),m(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return T(t,e,n),t}function Ad(t){this.f=[],this.F=new Xc,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Qa=this.P=0,this.Oa=!!n("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Na=n("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Ra=n("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Pa=n("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=n("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.Ka=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new ad(t&&t.concurrentRequestLimit),this.ja=new kd,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Bd(t){if(Cd(t),3==t.u){var e=t.P++,n=N(t.B);T(n,"SID",t.H),T(n,"RID",e),T(n,"TYPE","terminate"),Dd(t,n),(e=new M(t,e,void 0)).F=2,e.f=bc(N(n)),n=!1,k.navigator&&k.navigator.sendBeacon&&(n=k.navigator.sendBeacon(e.f.toString(),"")),!n&&k.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=w(),ec(e)}Ed(t)}function Cd(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(k.clearTimeout(t.l),t.l=null),Fd(t),t.b.cancel(),t.h&&(aa(t.h)&&k.clearTimeout(t.h),t.h=null)}function Gd(t,e){t.f.push(new $c(t.Qa++,e)),3==t.u&&Hd(t)}function Hd(t){ed(t.b)||t.h||(t.h=!0,wb(t.Ha,t),t.A=0)}function Id(t,e){return!(fd(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.f=e.j.concat(t.f),!0):!(1==t.u||2==t.u||t.A>=(t.Oa?0:t.Pa))&&(t.h=Ob(u(t.Ha,t,e),Jd(t,t.A)),t.A++,!0))}function Ld(t,e){var n;n=e?e.W:t.P++;var r=N(t.B);T(r,"SID",t.H),T(r,"RID",n),T(r,"AID",t.O),Dd(t,r),t.g&&t.i&&zd(r,t.g,t.i),n=new M(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Kd(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),dd(t.b,n),ac(n,r,e)}function Dd(t,e){t.c&&oc({},(function(t,n){T(e,n,t)}))}function Kd(t,e,n){n=Math.min(t.f.length,n);var r=t.c?u(t.c.Sa,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,c=0;c<n;c++){var h=i[c].b,l=i[c].a;if(0>(h-=o))o=Math.max(0,i[c].b-100),a=!1;else try{ld(l,s,"req"+h+"_")}catch(t){r&&r(l)}}if(a){r=s.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Md(t){t.a||t.l||(t.S=1,wb(t.Ga,t),t.v=0)}function Nd(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=Ob(u(t.Ga,t),Jd(t,t.v)),t.v++,!0)}function Vc(t,e,n){var r=e.l;r&&cd(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=Wc(t,null,t.ha),Hd(t)}function Fd(t){null!=t.s&&(k.clearTimeout(t.s),t.s=null)}function Jd(t,e){var n=t.Na+Math.floor(Math.random()*t.Ra);return t.ma()||(n*=2),n*e}function W(t,e){if(2==e){var n=null;t.c&&(n=null);var r=u(t.eb,t);n||(n=new S("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||uc(n,"https"),bc(n)),md(n.toString(),r)}else K(2);t.u=0,t.c&&t.c.ta(e),Ed(t),Cd(t)}function Ed(t){t.u=0,t.m=-1,t.c&&(0==id(t.b).length&&0==t.f.length||(t.b.c.length=0,pa(t.f),t.f.length=0),t.c.sa())}function Wc(t,e,n){var r=Jc(n);if(""!=r.b)e&&vc(r,e+"."+r.b),wc(r,r.i);else{var i,o=k.location;i=e?e+"."+o.hostname:o.hostname,r=Kc(o.protocol,i,+o.port,n)}return t.V&&va(t.V,(function(t,e){T(r,e,t)})),e=t.j,n=t.I,e&&n&&T(r,e,n),T(r,"VER",t.wa),Dd(t,r),r}function Od(){}function Pd(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];if(0==i.lastIndexOf("/",0))e=i;else(r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i}return e}function Qd(){if(B&&!(10<=Number(Na)))throw Error("Environmental error: no available transport.")}function Y(t,e){G.call(this),this.a=new Ad(e),this.g=t,this.m=e&&e.fb?e.fb:Pd(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!qa(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!qa(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Z(this)}function Rd(t){Ub.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Sd(){Vb.call(this),this.status=1}function Z(t){this.a=t}g=X.prototype,g.ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Sb(this.H):Sb(Wb),this.a.onreadystatechange=u(this.Ea,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void sd(this,t)}t=n||"";var i=new Q(this.headers);r&&oc(r,(function(t,e){i.set(e,t)})),r=ma(i.K()),n=k.FormData&&t instanceof k.FormData,!(0<=ja(rd,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{td(this),0<this.o&&((this.D=ud(this.a))?(this.a.timeout=this.o,this.a.ontimeout=u(this.Ba,this)):this.m=Eb(this.Ba,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){sd(this,t)}},g.Ba=function(){void 0!==goog&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},g.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),wd(this))},g.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),wd(this,!0)),X.N.G.call(this)},g.Ea=function(){this.j||(this.w||this.l||this.g?xd(this):this.Za())},g.Za=function(){xd(this)},g.T=function(){try{return 2<O(this)?this.a.status:-1}catch(t){return-1}},g.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},g.Ua=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),od(e)}},g.ya=function(){return this.h},g.Xa=function(){return m(this.f)?this.f:String(this.f)},g=Ad.prototype,g.wa=8,g.u=1,g.Ca=function(){return 0==this.u},g.Ha=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new M(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?ya(r=wa(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&m(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Kd(this,n,e),T(i=N(this.B),"RID",t),T(i,"CVER",22),this.o&&this.j&&T(i,"X-HTTP-Session-Id",this.j),Dd(this,i),this.g&&r&&zd(i,this.g,r),dd(this.b,n),this.W?(T(i,"$req",e),T(i,"SID","null"),n.S=!0,ac(n,i,null)):ac(n,i,e),this.u=2}}else 3==this.u&&(t?Ld(this,t):0==this.f.length||ed(this.b)||Ld(this))},g.Ga=function(){this.l=null,this.a=new M(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=N(this.pa);T(t,"RID","rpc"),T(t,"SID",this.H),T(t,"CI",this.ia?"0":"1"),T(t,"AID",this.O),Dd(this,t),T(t,"TYPE","xmlhttp"),this.g&&this.i&&zd(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),dc(this.a,t,!0,this.ga)},g.Fa=function(t,e){if(0!=this.u&&(this.a==t||gd(this.b,t)))if(this.m=t.o,!t.s&&gd(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(q(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;Fd(this),this.a.cancel(),this.a=null}Nd(this),K(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=Ob(u(this.Ya,this),6e3));if(1>=fd(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else W(this,11)}else if((t.s||this.a==t)&&Fd(this),!qa(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&aa(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=hc(r,"X-Client-Wire-Protocol"))&&cd(this.b,i),this.j&&(r=hc(r,"X-HTTP-Session-Id")))&&(this.I=r,T(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=Wc(this,this.Y()?this.ga:null,this.ha),r.s?(hd(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(gc(r),ec(r)),this.a=r):Md(this),0<this.f.length&&Hd(this)}else"stop"!=r[0]&&"close"!=r[0]||W(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?W(this,7):Bd(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},g.Ya=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Nd(this),K(19))},g.na=function(t){var e=null;if(this.a==t){Fd(this),this.a=null;var n=2}else{if(!gd(this.b,t))return;e=t.j,hd(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=w()-t.v,I.dispatchEvent(new Nb(I,t.l?t.l.length:0,e,this.A)),Hd(this)):Md(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&Id(this,t)||2==n&&Nd(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:W(this,5);break;case 4:W(this,10);break;case 3:W(this,6);break;default:W(this,2)}}},g.eb=function(t){K(t?2:1)},g.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new X(this.Ka)).F=this.R,t},g.ma=function(){return!!this.c&&!0},g.Y=function(){return this.R},g=Od.prototype,g.va=function(){},g.ua=function(){},g.ta=function(){},g.sa=function(){},g.Sa=function(){},Qd.prototype.a=function(t,e){return new Y(t,e)},x(Y,G),g=Y.prototype,g.addEventListener=function(t,e,n,r){Y.N.addEventListener.call(this,t,e,n,r)},g.removeEventListener=function(t,e,n,r){Y.N.removeEventListener.call(this,t,e,n,r)},g.Va=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;K(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new Sc(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=zd(e,t.g,t.i)),(t=t.w).i=n,e=Wc(t.a,null,t.i),K(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,Uc(t)):(fc(e,"MODE","init"),!t.a.o&&t.a.j&&fc(e,"X-HTTP-Session-Id",t.a.j),t.b=new M(t,void 0,void 0),t.b.h=t.h,dc(t.b,e,!1,null),t.M=0)},g.close=function(){Bd(this.a)},g.Wa=function(t){if(m(t)){var e={};e.__data__=t,Gd(this.a,e)}else this.h?((e={}).__data__=ob(t),Gd(this.a,e)):Gd(this.a,t)},g.G=function(){this.a.c=null,delete this.f,Bd(this.a),delete this.a,Y.N.G.call(this)},x(Rd,Ub),x(Sd,Vb),x(Z,Od),Z.prototype.va=function(){this.a.dispatchEvent("a")},Z.prototype.ua=function(t){this.a.dispatchEvent(new Rd(t))},Z.prototype.ta=function(t){this.a.dispatchEvent(new Sd(t))},Z.prototype.sa=function(){this.a.dispatchEvent("b")};var Td=v((function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r}),Qd);Qd.prototype.createWebChannel=Qd.prototype.a,Y.prototype.send=Y.prototype.Wa,Y.prototype.open=Y.prototype.Va,Y.prototype.close=Y.prototype.close,Pb.NO_ERROR=0,Pb.TIMEOUT=8,Pb.HTTP_ERROR=6,Qb.COMPLETE="complete",Tb.EventType=L,L.OPEN="a",L.CLOSE="b",L.ERROR="c",L.MESSAGE="d",G.prototype.listen=G.prototype.za,X.prototype.listenOnce=X.prototype.Aa,X.prototype.getLastError=X.prototype.Xa,X.prototype.getLastErrorCode=X.prototype.ya,X.prototype.getStatus=X.prototype.T,X.prototype.getResponseJson=X.prototype.Ua,X.prototype.getResponseText=X.prototype.aa,X.prototype.send=X.prototype.ca;var tmp={createWebChannelTransport:Td,ErrorCode:Pb,EventType:Qb,WebChannel:Tb,XhrIo:X},index_cjs$4=createCommonjsModule((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n,r=(n=index_cjs$2)&&"object"==typeof n&&"default"in n?n.default:n,i=r.SDK_VERSION,o=function(){function t(t){this.uid=t}return t.prototype.t=function(){return null!=this.uid},t.prototype.i=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.u=new t("google-credentials-uid"),t.s=new t("first-party-uid"),t}(),s={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},a=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return tslib_es6.__extends(e,t),e}(Error),u=function(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t},c=function(){function t(){this.h=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.l=function(){},t.prototype.v=function(t){Se(!this.h,"Can only call setChangeListener() once."),this.h=t,t(o.UNAUTHENTICATED)},t.prototype.m=function(){Se(null!==this.h,"removeChangeListener() when no listener registered"),this.h=null},t}(),h=function(){function t(t){var e=this;this.p=null,this.currentUser=o.UNAUTHENTICATED,this.g=!1,this._=0,this.h=null,this.forceRefresh=!1,this.p=function(){e._++,e.currentUser=e.I(),e.g=!0,e.h&&e.h(e.currentUser)},this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.p):(this.p(null),t.get().then((function(t){e.auth=t,e.p&&e.auth.addAuthTokenListener(e.p)}),(function(){})))}return t.prototype.getToken=function(){var t=this;Se(null!=this.p,"getToken cannot be called after listener removed.");var e=this._,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t._!==e)throw new a(s.ABORTED,"getToken aborted due to token change.");return n?(Se("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new u(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.l=function(){this.forceRefresh=!0},t.prototype.v=function(t){Se(!this.h,"Can only call setChangeListener() once."),this.h=t,this.g&&t(this.currentUser)},t.prototype.m=function(){Se(null!=this.p,"removeChangeListener() called twice"),Se(null!==this.h,"removeChangeListener() called when no listener registered"),this.auth&&this.auth.removeAuthTokenListener(this.p),this.p=null,this.h=null},t.prototype.I=function(){var t=this.auth&&this.auth.getUid();return Se(null===t||"string"==typeof t,"Received invalid UID: "+t),new o(t)},t}(),l=function(){function t(t,e){this.T=t,this.D=e,this.type="FirstParty",this.user=o.s}return Object.defineProperty(t.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.D},e=this.T.auth.R([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),f=function(){function t(t,e){this.T=t,this.D=e}return t.prototype.getToken=function(){return Promise.resolve(new l(this.T,this.D))},t.prototype.v=function(t){t(o.s)},t.prototype.m=function(){},t.prototype.l=function(){},t}();
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function p(t){if(!t)return new c;switch(t.type){case"gapi":var e=t.S;return Se(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new f(e,t.D||"0");case"provider":return t.S;default:throw new a(s.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var d=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new a(s.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new a(s.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new a(s.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new a(s.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.A=function(t){return this.seconds===t.seconds?ke(this.nanoseconds,t.nanoseconds):ke(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),g=function(){function t(t){this.timestamp=t}return t.C=function(e){var n=Math.floor(e/1e6);return new t(new d(n,e%1e6*1e3))},t.P=function(e){return new t(e)},t.V=function(){return t.MIN},t.prototype.k=function(t){return this.timestamp.A(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.N=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.O=function(){return this.timestamp},t.MIN=new t(new d(0,0)),t}(),m=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Ie("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Ie("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.F(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.U(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.j=function(t){return t=void 0===t?1:t,Se(this.length>=t,"Can't call popFirst() with less segments"),this.U(this.segments,this.offset+t,this.length-t)},t.prototype.L=function(){return Se(!this.M(),"Can't call popLast() on empty path"),this.U(this.segments,this.offset,this.length-1)},t.prototype.q=function(){return Se(!this.M(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.B=function(){return this.get(this.length-1)},t.prototype.get=function(t){return Se(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.M=function(){return 0===this.length},t.prototype.G=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.W=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.K=function(){return this.segments.slice(this.offset,this.limit())},t.F=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),v=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib_es6.__extends(e,t),e.prototype.U=function(t,n,r){return new e(t,n,r)},e.prototype.J=function(){return this.K().join("/")},e.prototype.toString=function(){return this.J()},e.H=function(t){if(t.indexOf("//")>=0)throw new a(s.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter((function(t){return t.length>0})))},e.Y=new e([]),e}(m),y=/^[_a-zA-Z][_a-zA-Z0-9]*$/,b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib_es6.__extends(e,t),e.prototype.U=function(t,n,r){return new e(t,n,r)},e.X=function(t){return y.test(t)},e.prototype.J=function(){return this.K().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.X(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.J()},e.prototype.$=function(){return 1===this.length&&"__name__"===this.get(0)},e.Z=function(){return new e(["__name__"])},e.tt=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new a(s.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},u=!1;i<t.length;){var c=t[i];if("\\"===c){if(i+1===t.length)throw new a(s.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var h=t[i+1];if("\\"!==h&&"."!==h&&"`"!==h)throw new a(s.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,i+=2}else"`"===c?(u=!u,i++):"."!==c||u?(r+=c,i++):(o(),i++)}if(o(),u)throw new a(s.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.Y=new e([]),e}(m),w=function(){function t(e){this.path=e,Se(t.nt(e),"Invalid DocumentKey with an odd number of segments: "+e.K().join("/"))}return t.it=function(e){return new t(v.H(e).j(5))},t.prototype.et=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===v.F(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.F=function(t,e){return v.F(t.path,e.path)},t.nt=function(t){return t.length%2==0},t.rt=function(e){return new t(new v(e.slice()))},t.EMPTY=new t(new v([])),t}(),_=function(){function t(t,e){this.F=t,this.root=e||T.EMPTY}return t.prototype.ut=function(e,n){return new t(this.F,this.root.ut(e,n,this.F).copy(null,null,T.st,null,null))},t.prototype.remove=function(e){return new t(this.F,this.root.remove(e,this.F).copy(null,null,T.st,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.M();){var n=this.F(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.M();){var r=this.F(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.M=function(){return this.root.M()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.ot=function(){return this.root.ot()},t.prototype.ht=function(){return this.root.ht()},t.prototype.ct=function(t){return this.root.ct(t)},t.prototype.forEach=function(t){this.ct((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ct((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.at=function(t){return this.root.at(t)},t.prototype.ft=function(){return new E(this.root,null,this.F,!1)},t.prototype.lt=function(t){return new E(this.root,t,this.F,!1)},t.prototype.dt=function(){return new E(this.root,null,this.F,!0)},t.prototype.vt=function(t){return new E(this.root,t,this.F,!0)},t}(),E=function(){function t(t,e,n,r){this.wt=r,this.pt=[];for(var i=1;!t.M();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.pt.push(t);break}this.pt.push(t),t=this.wt?t.right:t.left}}return t.prototype.bt=function(){Se(this.pt.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.pt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.M();)this.pt.push(t),t=t.right;else for(t=t.right;!t.M();)this.pt.push(t),t=t.left;return e},t.prototype.gt=function(){return this.pt.length>0},t.prototype.yt=function(){if(0===this.pt.length)return null;var t=this.pt[this.pt.length-1];return{key:t.key,value:t.value}},t}(),T=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.M=function(){return!1},t.prototype.ct=function(t){return this.left.ct(t)||t(this.key,this.value)||this.right.ct(t)},t.prototype.at=function(t){return this.right.at(t)||t(this.key,this.value)||this.left.at(t)},t.prototype.min=function(){return this.left.M()?this:this.left.min()},t.prototype.ot=function(){return this.min().key},t.prototype.ht=function(){return this.right.M()?this.key:this.right.ht()},t.prototype.ut=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.ut(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ut(t,e,n)))._t()},t.prototype.It=function(){if(this.left.M())return t.EMPTY;var e=this;return e.left.Tt()||e.left.left.Tt()||(e=e.Et()),(e=e.copy(null,null,null,e.left.It(),null))._t()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.M()||i.left.Tt()||i.left.left.Tt()||(i=i.Et()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.Tt()&&(i=i.Dt()),i.right.M()||i.right.Tt()||i.right.left.Tt()||(i=i.Rt()),0===n(e,i.key)){if(i.right.M())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.It())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i._t()},t.prototype.Tt=function(){return this.color},t.prototype._t=function(){var t=this;return t.right.Tt()&&!t.left.Tt()&&(t=t.St()),t.left.Tt()&&t.left.left.Tt()&&(t=t.Dt()),t.left.Tt()&&t.right.Tt()&&(t=t.At()),t},t.prototype.Et=function(){var t=this.At();return t.right.left.Tt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Dt())).St()).At()),t},t.prototype.Rt=function(){var t=this.At();return t.left.left.Tt()&&(t=(t=t.Dt()).At()),t},t.prototype.St=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Dt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.At=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Ct=function(){var t=this.Pt();return Math.pow(2,t)<=this.size+1},t.prototype.Pt=function(){if(this.Tt()&&this.left.Tt())throw Ie("Red node has red child("+this.key+","+this.value+")");if(this.right.Tt())throw Ie("Right child of ("+this.key+","+this.value+") is red");var t=this.left.Pt();if(t!==this.right.Pt())throw Ie("Black depths differ");return t+(this.Tt()?0:1)},t.EMPTY=null,t.RED=!0,t.st=!1,t}(),I=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Ie("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Ie("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Ie("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Ie("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Ie("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.ut=function(t,e,n){return new T(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.M=function(){return!0},t.prototype.ct=function(t){return!1},t.prototype.at=function(t){return!1},t.prototype.ot=function(){return null},t.prototype.ht=function(){return null},t.prototype.Tt=function(){return!1},t.prototype.Ct=function(){return!0},t.prototype.Pt=function(){return 0},t}();T.EMPTY=new I;
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var S=function(){function t(t){this.F=t,this.data=new _(this.F)}return t.Vt=function(e){var n=new t(e.F);return e.forEach((function(t){n=n.add(t)})),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.ot()},t.prototype.last=function(){return this.data.ht()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ct((function(e,n){return t(e),!1}))},t.prototype.kt=function(t,e){for(var n=this.data.lt(t[0]);n.gt();){var r=n.bt();if(this.F(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Nt=function(t,e){var n;for(n=void 0!==e?this.data.lt(e):this.data.ft();n.gt();)if(!t(n.bt().key))return},t.prototype.Ot=function(t){var e=this.data.lt(t);return e.gt()?e.bt().key:null},t.prototype.ft=function(){return new A(this.data.ft())},t.prototype.lt=function(t){return new A(this.data.lt(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).ut(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.M=function(){return this.data.M()},t.prototype.Ft=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.ft(),r=e.data.ft();n.gt();){var i=n.bt().key,o=r.bt().key;if(0!==this.F(i,o))return!1}return!0},t.prototype.K=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.F);return n.data=e,n},t}(),A=function(){function t(t){this.Ut=t}return t.prototype.bt=function(){return this.Ut.bt().key},t.prototype.gt=function(){return this.Ut.gt()},t}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function k(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function x(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function N(t){for(var e in Se(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var R=function(){function t(t){this.jt=t}return t.fromBase64String=function(e){return new t(ve.xt().atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return ve.xt().btoa(this.jt)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(this.jt)},t.prototype.Lt=function(){return 2*this.jt.length},t.prototype.k=function(t){return ke(this.jt,t.jt)},t.prototype.isEqual=function(t){return this.jt===t.jt},t.Mt=new t(""),t}();function O(t){return null==t}function C(t){return-0===t&&1/t==-1/0}function D(t){return"number"==typeof t&&Number.isInteger(t)&&!C(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function L(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function $(t){var e=V(t.mapValue.fields.__local_write_time__.timestampValue);return new d(e.seconds,e.nanos)}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var P=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function M(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?L(t)?4:10:Ie("Invalid value type: "+JSON.stringify(t))}function j(t,e){var n=M(t);if(n!==M(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return $(t).isEqual($(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=V(t.timestampValue),r=V(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return z(t.bytesValue).isEqual(z(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return G(t.geoPointValue.latitude)===G(e.geoPointValue.latitude)&&G(t.geoPointValue.longitude)===G(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return G(t.integerValue)===G(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=G(t.doubleValue),r=G(e.doubleValue);return n===r?C(n)===C(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return xe(t.arrayValue.values||[],e.arrayValue.values||[],j);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(k(n)!==k(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!j(n[i],r[i])))return!1;return!0}(t,e);default:return Ie("Unexpected value type: "+JSON.stringify(t))}}function B(t,e){return void 0!==(t.values||[]).find((function(t){return j(t,e)}))}function F(t,e){var n=M(t),r=M(e);if(n!==r)return ke(n,r);switch(n){case 0:return 0;case 1:return ke(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=G(t.integerValue||t.doubleValue),r=G(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return U(t.timestampValue,e.timestampValue);case 4:return U($(t),$(e));case 5:return ke(t.stringValue,e.stringValue);case 6:return function(t,e){var n=z(t),r=z(e);return n.k(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ke(n[i],r[i]);if(0!==o)return o}return ke(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=ke(G(t.latitude),G(e.latitude));return 0!==n?n:ke(G(t.longitude),G(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=F(n[i],r[i]);if(o)return o}return ke(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=ke(r[s],o[s]);if(0!==a)return a;var u=F(n[r[s]],i[o[s]]);if(0!==u)return u}return ke(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Ie("Invalid value type: "+n)}}function U(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ke(t,e);var n=V(t),r=V(e),i=ke(n.seconds,r.seconds);return 0!==i?i:ke(n.nanos,r.nanos)}function q(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(i=e.timestampValue,"time("+(o=V(i)).seconds+","+o.nanos+")"):"stringValue"in e?e.stringValue:"bytesValue"in e?z(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,w.it(r).toString()):"geoPointValue"in e?"geo("+(n=e.geoPointValue).latitude+","+n.longitude+")":"arrayValue"in e?function(e){for(var n="[",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=t(s)}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Ie("Invalid value type: "+JSON.stringify(e));var n,r,i,o}(t)}function V(t){if(Se(!!t,"Cannot normalize null or undefined timestamp."),"string"==typeof t){var e=0,n=P.exec(t);if(Se(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:G(t.seconds),nanos:e=G(t.nanos)}}function G(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function z(t){return"string"==typeof t?R.fromBase64String(t):R.fromUint8Array(t)}function W(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.J()}}function H(t){return!!t&&"integerValue"in t}function Y(t){return H(t)||function(t){return!!t&&"doubleValue"in t}(t)}function Q(t){return!!t&&"arrayValue"in t}function K(t){return!!t&&"referenceValue"in t}function J(t){return!!t&&"nullValue"in t}function X(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Z(t){return!!t&&"mapValue"in t}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var tt=function(){function t(){}return t.prototype.qt=function(t,e){return function(t,e){var n,r={fields:(n={},n.__type__={stringValue:"server_timestamp"},n.__local_write_time__={timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}},n)};return e&&(r.fields.__previous_value__=e),{mapValue:r}}(e,t)},t.prototype.Bt=function(t,e){return e},t.prototype.Qt=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),et=function(){function t(t){this.elements=t}return t.prototype.qt=function(t,e){return this.apply(t)},t.prototype.Bt=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=it(t),n=function(t){e.some((function(e){return j(e,t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return{arrayValue:{values:e}}},t.prototype.Qt=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&xe(this.elements,e.elements,j)},t}(),nt=function(){function t(t){this.elements=t}return t.prototype.qt=function(t,e){return this.apply(t)},t.prototype.Bt=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=it(t),n=function(t){e=e.filter((function(e){return!j(e,t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return{arrayValue:{values:e}}},t.prototype.Qt=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&xe(this.elements,e.elements,j)},t}(),rt=function(){function t(t,e){this.serializer=t,this.Gt=e,Se(Y(e),"NumericIncrementTransform transform requires a NumberValue")}return t.prototype.qt=function(t,e){var n=this.Qt(t),r=this.asNumber(n)+this.asNumber(this.Gt);return H(n)&&H(this.Gt)?this.serializer.Wt(r):this.serializer.zt(r)},t.prototype.Bt=function(t,e){return Se(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.Qt=function(t){return Y(t)?t:{integerValue:0}},t.prototype.isEqual=function(e){return e instanceof t&&j(this.Gt,e.Gt)},t.prototype.asNumber=function(t){return G(t.integerValue||t.doubleValue)},t}();function it(t){return Q(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var ot,st,at=function(){function t(t){this.fields=t}return t.Kt=function(e){return new t(e)},t.Jt=function(e){var n=new S(b.F);return e.forEach((function(t){return n=n.add(t)})),new t(n)},t.prototype.Ht=function(t){var e=!1;return this.fields.forEach((function(n){n.G(t)&&(e=!0)})),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),ut=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),ct=function(t,e){this.version=t,this.transformResults=e},ht=function(){function t(t,e){this.updateTime=t,this.exists=e,Se(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"Yt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.Xt=function(t){return void 0!==this.updateTime?t instanceof wt&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof wt:(Se(this.Yt,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,!((null!=e?!n||!e.isEqual(n):e!==n)||this.exists!==t.exists);var e,n},t.NONE=new t,t}(),lt=function(){function t(){}return t.prototype.$t=function(t){null!=t&&Se(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.Zt=function(t){return t instanceof wt?t.version:g.MIN},t}(),ft=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.tn=r,i.type=0,i}return tslib_es6.__extends(e,t),e.prototype.Bt=function(t,e){this.$t(t),Se(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new wt(this.key,n,this.value,{hasCommittedMutations:!0})},e.prototype.qt=function(t,e,n){if(this.$t(t),!this.tn.Xt(t))return t;var r=lt.Zt(t);return new wt(this.key,r,this.value,{nn:!0})},e.prototype.in=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.tn.isEqual(t.tn)},e}(lt),pt=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.en=r,o.tn=i,o.type=1,o}return tslib_es6.__extends(e,t),e.prototype.Bt=function(t,e){if(this.$t(t),Se(null==e.transformResults,"Transform results received by PatchMutation."),!this.tn.Xt(t))return new Et(this.key,e.version);var n=this.rn(t);return new wt(this.key,e.version,n,{hasCommittedMutations:!0})},e.prototype.qt=function(t,e,n){if(this.$t(t),!this.tn.Xt(t))return t;var r=lt.Zt(t),i=this.rn(t);return new wt(this.key,r,i,{nn:!0})},e.prototype.in=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.en.isEqual(t.en)&&this.tn.isEqual(t.tn)},e.prototype.rn=function(t){var e;return e=t instanceof wt?t.data():vt.EMPTY,this.un(e)},e.prototype.un=function(t){var e=this,n=t.sn();return this.en.fields.forEach((function(t){if(!t.M()){var r=e.data.field(t);null!==r?n.set(t,r):n.delete(t)}})),n.on()},e}(lt),dt=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=2,r.tn=ht.exists(!0),r}return tslib_es6.__extends(e,t),e.prototype.Bt=function(t,e){if(this.$t(t),Se(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.tn.Xt(t))return new Et(this.key,e.version);var n=this.hn(t),r=this.cn(t,e.transformResults),i=e.version,o=this.an(n.data(),r);return new wt(this.key,i,o,{hasCommittedMutations:!0})},e.prototype.qt=function(t,e,n){if(this.$t(t),!this.tn.Xt(t))return t;var r=this.hn(t),i=this.fn(n,t,e),o=this.an(r.data(),i);return new wt(this.key,r.version,o,{nn:!0})},e.prototype.in=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof wt?t.field(i.field):void 0,s=i.transform.Qt(o||null);null!=s&&(e=null==e?vt.ln().set(i.field,s):e.set(i.field,s))}return e?e.on():null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&xe(this.fieldTransforms,t.fieldTransforms,(function(t,e){return t.isEqual(e)}))&&this.tn.isEqual(t.tn)},e.prototype.hn=function(t){return Se(t instanceof wt,"Unknown MaybeDocument type "+t),Se(t.key.isEqual(this.key),"Can only transform a document with the same key"),t},e.prototype.cn=function(t,e){var n=[];Se(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof wt&&(s=t.field(i.field)),n.push(o.Bt(s,e[r]))}return n},e.prototype.fn=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],a=s.transform,u=null;e instanceof wt&&(u=e.field(s.field)),null===u&&n instanceof wt&&(u=n.field(s.field)),r.push(a.qt(u,t))}return r},e.prototype.an=function(t,e){Se(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=t.sn(),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.on()},e}(lt),gt=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.tn=n,r.type=3,r}return tslib_es6.__extends(e,t),e.prototype.Bt=function(t,e){return this.$t(t),Se(null==e.transformResults,"Transform results received by DeleteMutation."),new _t(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.qt=function(t,e,n){return this.$t(t),this.tn.Xt(t)?(t&&Se(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new _t(this.key,g.V())):t},e.prototype.in=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.tn.isEqual(t.tn)},e}(lt),mt=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.tn=n,r.type=4,r}return tslib_es6.__extends(e,t),e.prototype.Bt=function(t,e){Ie("VerifyMutation should only be used in Transactions.")},e.prototype.qt=function(t,e,n){Ie("VerifyMutation should only be used in Transactions.")},e.prototype.in=function(t){Ie("VerifyMutation should only be used in Transactions.")},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.tn.isEqual(t.tn)},e}(lt),vt=function(){function t(t){this.proto=t,Se(!L(t),"ServerTimestamps should be converted to ServerTimestampValue")}return t.ln=function(){return t.EMPTY.sn()},t.prototype.field=function(t){if(t.M())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Z(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.B()])||null},t.prototype.en=function(){return this.dn(this.proto.mapValue)},t.prototype.dn=function(t){var e=this,n=new S(b.F);return x(t.fields||{},(function(t,r){var i=new b([t]);if(10===M(r)){var o=e.dn(r.mapValue).fields;o.M()?n=n.add(i):o.forEach((function(t){n=n.add(i.child(t))}))}else n=n.add(i)})),at.Kt(n)},t.prototype.isEqual=function(t){return j(this.proto,t.proto)},t.prototype.sn=function(){return new yt(this)},t.EMPTY=new t({mapValue:{}}),t}(),yt=function(){function t(t){this.vn=t,this.wn=new Map}return t.prototype.set=function(t,e){return Se(!t.M(),"Cannot set field for empty path on ObjectValue"),this.mn(t,e),this},t.prototype.delete=function(t){return Se(!t.M(),"Cannot delete field for empty path on ObjectValue"),this.mn(t,null),this},t.prototype.mn=function(t,e){for(var n=this.wn,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===M(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.B(),e)},t.prototype.on=function(){var t=this.pn(b.Y,this.wn);return null!=t?new vt(t):this.vn},t.prototype.pn=function(t,e){var n=this,r=!1,i=this.vn.field(t),o=Z(i)?tslib_es6.__assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.pn(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}(),bt=function(){function t(t,e){this.key=t,this.version=e}return t.bn=function(t,e){return w.F(t.key,e.key)},t}(),wt=function(t){function e(e,n,r,i){var o=t.call(this,e,n)||this;return o.gn=r,o.nn=!!i.nn,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return tslib_es6.__extends(e,t),e.prototype.field=function(t){return this.gn.field(t)},e.prototype.data=function(){return this.gn},e.prototype.yn=function(){return this.gn.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.nn===t.nn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.gn.isEqual(t.gn)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.gn.toString()+", {hasLocalMutations: "+this.nn+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.nn||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e._n=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?F(r,i):Ie("Trying to compare documents on fields that don't exist")},e}(bt),_t=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return tslib_es6.__extends(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(bt),Et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib_es6.__extends(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(bt),Tt=function(){function t(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.In=null}return t.prototype.canonicalId=function(){if(null===this.In){var t=this.path.J();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map((function(t){return t.canonicalId()})).join(","),t+="|ob:",t+=this.orderBy.map((function(t){return t.canonicalId()})).join(","),O(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.In=t}return this.In},t.prototype.toString=function(){var t=this.path.J();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),O(this.limit)||(t+=", limit: "+this.limit),this.orderBy.length>0&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},t.prototype.Tn=function(){return w.nt(this.path)&&null===this.collectionGroup&&0===this.filters.length},t}(),It=function(){function t(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.En=n,this.filters=r,this.limit=i,this.Dn=o,this.startAt=s,this.endAt=a,this.Rn=null,this.Sn=null,this.startAt&&this.An(this.startAt),this.endAt&&this.An(this.endAt)}return t.Cn=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.Rn){var t=this.Pn(),e=this.Vn();if(null!==t&&null===e)t.$()?this.Rn=[$t]:this.Rn=[new Lt(t),$t];else{Se(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.Rn=[];for(var n=!1,r=0,i=this.En;r<i.length;r++){var o=i[r];this.Rn.push(o),o.field.$()&&(n=!0)}if(!n){var s=this.En.length>0?this.En[this.En.length-1].dir:Ct.ASCENDING;this.Rn.push(s===Ct.ASCENDING?$t:Pt)}}}return this.Rn},enumerable:!0,configurable:!0}),t.prototype.kn=function(e){Se(null==this.Pn()||!(e instanceof At)||!e.Nn()||e.field.isEqual(this.Pn()),"Query must only have one inequality field."),Se(!this.Tn(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.En.slice(),n,this.limit,this.Dn,this.startAt,this.endAt)},t.prototype.On=function(e){Se(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.En.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.Dn,this.startAt,this.endAt)},t.prototype.Fn=function(e){return new t(this.path,this.collectionGroup,this.En.slice(),this.filters.slice(),e,"F",this.startAt,this.endAt)},t.prototype.Un=function(e){return new t(this.path,this.collectionGroup,this.En.slice(),this.filters.slice(),e,"L",this.startAt,this.endAt)},t.prototype.jn=function(e){return new t(this.path,this.collectionGroup,this.En.slice(),this.filters.slice(),this.limit,this.Dn,e,this.endAt)},t.prototype.xn=function(e){return new t(this.path,this.collectionGroup,this.En.slice(),this.filters.slice(),this.limit,this.Dn,this.startAt,e)},t.prototype.Ln=function(e){return new t(e,null,this.En.slice(),this.filters.slice(),this.limit,this.Dn,this.startAt,this.endAt)},t.prototype.Mn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.En.length||1===this.En.length&&this.En[0].field.$())},t.prototype.canonicalId=function(){return this.qn().canonicalId()+"|lt:"+this.Dn},t.prototype.toString=function(){return"Query(target="+this.qn().toString()+"; limitType="+this.Dn+")"},t.prototype.isEqual=function(t){return this.qn().isEqual(t.qn())&&this.Dn===t.Dn},t.prototype.Bn=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.$()}return Se(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.Qn(t)&&this.Gn(t)&&this.Wn(t)&&this.zn(t)},t.prototype.Kn=function(){return!O(this.limit)&&"F"===this.Dn},t.prototype.Jn=function(){return!O(this.limit)&&"L"===this.Dn},t.prototype.Vn=function(){return this.En.length>0?this.En[0].field:null},t.prototype.Pn=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof At&&n.Nn())return n.field}return null},t.prototype.Hn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof At&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.Tn=function(){return this.qn().Tn()},t.prototype.Yn=function(){return null!==this.collectionGroup},t.prototype.qn=function(){if(!this.Sn)if("F"===this.Dn)this.Sn=new Tt(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i=r.dir===Ct.DESCENDING?Ct.ASCENDING:Ct.DESCENDING;t.push(new Lt(r.field,i))}var o=this.endAt?new Dt(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Dt(this.startAt.position,!this.startAt.before):null;this.Sn=new Tt(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Sn},t.prototype.Qn=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.et(this.collectionGroup)&&this.path.G(e):w.nt(this.path)?this.path.isEqual(e):this.path.W(e)},t.prototype.Gn=function(t){for(var e=0,n=this.En;e<n.length;e++){var r=n[e];if(!r.field.$()&&null===t.field(r.field))return!1}return!0},t.prototype.Wn=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},t.prototype.zn=function(t){return!(this.startAt&&!this.startAt.Xn(this.orderBy,t)||this.endAt&&this.endAt.Xn(this.orderBy,t))},t.prototype.An=function(t){Se(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),St=function(){function t(t){this.name=t}return t.H=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return Ie("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),At=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return tslib_es6.__extends(e,t),e.create=function(t,n,r){if(t.$())return n===St.IN?(Se(Q(r),"Comparing on key with IN, but filter value not an ArrayValue"),Se((r.arrayValue.values||[]).every((function(t){return K(t)})),"Comparing on key with IN, but an array value was not a RefValue"),new xt(t,r)):(Se(K(r),"Comparing on key, but filter value not a RefValue"),Se(n!==St.ARRAY_CONTAINS&&n!==St.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new kt(t,n,r));if(J(r)){if(n!==St.EQUAL)throw new a(s.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(X(r)){if(n!==St.EQUAL)throw new a(s.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===St.ARRAY_CONTAINS?new Nt(t,r):n===St.IN?(Se(Q(r),"IN filter has invalid value: "+r.toString()),new Rt(t,r)):n===St.ARRAY_CONTAINS_ANY?(Se(Q(r),"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new Ot(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&M(this.value)===M(e)&&this.$n(F(e,this.value))},e.prototype.$n=function(t){switch(this.op){case St.LESS_THAN:return t<0;case St.LESS_THAN_OR_EQUAL:return t<=0;case St.EQUAL:return 0===t;case St.GREATER_THAN:return t>0;case St.GREATER_THAN_OR_EQUAL:return t>=0;default:return Ie("Unknown FieldFilter operator: "+this.op)}},e.prototype.Nn=function(){return[St.LESS_THAN,St.LESS_THAN_OR_EQUAL,St.GREATER_THAN,St.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.J()+this.op.toString()+q(this.value)},e.prototype.isEqual=function(t){return t instanceof e&&this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&j(this.value,t.value)},e.prototype.toString=function(){return this.field.J()+" "+this.op+" "+q(this.value)},e}((function(){})),kt=function(t){function e(e,n,r){var i=t.call(this,e,n,r)||this;return Se(K(r),"KeyFieldFilter expects a ReferenceValue"),i.key=w.it(r.referenceValue),i}return tslib_es6.__extends(e,t),e.prototype.matches=function(t){var e=w.F(t.key,this.key);return this.$n(e)},e}(At),xt=function(t){function e(e,n){var r=t.call(this,e,St.IN,n)||this;return Se(Q(n),"KeyFieldInFilter expects an ArrayValue"),r.keys=(n.arrayValue.values||[]).map((function(t){return Se(K(t),"Comparing on key with IN, but an array value was not a ReferenceValue"),w.it(t.referenceValue)})),r}return tslib_es6.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(At),Nt=function(t){function e(e,n){return t.call(this,e,St.ARRAY_CONTAINS,n)||this}return tslib_es6.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return Q(e)&&B(e.arrayValue,this.value)},e}(At),Rt=function(t){function e(e,n){var r=t.call(this,e,St.IN,n)||this;return Se(Q(n),"InFilter expects an ArrayValue"),r}return tslib_es6.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&B(this.value.arrayValue,e)},e}(At),Ot=function(t){function e(e,n){var r=t.call(this,e,St.ARRAY_CONTAINS_ANY,n)||this;return Se(Q(n),"ArrayContainsAnyFilter expects an ArrayValue"),r}return tslib_es6.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!Q(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return B(e.value.arrayValue,t)}))},e}(At),Ct=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),Dt=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map((function(t){return q(t)})).join(",")},t.prototype.Xn=function(t,e){Se(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.$())Se(K(o),"Bound has a non-key value where the key path is being used."),n=w.F(w.it(o.referenceValue),e.key);else{var s=e.field(i.field);Se(null!==s,"Field should exist since document matched the orderBy already."),n=F(o,s)}if(i.dir===Ct.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!j(this.position[e],t.position[e]))return!1;return!0},t}(),Lt=function(){function t(t,e){this.field=t,void 0===e&&(e=Ct.ASCENDING),this.dir=e,this.Zn=t.$()}return t.prototype.compare=function(t,e){var n=this.Zn?wt.bn(t,e):wt._n(this.field,t,e);switch(this.dir){case Ct.ASCENDING:return n;case Ct.DESCENDING:return-1*n;default:return Ie("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.J()+this.dir.toString()},t.prototype.toString=function(){return this.field.J()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),$t=new Lt(b.Z(),Ct.ASCENDING),Pt=new Lt(b.Z(),Ct.DESCENDING),Mt=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=g.MIN),void 0===o&&(o=g.MIN),void 0===s&&(s=R.Mt),this.target=t,this.targetId=e,this.ti=n,this.sequenceNumber=r,this.ni=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.ii=function(e){return new t(this.target,this.targetId,this.ti,e,this.ni,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.ei=function(e,n){return new t(this.target,this.targetId,this.ti,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.ri=function(e){return new t(this.target,this.targetId,this.ti,this.sequenceNumber,this.ni,e,this.resumeToken)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.ti===t.ti&&this.sequenceNumber===t.sequenceNumber&&this.ni.isEqual(t.ni)&&this.lastLimboFreeSnapshotVersion.isEqual(t.lastLimboFreeSnapshotVersion)&&this.resumeToken.isEqual(t.resumeToken)&&this.target.isEqual(t.target)},t}(),jt=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}();function Bt(t){switch(t){case s.OK:return Ie("Treated status OK as error");case s.CANCELLED:case s.UNKNOWN:case s.DEADLINE_EXCEEDED:case s.RESOURCE_EXHAUSTED:case s.INTERNAL:case s.UNAVAILABLE:case s.UNAUTHENTICATED:return!1;case s.INVALID_ARGUMENT:case s.NOT_FOUND:case s.ALREADY_EXISTS:case s.PERMISSION_DENIED:case s.FAILED_PRECONDITION:case s.ABORTED:case s.OUT_OF_RANGE:case s.UNIMPLEMENTED:case s.DATA_LOSS:return!0;default:return Ie("Unknown status code: "+t)}}function Ft(t){if(void 0===t)return Ee("GRPC error has no .code"),s.UNKNOWN;switch(t){case ot.OK:return s.OK;case ot.CANCELLED:return s.CANCELLED;case ot.UNKNOWN:return s.UNKNOWN;case ot.DEADLINE_EXCEEDED:return s.DEADLINE_EXCEEDED;case ot.RESOURCE_EXHAUSTED:return s.RESOURCE_EXHAUSTED;case ot.INTERNAL:return s.INTERNAL;case ot.UNAVAILABLE:return s.UNAVAILABLE;case ot.UNAUTHENTICATED:return s.UNAUTHENTICATED;case ot.INVALID_ARGUMENT:return s.INVALID_ARGUMENT;case ot.NOT_FOUND:return s.NOT_FOUND;case ot.ALREADY_EXISTS:return s.ALREADY_EXISTS;case ot.PERMISSION_DENIED:return s.PERMISSION_DENIED;case ot.FAILED_PRECONDITION:return s.FAILED_PRECONDITION;case ot.ABORTED:return s.ABORTED;case ot.OUT_OF_RANGE:return s.OUT_OF_RANGE;case ot.UNIMPLEMENTED:return s.UNIMPLEMENTED;case ot.DATA_LOSS:return s.DATA_LOSS;default:return Ie("Unknown status code: "+t)}}(st=ot||(ot={}))[st.OK=0]="OK",st[st.CANCELLED=1]="CANCELLED",st[st.UNKNOWN=2]="UNKNOWN",st[st.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",st[st.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",st[st.NOT_FOUND=5]="NOT_FOUND",st[st.ALREADY_EXISTS=6]="ALREADY_EXISTS",st[st.PERMISSION_DENIED=7]="PERMISSION_DENIED",st[st.UNAUTHENTICATED=16]="UNAUTHENTICATED",st[st.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",st[st.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",st[st.ABORTED=10]="ABORTED",st[st.OUT_OF_RANGE=11]="OUT_OF_RANGE",st[st.UNIMPLEMENTED=12]="UNIMPLEMENTED",st[st.INTERNAL=13]="INTERNAL",st[st.UNAVAILABLE=14]="UNAVAILABLE",st[st.DATA_LOSS=15]="DATA_LOSS";
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
var Ut=new _(w.F);function qt(){return Ut}function Vt(){return qt()}var Gt=new _(w.F);function zt(){return Gt}var Wt=new _(w.F);function Ht(){return Wt}var Yt=new S(w.F);function Qt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Yt,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Kt=new S(ke);function Jt(){return Kt}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Xt=function(){function t(t){this.F=t?function(e,n){return t(e,n)||w.F(e.key,n.key)}:function(t,e){return w.F(t.key,e.key)},this.ui=zt(),this.si=new _(this.F)}return t.oi=function(e){return new t(e.F)},t.prototype.has=function(t){return null!=this.ui.get(t)},t.prototype.get=function(t){return this.ui.get(t)},t.prototype.first=function(){return this.si.ot()},t.prototype.last=function(){return this.si.ht()},t.prototype.M=function(){return this.si.M()},t.prototype.indexOf=function(t){var e=this.ui.get(t);return e?this.si.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.si.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.si.ct((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.ui.ut(t.key,t),e.si.ut(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.ui.remove(t),this.si.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.si.ft(),r=e.si.ft();n.gt();){var i=n.bt().key,o=r.bt().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.F=this.F,r.ui=e,r.si=n,r},t}(),Zt=function(){function t(){this.hi=new _(w.F)}return t.prototype.track=function(t){var e=t.doc.key,n=this.hi.get(e);n?0!==t.type&&3===n.type?this.hi=this.hi.ut(e,t):3===t.type&&1!==n.type?this.hi=this.hi.ut(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.hi=this.hi.ut(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.hi=this.hi.ut(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.hi=this.hi.remove(e):1===t.type&&2===n.type?this.hi=this.hi.ut(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.hi=this.hi.ut(e,{type:2,doc:t.doc}):Ie("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.hi=this.hi.ut(e,t)},t.prototype.ci=function(){var t=[];return this.hi.ct((function(e,n){t.push(n)})),t},t}(),te=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.ai=n,this.docChanges=r,this.fi=i,this.fromCache=o,this.li=s,this.di=a}return t.vi=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Xt.oi(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.fi.M()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.li===t.li&&this.fi.isEqual(t.fi)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ai.isEqual(t.ai)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),ee=function(){function t(t,e,n,r,i){this.ni=t,this.wi=e,this.mi=n,this.pi=r,this.bi=i}return t.gi=function(e,n){var r=new Map;return r.set(e,ne.yi(e,n)),new t(g.MIN,r,Jt(),qt(),Qt())},t}(),ne=function(){function t(t,e,n,r,i){this.resumeToken=t,this._i=e,this.Ii=n,this.Ti=r,this.Ei=i}return t.yi=function(e,n){return new t(R.Mt,n,Qt(),Qt(),Qt())},t}(),re=function(t,e,n,r){this.Di=t,this.removedTargetIds=e,this.key=n,this.Ri=r},ie=function(t,e){this.targetId=t,this.Si=e},oe=function(t,e,n,r){void 0===n&&(n=R.Mt),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},se=function(){function t(){this.Ai=0,this.Ci=ce(),this.Pi=R.Mt,this.Vi=!1,this.ki=!0}return Object.defineProperty(t.prototype,"_i",{get:function(){return this.Vi},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.Pi},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Ni",{get:function(){return 0!==this.Ai},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Oi",{get:function(){return this.ki},enumerable:!0,configurable:!0}),t.prototype.Fi=function(t){t.Lt()>0&&(this.ki=!0,this.Pi=t)},t.prototype.Ui=function(){var t=Qt(),e=Qt(),n=Qt();return this.Ci.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ie("Encountered invalid change type: "+i)}})),new ne(this.Pi,this.Vi,t,e,n)},t.prototype.ji=function(){this.ki=!1,this.Ci=ce()},t.prototype.xi=function(t,e){this.ki=!0,this.Ci=this.Ci.ut(t,e)},t.prototype.Li=function(t){this.ki=!0,this.Ci=this.Ci.remove(t)},t.prototype.Mi=function(){this.Ai+=1},t.prototype.qi=function(){this.Ai-=1},t.prototype.Bi=function(){this.ki=!0,this.Vi=!0},t}(),ae=function(){function t(t){this.Qi=t,this.Gi=new Map,this.Wi=qt(),this.zi=ue(),this.Ki=new S(ke)}return t.prototype.Ji=function(t){for(var e=0,n=t.Di;e<n.length;e++){var r=n[e];t.Ri instanceof wt?this.Hi(r,t.Ri):t.Ri instanceof _t&&this.Yi(r,t.key,t.Ri)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.Yi(r,t.key,t.Ri)},t.prototype.Xi=function(t){var e=this;this.$i(t,(function(n){var r=e.Zi(n);switch(t.state){case 0:e.te(n)&&r.Fi(t.resumeToken);break;case 1:r.qi(),r.Ni||r.ji(),r.Fi(t.resumeToken);break;case 2:r.qi(),r.Ni||e.removeTarget(n),Se(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case 3:e.te(n)&&(r.Bi(),r.Fi(t.resumeToken));break;case 4:e.te(n)&&(e.ne(n),r.Fi(t.resumeToken));break;default:Ie("Unknown target watch change state: "+t.state)}}))},t.prototype.$i=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Gi.forEach((function(t,n){return e(n)}))},t.prototype.ie=function(t){var e=t.targetId,n=t.Si.count,r=this.ee(e);if(r){var i=r.target;if(i.Tn())if(0===n){var o=new w(i.path);this.Yi(e,o,new _t(o,g.V()))}else Se(1===n,"Single document existence filter with count: "+n);else this.re(e)!==n&&(this.ne(e),this.Ki=this.Ki.add(e))}},t.prototype.ue=function(t){var e=this,n=new Map;this.Gi.forEach((function(r,i){var o=e.ee(i);if(o){if(r._i&&o.target.Tn()){var s=new w(o.target.path);null!==e.Wi.get(s)||e.se(i,s)||e.Yi(i,s,new _t(s,t))}r.Oi&&(n.set(i,r.Ui()),r.ji())}}));var r=Qt();this.zi.forEach((function(t,n){var i=!0;n.Nt((function(t){var n=e.ee(t);return!n||2===n.ti||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new ee(t,n,this.Ki,this.Wi,r);return this.Wi=qt(),this.zi=ue(),this.Ki=new S(ke),i},t.prototype.Hi=function(t,e){if(this.te(t)){var n=this.se(t,e.key)?2:0;this.Zi(t).xi(e.key,n),this.Wi=this.Wi.ut(e.key,e),this.zi=this.zi.ut(e.key,this.oe(e.key).add(t))}},t.prototype.Yi=function(t,e,n){if(this.te(t)){var r=this.Zi(t);this.se(t,e)?r.xi(e,1):r.Li(e),this.zi=this.zi.ut(e,this.oe(e).delete(t)),n&&(this.Wi=this.Wi.ut(e,n))}},t.prototype.removeTarget=function(t){this.Gi.delete(t)},t.prototype.re=function(t){var e=this.Zi(t).Ui();return this.Qi.he(t).size+e.Ii.size-e.Ei.size},t.prototype.Mi=function(t){this.Zi(t).Mi()},t.prototype.Zi=function(t){var e=this.Gi.get(t);return e||(e=new se,this.Gi.set(t,e)),e},t.prototype.oe=function(t){var e=this.zi.get(t);return e||(e=new S(ke),this.zi=this.zi.ut(t,e)),e},t.prototype.te=function(t){var e=null!==this.ee(t);return e||_e("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ee=function(t){var e=this.Gi.get(t);return e&&e.Ni?null:this.Qi.ce(t)},t.prototype.ne=function(t){var e=this;Se(!this.Gi.get(t).Ni,"Should only reset active targets"),this.Gi.set(t,new se),this.Qi.he(t).forEach((function(n){e.Yi(t,n,null)}))},t.prototype.se=function(t,e){return this.Qi.he(t).has(e)},t}();
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function ue(){return new _(w.F)}function ce(){return new _(w.F)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var he,le,fe=((he={})[Ct.ASCENDING.name]="ASCENDING",he[Ct.DESCENDING.name]="DESCENDING",he),pe=((le={})[St.LESS_THAN.name]="LESS_THAN",le[St.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",le[St.GREATER_THAN.name]="GREATER_THAN",le[St.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",le[St.EQUAL.name]="EQUAL",le[St.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",le[St.IN.name]="IN",le[St.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",le);function de(t,e){Se(!O(t),e+" is missing")}var ge=function(){function t(t,e){this.ae=t,this.options=e}return t.prototype.fe=function(t){var e=void 0===t.code?s.UNKNOWN:Ft(t.code);return new a(e,t.message||"")},t.prototype.le=function(t){return this.options.de||O(t)?t:{value:t}},t.prototype.ve=function(t){var e;return O(e="object"==typeof t?t.value:t)?null:e},t.prototype.Wt=function(t){return{integerValue:""+t}},t.prototype.zt=function(t){if(this.options.de){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:C(t)?"-0":t}},t.prototype.we=function(t){return D(t)?this.Wt(t):this.zt(t)},t.prototype.O=function(t){return this.options.de?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.P=function(t){var e=V(t);return new d(e.seconds,e.nanos)},t.prototype.me=function(t){return this.options.de?t.toBase64():t.toUint8Array()},t.prototype.pe=function(t){return this.options.de?(Se(void 0===t||"string"==typeof t,"value must be undefined or a string when using proto3 Json"),R.fromBase64String(t||"")):(Se(void 0===t||t instanceof Uint8Array,"value must be undefined or Uint8Array"),R.fromUint8Array(t||new Uint8Array))},t.prototype.toVersion=function(t){return this.O(t.O())},t.prototype.fromVersion=function(t){return Se(!!t,"Trying to deserialize version that isn't set"),g.P(this.P(t))},t.prototype.be=function(t,e){return this.ge(e||this.ae).child("documents").child(t).J()},t.prototype.ye=function(t){var e=v.H(t);return Se(me(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype._e=function(t){return this.be(t.path)},t.prototype.it=function(t){var e=this.ye(t);return Se(e.get(1)===this.ae.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.ae.projectId),Se(!e.get(3)&&!this.ae.database||e.get(3)===this.ae.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.ae.database),new w(this.Ie(e))},t.prototype.Te=function(t){return this.be(t)},t.prototype.Ee=function(t){var e=this.ye(t);return 4===e.length?v.Y:this.Ie(e)},Object.defineProperty(t.prototype,"De",{get:function(){return new v(["projects",this.ae.projectId,"databases",this.ae.database]).J()},enumerable:!0,configurable:!0}),t.prototype.ge=function(t){return new v(["projects",t.projectId,"databases",t.database])},t.prototype.Ie=function(t){return Se(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.j(5)},t.prototype.Re=function(t,e){return{name:this._e(t),fields:e.proto.mapValue.fields}},t.prototype.Se=function(t){return Se(!t.nn,"Can't serialize documents with mutations."),{name:this._e(t.key),fields:t.yn().mapValue.fields,updateTime:this.O(t.version.O())}},t.prototype.Ae=function(t,e){var n=this.it(t.name),r=this.fromVersion(t.updateTime),i=new vt({mapValue:{fields:t.fields}});return new wt(n,r,i,{hasCommittedMutations:!!e})},t.prototype.Ce=function(t){Se(!!t.found,"Tried to deserialize a found document from a missing document."),de(t.found.name,"doc.found.name"),de(t.found.updateTime,"doc.found.updateTime");var e=this.it(t.found.name),n=this.fromVersion(t.found.updateTime),r=new vt({mapValue:{fields:t.found.fields}});return new wt(e,n,r,{})},t.prototype.Pe=function(t){Se(!!t.missing,"Tried to deserialize a missing document from a found document."),Se(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.it(t.missing),n=this.fromVersion(t.readTime);return new _t(e,n)},t.prototype.Ve=function(t){return"found"in t?this.Ce(t):"missing"in t?this.Pe(t):Ie("invalid batch get response: "+JSON.stringify(t))},t.prototype.ke=function(t){var e;if("targetChange"in t){de(t.targetChange,"targetChange");var n=this.Ne(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=this.pe(t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&this.fe(o);e=new oe(n,r,i,s||null)}else if("documentChange"in t){de(t.documentChange,"documentChange");var a=t.documentChange;de(a.document,"documentChange.name"),de(a.document.name,"documentChange.document.name"),de(a.document.updateTime,"documentChange.document.updateTime");var u=this.it(a.document.name),c=this.fromVersion(a.document.updateTime),h=new vt({mapValue:{fields:a.document.fields}}),l=new wt(u,c,h,{}),f=a.targetIds||[],p=a.removedTargetIds||[];e=new re(f,p,l.key,l)}else if("documentDelete"in t){de(t.documentDelete,"documentDelete");var d=t.documentDelete;de(d.document,"documentDelete.document"),u=this.it(d.document),c=d.readTime?this.fromVersion(d.readTime):g.V(),l=new _t(u,c),p=d.removedTargetIds||[],e=new re([],p,l.key,l)}else if("documentRemove"in t){de(t.documentRemove,"documentRemove");var m=t.documentRemove;de(m.document,"documentRemove"),u=this.it(m.document),p=m.removedTargetIds||[],e=new re([],p,u,null)}else{if(!("filter"in t))return Ie("Unknown change type "+JSON.stringify(t));de(t.filter,"filter");var v=t.filter;de(v.targetId,"filter.targetId");var y=v.count||0,b=new jt(y),w=v.targetId;e=new ie(w,b)}return e},t.prototype.Ne=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ie("Got unexpected TargetChange.state: "+t)},t.prototype.Oe=function(t){if(!("targetChange"in t))return g.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?g.MIN:e.readTime?this.fromVersion(e.readTime):g.MIN},t.prototype.Fe=function(t){var e,n=this;if(t instanceof ft)e={update:this.Re(t.key,t.value)};else if(t instanceof gt)e={delete:this._e(t.key)};else if(t instanceof pt)e={update:this.Re(t.key,t.data),updateMask:this.Ue(t.en)};else if(t instanceof dt)e={transform:{document:this._e(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.je(t)}))}};else{if(!(t instanceof mt))return Ie("Unknown mutation type "+t.type);e={verify:this._e(t.key)}}return t.tn.Yt||(e.currentDocument=this.xe(t.tn)),e},t.prototype.Le=function(t){var e=this,n=t.currentDocument?this.Me(t.currentDocument):ht.NONE;if(t.update){de(t.update.name,"name");var r=this.it(t.update.name),i=new vt({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.qe(t.updateMask);return new pt(r,i,o,n)}return new ft(r,i,n)}if(t.delete)return r=this.it(t.delete),new gt(r,n);if(t.transform){r=this.it(t.transform.document);var s=t.transform.fieldTransforms.map((function(t){return e.Be(t)}));return Se(!0===n.exists,'Transforms only support precondition "exists == true"'),new dt(r,s)}return t.verify?(r=this.it(t.verify),new mt(r,n)):Ie("unknown mutation proto: "+JSON.stringify(t))},t.prototype.xe=function(t){return Se(!t.Yt,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ie("Unknown precondition")},t.prototype.Me=function(t){return void 0!==t.updateTime?ht.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ht.exists(t.exists):ht.NONE},t.prototype.Qe=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(g.MIN)&&(n=this.fromVersion(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new ct(n,r)},t.prototype.Ge=function(t,e){var n=this;return t&&t.length>0?(Se(void 0!==e,"Received a write result without a commit time"),t.map((function(t){return n.Qe(t,e)}))):[]},t.prototype.je=function(t){var e=t.transform;if(e instanceof tt)return{fieldPath:t.field.J(),setToServerValue:"REQUEST_TIME"};if(e instanceof et)return{fieldPath:t.field.J(),appendMissingElements:{values:e.elements}};if(e instanceof nt)return{fieldPath:t.field.J(),removeAllFromArray:{values:e.elements}};if(e instanceof rt)return{fieldPath:t.field.J(),increment:e.Gt};throw Ie("Unknown transform: "+t.transform)},t.prototype.Be=function(t){var e=null;if("setToServerValue"in t)Se("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),e=tt.instance;else if("appendMissingElements"in t){var n=t.appendMissingElements.values||[];e=new et(n)}else"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],e=new nt(n)):"increment"in t?e=new rt(this,t.increment):Ie("Unknown transform proto: "+JSON.stringify(t));var r=b.tt(t.fieldPath);return new ut(r,e)},t.prototype.We=function(t){return{documents:[this.Te(t.path)]}},t.prototype.ze=function(t){var e=t.documents.length;Se(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return It.Cn(this.Ee(n)).qn()},t.prototype.Ke=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(Se(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.Te(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(Se(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.Te(n.L()),e.structuredQuery.from=[{collectionId:n.B()}]);var r=this.Je(t.filters);r&&(e.structuredQuery.where=r);var i=this.He(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.le(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Ye(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Ye(t.endAt)),e},t.prototype.Xe=function(t){var e=this.Ee(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Se(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.$e(n.where));var a=[];n.orderBy&&(a=this.Ze(n.orderBy));var u=null;n.limit&&(u=this.ve(n.limit));var c=null;n.startAt&&(c=this.tr(n.startAt));var h=null;return n.endAt&&(h=this.tr(n.endAt)),new It(e,i,a,s,u,"F",c,h).qn()},t.prototype.nr=function(t){var e=this.ir(t.ti);return null==e?null:{"goog-listen-tags":e}},t.prototype.ir=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ie("Unrecognized query purpose: "+t)}},t.prototype.qn=function(t){var e,n=t.target;return(e=n.Tn()?{documents:this.We(n)}:{query:this.Ke(n)}).targetId=t.targetId,t.resumeToken.Lt()>0&&(e.resumeToken=this.me(t.resumeToken)),e},t.prototype.Je=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof At?e.er(t):Ie("Unrecognized filter: "+JSON.stringify(t))}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.$e=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.rr(t)]:void 0!==t.fieldFilter?[this.ur(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.$e(t)})).reduce((function(t,e){return t.concat(e)})):Ie("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.He=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.sr(t)}))},t.prototype.Ze=function(t){var e=this;return t.map((function(t){return e.or(t)}))},t.prototype.Ye=function(t){return{before:t.before,values:t.position}},t.prototype.tr=function(t){var e=!!t.before,n=t.values||[];return new Dt(n,e)},t.prototype.hr=function(t){return fe[t.name]},t.prototype.cr=function(t){switch(t){case"ASCENDING":return Ct.ASCENDING;case"DESCENDING":return Ct.DESCENDING;default:return}},t.prototype.ar=function(t){return pe[t.name]},t.prototype.lr=function(t){switch(t){case"EQUAL":return St.EQUAL;case"GREATER_THAN":return St.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return St.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return St.LESS_THAN;case"LESS_THAN_OR_EQUAL":return St.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return St.ARRAY_CONTAINS;case"IN":return St.IN;case"ARRAY_CONTAINS_ANY":return St.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Ie("Unspecified operator");default:return Ie("Unknown operator")}},t.prototype.dr=function(t){return{fieldPath:t.J()}},t.prototype.vr=function(t){return b.tt(t.fieldPath)},t.prototype.sr=function(t){return{field:this.dr(t.field),direction:this.hr(t.dir)}},t.prototype.or=function(t){return new Lt(this.vr(t.field),this.cr(t.direction))},t.prototype.ur=function(t){return At.create(this.vr(t.fieldFilter.field),this.lr(t.fieldFilter.op),t.fieldFilter.value)},t.prototype.er=function(t){if(t.op===St.EQUAL){if(X(t.value))return{unaryFilter:{field:this.dr(t.field),op:"IS_NAN"}};if(J(t.value))return{unaryFilter:{field:this.dr(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.dr(t.field),op:this.ar(t.op),value:t.value}}},t.prototype.rr=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.vr(t.unaryFilter.field);return At.create(e,St.EQUAL,{doubleValue:NaN});case"IS_NULL":var n=this.vr(t.unaryFilter.field);return At.create(n,St.EQUAL,{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ie("Unspecified filter");default:return Ie("Unknown filter")}},t.prototype.Ue=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.J())})),{fieldPaths:e}},t.prototype.qe=function(t){var e=(t.fieldPaths||[]).map((function(t){return b.tt(t)}));return at.Jt(e)},t}();function me(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var ve=function(){function t(){}return t.wr=function(e){t.platform&&Ie("Platform already defined"),t.platform=e},t.xt=function(){return t.platform||Ie("Platform not set"),t.platform},t}(),ye=new index_esm.Logger("@firebase/firestore");
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function be(){return ye.logLevel}function we(t){ye.logLevel=t}function _e(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ye.logLevel<=index_esm.LogLevel.DEBUG){var r=e.map(Te);ye.error.apply(ye,tslib_es6.__spreadArrays(["Firestore ("+i+"): "+t],r))}}function Ee(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(ye.logLevel<=index_esm.LogLevel.ERROR){var r=e.map(Te);ye.error.apply(ye,tslib_es6.__spreadArrays(["Firestore ("+i+"): "+t],r))}}function Te(t){if("string"==typeof t)return t;var e=ve.xt();try{return e.mr(t)}catch(e){return t}}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ie(t){var e="FIRESTORE ("+i+") INTERNAL ASSERTION FAILED: "+t;throw Ee(e),new Error(e)}function Se(t,e){t||Ie(e)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ae=function(){function t(){}return t.pr=function(){for(var t="";t.length<20;)for(var e=ve.xt().randomBytes(40),n=0,r=Array.from(e);n<r.length;n++){var i=r[n];t.length<20&&i<=247&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i%62))}return Se(20===t.length,"Invalid auto ID: "+t),t},t}();function ke(t,e){return t<e?-1:t>e?1:0}function xe(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function Ne(t){return t+"\0"}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Re=function(t,e,n,r,i){this.ae=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},Oe=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"br",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.k=function(t){return ke(this.projectId,t.projectId)||ke(this.database,t.database)},t}(),Ce=function(){function t(t,e,n,r){this.batchId=t,this.gr=e,this.baseMutations=n,this.mutations=r,Se(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.Bt=function(t,e,n){e&&Se(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.yr;Se(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.Bt(e,s)}}return e},t.prototype.qt=function(t,e){e&&Se(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++)(a=r[n]).key.isEqual(t)&&(e=a.qt(e,e,this.gr));for(var i=e,o=0,s=this.mutations;o<s.length;o++){var a;(a=s[o]).key.isEqual(t)&&(e=a.qt(e,i,this.gr))}return e},t.prototype._r=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.qt(r.key,t.get(r.key));i&&(n=n.ut(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Qt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&xe(this.mutations,t.mutations,(function(t,e){return t.isEqual(e)}))&&xe(this.baseMutations,t.baseMutations,(function(t,e){return t.isEqual(e)}))},t}(),De=function(){function t(t,e,n,r,i){this.batch=t,this.Ir=e,this.yr=n,this.streamToken=r,this.Tr=i}return t.from=function(e,n,r,i){Se(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Ht(),s=e.mutations,a=0;a<s.length;a++)o=o.ut(s[a].key,r[a].version);return new t(e,n,r,i,o)},t}(),Le=function(){function t(t){this.Er=t,this.Dr={}}return t.prototype.get=function(t){var e=this.Er(t),n=this.Dr[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(s.isEqual(t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.Er(t),r=this.Dr[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.Dr[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.Er(t),n=this.Dr[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.Dr[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){x(this.Dr,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.M=function(){return N(this.Dr)},t}(),$e=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.Rr=n,this.Sr=r}return t.Ar=function(e,n){for(var r=Qt(),i=Qt(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Pe=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.Cr=function(t){return n.Pr(t)},this.Vr=function(t){return e.kr(t)})}return t.prototype.Pr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.Vr&&this.Vr(t),t},t.Nr=-1,t}(),Me=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},je=function(){function t(t,e,n,r,i){this.Or=t,this.Fr=e,this.Ur=n,this.op=r,this.jr=i,this.xr=new Me,this.then=this.xr.promise.then.bind(this.xr.promise),this.catch=this.xr.promise.catch.bind(this.xr.promise),this.xr.promise.catch((function(t){}))}return t.Lr=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.Mr=setTimeout((function(){return e.qr()}),t)},t.prototype.Br=function(){return this.qr()},t.prototype.cancel=function(t){null!==this.Mr&&(this.clearTimeout(),this.xr.reject(new a(s.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.qr=function(){var t=this;this.Or.Qr((function(){return null!==t.Mr?(t.clearTimeout(),t.op().then((function(e){return t.xr.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.Mr&&(this.jr(this),clearTimeout(this.Mr),this.Mr=null)},t}(),Be=function(){function t(){this.Gr=Promise.resolve(),this.Wr=!1,this.zr=[],this.Kr=null,this.Jr=!1,this.Hr=[]}return Object.defineProperty(t.prototype,"Yr",{get:function(){return this.Wr},enumerable:!0,configurable:!0}),t.prototype.Qr=function(t){this.enqueue(t)},t.prototype.Xr=function(t){this.$r(),this.Zr(t)},t.prototype.tu=function(t){return this.$r(),this.Zr(t)},t.prototype.nu=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return this.$r(),this.Wr?[3,2]:(this.Wr=!0,[4,this.tu(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.enqueue=function(t){return this.$r(),this.Wr?new Promise((function(t){})):this.Zr(t)},t.prototype.Zr=function(t){var e=this,n=this.Gr.then((function(){return e.Jr=!0,t().catch((function(t){e.Kr=t,e.Jr=!1;var n=t.stack||t.message||"";throw Ee("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout((function(){throw t}),0),t})).then((function(t){return e.Jr=!1,t}))}));return this.Gr=n,n},t.prototype.iu=function(t,e,n){var r=this;this.$r(),Se(e>=0,"Attempted to schedule an operation with a negative delay of "+e),this.Hr.indexOf(t)>-1&&(e=0);var i=je.Lr(this,t,e,n,(function(t){return r.eu(t)}));return this.zr.push(i),i},t.prototype.$r=function(){this.Kr&&Ie("AsyncQueue is already failed: "+(this.Kr.stack||this.Kr.message))},t.prototype.ru=function(){Se(this.Jr,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.uu=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t;return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.Gr];case 1:e.sent(),e.label=2;case 2:if(t!==this.Gr)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.su=function(t){for(var e=0,n=this.zr;e<n.length;e++)if(n[e].Fr===t)return!0;return!1},t.prototype.ou=function(t){var e=this;return this.uu().then((function(){Se("all"===t||e.su(t),"Attempted to drain to missing operation "+t),e.zr.sort((function(t,e){return t.Ur-e.Ur}));for(var n=0,r=e.zr;n<r.length;n++){var i=r[n];if(i.Br(),"all"!==t&&i.Fr===t)break}return e.uu()}))},t.prototype.hu=function(t){this.Hr.push(t)},t.prototype.eu=function(t){var e=this.zr.indexOf(t);Se(e>=0,"Delayed operation not found."),this.zr.splice(e,1)},t}(),Fe=function(){function t(t){var e=this;this.cu=null,this.au=null,this.result=void 0,this.error=void 0,this.fu=!1,this.lu=!1,t((function(t){e.fu=!0,e.result=t,e.cu&&e.cu(t)}),(function(t){e.fu=!0,e.error=t,e.au&&e.au(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.lu&&Ie("Called next() or catch() twice for PersistencePromise"),this.lu=!0,this.fu?this.error?this.du(n,this.error):this.vu(e,this.result):new t((function(t,i){r.cu=function(n){r.vu(e,n).next(t,i)},r.au=function(e){r.du(n,e).next(t,i)}}))},t.prototype.wu=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.mu=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.vu=function(e,n){return e?this.mu((function(){return e(n)})):t.resolve(n)},t.prototype.du=function(e,n){return e?this.mu((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.pu=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.bu=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.pu(r)},t}();
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Ue(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=ke(n,i);return 0===s?ke(r,o):s}var qe=function(){function t(t){this.gu=t,this.buffer=new S(Ue),this.yu=0}return t.prototype._u=function(){return++this.yu},t.prototype.Iu=function(t){var e=[t,this._u()];if(this.buffer.size<this.gu)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Ue(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Ve={Tu:!1,Eu:0,Du:0,Ru:0},Ge=function(){function t(t,e,n){this.Su=t,this.Au=e,this.Cu=n}return t.Pu=function(e){return new t(e,t.Vu,t.ku)},t.Nu=-1,t.Ou=1048576,t.Fu=41943040,t.Vu=10,t.ku=1e3,t.Uu=new t(t.Fu,t.Vu,t.ku),t.DISABLED=new t(t.Nu,0,0),t}(),ze=function(){function t(t,e){this.ju=t,this.Or=e,this.xu=!1,this.Lu=null}return t.prototype.start=function(t){Se(null===this.Lu,"Cannot start an already started LruScheduler"),this.ju.params.Su!==Ge.Nu&&this.Mu(t)},t.prototype.stop=function(){this.Lu&&(this.Lu.cancel(),this.Lu=null)},Object.defineProperty(t.prototype,"qu",{get:function(){return null!==this.Lu},enumerable:!0,configurable:!0}),t.prototype.Mu=function(t){var e=this;Se(null===this.Lu,"Cannot schedule GC while a task is pending");var n=this.xu?3e5:6e4;_e("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.Lu=this.Or.iu("lru_garbage_collection",n,(function(){return e.Lu=null,e.xu=!0,t.Bu(e.ju).then((function(){return e.Mu(t)})).catch(Je)}))},t}(),We=function(){function t(t,e){this.Qu=t,this.params=e}return t.prototype.Gu=function(t,e){return this.Qu.Wu(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.zu=function(t,e){var n=this;if(0===e)return Fe.resolve(Pe.Nr);var r=new qe(e);return this.Qu.$i(t,(function(t){return r.Iu(t.sequenceNumber)})).next((function(){return n.Qu.Ku(t,(function(t){return r.Iu(t)}))})).next((function(){return r.maxValue}))},t.prototype.Ju=function(t,e,n){return this.Qu.Ju(t,e,n)},t.prototype.Hu=function(t,e){return this.Qu.Hu(t,e)},t.prototype.Yu=function(t,e){var n=this;return this.params.Su===Ge.Nu?(_e("LruGarbageCollector","Garbage collection skipped; disabled"),Fe.resolve(Ve)):this.Xu(t).next((function(r){return r<n.params.Su?(_e("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.Su),Ve):n.$u(t,e)}))},t.prototype.Xu=function(t){return this.Qu.Xu(t)},t.prototype.$u=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.Gu(t,this.params.Au).next((function(e){return e>c.params.Cu?(_e("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.Cu+" from "+e),r=c.params.Cu):r=e,o=Date.now(),c.zu(t,r)})).next((function(r){return n=r,s=Date.now(),c.Ju(t,n,e)})).next((function(e){return i=e,a=Date.now(),c.Hu(t,n)})).next((function(t){return u=Date.now(),be()<=index_esm.LogLevel.DEBUG&&_e("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),Fe.resolve({Tu:!0,Eu:r,Du:i,Ru:t})}))},t}(),He=function(){function t(){this.Zu=new S(Ye.bn),this.ts=new S(Ye.ns)}return t.prototype.M=function(){return this.Zu.M()},t.prototype.es=function(t,e){var n=new Ye(t,e);this.Zu=this.Zu.add(n),this.ts=this.ts.add(n)},t.prototype.rs=function(t,e){var n=this;t.forEach((function(t){return n.es(t,e)}))},t.prototype.us=function(t,e){this.ss(new Ye(t,e))},t.prototype.os=function(t,e){var n=this;t.forEach((function(t){return n.us(t,e)}))},t.prototype.hs=function(t){var e=this,n=w.EMPTY,r=new Ye(n,t),i=new Ye(n,t+1),o=[];return this.ts.kt([r,i],(function(t){e.ss(t),o.push(t.key)})),o},t.prototype.cs=function(){var t=this;this.Zu.forEach((function(e){return t.ss(e)}))},t.prototype.ss=function(t){this.Zu=this.Zu.delete(t),this.ts=this.ts.delete(t)},t.prototype.as=function(t){var e=w.EMPTY,n=new Ye(e,t),r=new Ye(e,t+1),i=Qt();return this.ts.kt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.fs=function(t){var e=new Ye(t,0),n=this.Zu.Ot(e);return null!==n&&t.isEqual(n.key)},t}(),Ye=function(){function t(t,e){this.key=t,this.ls=e}return t.bn=function(t,e){return w.F(t.key,e.key)||ke(t.ls,e.ls)},t.ns=function(t,e){return ke(t.ls,e.ls)||w.F(t.key,e.key)},t}(),Qe=function(){function t(){this.ds=new Le((function(t){return t.toString()})),this.vs=!1}return Object.defineProperty(t.prototype,"readTime",{get:function(){return Se(void 0!==this.ws,"Read time is not set. All removeEntry() calls must include a readTime if `trackRemovals` is used."),this.ws},set:function(t){Se(void 0===this.ws||this.ws.isEqual(t),"All changes in a RemoteDocumentChangeBuffer must have the same read time"),this.ws=t},enumerable:!0,configurable:!0}),t.prototype.ms=function(t,e){this.ps(),this.readTime=e,this.ds.set(t.key,t)},t.prototype.bs=function(t,e){this.ps(),e&&(this.readTime=e),this.ds.set(t,null)},t.prototype.gs=function(t,e){this.ps();var n=this.ds.get(e);return void 0!==n?Fe.resolve(n):this.ys(t,e)},t.prototype.getEntries=function(t,e){return this._s(t,e)},t.prototype.apply=function(t){return this.ps(),this.vs=!0,this.Is(t)},t.prototype.ps=function(){Se(!this.vs,"Changes have already been applied.")},t}(),Ke=function(){function t(t,e,n){this.persistence=t,this.Ts=e,this.Es=new He,this.Ds=new _(ke),this.Rs=new Le((function(t){return t.canonicalId()})),this.Ss=g.MIN,Se(t.qu,"LocalStore was passed an unstarted persistence implementation"),this.persistence.Cs.As(this.Es),this.Ps=t.Vs(n),this.ks=t.Ns(),this.Os=t.Fs(),this.Us=new ln(this.ks,this.Ps,this.persistence.js()),this.Ts.xs(this.Us)}return t.prototype.start=function(){return this.Ls()},t.prototype.Ms=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n,r,i=this;return tslib_es6.__generator(this,(function(o){switch(o.label){case 0:return e=this.Ps,n=this.Us,[4,this.persistence.runTransaction("Handle user change","readonly",(function(r){var o;return i.Ps.qs(r).next((function(s){return o=s,e=i.persistence.Vs(t),n=new ln(i.ks,e,i.persistence.js()),e.qs(r)})).next((function(t){for(var e=[],i=[],s=Qt(),a=0,u=o;a<u.length;a++){var c=u[a];e.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p],i.push(c.batchId);for(var g=0,m=c.mutations;g<m.length;g++)f=m[g],s=s.add(f.key)}return n.Bs(r,s).next((function(t){return{Qs:t,Gs:e,Ws:i}}))}))}))];case 1:return r=o.sent(),this.Ps=e,this.Us=n,this.Ts.xs(this.Us),[2,r]}}))}))},t.prototype.zs=function(t){var e,n=this,r=d.now(),i=t.reduce((function(t,e){return t.add(e.key)}),Qt());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(o){return n.Us.Bs(o,i).next((function(i){e=i;for(var s=[],a=0,u=t;a<u.length;a++){var c=u[a],h=c.in(e.get(c.key));null!=h&&s.push(new pt(c.key,h,h.en(),ht.exists(!0)))}return n.Ps.Ks(o,r,s,t)}))})).then((function(t){var n=t._r(e);return{batchId:t.batchId,ds:n}}))},t.prototype.Js=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",(function(n){return e.Ps.Hs(n,t).next((function(t){return t?e.Us.Bs(n,t):Fe.resolve(null)}))}))},t.prototype.Ys=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.ks.Xs({$s:!0});return e.Ps.Ys(n,t.batch,t.streamToken).next((function(){return e.Zs(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.Ps.to(n)})).next((function(){return e.Us.Bs(n,r)}))}))},t.prototype.no=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.Ps.io(n,t).next((function(t){return Se(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.Ps.eo(n,t)})).next((function(){return e.Ps.to(n)})).next((function(){return e.Us.Bs(n,r)}))}))},t.prototype.ro=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.Ps.ro(e)}))},t.prototype.uo=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",(function(e){return t.Ps.uo(e)}))},t.prototype.so=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",(function(n){return e.Ps.so(n,t)}))},t.prototype.oo=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Os.oo(e)}))},t.prototype.ho=function(e){var n=this,r=e.ni,i=this.Ds;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(o){var s=n.ks.Xs({$s:!0});i=n.Ds;var a=[];e.wi.forEach((function(e,s){var u=i.get(s);if(u){a.push(n.Os.co(o,e.Ei,s).next((function(){return n.Os.ao(o,e.Ii,s)})));var c=e.resumeToken;if(c.Lt()>0){var h=u.ei(c,r).ii(o.fo);i=i.ut(s,h),t.lo(u,h,e)&&a.push(n.Os.do(o,h))}}}));var u=qt(),c=Qt();if(e.pi.forEach((function(t,e){c=c.add(t)})),a.push(s.getEntries(o,c).next((function(t){e.pi.forEach((function(i,c){var h=t.get(i);c instanceof _t&&c.version.isEqual(g.MIN)?(s.bs(i,r),u=u.ut(i,c)):null==h||c.version.k(h.version)>0||0===c.version.k(h.version)&&h.hasPendingWrites?(Se(!g.MIN.isEqual(r),"Cannot add a document when the remote version is zero"),s.ms(c,r),u=u.ut(i,c)):_e("LocalStore","Ignoring outdated watch update for ",i,". Current version:",h.version," Watch version:",c.version),e.bi.has(i)&&a.push(n.persistence.Cs.vo(o,i))}))}))),!r.isEqual(g.MIN)){var h=n.Os.oo(o).next((function(t){return Se(r.k(t)>=0,"Watch stream reverted to previous snapshot?? "+r+" < "+t),n.Os.wo(o,o.fo,r)}));a.push(h)}return Fe.pu(a).next((function(){return s.apply(o)})).next((function(){return n.Us.mo(o,u)}))})).then((function(t){return n.Ds=i,t}))},t.lo=function(t,e,n){return Se(e.resumeToken.Lt()>0,"Attempted to persist target data with no resume token"),0===t.resumeToken.Lt()||e.ni.N()-t.ni.N()>=this.po||n.Ii.size+n.Ti.size+n.Ei.size>0},t.prototype.bo=function(t){for(var e=this,n=0,r=t;n<r.length;n++){var i=r[n],o=i.targetId;if(this.Es.rs(i.Rr,o),this.Es.os(i.Sr,o),!i.fromCache){var s=this.Ds.get(o);Se(null!==s,"Can't set limbo-free snapshot version for unknown target: "+o);var a=s.ni,u=s.ri(a);this.Ds=this.Ds.ut(o,u)}}return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(n){return Fe.forEach(t,(function(t){return Fe.forEach(t.Sr,(function(t){return e.persistence.Cs.us(n,t)}))}))}))},t.prototype.yo=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.Ps._o(n,t)}))},t.prototype.Io=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.Us.To(n,t)}))},t.prototype.Eo=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite",(function(n){var r;return e.Os.Do(n,t).next((function(i){return i?(r=i,Fe.resolve(r)):e.Os.Ro(n).next((function(i){return r=new Mt(t,i,0,n.fo),e.Os.So(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.Ds.get(n.targetId)&&(e.Ds=e.Ds.ut(n.targetId,n),e.Rs.set(t,n.targetId)),n}))},t.prototype.Do=function(t,e){var n=this.Rs.get(e);return void 0!==n?Fe.resolve(this.Ds.get(n)):this.Os.Do(t,e)},t.prototype.Ao=function(t,e){var n=this,r=this.Ds.get(t);Se(null!==r,"Tried to release nonexistent target: "+t);var i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,(function(i){var o=n.Es.hs(t);return e?Fe.resolve():Fe.forEach(o,(function(t){return n.persistence.Cs.us(i,t)})).next((function(){n.persistence.Cs.removeTarget(i,r)}))})).then((function(){n.Ds=n.Ds.remove(t),n.Rs.delete(r.target)}))},t.prototype.Co=function(t,e){var n=this,r=g.MIN,i=Qt();return this.persistence.runTransaction("Execute query","readonly",(function(o){return n.Do(o,t.qn()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.Os.Po(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.Ts.Vo(o,t,e?r:g.MIN,e?i:Qt())})).next((function(t){return{documents:t,ko:i}}))}))},t.prototype.No=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",(function(n){return e.Os.Po(n,t)}))},t.prototype.Oo=function(){return this.persistence.Oo()},t.prototype.Fo=function(t){this.Ps.Uo(t)},t.prototype.jo=function(t){this.persistence.jo(t)},t.prototype.Zs=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=Fe.resolve();return o.forEach((function(r){s=s.next((function(){return n.gs(t,r)})).next((function(t){var o=t,s=e.Tr.get(r);Se(null!==s,"ackVersions should contain every doc in the write."),(!o||o.version.k(s)<0)&&((o=i.Bt(r,o,e))?n.ms(o,e.Ir):Se(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))}))})),s.next((function(){return r.Ps.eo(t,i)}))},t.prototype.Bu=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.Yu(n,e.Ds)}))},t.prototype.xo=function(t){var e=this,n=this.Ds.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly",(function(n){return e.Os.ce(n,t).next((function(t){return t?t.target:null}))}))},t.prototype.Lo=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",(function(e){return t.ks.Lo(e,t.Ss)})).then((function(e){var n=e.Mo,r=e.readTime;return t.Ss=r,n}))},t.prototype.Ls=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t,e=this;return tslib_es6.__generator(this,(function(n){switch(n.label){case 0:return t=this,[4,this.persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e.ks.qo(t)}))];case 1:return t.Ss=n.sent(),[2]}}))}))},t.po=3e8,t}();function Je(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){if(t.code!==s.FAILED_PRECONDITION||t.message!==cn)throw t;return _e("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Xe(t,e){return Se(-1===e.indexOf("_"),"Client key cannot contain '_', but was '"+e+"'"),"firestore_clients_"+t+"_"+e}function Ze(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function tn(t,e){return"firestore_targets_"+t+"_"+e}
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var en=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,Se(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.Bo=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),s=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(s=new a(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(Ee("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Qo=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),nn=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,Se(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.Bo=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new a(r.error.code,r.error.message)),i?new t(e,r.state,o):(Ee("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Qo=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),rn=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Bo=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Jt(),s=0;i&&s<r.activeTargetIds.length;++s)i=D(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Ee("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),on=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Bo=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Ee("SharedClientState","Failed to parse online state: "+e),null)},t}(),sn=function(){function t(){this.activeTargetIds=Jt()}return t.prototype.Go=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Wo=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Qo=function(){var t={activeTargetIds:this.activeTargetIds.K(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),an=function(){function t(e,n,r,i,o){if(this.zo=e,this.platform=n,this.persistenceKey=r,this.Ko=i,this.Jo=null,this.Ho=null,this.Cr=null,this.Yo={},this.Xo=this.$o.bind(this),this.qu=!1,this.Zo=[],!t.th(this.platform))throw new a(s.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.nh=Xe(this.persistenceKey,this.Ko),this.ih=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Yo[this.Ko]=new sn,this.eh=new RegExp("^firestore_clients_"+u+"_([^_]*)$"),this.rh=new RegExp("^firestore_mutations_"+u+"_(\\d+)(?:_(.*))?$"),this.uh=new RegExp("^firestore_targets_"+u+"_(\\d+)$"),this.sh=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.platform.window.addEventListener("storage",this.Xo)}return t.th=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h,l=this;return tslib_es6.__generator(this,(function(f){switch(f.label){case 0:return Se(!this.qu,"WebStorageSharedClientState already started"),Se(null!==this.Jo,"syncEngine property must be set before calling start()"),Se(null!==this.Ho,"onlineStateHandler property must be set before calling start()"),[4,this.Jo.Oo()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ko&&(i=this.getItem(Xe(this.persistenceKey,r)))&&(o=rn.Bo(r,i))&&(this.Yo[o.clientId]=o);for(this.oh(),(s=this.storage.getItem(this.sh))&&(a=this.hh(s))&&this.ah(a),u=0,c=this.Zo;u<c.length;u++)h=c[u],this.$o(h);return this.Zo=[],this.platform.window.addEventListener("unload",(function(){return l.shutdown()})),this.qu=!0,[2]}}))}))},t.prototype.kr=function(t){this.setItem(this.ih,JSON.stringify(t))},t.prototype.fh=function(){var t=Jt();return x(this.Yo,(function(e,n){t=t.Ft(n.activeTargetIds)})),t},t.prototype.lh=function(t){for(var e in this.Yo)if(this.Yo.hasOwnProperty(e)&&this.Yo[e].activeTargetIds.has(t))return!0;return!1},t.prototype.dh=function(t){this.vh(t,"pending")},t.prototype.wh=function(t,e,n){this.vh(t,e,n),this.mh(t)},t.prototype.ph=function(t){var e="not-current";if(this.lh(t)){var n=this.storage.getItem(tn(this.persistenceKey,t));if(n){var r=nn.Bo(t,n);r&&(e=r.state)}}return this.bh.Go(t),this.oh(),e},t.prototype.gh=function(t){this.bh.Wo(t),this.oh()},t.prototype.yh=function(t){return this.bh.activeTargetIds.has(t)},t.prototype._h=function(t){this.removeItem(tn(this.persistenceKey,t))},t.prototype.Ih=function(t,e,n){this.Th(t,e,n)},t.prototype.Ms=function(t,e,n){var r=this;e.forEach((function(t){r.mh(t)})),this.currentUser=t,n.forEach((function(t){r.dh(t)}))},t.prototype.Eh=function(t){this.Dh(t)},t.prototype.shutdown=function(){this.qu&&(this.platform.window.removeEventListener("storage",this.Xo),this.removeItem(this.nh),this.qu=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return _e("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){_e("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){_e("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.$o=function(t){var e=this;if(t.storageArea===this.storage){if(_e("SharedClientState","EVENT",t.key,t.newValue),t.key===this.nh)return void Ee("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.zo.Qr((function(){return tslib_es6.__awaiter(e,void 0,void 0,(function(){var e,n,r,i,o,s;return tslib_es6.__generator(this,(function(a){if(!this.qu)return this.Zo.push(t),[2];if(null===t.key)return[2];if(this.eh.test(t.key)){if(null==t.newValue)return n=this.Rh(t.key),[2,this.Sh(n,null)];if(e=this.Ah(t.key,t.newValue))return[2,this.Sh(e.clientId,e)]}else if(this.rh.test(t.key)){if(null!==t.newValue&&(r=this.Ch(t.key,t.newValue)))return[2,this.Ph(r)]}else if(this.uh.test(t.key)){if(null!==t.newValue&&(i=this.Vh(t.key,t.newValue)))return[2,this.kh(i)]}else if(t.key===this.sh){if(null!==t.newValue&&(o=this.hh(t.newValue)))return[2,this.ah(o)]}else t.key===this.ih&&(Se(!!this.Cr,"Missing sequenceNumberHandler"),(s=function(t){var e=Pe.Nr;if(null!=t)try{var n=JSON.parse(t);Se("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Ee("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==Pe.Nr&&this.Cr(s));return[2]}))}))}))}},Object.defineProperty(t.prototype,"bh",{get:function(){return this.Yo[this.Ko]},enumerable:!0,configurable:!0}),t.prototype.oh=function(){this.setItem(this.nh,this.bh.Qo())},t.prototype.vh=function(t,e,n){var r=new en(this.currentUser,t,e,n),i=Ze(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Qo())},t.prototype.mh=function(t){var e=Ze(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Dh=function(t){var e={clientId:this.Ko,onlineState:t};this.storage.setItem(this.sh,JSON.stringify(e))},t.prototype.Th=function(t,e,n){var r=tn(this.persistenceKey,t),i=new nn(t,e,n);this.setItem(r,i.Qo())},t.prototype.Rh=function(t){var e=this.eh.exec(t);return e?e[1]:null},t.prototype.Ah=function(t,e){var n=this.Rh(t);return Se(null!==n,"Cannot parse client state key '"+t+"'"),rn.Bo(n,e)},t.prototype.Ch=function(t,e){var n=this.rh.exec(t);Se(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return en.Bo(new o(i),r,e)},t.prototype.Vh=function(t,e){var n=this.uh.exec(t);Se(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return nn.Bo(r,e)},t.prototype.hh=function(t){return on.Bo(t)},t.prototype.Ph=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return t.user.uid!==this.currentUser.uid?(_e("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.Jo.Nh(t.batchId,t.state,t.error)]}))}))},t.prototype.kh=function(t){return this.Jo.Oh(t.targetId,t.state,t.error)},t.prototype.Sh=function(t,e){var n=this,r=this.fh();e?this.Yo[t]=e:delete this.Yo[t];var i=this.fh(),o=[],s=[];return i.forEach((function(t){return tslib_es6.__awaiter(n,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return r.has(t)||o.push(t),[2]}))}))})),r.forEach((function(t){return tslib_es6.__awaiter(n,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return i.has(t)||s.push(t),[2]}))}))})),this.Jo.Fh(o,s)},t.prototype.ah=function(t){this.Yo[t.clientId]&&this.Ho(t.onlineState)},t}(),un=function(){function t(){this.Uh=new sn,this.jh={},this.Jo=null,this.Ho=null,this.Cr=null}return t.prototype.dh=function(t){},t.prototype.wh=function(t,e,n){},t.prototype.ph=function(t){return this.Uh.Go(t),this.jh[t]||"not-current"},t.prototype.Ih=function(t,e,n){this.jh[t]=e},t.prototype.gh=function(t){this.Uh.Wo(t)},t.prototype.yh=function(t){return this.Uh.activeTargetIds.has(t)},t.prototype._h=function(t){delete this.jh[t]},t.prototype.fh=function(){return this.Uh.activeTargetIds},t.prototype.lh=function(t){return this.Uh.activeTargetIds.has(t)},t.prototype.start=function(){return this.Uh=new sn,Promise.resolve()},t.prototype.Ms=function(t,e,n){},t.prototype.Eh=function(t){},t.prototype.shutdown=function(){},t.prototype.kr=function(t){},t}(),cn="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",hn=function(){function t(){this.xh=[]}return t.prototype.Lh=function(t){this.xh.push(t)},t.prototype.Mh=function(){this.xh.forEach((function(t){return t()}))},t}(),ln=function(){function t(t,e,n){this.qh=t,this.Ps=e,this.Bh=n}return t.prototype.To=function(t,e){var n=this;return this.Ps.Qh(t,e).next((function(r){return n.Gh(t,e,r)}))},t.prototype.Gh=function(t,e,n){return this.qh.gs(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].qt(e,t);return t}))},t.prototype.Wh=function(t,e,n){var r=Vt();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].qt(t,e);r=r.ut(t,e)})),r},t.prototype.Bs=function(t,e){var n=this;return this.qh.getEntries(t,e).next((function(e){return n.mo(t,e)}))},t.prototype.mo=function(t,e){var n=this;return this.Ps.zh(t,e).next((function(r){var i=n.Wh(t,e,r),o=qt();return i.forEach((function(t,e){e||(e=new _t(t,g.V())),o=o.ut(t,e)})),o}))},t.prototype.Vo=function(t,e,n){return e.Tn()?this.Kh(t,e.path):e.Yn()?this.Jh(t,e,n):this.Hh(t,e,n)},t.prototype.Kh=function(t,e){return this.To(t,new w(e)).next((function(t){var e=zt();return t instanceof wt&&(e=e.ut(t.key,t)),e}))},t.prototype.Jh=function(t,e,n){var r=this;Se(e.path.M(),"Currently we only support collection group queries at the root.");var i=e.collectionGroup,o=zt();return this.Bh.Yh(t,i).next((function(s){return Fe.forEach(s,(function(s){var a=e.Ln(s.child(i));return r.Hh(t,a,n).next((function(t){t.forEach((function(t,e){o=o.ut(t,e)}))}))})).next((function(){return o}))}))},t.prototype.Hh=function(t,e,n){var r,i,o=this;return this.qh.Vo(t,e,n).next((function(n){return r=n,o.Ps.Xh(t,e)})).next((function(e){return i=e,o.$h(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c),l=u.qt(h,h,o.gr);r=l instanceof wt?r.ut(c,l):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},t.prototype.$h=function(t,e,n){for(var r=Qt(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof pt&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.qh.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof wt&&(c=c.ut(t,e))})),c}))},t}(),fn=function(){function t(){}return t.prototype.xs=function(t){this.Zh=t},t.prototype.Vo=function(t,e,n,r){var i=this;return Se(void 0!==this.Zh,"setLocalDocumentsView() not called"),e.Mn()||n.isEqual(g.MIN)?this.tc(t,e):this.Zh.Bs(t,r).next((function(o){var s=i.nc(e,o);return(e.Kn()||e.Jn())&&i.ic(e.Dn,s,r,n)?i.tc(t,e):(be()<=index_esm.LogLevel.DEBUG&&_e("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),i.Zh.Vo(t,e,n).next((function(t){return s.forEach((function(e){t=t.ut(e.key,e)})),t})))}))},t.prototype.nc=function(t,e){var n=new S((function(e,n){return t.Bn(e,n)}));return e.forEach((function(e,r){r instanceof wt&&t.matches(r)&&(n=n.add(r))})),n},t.prototype.ic=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.k(r)>0)},t.prototype.tc=function(t,e){return be()<=index_esm.LogLevel.DEBUG&&_e("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Zh.Vo(t,e,g.MIN)},t}();
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function pn(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=gn(e)),e=dn(t.get(n),e);return gn(e)}function dn(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function gn(t){return t+""}function mn(t){var e=t.length;if(Se(e>=2,"Invalid path "+t),2===e)return Se(""===t.charAt(0)&&""===t.charAt(1),"Non-empty path "+t+" had length 2"),v.Y;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||s>n)&&Ie('Invalid encoded resource path: "'+t+'"'),t.charAt(s+1)){case"":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Ie('Invalid encoded resource path: "'+t+'"')}o=s+2}return new v(r)}
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var vn=function(){function t(){this.ec=new yn}return t.prototype.rc=function(t,e){return this.ec.add(e),Fe.resolve()},t.prototype.Yh=function(t,e){return Fe.resolve(this.ec.getEntries(e))},t}(),yn=function(){function t(){this.index={}}return t.prototype.add=function(t){Se(t.length%2==1,"Expected a collection path.");var e=t.B(),n=t.L(),r=this.index[e]||new S(v.F),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.B(),n=t.L(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new S(v.F)).K()},t}(),bn=function(){function t(t,e){this.Bh=t,this.Cs=e,this.Ps=[],this.uc=1,this.lastStreamToken=R.Mt,this.sc=new S(Ye.bn)}return t.prototype.oc=function(t){return Fe.resolve(0===this.Ps.length)},t.prototype.Ys=function(t,e,n){var r=e.batchId,i=this.hc(r,"acknowledged");Se(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.Ps[i];return Se(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,Fe.resolve()},t.prototype.uo=function(t){return Fe.resolve(this.lastStreamToken)},t.prototype.so=function(t,e){return this.lastStreamToken=e,Fe.resolve()},t.prototype.Ks=function(t,e,n,r){Se(0!==r.length,"Mutation batches should not be empty");var i=this.uc;this.uc++,this.Ps.length>0&&Se(this.Ps[this.Ps.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Ce(i,e,n,r);this.Ps.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.sc=this.sc.add(new Ye(u.key,i)),this.Bh.rc(t,u.key.path.L())}return Fe.resolve(o)},t.prototype.io=function(t,e){return Fe.resolve(this.cc(e))},t.prototype.Hs=function(t,e){var n=this.cc(e);return Se(null!=n,"Failed to find local mutation batch."),Fe.resolve(n.keys())},t.prototype._o=function(t,e){var n=e+1,r=this.ac(n),i=r<0?0:r;return Fe.resolve(this.Ps.length>i?this.Ps[i]:null)},t.prototype.ro=function(){return Fe.resolve(0===this.Ps.length?-1:this.uc-1)},t.prototype.qs=function(t){return Fe.resolve(this.Ps.slice())},t.prototype.Qh=function(t,e){var n=this,r=new Ye(e,0),i=new Ye(e,Number.POSITIVE_INFINITY),o=[];return this.sc.kt([r,i],(function(t){Se(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.cc(t.ls);Se(null!==r,"Batches in the index must exist in the main table"),o.push(r)})),Fe.resolve(o)},t.prototype.zh=function(t,e){var n=this,r=new S(ke);return e.forEach((function(t){var e=new Ye(t,0),i=new Ye(t,Number.POSITIVE_INFINITY);n.sc.kt([e,i],(function(e){Se(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.ls)}))})),Fe.resolve(this.fc(r))},t.prototype.Xh=function(t,e){Se(!e.Yn(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;w.nt(i)||(i=i.child(""));var o=new Ye(new w(i),0),s=new S(ke);return this.sc.Nt((function(t){var e=t.key.path;return!!n.G(e)&&(e.length===r&&(s=s.add(t.ls)),!0)}),o),Fe.resolve(this.fc(s))},t.prototype.fc=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.cc(t);null!==r&&n.push(r)})),n},t.prototype.eo=function(t,e){var n=this;Se(0===this.hc(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.Ps.shift();var r=this.sc;return Fe.forEach(e.mutations,(function(i){var o=new Ye(i.key,e.batchId);return r=r.delete(o),n.Cs.lc(t,i.key)})).next((function(){n.sc=r}))},t.prototype.Uo=function(t){},t.prototype.fs=function(t,e){var n=new Ye(e,0),r=this.sc.Ot(n);return Fe.resolve(e.isEqual(r&&r.key))},t.prototype.to=function(t){return 0===this.Ps.length&&Se(this.sc.M(),"Document leak -- detected dangling mutation references when queue is empty."),Fe.resolve()},t.prototype.hc=function(t,e){var n=this.ac(t);return Se(n>=0&&n<this.Ps.length,"Batches must exist to be "+e),n},t.prototype.ac=function(t){return 0===this.Ps.length?0:t-this.Ps[0].batchId},t.prototype.cc=function(t){var e=this.ac(t);if(e<0||e>=this.Ps.length)return null;var n=this.Ps[e];return Se(n.batchId===t,"If found batch must match"),n},t}(),wn=function(){function t(t,e){this.Bh=t,this.dc=e,this.docs=new _(w.F),this.size=0}return t.prototype.ms=function(t,e,n){Se(!n.isEqual(g.MIN),"Cannot add a document with a read time of zero");var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.dc(e);return this.docs=this.docs.ut(r,{vc:e,size:s,readTime:n}),this.size+=s-o,this.Bh.rc(t,r.path.L())},t.prototype.bs=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.gs=function(t,e){var n=this.docs.get(e);return Fe.resolve(n?n.vc:null)},t.prototype.getEntries=function(t,e){var n=this,r=Vt();return e.forEach((function(t){var e=n.docs.get(t);r=r.ut(t,e?e.vc:null)})),Fe.resolve(r)},t.prototype.Vo=function(t,e,n){Se(!e.Yn(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var r=zt(),i=new w(e.path.child("")),o=this.docs.lt(i);o.gt();){var s=o.bt(),a=s.key,u=s.value,c=u.vc,h=u.readTime;if(!e.path.G(a.path))break;h.k(n)<=0||c instanceof wt&&e.matches(c)&&(r=r.ut(c.key,c))}return Fe.resolve(r)},t.prototype.wc=function(t,e){return Fe.forEach(this.docs,(function(t){return e(t)}))},t.prototype.Lo=function(t,e){throw new Error("getNewDocumentChanges() is not supported with MemoryPersistence")},t.prototype.qo=function(t){return Fe.resolve(g.MIN)},t.prototype.Xs=function(e){return new t.mc(this)},t.prototype.pc=function(t){return Fe.resolve(this.size)},t.mc=function(t){function e(e){var n=t.call(this)||this;return n.bc=e,n}return tslib_es6.__extends(e,t),e.prototype.Is=function(t){var e=this,n=[];return this.ds.forEach((function(r,i){i?n.push(e.bc.ms(t,i,e.readTime)):e.bc.bs(r)})),Fe.pu(n)},e.prototype.ys=function(t,e){return this.bc.gs(t,e)},e.prototype._s=function(t,e){return this.bc.getEntries(t,e)},e}(Qe),t}(),_n=function(){function t(t,e){this.gc=t,Se((1&t)===t,"Generator ID "+t+" contains more than 1 reserved bits"),this.yc(void 0!==e?e:this.gc)}return t.prototype.next=function(){var t=this._c;return this._c+=2,t},t.prototype.after=function(t){return this.yc(t+2),this.next()},t.prototype.yc=function(t){Se((1&t)===this.gc,"Cannot supply target ID from different generator ID"),this._c=t},t.Ic=function(){return new t(0,2)},t.Tc=function(){return new t(1)},t}(),En=function(){function t(t){this.persistence=t,this.Ec=new Le((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=g.MIN,this.highestTargetId=0,this.Dc=0,this.Rc=new He,this.targetCount=0,this.Sc=_n.Ic()}return t.prototype.$i=function(t,e){return this.Ec.forEach((function(t,n){return e(n)})),Fe.resolve()},t.prototype.oo=function(t){return Fe.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Ac=function(t){return Fe.resolve(this.Dc)},t.prototype.Ro=function(t){var e=this.Sc.after(this.highestTargetId);return this.highestTargetId=e,Fe.resolve(e)},t.prototype.wo=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Dc&&(this.Dc=e),Fe.resolve()},t.prototype.Cc=function(t){this.Ec.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.Dc&&(this.Dc=t.sequenceNumber)},t.prototype.So=function(t,e){return Se(!this.Ec.has(e.target),"Adding a target that already exists"),this.Cc(e),this.targetCount+=1,Fe.resolve()},t.prototype.do=function(t,e){return Se(this.Ec.has(e.target),"Updating a non-existent target"),this.Cc(e),Fe.resolve()},t.prototype.Pc=function(t,e){return Se(this.targetCount>0,"Removing a target from an empty cache"),Se(this.Ec.has(e.target),"Removing a non-existent target from the cache"),this.Ec.delete(e.target),this.Rc.hs(e.targetId),this.targetCount-=1,Fe.resolve()},t.prototype.Ju=function(t,e,n){var r=this,i=0,o=[];return this.Ec.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.Ec.delete(s),o.push(r.Vc(t,a.targetId)),i++)})),Fe.pu(o).next((function(){return i}))},t.prototype.kc=function(t){return Fe.resolve(this.targetCount)},t.prototype.Do=function(t,e){var n=this.Ec.get(e)||null;return Fe.resolve(n)},t.prototype.ce=function(t,e){return Ie("Not yet implemented.")},t.prototype.ao=function(t,e,n){this.Rc.rs(e,n);var r=this.persistence.Cs,i=[];return r&&e.forEach((function(e){i.push(r.es(t,e))})),Fe.pu(i)},t.prototype.co=function(t,e,n){this.Rc.os(e,n);var r=this.persistence.Cs,i=[];return r&&e.forEach((function(e){i.push(r.us(t,e))})),Fe.pu(i)},t.prototype.Vc=function(t,e){return this.Rc.hs(e),Fe.resolve()},t.prototype.Po=function(t,e){var n=this.Rc.as(e);return Fe.resolve(n)},t.prototype.fs=function(t,e){return Fe.resolve(this.Rc.fs(e))},t}(),Tn="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",In=function(){function t(t,e){var n=this;this.clientId=t,this.Nc={},this.Oc=new Pe(0),this.Fc=!1,this.Fc=!0,this.Cs=e(this),this.Os=new En(this),this.Bh=new vn,this.qh=new wn(this.Bh,(function(t){return n.Cs.Uc(t)}))}return t.prototype.shutdown=function(){return this.Fc=!1,Promise.resolve()},Object.defineProperty(t.prototype,"qu",{get:function(){return this.Fc},enumerable:!0,configurable:!0}),t.prototype.Oo=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){return[2,[this.clientId]]}))}))},t.prototype.jc=function(t){return t(!0)},t.prototype.xc=function(){},t.prototype.jo=function(t){},t.prototype.js=function(){return this.Bh},t.prototype.Vs=function(t){var e=this.Nc[t.i()];return e||(e=new bn(this.Bh,this.Cs),this.Nc[t.i()]=e),e},t.prototype.Fs=function(){return this.Os},t.prototype.Ns=function(){return this.qh},t.prototype.runTransaction=function(t,e,n){var r=this;_e("MemoryPersistence","Starting transaction:",t);var i=new Sn(this.Oc.next());return this.Cs.Lc(),n(i).next((function(t){return r.Cs.Mc(i).next((function(){return t}))})).wu().then((function(t){return i.Mh(),t}))},t.prototype.qc=function(t,e){return Fe.bu(Object.values(this.Nc).map((function(n){return function(){return n.fs(t,e)}})))},t}(),Sn=function(t){function e(e){var n=t.call(this)||this;return n.fo=e,n}return tslib_es6.__extends(e,t),e}(hn),An=function(){function t(t){this.persistence=t,this.Bc=null,this.Qc=null}return Object.defineProperty(t.prototype,"Gc",{get:function(){if(this.Qc)return this.Qc;throw Ie("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),t.prototype.As=function(t){this.Bc=t},t.prototype.es=function(t,e){return this.Gc.delete(e),Fe.resolve()},t.prototype.us=function(t,e){return this.Gc.add(e),Fe.resolve()},t.prototype.lc=function(t,e){return this.Gc.add(e),Fe.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.Fs();return r.Po(t,e.targetId).next((function(t){t.forEach((function(t){return n.Gc.add(t)}))})).next((function(){return r.Pc(t,e)}))},t.prototype.Lc=function(){this.Qc=new Set},t.prototype.Mc=function(t){var e=this,n=this.persistence.Ns().Xs();return Fe.forEach(this.Gc,(function(r){return e.Wc(t,r).next((function(t){t||n.bs(r)}))})).next((function(){return e.Qc=null,n.apply(t)}))},t.prototype.vo=function(t,e){var n=this;return this.Wc(t,e).next((function(t){t?n.Gc.delete(e):n.Gc.add(e)}))},t.prototype.Uc=function(t){return 0},t.prototype.Wc=function(t,e){var n=this;return Fe.bu([function(){return n.persistence.Fs().fs(t,e)},function(){return n.persistence.qc(t,e)},function(){return Fe.resolve(n.Bc.fs(e))}])},t}(),kn=function(){function t(){}return t.prototype.initialize=function(t,e,n,r,i,o){if(o.zc)throw new a(s.FAILED_PRECONDITION,Tn);return this.clientId=r,Promise.resolve()},t.prototype.Kc=function(){var t=!1;return{qu:t,start:function(){return t=!0},stop:function(){return t=!1}}},t.prototype.Jc=function(){return Se(!!this.clientId,"initialize() not called"),new In(this.clientId,(function(t){return new An(t)}))},t.prototype.Hc=function(){return new un},t.prototype.clearPersistence=function(){throw new a(s.FAILED_PRECONDITION,Tn)},t}(),xn=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.zo=t,this.Fr=e,this.Yc=n,this.Xc=r,this.$c=i,this.Zc=0,this.ta=null,this.na=Date.now(),this.reset()}return t.prototype.reset=function(){this.Zc=0},t.prototype.ia=function(){this.Zc=this.$c},t.prototype.ea=function(t){var e=this;this.cancel();var n=Math.floor(this.Zc+this.ra()),r=Math.max(0,Date.now()-this.na),i=Math.max(0,n-r);this.Zc>0&&_e("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Zc+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.ta=this.zo.iu(this.Fr,i,(function(){return e.na=Date.now(),t()})),this.Zc*=this.Xc,this.Zc<this.Yc&&(this.Zc=this.Yc),this.Zc>this.$c&&(this.Zc=this.$c)},t.prototype.cancel=function(){null!==this.ta&&(this.ta.cancel(),this.ta=null)},t.prototype.ra=function(){return(Math.random()-.5)*this.Zc},t}(),Nn=function(){function t(t,e,n,r,i,o){this.zo=t,this.ua=n,this.connection=r,this.sa=i,this.listener=o,this.state=0,this.oa=0,this.ha=null,this.stream=null,this.ca=new xn(t,e)}return t.prototype.aa=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.fa=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?(Se(0===this.state,"Already started"),this.auth()):this.la()},t.prototype.stop=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.aa()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.da=function(){Se(!this.aa(),"Can only inhibit backoff in a stopped state"),this.state=0,this.ca.reset()},t.prototype.va=function(){var t=this;this.fa()&&null===this.ha&&(this.ha=this.zo.iu(this.ua,6e4,(function(){return t.wa()})))},t.prototype.ma=function(t){this.pa(),this.stream.send(t)},t.prototype.wa=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){return this.fa()?[2,this.close(0)]:[2]}))}))},t.prototype.pa=function(){this.ha&&(this.ha.cancel(),this.ha=null)},t.prototype.close=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(n){switch(n.label){case 0:return Se(this.aa(),"Only started streams should be closed."),Se(3===t||O(e),"Can't provide an error when not in an error state."),this.pa(),this.ca.cancel(),this.oa++,3!==t?this.ca.reset():e&&e.code===s.RESOURCE_EXHAUSTED?(Ee(e.toString()),Ee("Using maximum backoff delay to prevent overloading the backend."),this.ca.ia()):e&&e.code===s.UNAUTHENTICATED&&this.sa.l(),null!==this.stream&&(this.ba(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.ga(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ba=function(){},t.prototype.auth=function(){var t=this;Se(0===this.state,"Must be in initial state to auth"),this.state=1;var e=this.ya(this.oa),n=this.oa;this.sa.getToken().then((function(e){t.oa===n&&t._a(e)}),(function(n){e((function(){var e=new a(s.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Ia(e)}))}))},t.prototype._a=function(t){var e=this;Se(1===this.state,"Trying to start stream in a non-starting state");var n=this.ya(this.oa);this.stream=this.Ta(t),this.stream.Ea((function(){n((function(){return Se(1===e.state,"Expected stream to be in state Starting, but was "+e.state),e.state=2,e.listener.Ea()}))})),this.stream.ga((function(t){n((function(){return e.Ia(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.la=function(){var t=this;Se(3===this.state,"Should only perform backoff when in Error state"),this.state=4,this.ca.ea((function(){return tslib_es6.__awaiter(t,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){return Se(4===this.state,"Backoff elapsed but state is now: "+this.state),this.state=0,this.start(),Se(this.aa(),"PersistentStream should have started"),[2]}))}))}))},t.prototype.Ia=function(t){return Se(this.aa(),"Can't handle server close on non-started stream"),_e("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.ya=function(t){var e=this;return function(n){e.zo.Qr((function(){return e.oa===t?n():(_e("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),Rn=function(t){function e(e,n,r,i,o){var s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this;return s.serializer=i,s}return tslib_es6.__extends(e,t),e.prototype.Ta=function(t){return this.connection.Da("Listen",t)},e.prototype.onMessage=function(t){this.ca.reset();var e=this.serializer.ke(t),n=this.serializer.Oe(t);return this.listener.Ra(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.De,e.addTarget=this.serializer.qn(t);var n=this.serializer.nr(t);n&&(e.labels=n),this.ma(e)},e.prototype.Sa=function(t){var e={};e.database=this.serializer.De,e.removeTarget=t,this.ma(e)},e}(Nn),On=function(t){function e(e,n,r,i,o){var s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this;return s.serializer=i,s.Aa=!1,s.lastStreamToken=R.Mt,s}return tslib_es6.__extends(e,t),Object.defineProperty(e.prototype,"Ca",{get:function(){return this.Aa},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.Aa=!1,t.prototype.start.call(this)},e.prototype.ba=function(){this.Aa&&this.Pa([])},e.prototype.Ta=function(t){return this.connection.Da("Write",t)},e.prototype.onMessage=function(t){if(Se(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=this.serializer.pe(t.streamToken),this.Aa){this.ca.reset();var e=this.serializer.Ge(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.Va(n,e)}return Se(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.Aa=!0,this.listener.ka()},e.prototype.Na=function(){Se(this.fa(),"Writing handshake requires an opened stream"),Se(!this.Aa,"Handshake already completed");var t={};t.database=this.serializer.De,this.ma(t)},e.prototype.Pa=function(t){var e=this;Se(this.fa(),"Writing mutations requires an opened stream"),Se(this.Aa,"Handshake must be complete before writing mutations"),Se(this.lastStreamToken.Lt()>0,"Trying to write mutation without a token");var n={streamToken:this.serializer.me(this.lastStreamToken),writes:t.map((function(t){return e.serializer.Fe(t)}))};this.ma(n)},e}(Nn),Cn=function(){function t(t,e,n,r){this.zo=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.Oa=function(t){return new On(this.zo,this.connection,this.credentials,this.serializer,t)},t.prototype.Fa=function(t){return new Rn(this.zo,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.De,writes:t.map((function(t){return e.serializer.Fe(t)}))};return this.Ua("Commit",n).then((function(t){return e.serializer.Ge(t.writeResults,t.commitTime)}))},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.De,documents:t.map((function(t){return e.serializer._e(t)}))};return this.ja("BatchGetDocuments",n).then((function(n){var r=qt();n.forEach((function(t){var n=e.serializer.Ve(t);r=r.ut(n.key,n)}));var i=[];return t.forEach((function(t){var e=r.get(t);Se(!!e,"Missing entity in write response for "+t),i.push(e)})),i}))},t.prototype.Ua=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.Ua(t,e,r)})).catch((function(t){throw t.code===s.UNAUTHENTICATED&&n.credentials.l(),t}))},t.prototype.ja=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.connection.ja(t,e,r)})).catch((function(t){throw t.code===s.UNAUTHENTICATED&&n.credentials.l(),t}))},t}();
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Dn(t,e){if(0!==e.length)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Xn(e.length,"argument")+".")}function Ln(t,e,n){if(e.length!==n)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires "+Xn(n,"argument")+", but was called with "+Xn(e.length,"argument")+".")}function $n(t,e,n){if(e.length<n)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Xn(n,"argument")+", but was called with "+Xn(e.length,"argument")+".")}function Pn(t,e,n,r){if(e.length<n||e.length>r)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Xn(e.length,"argument")+".")}function Mn(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+Xn(r,"element")+".")}function jn(t,e,n,r){Gn(t,e,Jn(n)+" argument",r)}function Bn(t,e,n,r){void 0!==r&&jn(t,e,n,r)}function Fn(t,e,n,r){Gn(t,e,n+" option",r)}function Un(t,e,n,r){void 0!==r&&Fn(t,e,n,r)}function qn(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],u=0,c=i;u<c.length;u++){var h=c[u];if(h===r)return;o.push(Wn(h))}var l=Wn(r);throw new a(s.INVALID_ARGUMENT,"Invalid value "+l+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Vn(t,e,n,r){if(!e.some((function(t){return t===r})))throw new a(s.INVALID_ARGUMENT,"Invalid value "+Wn(r)+" provided to function "+t+"() for its "+Jn(n)+" argument. Acceptable values: "+e.join(", "))}function Gn(t,e,n,r){if(!("object"===e?zn(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Wn(r);throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function zn(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Wn(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Ie("Unknown wrong type: "+typeof t)}function Hn(t,e,n){if(void 0===n)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Jn(e)+" argument, but it was undefined.")}function Yn(t,e,n){x(e,(function(e,r){if(n.indexOf(e)<0)throw new a(s.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function Qn(t,e,n,r){var i=Wn(r);return new a(s.INVALID_ARGUMENT,"Function "+t+"() requires its "+Jn(n)+" argument to be a "+e+", but it was: "+i)}function Kn(t,e,n){if(n<=0)throw new a(s.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Jn(e)+" argument to be a positive number, but it was: "+n+".")}function Jn(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Xn(t,e){return t+" "+e+(1===t?"":"s")}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function Zn(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new a(s.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}function tr(){if("undefined"==typeof Uint8Array)throw new a(s.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function er(){if(!ve.xt().xa)throw new a(s.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var nr=function(){function t(t){er(),this.La=t}return t.fromBase64String=function(e){Ln("Blob.fromBase64String",arguments,1),jn("Blob.fromBase64String","string",1,e),er();try{return new t(R.fromBase64String(e))}catch(t){throw new a(s.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(Ln("Blob.fromUint8Array",arguments,1),tr(),!(e instanceof Uint8Array))throw Qn("Blob.fromUint8Array","Uint8Array",1,e);return new t(R.fromUint8Array(e))},t.prototype.toBase64=function(){return Ln("Blob.toBase64",arguments,0),er(),this.La.toBase64()},t.prototype.toUint8Array=function(){return Ln("Blob.toUint8Array",arguments,0),tr(),this.La.toUint8Array()},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this.La.isEqual(t.La)},t}(),rr=Zn(nr,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),ir=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Mn("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if(jn("FieldPath","string",n,t[n]),0===t[n].length)throw new a(s.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.Ma=new b(t)}return t.documentId=function(){return t.qa},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Qn("isEqual","FieldPath",1,e);return this.Ma.isEqual(e.Ma)},t.qa=new t(b.Z().J()),t}(),or=new RegExp("[~\\*/\\[\\]]"),sr=function(){function t(t){this.Ba=t}return t.delete=function(){return Dn("FieldValue.delete",arguments),ar.instance},t.serverTimestamp=function(){return Dn("FieldValue.serverTimestamp",arguments),ur.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return $n("FieldValue.arrayUnion",arguments,1),new cr(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return $n("FieldValue.arrayRemove",arguments,1),new hr(t)},t.increment=function(t){return jn("FieldValue.increment","number",1,t),Ln("FieldValue.increment",arguments,1),new lr(t)},t.prototype.isEqual=function(t){return this===t},t}(),ar=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return tslib_es6.__extends(e,t),e.instance=new e,e}(sr),ur=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return tslib_es6.__extends(e,t),e.instance=new e,e}(sr),cr=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n.Qa=e,n}return tslib_es6.__extends(e,t),e}(sr),hr=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n.Qa=e,n}return tslib_es6.__extends(e,t),e}(sr),lr=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n.Ga=e,n}return tslib_es6.__extends(e,t),e}(sr),fr=Zn(sr,"Use FieldValue.<field>() instead."),pr=function(){function t(t,e){if(Ln("GeoPoint",arguments,2),jn("GeoPoint","number",1,t),jn("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new a(s.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new a(s.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Wa=t,this.za=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this.Wa},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this.za},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this.Wa===t.Wa&&this.za===t.za},t.prototype.A=function(t){return ke(this.Wa,t.Wa)||ke(this.za,t.za)},t}(),dr=/^__.*__$/,gr=function(){function t(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}return t.prototype.Ka=function(t,e){var n=[];return null!==this.en?n.push(new pt(t,this.data,this.en,e)):n.push(new ft(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new dt(t,this.fieldTransforms)),n},t}(),mr=function(){function t(t,e,n){this.data=t,this.en=e,this.fieldTransforms=n}return t.prototype.Ka=function(t,e){var n=[new pt(t,this.data,this.en,e)];return this.fieldTransforms.length>0&&n.push(new dt(t,this.fieldTransforms)),n},t}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function vr(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ie("Unexpected case for UserDataSource: "+t)}}var yr=function(){function t(t,e,n,r,i,o){this.Ja=t,this.methodName=e,this.path=n,this.Ha=r,void 0===i&&this.Ya(),this.Ha=void 0!==r&&r,this.fieldTransforms=i||[],this.en=o||[]}return t.prototype.Xa=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.Ja,this.methodName,n,!1,this.fieldTransforms,this.en);return r.$a(e),r},t.prototype.Za=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.Ja,this.methodName,n,!1,this.fieldTransforms,this.en);return r.Ya(),r},t.prototype.tf=function(e){return new t(this.Ja,this.methodName,null,!0,this.fieldTransforms,this.en)},t.prototype.nf=function(t){var e=null===this.path||this.path.M()?"":" (found in field "+this.path.toString()+")";return new a(s.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.en.find((function(e){return t.G(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.G(e.field)}))},t.prototype.Ya=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.$a(this.path.get(t))},t.prototype.$a=function(t){if(0===t.length)throw this.nf("Document fields must not be empty");if(vr(this.Ja)&&dr.test(t))throw this.nf('Document fields cannot begin and end with "__"')},t}(),br=function(t,e){this.ae=t,this.key=e},wr=function(){function t(t,e){this.serializer=t,this.if=e}return t.prototype.ef=function(t,e){var n=new yr(0,t,b.Y);Er("Data must be an object, but it was:",n,e);var r=this.rf(e,n);return new gr(new vt(r),null,n.fieldTransforms)},t.prototype.uf=function(t,e,n){var r=new yr(2,t,b.Y);Er("Data must be an object, but it was:",r,e);var i,o,u=this.rf(e,r);if(n){for(var c=new S(b.F),h=0,l=n;h<l.length;h++){var f=l[h],p=void 0;if(f instanceof ir)p=f.Ma;else{if("string"!=typeof f)throw Ie("Expected stringOrFieldPath to be a string or a FieldPath");p=Ir(t,f)}if(!r.contains(p))throw new a(s.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");c=c.add(p)}i=at.Kt(c),o=r.fieldTransforms.filter((function(t){return i.Ht(t.field)}))}else i=at.Jt(r.en),o=r.fieldTransforms;return new gr(new vt(u),i,o)},t.prototype.sf=function(t,e){var n=this,r=new yr(1,t,b.Y);Er("Data must be an object, but it was:",r,e);var i=new S(b.F),o=vt.ln();x(e,(function(e,s){var a=Ir(t,e),u=r.Za(a);if((s=n.hf(s,u))instanceof ar)i=i.add(a);else{var c=n.cf(s,u);null!=c&&(i=i.add(a),o.set(a,c))}}));var s=at.Kt(i);return new mr(o.on(),s,r.fieldTransforms)},t.prototype.af=function(t,e,n,r){var i=new yr(1,t,b.Y),o=[Tr(t,e)],u=[n];if(r.length%2!=0)throw new a(s.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<r.length;c+=2)o.push(Tr(t,r[c])),u.push(r[c+1]);var h=new S(b.F),l=vt.ln();for(c=0;c<o.length;++c){var f=o[c],p=i.Za(f),d=this.hf(u[c],p);if(d instanceof ar)h=h.add(f);else{var g=this.cf(d,p);null!=g&&(h=h.add(f),l.set(f,g))}}var m=at.Kt(h);return new mr(l.on(),m,i.fieldTransforms)},t.prototype.ff=function(t,e,n){void 0===n&&(n=!1);var r=new yr(n?4:3,t,b.Y),i=this.cf(e,r);return Se(null!=i,"Parsed data should not be null."),Se(0===r.fieldTransforms.length,"Field transforms should have been disallowed."),i},t.prototype.hf=function(t,e){try{return this.if(t)}catch(t){var n=Sr(t);throw e.nf(n)}},t.prototype.cf=function(t,e){if(_r(t=this.hf(t,e)))return Er("Unsupported field value:",e,t),this.rf(t,e);if(t instanceof sr)return this.lf(t,e),null;if(e.path&&e.en.push(e.path),t instanceof Array){if(e.Ha&&4!==e.Ja)throw e.nf("Nested arrays are not supported");return this.df(t,e)}return this.vf(t,e)},t.prototype.rf=function(t,e){var n=this,r={};return N(t)?e.path&&e.path.length>0&&e.en.push(e.path):x(t,(function(t,i){var o=n.cf(i,e.Xa(t));null!=o&&(r[t]=o)})),{mapValue:{fields:r}}},t.prototype.df=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=o[i],a=this.cf(s,e.tf(r));null==a&&(a={nullValue:"NULL_VALUE"}),n.push(a),r++}return{arrayValue:{values:n}}},t.prototype.lf=function(t,e){if(!vr(e.Ja))throw e.nf(t.Ba+"() can only be used with update() and set()");if(null===e.path)throw e.nf(t.Ba+"() is not currently supported inside arrays");if(t instanceof ar){if(2!==e.Ja)throw 1===e.Ja?(Se(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.nf("FieldValue.delete() can only appear at the top level of your update data")):e.nf("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.en.push(e.path)}else if(t instanceof ur)e.fieldTransforms.push(new ut(e.path,tt.instance));else if(t instanceof cr){var n=this.wf(t.Ba,t.Qa),r=new et(n);e.fieldTransforms.push(new ut(e.path,r))}else if(t instanceof hr){n=this.wf(t.Ba,t.Qa);var i=new nt(n);e.fieldTransforms.push(new ut(e.path,i))}else if(t instanceof lr){var o=this.ff("FieldValue.increment",t.Ga),s=new rt(this.serializer,o);e.fieldTransforms.push(new ut(e.path,s))}else Ie("Unknown FieldValue type: "+t)},t.prototype.vf=function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return this.serializer.we(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=d.fromDate(t);return{timestampValue:this.serializer.O(n)}}if(t instanceof d)return n=new d(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:this.serializer.O(n)};if(t instanceof pr)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof nr)return{bytesValue:this.serializer.me(t)};if(t instanceof br)return{referenceValue:this.serializer.be(t.key.path,t.ae)};throw e.nf("Unsupported field value: "+Wn(t))},t.prototype.wf=function(t,e){var n=this;return e.map((function(e,r){var i=new yr(3,t,b.Y);return n.cf(e,i.tf(r))}))},t}();function _r(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof d||t instanceof pr||t instanceof nr||t instanceof br||t instanceof sr)}function Er(t,e,n){if(!_r(n)||!zn(n)){var r=Wn(n);throw"an object"===r?e.nf(t+" a custom object"):e.nf(t+" "+r)}}function Tr(t,e){if(e instanceof ir)return e.Ma;if("string"==typeof e)return Ir(t,e);throw new a(s.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Ir(t,e){try{return function(t){if(t.search(or)>=0)throw new a(s.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(ir.bind.apply(ir,tslib_es6.__spreadArrays([void 0],t.split("."))))}catch(e){throw new a(s.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).Ma}catch(e){var n=Sr(e);throw new a(s.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Sr(t){return t instanceof Error?t.message:t.toString()}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ar=function(){function t(t){this.mf=t,this.pf=Ht(),this.mutations=[],this.bf=!1,this.gf=null,this.yf=new Set}return t.prototype.lookup=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n=this;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:if(this._f(),this.mutations.length>0)throw new a(s.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.mf.lookup(t)];case 1:return(e=r.sent()).forEach((function(t){t instanceof _t||t instanceof wt?n.If(t):Ie("Document in a transaction was a "+t.constructor.name)})),[2,e]}}))}))},t.prototype.set=function(t,e){this.write(e.Ka(t,this.tn(t))),this.yf.add(t)},t.prototype.update=function(t,e){try{this.write(e.Ka(t,this.Tf(t)))}catch(t){this.gf=t}this.yf.add(t)},t.prototype.delete=function(t){this.write([new gt(t,this.tn(t))]),this.yf.add(t)},t.prototype.commit=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t,e=this;return tslib_es6.__generator(this,(function(n){switch(n.label){case 0:if(this._f(),this.gf)throw this.gf;return t=this.pf,this.mutations.forEach((function(e){t=t.remove(e.key)})),t.forEach((function(t,n){e.mutations.push(new mt(t,e.tn(t)))})),[4,this.mf.commit(this.mutations)];case 1:return n.sent(),this.bf=!0,[2]}}))}))},t.prototype.If=function(t){var e;if(t instanceof wt)e=t.version;else{if(!(t instanceof _t))throw Ie("Document in a transaction was a "+t.constructor.name);e=g.V()}var n=this.pf.get(t.key);if(null!==n){if(!e.isEqual(n))throw new a(s.ABORTED,"Document version changed between two reads.")}else this.pf=this.pf.ut(t.key,e)},t.prototype.tn=function(t){var e=this.pf.get(t);return!this.yf.has(t)&&e?ht.updateTime(e):ht.NONE},t.prototype.Tf=function(t){var e=this.pf.get(t);if(!this.yf.has(t)&&e){if(e.isEqual(g.V()))throw new a(s.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ht.updateTime(e)}return ht.exists(!0)},t.prototype.write=function(t){this._f(),this.mutations=this.mutations.concat(t)},t.prototype._f=function(){Se(!this.bf,"A transaction object cannot be used after its update callback has been invoked.")},t}(),kr=function(){function t(t,e){this.Or=t,this.Ho=e,this.state="Unknown",this.Ef=0,this.Df=null,this.Rf=!0}return t.prototype.Sf=function(){var t=this;0===this.Ef&&(this.Af("Unknown"),Se(null===this.Df,"onlineStateTimer shouldn't be started yet"),this.Df=this.Or.iu("online_state_timeout",1e4,(function(){return t.Df=null,Se("Unknown"===t.state,"Timer should be canceled if we transitioned to a different state."),t.Cf("Backend didn't respond within 10 seconds."),t.Af("Offline"),Promise.resolve()})))},t.prototype.Pf=function(t){"Online"===this.state?(this.Af("Unknown"),Se(0===this.Ef,"watchStreamFailures must be 0"),Se(null===this.Df,"onlineStateTimer must be null")):(this.Ef++,this.Ef>=1&&(this.Vf(),this.Cf("Connection failed 1 times. Most recent error: "+t.toString()),this.Af("Offline")))},t.prototype.set=function(t){this.Vf(),this.Ef=0,"Online"===t&&(this.Rf=!1),this.Af(t)},t.prototype.Af=function(t){t!==this.state&&(this.state=t,this.Ho(t))},t.prototype.Cf=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Rf?(Ee(e),this.Rf=!1):_e("OnlineStateTracker",e)},t.prototype.Vf=function(){null!==this.Df&&(this.Df.cancel(),this.Df=null)},t}(),xr=function(){function t(t,e,n,r,i){var o=this;this.kf=t,this.mf=e,this.Nf=[],this.Of=new Map,this.Ff=null,this.networkEnabled=!1,this.isPrimary=!1,this.Uf=i,this.Uf.jf((function(t){n.Qr((function(){return tslib_es6.__awaiter(o,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.xf()?(_e("RemoteStore","Restarting streams for network reachability change."),[4,this.Lf()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Mf=new kr(n,r),this.qf=this.mf.Fa({Ea:this.Bf.bind(this),ga:this.Qf.bind(this),Ra:this.Gf.bind(this)}),this.Wf=this.mf.Oa({Ea:this.zf.bind(this),ga:this.Kf.bind(this),ka:this.Jf.bind(this),Va:this.Va.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t;return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.xf()?(t=this.Wf,[4,this.kf.uo()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.Hf()?this.Yf():this.Mf.set("Unknown"),[4,this.Xf()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},t.prototype.disableNetwork=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.$f()];case 1:return t.sent(),this.Mf.set("Offline"),[2]}}))}))},t.prototype.$f=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return[4,this.Wf.stop()];case 1:return t.sent(),[4,this.qf.stop()];case 2:return t.sent(),this.Nf.length>0&&(_e("RemoteStore","Stopping write stream with "+this.Nf.length+" pending writes"),this.Nf=[]),this.Zf(),[2]}}))}))},t.prototype.shutdown=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return _e("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.$f()];case 1:return t.sent(),this.Uf.shutdown(),this.Mf.set("Unknown"),[2]}}))}))},t.prototype.listen=function(t){this.Of.has(t.targetId)||(this.Of.set(t.targetId,t),this.Hf()?this.Yf():this.qf.fa()&&this.tl(t))},t.prototype.nl=function(t){Se(this.Of.has(t),"unlisten called on target no currently watched: "+t),this.Of.delete(t),this.qf.fa()&&this.il(t),0===this.Of.size&&(this.qf.fa()?this.qf.va():this.xf()&&this.Mf.set("Unknown"))},t.prototype.ce=function(t){return this.Of.get(t)||null},t.prototype.he=function(t){return this.Jo.he(t)},t.prototype.tl=function(t){this.Ff.Mi(t.targetId),this.qf.watch(t)},t.prototype.il=function(t){this.Ff.Mi(t),this.qf.Sa(t)},t.prototype.Yf=function(){Se(this.Hf(),"startWatchStream() called when shouldStartWatchStream() is false."),this.Ff=new ae(this),this.qf.start(),this.Mf.Sf()},t.prototype.Hf=function(){return this.xf()&&!this.qf.aa()&&this.Of.size>0},t.prototype.xf=function(){return this.isPrimary&&this.networkEnabled},t.prototype.Zf=function(){this.Ff=null},t.prototype.Bf=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t=this;return tslib_es6.__generator(this,(function(e){return this.Of.forEach((function(e,n){t.tl(e)})),[2]}))}))},t.prototype.Qf=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return void 0===t&&Se(!this.Hf(),"Watch stream was stopped gracefully while still needed."),this.Zf(),this.Hf()?(this.Mf.Pf(t),this.Yf()):this.Mf.set("Unknown"),[2]}))}))},t.prototype.Gf=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return this.Mf.set("Online"),t instanceof oe&&2===t.state&&t.cause?[2,this.el(t)]:(t instanceof re?this.Ff.Ji(t):t instanceof ie?this.Ff.ie(t):(Se(t instanceof oe,"Expected watchChange to be an instance of WatchTargetChange"),this.Ff.Xi(t)),e.isEqual(g.MIN)?[3,3]:[4,this.kf.oo()]);case 1:return n=r.sent(),e.k(n)>=0?[4,this.rl(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))},t.prototype.rl=function(t){var e=this;Se(!t.isEqual(g.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.Ff.ue(t);return n.wi.forEach((function(n,r){if(n.resumeToken.Lt()>0){var i=e.Of.get(r);i&&e.Of.set(r,i.ei(n.resumeToken,t))}})),n.mi.forEach((function(t){var n=e.Of.get(t);if(n){e.Of.set(t,n.ei(R.Mt,n.ni)),e.il(t);var r=new Mt(n.target,t,1,n.sequenceNumber);e.tl(r)}})),this.Jo.ho(n)},t.prototype.el=function(t){var e=this;Se(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach((function(t){r=r.then((function(){return tslib_es6.__awaiter(e,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return this.Of.has(t)?(this.Of.delete(t),this.Ff.removeTarget(t),[2,this.Jo.ul(t,n)]):[2]}))}))}))})),r},t.prototype.Xf=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t,e;return tslib_es6.__generator(this,(function(n){switch(n.label){case 0:return this.sl()?(t=this.Nf.length>0?this.Nf[this.Nf.length-1].batchId:-1,[4,this.kf.yo(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.Nf.length&&this.Wf.va(),[3,4]);case 2:return this.ol(e),[4,this.Xf()];case 3:n.sent(),n.label=4;case 4:return this.hl()&&this.cl(),[2]}}))}))},t.prototype.sl=function(){return this.xf()&&this.Nf.length<10},t.prototype.al=function(){return this.Nf.length},t.prototype.ol=function(t){Se(this.sl(),"addToWritePipeline called when pipeline is full"),this.Nf.push(t),this.Wf.fa()&&this.Wf.Ca&&this.Wf.Pa(t.mutations)},t.prototype.hl=function(){return this.xf()&&!this.Wf.aa()&&this.Nf.length>0},t.prototype.cl=function(){Se(this.hl(),"startWriteStream() called when shouldStartWriteStream() is false."),this.Wf.start()},t.prototype.zf=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){return this.Wf.Na(),[2]}))}))},t.prototype.Jf=function(){var t=this;return this.kf.so(this.Wf.lastStreamToken).then((function(){for(var e=0,n=t.Nf;e<n.length;e++){var r=n[e];t.Wf.Pa(r.mutations)}})).catch(Je)},t.prototype.Va=function(t,e){var n=this;Se(this.Nf.length>0,"Got result for empty write pipeline");var r=this.Nf.shift(),i=De.from(r,t,e,this.Wf.lastStreamToken);return this.Jo.fl(i).then((function(){return n.Xf()}))},t.prototype.Kf=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e=this;return tslib_es6.__generator(this,(function(n){return void 0===t&&Se(!this.hl(),"Write stream was stopped gracefully while still needed."),t&&this.Nf.length>0?[2,(this.Wf.Ca?this.ll(t):this.dl(t)).then((function(){e.hl()&&e.cl()}))]:[2]}))}))},t.prototype.dl=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return Bt(t.code)?(_e("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.Wf.lastStreamToken),this.Wf.lastStreamToken=R.Mt,[2,this.kf.so(R.Mt).catch(Je)]):[2]}))}))},t.prototype.ll=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n=this;return tslib_es6.__generator(this,(function(r){return Bt(i=t.code)&&i!==s.ABORTED?(e=this.Nf.shift(),this.Wf.da(),[2,this.Jo.vl(e.batchId,t).then((function(){return n.Xf()}))]):[2];var i}))}))},t.prototype.wl=function(){return new Ar(this.mf)},t.prototype.Lf=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.$f()];case 1:return t.sent(),this.Mf.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},t.prototype.ml=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.xf()?(_e("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.Lf()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.pl=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.$f()];case 3:e.sent(),this.Mf.set("Unknown"),e.label=4;case 4:return[2]}}))}))},t}(),Nr=function(t){this.key=t},Rr=function(t){this.key=t},Or=function(){function t(t,e){this.query=t,this.bl=e,this.gl=null,this._i=!1,this.yl=Qt(),this.fi=Qt(),this._l=new Xt(t.Bn.bind(t))}return Object.defineProperty(t.prototype,"Il",{get:function(){return this.bl},enumerable:!0,configurable:!0}),t.prototype.Tl=function(t,e){var n=this,r=e?e.El:new Zt,i=e?e._l:this._l,o=e?e.fi:this.fi,s=i,a=!1,u=this.query.Kn()&&i.size===this.query.limit?i.last():null,c=this.query.Jn()&&i.size===this.query.limit?i.first():null;if(t.ct((function(t,e){var h=i.get(t),l=e instanceof wt?e:null;l&&(Se(t.isEqual(l.key),"Mismatching keys found in document changes: "+t+" != "+l.key),l=n.query.matches(l)?l:null);var f=!!h&&n.fi.has(h.key),p=!!l&&(l.nn||n.fi.has(l.key)&&l.hasCommittedMutations),d=!1;h&&l?h.data().isEqual(l.data())?f!==p&&(r.track({type:3,doc:l}),d=!0):n.Dl(h,l)||(r.track({type:2,doc:l}),d=!0,(u&&n.query.Bn(l,u)>0||c&&n.query.Bn(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),d=!0):h&&!l&&(r.track({type:1,doc:h}),d=!0,(u||c)&&(a=!0)),d&&(l?(s=s.add(l),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),this.query.Kn()||this.query.Jn())for(;s.size>this.query.limit;){var h=this.query.Kn()?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return Se(!a||!e,"View was refilled using docs that themselves needed refilling."),{_l:s,El:r,ic:a,fi:o}},t.prototype.Dl=function(t,e){return t.nn&&e.hasCommittedMutations&&!e.nn},t.prototype.Is=function(t,e,n){var r=this;Se(!t.ic,"Cannot apply changes that need a refill");var i=this._l;this._l=t._l,this.fi=t.fi;var o=t.El.ci();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ie("Unknown ChangeType: "+t)}};return n(t)-n(e)}
/**
     * @license
     * Copyright 2019 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t.type,e.type)||r.query.Bn(t.doc,e.doc)})),this.Rl(n);var s=e?this.Sl():[],a=0===this.yl.size&&this._i?1:0,u=a!==this.gl;return this.gl=a,0!==o.length||u?{snapshot:new te(this.query,t._l,i,o,t.fi,0===a,u,!1),Al:s}:{Al:s}},t.prototype.Cl=function(t){return this._i&&"Offline"===t?(this._i=!1,this.Is({_l:this._l,El:new Zt,fi:this.fi,ic:!1},!1)):{Al:[]}},t.prototype.Pl=function(t){return!this.bl.has(t)&&!!this._l.has(t)&&!this._l.get(t).nn},t.prototype.Rl=function(t){var e=this;t&&(t.Ii.forEach((function(t){return e.bl=e.bl.add(t)})),t.Ti.forEach((function(t){return Se(e.bl.has(t),"Modified document "+t+" not found in view.")})),t.Ei.forEach((function(t){return e.bl=e.bl.delete(t)})),this._i=t._i)},t.prototype.Sl=function(){var t=this;if(!this._i)return[];var e=this.yl;this.yl=Qt(),this._l.forEach((function(e){t.Pl(e.key)&&(t.yl=t.yl.add(e.key))}));var n=[];return e.forEach((function(e){t.yl.has(e)||n.push(new Rr(e))})),this.yl.forEach((function(t){e.has(t)||n.push(new Nr(t))})),n},t.prototype.Vl=function(t){this.bl=t.ko,this.yl=Qt();var e=this.Tl(t.documents);return this.Is(e,!0)},t.prototype.kl=function(){return te.vi(this.query,this._l,this.fi,0===this.gl)},t}(),Cr=function(){function t(t,e,n,r){this.Or=t,this.Nl=e,this.updateFunction=n,this.xr=r,this.Ol=5,this.ca=new xn(this.Or,"retry_transaction")}return t.prototype.run=function(){this.Fl()},t.prototype.Fl=function(){var t=this;this.ca.ea((function(){return tslib_es6.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return tslib_es6.__generator(this,(function(r){return t=this.Nl.wl(),(e=this.Ul(t))&&e.then((function(e){n.Or.Qr((function(){return t.commit().then((function(){n.xr.resolve(e)})).catch((function(t){n.jl(t)}))}))})).catch((function(t){n.jl(t)})),[2]}))}))}))},t.prototype.Ul=function(t){try{var e=this.updateFunction(t);return!O(e)&&e.catch&&e.then?e:(this.xr.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.xr.reject(t),null}},t.prototype.jl=function(t){var e=this;this.Ol>0&&this.xl(t)?(this.Ol-=1,this.Or.Qr((function(){return e.Fl(),Promise.resolve()}))):this.xr.reject(t)},t.prototype.xl=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Bt(e)}return!1},t}(),Dr=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Lr=function(t){this.key=t,this.Ll=!1},$r=function(){function t(t,e,n,r,i){this.kf=t,this.Nl=e,this.Ml=n,this.currentUser=r,this.ql=i,this.Bl=null,this.Ql=new Le((function(t){return t.canonicalId()})),this.Gl=new Map,this.Wl=[],this.zl=new _(w.F),this.Kl=new Map,this.Jl=new He,this.Hl={},this.Yl=new Map,this.Xl=_n.Tc(),this.isPrimary=void 0,this.onlineState="Unknown"}return Object.defineProperty(t.prototype,"$l",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){Se(null!==t,"SyncEngine listener cannot be null"),Se(null===this.Bl,"SyncEngine already has a subscriber."),this.Bl=t},t.prototype.listen=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n,r,i,o;return tslib_es6.__generator(this,(function(s){switch(s.label){case 0:return this.Zl("listen()"),(r=this.Ql.get(t))?(e=r.targetId,this.Ml.ph(e),n=r.view.kl(),[3,4]):[3,1];case 1:return[4,this.kf.Eo(t.qn())];case 2:return i=s.sent(),o=this.Ml.ph(i.targetId),e=i.targetId,[4,this.td(t,e,"current"===o)];case 3:n=s.sent(),this.isPrimary&&this.Nl.listen(i),s.label=4;case 4:return this.Bl.Ra([n]),[2,e]}}))}))},t.prototype.td=function(t,e,n){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var r,i,o,s,a,u;return tslib_es6.__generator(this,(function(c){switch(c.label){case 0:return[4,this.kf.Co(t,!0)];case 1:return r=c.sent(),i=new Or(t,r.ko),o=i.Tl(r.documents),s=ne.yi(e,n&&"Offline"!==this.onlineState),Se(0===(a=i.Is(o,!0===this.isPrimary,s)).Al.length,"View returned limbo docs before target ack from the server."),Se(!!a.snapshot,"applyChanges for new view should always return a snapshot"),u=new Dr(t,e,i),this.Ql.set(t,u),this.Gl.has(e)?this.Gl.get(e).push(t):this.Gl.set(e,[t]),[2,a.snapshot]}}))}))},t.prototype.nd=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return[4,this.kf.Co(t.query,!0)];case 1:return e=r.sent(),n=t.view.Vl(e),this.isPrimary&&this.ed(t.targetId,n.Al),[2,n]}}))}))},t.prototype.nl=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n,r=this;return tslib_es6.__generator(this,(function(i){switch(i.label){case 0:return this.Zl("unlisten()"),Se(!!(e=this.Ql.get(t)),"Trying to unlisten on query not found:"+t),(n=this.Gl.get(e.targetId)).length>1?(this.Gl.set(e.targetId,n.filter((function(e){return!e.isEqual(t)}))),this.Ql.delete(t),[2]):this.isPrimary?(this.Ml.gh(e.targetId),this.Ml.lh(e.targetId)?[3,2]:[4,this.kf.Ao(e.targetId,!1).then((function(){r.Ml._h(e.targetId),r.Nl.nl(e.targetId),r.rd(e.targetId)})).catch(Je)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.rd(e.targetId),[4,this.kf.Ao(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.write=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return this.Zl("write()"),[4,this.kf.zs(t)];case 1:return n=r.sent(),this.Ml.dh(n.batchId),this.ud(n.batchId,e),[4,this.sd(n.ds)];case 2:return r.sent(),[4,this.Nl.Xf()];case 3:return r.sent(),[2]}}))}))},t.prototype.runTransaction=function(t,e,n){new Cr(t,this.Nl,e,n).run()},t.prototype.ho=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n=this;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:this.Zl("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.kf.ho(t)];case 2:return e=r.sent(),t.wi.forEach((function(t,e){var r=n.Kl.get(e);r&&(Se(t.Ii.size+t.Ti.size+t.Ei.size<=1,"Limbo resolution for single document contains multiple changes."),t.Ii.size>0?r.Ll=!0:t.Ti.size>0?Se(r.Ll,"Received change for limbo target document without add."):t.Ei.size>0&&(Se(r.Ll,"Received remove for limbo target document without add."),r.Ll=!1))})),[4,this.sd(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Je(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.Cl=function(t,e){if(this.isPrimary&&0===e||!this.isPrimary&&1===e){this.Zl("applyOnlineStateChange()");var n=[];this.Ql.forEach((function(e,r){var i=r.view.Cl(t);Se(0===i.Al.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)})),this.Bl.od(t),this.Bl.Ra(n),this.onlineState=t,this.isPrimary&&this.Ml.Eh(t)}},t.prototype.ul=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n,r,i,o,s,a=this;return tslib_es6.__generator(this,(function(u){switch(u.label){case 0:return this.Zl("rejectListens()"),this.Ml.Ih(t,"rejected",e),n=this.Kl.get(t),(r=n&&n.key)?(this.zl=this.zl.remove(r),this.Kl.delete(t),this.hd(),i=(i=new _(w.F)).ut(r,new _t(r,g.V())),o=Qt().add(r),s=new ee(g.MIN,new Map,new S(ke),i,o),[2,this.ho(s)]):[3,1];case 1:return[4,this.kf.Ao(t,!1).then((function(){return a.rd(t,e)})).catch(Je)];case 2:u.sent(),u.label=3;case 3:return[2]}}))}))},t.prototype.Nh=function(t,e,n){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var r;return tslib_es6.__generator(this,(function(i){switch(i.label){case 0:return this.Zl("applyBatchState()"),[4,this.kf.Js(t)];case 1:return null===(r=i.sent())?(_e("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.Nl.Xf()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.ad(t,n||null),this.kf.Fo(t)):Ie("Unknown batchState: "+e),i.label=4;case 4:return[4,this.sd(r)];case 5:return i.sent(),[2]}}))}))},t.prototype.fl=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:this.Zl("applySuccessfulWrite()"),e=t.batch.batchId,this.ad(e,null),this.fd(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.kf.Ys(t)];case 2:return n=r.sent(),this.Ml.wh(e,"acknowledged"),[4,this.sd(n)];case 3:return r.sent(),[3,6];case 4:return[4,Je(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.vl=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:this.Zl("rejectFailedWrite()"),this.ad(t,e),this.fd(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.kf.no(t)];case 2:return n=r.sent(),this.Ml.wh(t,"rejected",e),[4,this.sd(n)];case 3:return r.sent(),[3,6];case 4:return[4,Je(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},t.prototype.ld=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return this.Nl.xf()||_e("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.kf.ro()];case 1:return-1===(e=r.sent())?(t.resolve(),[2]):((n=this.Yl.get(e)||[]).push(t),this.Yl.set(e,n),[2])}}))}))},t.prototype.fd=function(t){(this.Yl.get(t)||[]).forEach((function(t){t.resolve()})),this.Yl.delete(t)},t.prototype.dd=function(t){this.Yl.forEach((function(e){e.forEach((function(e){e.reject(new a(s.CANCELLED,t))}))})),this.Yl.clear()},t.prototype.ud=function(t,e){var n=this.Hl[this.currentUser.i()];n||(n=new _(ke)),n=n.ut(t,e),this.Hl[this.currentUser.i()]=n},t.prototype.ad=function(t,e){var n=this.Hl[this.currentUser.i()];if(n){var r=n.get(t);r&&(Se(t===n.ot(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.Hl[this.currentUser.i()]=n}},t.prototype.rd=function(t,e){var n=this;void 0===e&&(e=null),this.Ml.gh(t),Se(this.Gl.has(t)&&0!==this.Gl.get(t).length,"There are no queries mapped to target id "+t);for(var r=0,i=this.Gl.get(t);r<i.length;r++){var o=i[r];this.Ql.delete(o),e&&this.Bl.vd(o,e)}if(this.Gl.delete(t),this.isPrimary){var s=this.Jl.as(t);this.Jl.hs(t),s.forEach((function(t){n.Jl.fs(t)||n.wd(t)}))}},t.prototype.wd=function(t){var e=this.zl.get(t);null!==e&&(this.Nl.nl(e),this.zl=this.zl.remove(t),this.Kl.delete(e),this.hd())},t.prototype.ed=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Nr?(this.Jl.es(i.key,t),this.md(i)):i instanceof Rr?(_e("SyncEngine","Document no longer in limbo: "+i.key),this.Jl.us(i.key,t),this.Jl.fs(i.key)||this.wd(i.key)):Ie("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.md=function(t){var e=t.key;this.zl.get(e)||(_e("SyncEngine","New document in limbo: "+e),this.Wl.push(e),this.hd())},t.prototype.hd=function(){for(;this.Wl.length>0&&this.zl.size<this.ql;){var t=this.Wl.shift(),e=this.Xl.next();this.Kl.set(e,new Lr(t)),this.zl=this.zl.ut(t,e),this.Nl.listen(new Mt(It.Cn(t.path).qn(),e,2,Pe.Nr))}},t.prototype.pd=function(){return this.zl},t.prototype.bd=function(){return this.Wl},t.prototype.sd=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n,r,i,o=this;return tslib_es6.__generator(this,(function(s){switch(s.label){case 0:return n=[],r=[],i=[],this.Ql.forEach((function(s,a){i.push(Promise.resolve().then((function(){var e=a.view.Tl(t);return e.ic?o.kf.Co(a.query,!1).then((function(t){var n=t.documents;return a.view.Tl(n,e)})):e})).then((function(t){var i=e&&e.wi.get(a.targetId),s=a.view.Is(t,!0===o.isPrimary,i);if(o.ed(a.targetId,s.Al),s.snapshot){o.isPrimary&&o.Ml.Ih(a.targetId,s.snapshot.fromCache?"not-current":"current"),n.push(s.snapshot);var u=$e.Ar(a.targetId,s.snapshot);r.push(u)}})))})),[4,Promise.all(i)];case 1:return s.sent(),this.Bl.Ra(n),[4,this.kf.bo(r)];case 2:return s.sent(),[2]}}))}))},t.prototype.Zl=function(t){Se(null!==this.Bl,"Trying to call "+t+" before calling subscribe().")},t.prototype.ml=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.dd("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.kf.Ms(t)]):[3,3];case 1:return n=r.sent(),this.Ml.Ms(t,n.Gs,n.Ws),[4,this.sd(n.Qs)];case 2:r.sent(),r.label=3;case 3:return[4,this.Nl.ml()];case 4:return r.sent(),[2]}}))}))},t.prototype.pl=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n,r,i,o,s,a=this;return tslib_es6.__generator(this,(function(u){switch(u.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.Nl.pl(!0)]);case 1:return u.sent(),o=this.Ml.fh(),[4,this.gd(o.K())];case 2:for(e=u.sent(),n=0,r=e;n<r.length;n++)i=r[n],this.Nl.listen(i);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,o=[],s=Promise.resolve(),this.Gl.forEach((function(t,e){a.Ml.yh(e)?o.push(e):s=s.then((function(){return a.rd(e),a.kf.Ao(e,!0)})),a.Nl.nl(e)})),[4,s]);case 4:return u.sent(),[4,this.gd(o)];case 5:return u.sent(),this.yd(),[4,this.Nl.pl(!1)];case 6:u.sent(),u.label=7;case 7:return[2]}}))}))},t.prototype.yd=function(){var t=this;this.Kl.forEach((function(e,n){t.Nl.nl(n)})),this.Jl.cs(),this.Kl=new Map,this.zl=new _(w.F)},t.prototype.gd=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n,r,i,o,s,a,u,c,h,l,f,p;return tslib_es6.__generator(this,(function(d){switch(d.label){case 0:e=[],n=[],r=0,i=t,d.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(a=this.Gl.get(o))&&0!==a.length?[4,this.kf.Ao(o,!0)]:[3,8]):[3,14];case 2:return d.sent(),[4,this.kf.Eo(a[0].qn())];case 3:s=d.sent(),u=0,c=a,d.label=4;case 4:return u<c.length?(h=c[u],Se(!!(l=this.Ql.get(h)),"No query view found for "+h),[4,this.nd(l)]):[3,7];case 5:(f=d.sent()).snapshot&&n.push(f.snapshot),d.label=6;case 6:return u++,[3,4];case 7:return[3,12];case 8:return Se(!0===this.isPrimary,"A secondary tab should never have an active target without an active query."),[4,this.kf.xo(o)];case 9:return Se(!!(p=d.sent()),"Target for id "+o+" not found"),[4,this.kf.Eo(p)];case 10:return s=d.sent(),[4,this.td(this._d(p),o,!1)];case 11:d.sent(),d.label=12;case 12:e.push(s),d.label=13;case 13:return r++,[3,1];case 14:return this.Bl.Ra(n),[2,e]}}))}))},t.prototype._d=function(t){return new It(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},t.prototype.Oo=function(){return this.kf.Oo()},t.prototype.Oh=function(t,e,n){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var r,i;return tslib_es6.__generator(this,(function(o){switch(o.label){case 0:if(this.isPrimary)return _e("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.Gl.has(t))return[3,7];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,4]}return[3,6];case 1:return[4,this.kf.Lo()];case 2:return r=o.sent(),i=ee.gi(t,"current"===e),[4,this.sd(r,i)];case 3:return o.sent(),[3,7];case 4:return[4,this.kf.Ao(t,!0)];case 5:return o.sent(),this.rd(t,n),[3,7];case 6:Ie("Unexpected target state: "+e),o.label=7;case 7:return[2]}}))}))},t.prototype.Fh=function(t,e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l=this;return tslib_es6.__generator(this,(function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],Se(!this.Gl.has(h),"Trying to add an already active target"),[4,this.kf.xo(h)]):[3,6];case 2:return Se(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.kf.Eo(i)];case 3:return o=f.sent(),[4,this.td(this._d(i),o.targetId,!1)];case 4:f.sent(),this.Nl.listen(o),f.label=5;case 5:return n++,[3,1];case 6:s=function(t){return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return a.Gl.has(t)?[4,a.kf.Ao(t,!1).then((function(){l.Nl.nl(t),l.rd(t)})).catch(Je)]:[2,"continue"];case 1:return e.sent(),[2]}}))},a=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,s(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}}))}))},t.prototype.enableNetwork=function(){return this.kf.jo(!0),this.Nl.enableNetwork()},t.prototype.disableNetwork=function(){return this.kf.jo(!1),this.Nl.disableNetwork()},t.prototype.he=function(t){var e=this.Kl.get(t);if(e&&e.Ll)return Qt().add(e.key);var n=Qt(),r=this.Gl.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],a=this.Ql.get(s);Se(!!a,"No query view found for "+s),n=n.Ft(a.view.Il)}return n},t}(),Pr=function(){this.Id=null,this.targetId=0,this.listeners=[]},Mr=function(){function t(t){this.Jo=t,this.Td=new Le((function(t){return t.canonicalId()})),this.onlineState="Unknown",this.Ed=new Set,this.Jo.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.Td.get(e);return r||(n=!0,r=new Pr,this.Td.set(e,r)),r.listeners.push(t),Se(!t.Cl(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.Id&&t.Dd(r.Id)&&this.Rd(),n?this.Jo.listen(e).then((function(t){return r.targetId=t,t})):Promise.resolve(r.targetId)},t.prototype.nl=function(t){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e,n,r,i;return tslib_es6.__generator(this,(function(o){return e=t.query,n=!1,(r=this.Td.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.Td.delete(e),[2,this.Jo.nl(e)]):[2]}))}))},t.prototype.Ra=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.Td.get(o);if(s){for(var a=0,u=s.listeners;a<u.length;a++)u[a].Dd(i)&&(e=!0);s.Id=i}}e&&this.Rd()},t.prototype.vd=function(t,e){var n=this.Td.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.Td.delete(t)},t.prototype.od=function(t){this.onlineState=t;var e=!1;this.Td.forEach((function(n,r){for(var i=0,o=r.listeners;i<o.length;i++)o[i].Cl(t)&&(e=!0)})),e&&this.Rd()},t.prototype.Sd=function(t){this.Ed.add(t),t.next()},t.prototype.Ad=function(t){this.Ed.delete(t)},t.prototype.Rd=function(){this.Ed.forEach((function(t){t.next()}))},t}(),jr=function(){function t(t,e,n){this.query=t,this.Cd=e,this.Pd=!1,this.Vd=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Dd=function(t){if(Se(t.docChanges.length>0||t.li,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new te(t.query,t.docs,t.ai,e,t.fi,t.fromCache,t.li,!0)}var o=!1;return this.Pd?this.kd(t)&&(this.Cd.next(t),o=!0):this.Nd(t,this.onlineState)&&(this.Od(t),o=!0),this.Vd=t,o},t.prototype.onError=function(t){this.Cd.error(t)},t.prototype.Cl=function(t){this.onlineState=t;var e=!1;return this.Vd&&!this.Pd&&this.Nd(this.Vd,t)&&(this.Od(this.Vd),e=!0),e},t.prototype.Nd=function(t,e){if(Se(!this.Pd,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n="Offline"!==e;return this.options.Fd&&n?(Se(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.M()||"Offline"===e},t.prototype.kd=function(t){if(t.docChanges.length>0)return!0;var e=this.Vd&&this.Vd.hasPendingWrites!==t.hasPendingWrites;return!(!t.li&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Od=function(t){Se(!this.Pd,"Trying to raise initial events for second time"),t=te.vi(t.query,t.docs,t.fi,t.fromCache),this.Pd=!0,this.Cd.next(t)},t}(),Br=function(){function t(t,e,n,r){this.platform=t,this.Ud=e,this.credentials=n,this.Or=r,this.clientId=Ae.pr()}return t.prototype.start=function(t,e){var n=this;this.jd();var r=new Me,i=new Me,o=!1;return this.credentials.v((function(s){o?n.Or.Qr((function(){return n.ml(s)})):(o=!0,n.xd(t,e,s,i).then((function(){return n.Ld(s)})).then(r.resolve,r.reject))})),this.Or.Qr((function(){return r.promise})),i.promise},t.prototype.enableNetwork=function(){var t=this;return this.jd(),this.Or.enqueue((function(){return t.Jo.enableNetwork()}))},t.prototype.xd=function(t,e,n,r){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var i;return tslib_es6.__generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,t.initialize(this.Or,this.Ud,this.platform,this.clientId,n,e)];case 1:return o.sent(),this.persistence=t.Jc(),this.Md=t.Kc(),this.Ml=t.Hc(),r.resolve(),[3,3];case 2:if(i=o.sent(),r.reject(i),!this.qd(i))throw i;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i),[2,this.xd(new kn,{zc:!1},n,r)];case 3:return[2]}}))}))},t.prototype.qd=function(t){return"FirebaseError"===t.name?t.code===s.FAILED_PRECONDITION||t.code===s.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.jd=function(){if(this.Or.Yr)throw new a(s.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ld=function(t){var e=this;return _e("FirestoreClient","Initializing. user=",t.uid),this.platform.Bd(this.Ud).then((function(n){return tslib_es6.__awaiter(e,void 0,void 0,(function(){var e,r,i,o,s,a,u=this;return tslib_es6.__generator(this,(function(c){switch(c.label){case 0:return e=new fn,this.kf=new Ke(this.persistence,e,t),[4,this.kf.start()];case 1:return c.sent(),r=this.platform.Qd(),i=this.platform.Gd(this.Ud.ae),o=new Cn(this.Or,n,this.credentials,i),s=function(t){return u.Jo.Cl(t,0)},a=function(t){return u.Jo.Cl(t,1)},this.Nl=new xr(this.kf,o,this.Or,s,r),this.Jo=new $r(this.kf,this.Nl,this.Ml,t,100),this.Ml.Ho=a,this.Nl.Jo=this.Jo,this.Ml.Jo=this.Jo,this.Wd=new Mr(this.Jo),[4,this.Ml.start()];case 2:return c.sent(),[4,this.Nl.start()];case 3:return c.sent(),[4,this.persistence.jc((function(t){return tslib_es6.__awaiter(u,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return[4,this.Jo.pl(t)];case 1:return e.sent(),t&&!this.Md.qu?this.Md.start(this.kf):t||this.Md.stop(),[2]}}))}))}))];case 4:return c.sent(),[4,this.persistence.xc((function(){return tslib_es6.__awaiter(u,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))}))];case 5:return c.sent(),[2]}}))}))}))},t.prototype.ml=function(t){return this.Or.ru(),_e("FirestoreClient","Credential Changed. Current user: "+t.uid),this.Jo.ml(t)},t.prototype.disableNetwork=function(){var t=this;return this.jd(),this.Or.enqueue((function(){return t.Jo.disableNetwork()}))},t.prototype.terminate=function(){var t=this;return this.Or.nu((function(){return tslib_es6.__awaiter(t,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.Md.stop(),[4,this.Nl.shutdown()];case 1:return t.sent(),[4,this.Ml.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.m(),[2]}}))}))}))},t.prototype.waitForPendingWrites=function(){var t=this;this.jd();var e=new Me;return this.Or.Qr((function(){return t.Jo.ld(e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.jd();var i=new jr(t,e,n);return this.Or.Qr((function(){return r.Wd.listen(i)})),i},t.prototype.nl=function(t){var e=this;this.zd||this.Or.Qr((function(){return e.Wd.nl(t)}))},t.prototype.Kd=function(t){var e=this;return this.jd(),this.Or.enqueue((function(){return e.kf.Io(t)})).then((function(t){if(t instanceof wt)return t;if(t instanceof _t)return null;throw new a(s.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")}))},t.prototype.Jd=function(t){var e=this;return this.jd(),this.Or.enqueue((function(){return tslib_es6.__awaiter(e,void 0,void 0,(function(){var e,n,r;return tslib_es6.__generator(this,(function(i){switch(i.label){case 0:return[4,this.kf.Co(t,!0)];case 1:return e=i.sent(),n=new Or(t,e.ko),r=n.Tl(e.documents),[2,n.Is(r,!1).snapshot]}}))}))}))},t.prototype.write=function(t){var e=this;this.jd();var n=new Me;return this.Or.Qr((function(){return e.Jo.write(t,n)})),n.promise},t.prototype.ae=function(){return this.Ud.ae},t.prototype.Sd=function(t){var e=this;this.jd(),this.Or.Qr((function(){return e.Wd.Sd(t),Promise.resolve()}))},t.prototype.Ad=function(t){this.zd||this.Wd.Ad(t)},Object.defineProperty(t.prototype,"zd",{get:function(){return this.Or.Yr},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.jd();var n=new Me;return this.Or.Qr((function(){return e.Jo.runTransaction(e.Or,t,n),Promise.resolve()})),n.promise},t}(),Fr=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.Hd(this.observer.next,t)},t.prototype.error=function(t){this.Hd(this.observer.error,t)},t.prototype.Yd=function(){this.muted=!0},t.prototype.Hd=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}();
/**
     * @license
     * Copyright 2018 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function Ur(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}
/**
     * @license
     * Copyright 2020 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */(t)}var qr=function(){function t(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.Xd=n,this.converter=r}return t.prototype.$d=function(t){switch(M(t)){case 0:return null;case 1:return t.booleanValue;case 2:return G(t.integerValue||t.doubleValue);case 3:return this.Zd(t.timestampValue);case 4:return this.tv(t);case 5:return t.stringValue;case 6:return new nr(z(t.bytesValue));case 7:return this.nv(t.referenceValue);case 8:return new pr(t.geoPointValue.latitude,t.geoPointValue.longitude);case 9:return this.iv(t.arrayValue);case 10:return this.ev(t.mapValue);default:throw Ie("Invalid value type: "+JSON.stringify(t))}},t.prototype.ev=function(t){var e=this,n={};return x(t.fields||{},(function(t,r){n[t]=e.$d(r)})),n},t.prototype.iv=function(t){var e=this;return(t.values||[]).map((function(t){return e.$d(t)}))},t.prototype.tv=function(t){switch(this.Xd){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return L(n)?t(n):n}(t);return null==e?null:this.$d(e);case"estimate":return this.Zd($(t));default:return null}},t.prototype.Zd=function(t){var e=V(t),n=new d(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.nv=function(t){var e=v.H(t);Se(me(e),"ReferenceValue is not valid "+t);var n=new Oe(e.get(1),e.get(3)),r=new w(e.j(5));return n.isEqual(this.firestore.rv)||Ee("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.rv.projectId+"/"+this.firestore.rv.database+") instead."),new Yr(r,this.firestore,this.converter)},t}(),Vr=Ge.Nu,Gr=function(){function t(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new a(s.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Fn("settings","non-empty string","host",t.host),this.host=t.host,Un("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Yn("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Un("settings","object","credentials",t.credentials),this.credentials=t.credentials,Un("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Ee("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Ee("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Un("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Ge.Fu;else{if(t.cacheSizeBytes!==Vr&&t.cacheSizeBytes<Ge.Ou)throw new a(s.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Ge.Ou);this.cacheSizeBytes=t.cacheSizeBytes}Un("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),zr=function(){function t(e,n,r){var i=this;if(void 0===r&&(r=new kn),this.uv=null,this.sv=new Be,this.INTERNAL={delete:function(){return tslib_es6.__awaiter(i,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.ov(),[4,this.hv.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof e.options){var o=e;this.uv=o,this.rv=t.cv(o),this.av=o.name,this.fv=new h(n)}else{var u=e;if(!u.projectId)throw new a(s.INVALID_ARGUMENT,"Must provide projectId");this.rv=new Oe(u.projectId,u.database),this.av="[DEFAULT]",this.fv=new c}this.lv=r,this.dv=new Gr({}),this.vv=this.wv(this.rv)}return t.prototype.settings=function(t){if(Ln("Firestore.settings",arguments,1),jn("Firestore.settings","object",1,t),ai(t,"persistence"))throw new a(s.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Gr(t);if(this.hv&&!this.dv.isEqual(e))throw new a(s.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this.dv=e,void 0!==e.credentials&&(this.fv=p(e.credentials))},t.prototype.enableNetwork=function(){return this.ov(),this.hv.enableNetwork()},t.prototype.disableNetwork=function(){return this.ov(),this.hv.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.hv)throw new a(s.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Ee("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.mv(this.lv,{zc:!0,cacheSizeBytes:this.dv.cacheSizeBytes,synchronizeTabs:r})},t.prototype.clearPersistence=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t,e=this;return tslib_es6.__generator(this,(function(n){if(void 0!==this.hv&&!this.hv.zd)throw new a(s.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return t=new Me,this.sv.Xr((function(){return tslib_es6.__awaiter(e,void 0,void 0,(function(){var e,n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this.pv(),[4,this.lv.clearPersistence(e)];case 1:return r.sent(),t.resolve(),[3,3];case 2:return n=r.sent(),t.reject(n),[3,3];case 3:return[2]}}))}))})),[2,t.promise]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"bv",{get:function(){return this.ov(),this.hv.zd},enumerable:!0,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ov(),this.hv.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.ov(),Ur(t))return this.gv(t);jn("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.gv(e)},t.prototype.gv=function(t){var e=this,n=new Fr({next:function(){t.next&&t.next()},error:function(t){throw Ie("Uncaught Error in onSnapshotsInSync")}});return this.hv.Sd(n),function(){n.Yd(),e.hv.Ad(n)}},t.prototype.ov=function(){return this.hv||this.mv(new kn,{zc:!1}),this.hv},t.prototype.pv=function(){return new Re(this.rv,this.av,this.dv.host,this.dv.ssl,this.dv.forceLongPolling)},t.prototype.mv=function(t,e){Se(!!this.dv.host,"FirestoreSettings.host is not set"),Se(!this.hv,"configureClient() called multiple times");var n=this.pv();return this.hv=new Br(ve.xt(),n,this.fv,this.sv),this.hv.start(t,e)},t.prototype.wv=function(t){var e=new ge(t,{de:ve.xt().de});return new wr(e,(function(e){if(e instanceof Yr){var n=t,r=e.firestore.rv;if(!r.isEqual(n))throw new a(s.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new br(t,e.yv)}return e}))},t.cv=function(t){if(!ai(t.options,"projectId"))throw new a(s.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e=t.options.projectId;if(!e||"string"!=typeof e)throw new a(s.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Oe(e)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.uv)throw new a(s.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.uv},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return Ln("Firestore.collection",arguments,1),jn("Firestore.collection","non-empty string",1,t),this.ov(),new ti(v.H(t),this)},t.prototype.doc=function(t){return Ln("Firestore.doc",arguments,1),jn("Firestore.doc","non-empty string",1,t),this.ov(),Yr._v(v.H(t),this)},t.prototype.collectionGroup=function(t){if(Ln("Firestore.collectionGroup",arguments,1),jn("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new a(s.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ov(),new Xr(new It(v.Y,t),this)},t.prototype.runTransaction=function(t){var e=this;return Ln("Firestore.runTransaction",arguments,1),jn("Firestore.runTransaction","function",1,t),this.ov().transaction((function(n){return t(new Wr(e,n))}))},t.prototype.batch=function(){return this.ov(),new Hr(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(be()){case index_esm.LogLevel.DEBUG:return"debug";case index_esm.LogLevel.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(Ln("Firestore.setLogLevel",arguments,1),jn("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":we(index_esm.LogLevel.DEBUG);break;case"error":we(index_esm.LogLevel.ERROR);break;case"silent":we(index_esm.LogLevel.SILENT);break;default:throw new a(s.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype.Iv=function(){return this.dv.timestampsInSnapshots},t}(),Wr=function(){function t(t,e){this.Tv=t,this.Ev=e}return t.prototype.get=function(t){var e=this;Ln("Transaction.get",arguments,1);var n=ii("Transaction.get",t,this.Tv);return this.Ev.lookup([n.yv]).then((function(t){if(!t||1!==t.length)return Ie("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof _t)return new Kr(e.Tv,n.yv,null,!1,!1,n.Dv);if(r instanceof wt)return new Kr(e.Tv,n.yv,r,!1,!1,n.Dv);throw Ie("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)}))},t.prototype.set=function(t,e,n){Pn("Transaction.set",arguments,2,3);var r=ii("Transaction.set",t,this.Tv);n=ei("Transaction.set",n);var i=si(r.Dv,e,"Transaction.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.Tv.vv.uf(s,o,n.mergeFields):this.Tv.vv.ef(s,o);return this.Ev.set(r.yv,a),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return"string"==typeof e||e instanceof ir?($n("Transaction.update",arguments,3),r=ii("Transaction.update",t,this.Tv),i=this.Tv.vv.af("Transaction.update",e,n,o)):(Ln("Transaction.update",arguments,2),r=ii("Transaction.update",t,this.Tv),i=this.Tv.vv.sf("Transaction.update",e)),this.Ev.update(r.yv,i),this},t.prototype.delete=function(t){Ln("Transaction.delete",arguments,1);var e=ii("Transaction.delete",t,this.Tv);return this.Ev.delete(e.yv),this},t}(),Hr=function(){function t(t){this.Tv=t,this.Rv=[],this.Sv=!1}return t.prototype.set=function(t,e,n){Pn("WriteBatch.set",arguments,2,3),this.Av();var r=ii("WriteBatch.set",t,this.Tv);n=ei("WriteBatch.set",n);var i=si(r.Dv,e,"WriteBatch.set"),o=i[0],s=i[1],a=n.merge||n.mergeFields?this.Tv.vv.uf(s,o,n.mergeFields):this.Tv.vv.ef(s,o);return this.Rv=this.Rv.concat(a.Ka(r.yv,ht.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Av(),"string"==typeof e||e instanceof ir?($n("WriteBatch.update",arguments,3),r=ii("WriteBatch.update",t,this.Tv),i=this.Tv.vv.af("WriteBatch.update",e,n,o)):(Ln("WriteBatch.update",arguments,2),r=ii("WriteBatch.update",t,this.Tv),i=this.Tv.vv.sf("WriteBatch.update",e)),this.Rv=this.Rv.concat(i.Ka(r.yv,ht.exists(!0))),this},t.prototype.delete=function(t){Ln("WriteBatch.delete",arguments,1),this.Av();var e=ii("WriteBatch.delete",t,this.Tv);return this.Rv=this.Rv.concat(new gt(e.yv,ht.NONE)),this},t.prototype.commit=function(){return this.Av(),this.Sv=!0,this.Rv.length>0?this.Tv.ov().write(this.Rv):Promise.resolve()},t.prototype.Av=function(){if(this.Sv)throw new a(s.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Yr=function(){function t(t,e,n){this.yv=t,this.firestore=e,this.Dv=n,this.hv=this.firestore.ov()}return t._v=function(e,n,r){if(e.length%2!=0)throw new a(s.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.J()+" has "+e.length);return new t(new w(e),n,r)},Object.defineProperty(t.prototype,"id",{get:function(){return this.yv.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new ti(this.yv.path.L(),this.firestore,this.Dv)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this.yv.path.J()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(Ln("DocumentReference.collection",arguments,1),jn("DocumentReference.collection","non-empty string",1,t),!t)throw new a(s.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=v.H(t);return new ti(this.yv.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Qn("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this.yv.isEqual(e.yv)&&this.Dv===e.Dv},t.prototype.set=function(t,e){Pn("DocumentReference.set",arguments,1,2),e=ei("DocumentReference.set",e);var n=si(this.Dv,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.vv.uf(i,r,e.mergeFields):this.firestore.vv.ef(i,r);return this.hv.write(o.Ka(this.yv,ht.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof ir?($n("DocumentReference.update",arguments,2),n=this.firestore.vv.af("DocumentReference.update",t,e,r)):(Ln("DocumentReference.update",arguments,1),n=this.firestore.vv.sf("DocumentReference.update",t)),this.hv.write(n.Ka(this.yv,ht.exists(!0)))},t.prototype.delete=function(){return Ln("DocumentReference.delete",arguments,0),this.hv.write([new gt(this.yv,ht.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Pn("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||Ur(t[i])||(Yn("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Un("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return Ur(t[i])?n=t[i]:(jn("DocumentReference.onSnapshot","function",i,t[i]),Bn("DocumentReference.onSnapshot","function",i+1,t[i+1]),Bn("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.Cv(o,n)},t.prototype.Cv=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Fr({next:function(t){if(e.next){Se(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n.yv);e.next(new Kr(n.firestore,n.yv,r,t.fromCache,t.hasPendingWrites,n.Dv))}},error:r}),o=this.hv.listen(It.Cn(this.yv.path),i,t);return function(){i.Yd(),n.hv.nl(o)}},t.prototype.get=function(t){var e=this;return Pn("DocumentReference.get",arguments,0,1),ri("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ov().Kd(e.yv).then((function(t){n(new Kr(e.firestore,e.yv,t,!0,t instanceof wt&&t.nn,e.Dv))}),r):e.Pv(n,r,t)}))},t.prototype.Pv=function(t,e,n){var r=this.Cv({includeMetadataChanges:!0,Fd:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new a(s.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new a(s.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t.prototype.withConverter=function(e){return new t(this.yv,this.firestore,e)},t}(),Qr=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Kr=function(){function t(t,e,n,r,i,o){this.Tv=t,this.yv=e,this.Vv=n,this.kv=r,this.Nv=i,this.Dv=o}return t.prototype.data=function(t){if(Pn("DocumentSnapshot.data",arguments,0,1),t=ni("DocumentSnapshot.data",t),this.Vv){if(this.Dv){var e=new Jr(this.Tv,this.yv,this.Vv,this.kv,this.Nv);return this.Dv.fromFirestore(e,t)}var n=new qr(this.Tv,this.Tv.Iv(),t.serverTimestamps,void 0);return n.$d(this.Vv.yn())}},t.prototype.get=function(t,e){if(Pn("DocumentSnapshot.get",arguments,1,2),e=ni("DocumentSnapshot.get",e),this.Vv){var n=this.Vv.data().field(Tr("DocumentSnapshot.get",t));if(null!==n){var r=new qr(this.Tv,this.Tv.Iv(),e.serverTimestamps,this.Dv);return r.$d(n)}}},Object.defineProperty(t.prototype,"id",{get:function(){return this.yv.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Yr(this.yv,this.Tv,this.Dv)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this.Vv},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Qr(this.Nv,this.kv)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw Qn("isEqual","DocumentSnapshot",1,e);return this.Tv===e.Tv&&this.kv===e.kv&&this.yv.isEqual(e.yv)&&(null===this.Vv?null===e.Vv:this.Vv.isEqual(e.Vv))&&this.Dv===e.Dv},t}(),Jr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return tslib_es6.__extends(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return Se(void 0!==n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Kr),Xr=function(){function t(t,e,n){this.Ov=t,this.firestore=e,this.Dv=n}return t.prototype.where=function(e,n,r){Ln("Query.where",arguments,3),Hn("Query.where",3,r);var i,o=["<","<=","==",">=",">","array-contains","in","array-contains-any"];Vn("Query.where",o,2,n);var u=Tr("Query.where",e),c=St.H(n);if(u.$()){if(c===St.ARRAY_CONTAINS||c===St.ARRAY_CONTAINS_ANY)throw new a(s.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+c.toString()+"' queries on FieldPath.documentId().");if(c===St.IN){this.Fv(r,c);for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l];h.push(this.Uv(p))}i={arrayValue:{values:h}}}else i=this.Uv(r)}else c!==St.IN&&c!==St.ARRAY_CONTAINS_ANY||this.Fv(r,c),i=this.firestore.vv.ff("Query.where",r,c===St.IN);var d=At.create(u,c,i);return this.jv(d),new t(this.Ov.kn(d),this.firestore,this.Dv)},t.prototype.orderBy=function(e,n){var r;if(Pn("Query.orderBy",arguments,1,2),Bn("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=Ct.ASCENDING;else{if("desc"!==n)throw new a(s.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=Ct.DESCENDING}if(null!==this.Ov.startAt)throw new a(s.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.Ov.endAt)throw new a(s.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Tr("Query.orderBy",e),o=new Lt(i,r);return this.xv(o),new t(this.Ov.On(o),this.firestore,this.Dv)},t.prototype.limit=function(e){return Ln("Query.limit",arguments,1),jn("Query.limit","number",1,e),Kn("Query.limit",1,e),new t(this.Ov.Fn(e),this.firestore,this.Dv)},t.prototype.limitToLast=function(e){return Ln("Query.limitToLast",arguments,1),jn("Query.limitToLast","number",1,e),Kn("Query.limitToLast",1,e),new t(this.Ov.Un(e),this.firestore,this.Dv)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];$n("Query.startAt",arguments,1);var i=this.Lv("Query.startAt",e,n,!0);return new t(this.Ov.jn(i),this.firestore,this.Dv)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];$n("Query.startAfter",arguments,1);var i=this.Lv("Query.startAfter",e,n,!1);return new t(this.Ov.jn(i),this.firestore,this.Dv)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];$n("Query.endBefore",arguments,1);var i=this.Lv("Query.endBefore",e,n,!0);return new t(this.Ov.xn(i),this.firestore,this.Dv)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];$n("Query.endAt",arguments,1);var i=this.Lv("Query.endAt",e,n,!1);return new t(this.Ov.xn(i),this.firestore,this.Dv)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Qn("isEqual","Query",1,e);return this.firestore===e.firestore&&this.Ov.isEqual(e.Ov)},t.prototype.withConverter=function(e){return new t(this.Ov,this.firestore,e)},t.prototype.Lv=function(t,e,n,r){if(Hn(t,1,e),e instanceof Kr){if(n.length>0)throw new a(s.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new a(s.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.Mv(i.Vv,r)}var o=[e].concat(n);return this.qv(t,o,r)},t.prototype.Mv=function(t,e){for(var n=[],r=0,i=this.Ov.orderBy;r<i.length;r++){var o=i[r];if(o.field.$())n.push(W(this.firestore.rv,t.key));else{var u=t.field(o.field);if(L(u))throw new a(s.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var c=o.field.J();throw new a(s.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+c+"' (used as the orderBy) does not exist.")}n.push(u)}}return new Dt(n,e)},t.prototype.qv=function(t,e,n){var r=this.Ov.En;if(e.length>r.length)throw new a(s.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var u=e[o];if(r[o].field.$()){if("string"!=typeof u)throw new a(s.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof u);if(!this.Ov.Yn()&&-1!==u.indexOf("/"))throw new a(s.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+u+"' contains a slash.");var c=this.Ov.path.child(v.H(u));if(!w.nt(c))throw new a(s.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+c+"' is not because it contains an odd number of segments.");var h=new w(c);i.push(W(this.firestore.rv,h))}else{var l=this.firestore.vv.ff(t,u);i.push(l)}}return new Dt(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Pn("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||Ur(t[i])||(Yn("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Un("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),Ur(t[i])?n=t[i]:(jn("Query.onSnapshot","function",i,t[i]),Bn("Query.onSnapshot","function",i+1,t[i+1]),Bn("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.Bv(this.Ov),this.Cv(r,n)},t.prototype.Cv=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Fr({next:function(t){e.next&&e.next(new Zr(n.firestore,n.Ov,t,n.Dv))},error:r}),o=this.firestore.ov(),s=o.listen(this.Ov,i,t);return function(){i.Yd(),o.nl(s)}},t.prototype.Bv=function(t){if(t.Jn()&&0===t.En.length)throw new a(s.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},t.prototype.get=function(t){var e=this;return Pn("Query.get",arguments,0,1),ri("Query.get",t),this.Bv(this.Ov),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.ov().Jd(e.Ov).then((function(t){n(new Zr(e.firestore,e.Ov,t,e.Dv))}),r):e.Pv(n,r,t)}))},t.prototype.Pv=function(t,e,n){var r=this.Cv({includeMetadataChanges:!0,Fd:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new a(s.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.Uv=function(t){if("string"==typeof t){if(""===t)throw new a(s.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.Ov.Yn()&&-1!==t.indexOf("/"))throw new a(s.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.Ov.path.child(v.H(t));if(!w.nt(e))throw new a(s.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return W(this.firestore.rv,new w(e))}if(t instanceof Yr){var n=t;return W(this.firestore.rv,n.yv)}throw new a(s.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Wn(t)+".")},t.prototype.Fv=function(t,e){if(!Array.isArray(t)||0===t.length)throw new a(s.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new a(s.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new a(s.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new a(s.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.jv=function(t){if(t instanceof At){var e=[St.ARRAY_CONTAINS,St.ARRAY_CONTAINS_ANY],n=[St.IN,St.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.Nn()){var o=this.Ov.Pn();if(null!==o&&!o.isEqual(t.field))throw new a(s.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var u=this.Ov.Vn();null!==u&&this.Qv(t.field,u)}else if(i||r){var c=null;if(i&&(c=this.Ov.Hn(n)),null===c&&r&&(c=this.Ov.Hn(e)),null!=c)throw c===t.op?new a(s.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new a(s.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+c.toString()+"' filters.")}}},t.prototype.xv=function(t){if(null===this.Ov.Vn()){var e=this.Ov.Pn();null!==e&&this.Qv(e,t.field)}},t.prototype.Qv=function(t,e){if(!e.isEqual(t))throw new a(s.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),Zr=function(){function t(t,e,n,r){this.Tv=t,this.Gv=e,this.Wv=n,this.Dv=r,this.zv=null,this.Kv=null,this.metadata=new Qr(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this.Wv.docs.M()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.Wv.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Pn("QuerySnapshot.forEach",arguments,1,2),jn("QuerySnapshot.forEach","function",1,t),this.Wv.docs.forEach((function(r){t.call(e,n.Jv(r))}))},Object.defineProperty(t.prototype,"query",{get:function(){return new Xr(this.Gv,this.Tv,this.Dv)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(Yn("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Un("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Wv.di)throw new a(s.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.zv&&this.Kv===e||(this.zv=function(t,e,n,r){if(n.ai.M()){var i,o=0;return n.docChanges.map((function(e){var s=new Jr(t,e.doc.key,e.doc,n.fromCache,n.fi.has(e.doc.key),r);return Se(0===e.type,"Invalid event type for first snapshot"),Se(!i||n.query.Bn(i,e.doc)<0,"Got added events in wrong order"),i=e.doc,{type:"added",doc:s,oldIndex:-1,newIndex:o++}}))}var s=n.ai;return n.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var i=new Jr(t,e.doc.key,e.doc,n.fromCache,n.fi.has(e.doc.key),r),o=-1,a=-1;return 0!==e.type&&(Se((o=s.indexOf(e.doc.key))>=0,"Index for document not found"),s=s.delete(e.doc.key)),1!==e.type&&(a=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:oi(e.type),doc:i,oldIndex:o,newIndex:a}}))}(this.Tv,e,this.Wv,this.Dv),this.Kv=e),this.zv},t.prototype.isEqual=function(e){if(!(e instanceof t))throw Qn("isEqual","QuerySnapshot",1,e);return this.Tv===e.Tv&&this.Gv.isEqual(e.Gv)&&this.Wv.isEqual(e.Wv)&&this.Dv===e.Dv},t.prototype.Jv=function(t){return new Jr(this.Tv,t.key,t,this.metadata.fromCache,this.Wv.fi.has(t.key),this.Dv)},t}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */tslib_es6.__spreadArrays(["length","forEach","map"],"undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach((function(t){try{Object.defineProperty(Zr.prototype.docChanges,t,{get:function(){return function(){throw new a(s.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}}));var ti=function(t){function e(e,n,r){var i=t.call(this,It.Cn(e),n,r)||this;if(i.Hv=e,e.length%2!=1)throw new a(s.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.J()+" has "+e.length);return i}return tslib_es6.__extends(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this.Ov.path.B()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this.Ov.path.L();return t.M()?null:new Yr(new w(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this.Ov.path.J()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(Pn("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Ae.pr()),jn("CollectionReference.doc","non-empty string",1,t),""===t)throw new a(s.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=v.H(t);return Yr._v(this.Ov.path.child(e),this.firestore,this.Dv)},e.prototype.add=function(t){Ln("CollectionReference.add",arguments,1);var e=this.Dv?this.Dv.toFirestore(t):t;jn("CollectionReference.add","object",1,e);var n=this.doc();return n.set(t).then((function(){return n}))},e.prototype.withConverter=function(t){return new e(this.Hv,this.firestore,t)},e}(Xr);function ei(t,e){if(void 0===e)return{merge:!1};if(Yn(t,e,["merge","mergeFields"]),Un(t,"boolean","merge",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Wn(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new a(s.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Wn(r[o]))}(t,e,n,r,i)}(t,"mergeFields","a string or a FieldPath",e.mergeFields,(function(t){return"string"==typeof t||t instanceof ir})),void 0!==e.mergeFields&&void 0!==e.merge)throw new a(s.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function ni(t,e){return void 0===e?{}:(Yn(t,e,["serverTimestamps"]),qn(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function ri(t,e){Bn(t,"object",1,e),e&&(Yn(t,e,["source"]),qn(t,0,"source",e.source,["default","server","cache"]))}function ii(t,e,n){if(e instanceof Yr){if(e.firestore!==n)throw new a(s.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Qn(t,"DocumentReference",1,e)}function oi(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ie("Unknown change type: "+t)}}function si(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function ai(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var ui=Zn(zr,"Use firebase.firestore() instead."),ci=Zn(Wr,"Use firebase.firestore().runTransaction() instead."),hi=Zn(Hr,"Use firebase.firestore().batch() instead."),li=Zn(Yr,"Use firebase.firestore().doc() instead."),fi=Zn(Kr),pi=Zn(Jr),di=Zn(Xr),gi=Zn(Zr),mi=Zn(ti,"Use firebase.firestore().collection() instead."),vi=function(){function t(e){this.db=e,12.2===t.Yv(index_cjs.getUA())&&Ee("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.Xv=function(e,n,r){return Se(t.th(),"IndexedDB not supported in current environment."),_e("SimpleDb","Opening database:",e),new Fe((function(i,o){var u=window.indexedDB.open(e,n);u.onsuccess=function(e){var n=e.target.result;i(new t(n))},u.onblocked=function(){o(new a(s.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},u.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new a(s.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},u.onupgradeneeded=function(t){_e("SimpleDb",'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result;r.createOrUpgrade(n,u.transaction,t.oldVersion,Fi).next((function(){_e("SimpleDb","Database upgrade to version "+Fi+" complete")}))}})).wu()},t.delete=function(t){return _e("SimpleDb","Removing database:",t),_i(window.indexedDB.deleteDatabase(t)).wu()},t.th=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(t.$v())return!0;if(void 0===window.navigator)return!1;var e=index_cjs.getUA(),n=t.Yv(e),r=0<n&&n<10,i=t.Zv(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.$v=function(){var t;return void 0!==process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.tw)},t.nw=function(t,e){return t.store(e)},t.Yv=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Zv=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.iw=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var r,i,o,s,a;return tslib_es6.__generator(this,(function(u){switch(u.label){case 0:r="readonly"===t,i=0,o=function(){var t,o,a,u;return tslib_es6.__generator(this,(function(c){switch(c.label){case 0:++i,t=bi.open(s.db,r?"readonly":"readwrite",e),c.label=1;case 1:return c.trys.push([1,3,,4]),(o=n(t).catch((function(e){return t.abort(e),Fe.reject(e)})).wu()).catch((function(){})),[4,t.ew];case 2:return c.sent(),[2,{value:o}];case 3:return a=c.sent(),u="FirebaseError"!==a.name&&i<3,_e("SimpleDb","Transaction failed with error: %s. Retrying: %s.",a.message,u),u?[3,4]:[2,{value:Promise.reject(a)}];case 4:return[2]}}))},s=this,u.label=1;case 1:return[5,o()];case 2:return"object"==typeof(a=u.sent())?[2,a.value]:[3,1];case 3:return[2]}}))}))},t.prototype.close=function(){this.db.close()},t}(),yi=function(){function t(t){this.rw=t,this.uw=!1,this.sw=null}return Object.defineProperty(t.prototype,"fu",{get:function(){return this.uw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ow",{get:function(){return this.sw},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.rw=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.uw=!0},t.prototype.hw=function(t){this.sw=t},t.prototype.delete=function(){return _i(this.rw.delete())},t}(),bi=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.cw=new Me,this.transaction.oncomplete=function(){e.cw.resolve()},this.transaction.onabort=function(){t.error?e.cw.reject(t.error):e.cw.resolve()},this.transaction.onerror=function(t){var n=Ti(t.target.error);e.cw.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"ew",{get:function(){return this.cw.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.cw.reject(t),this.aborted||(_e("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return Se(!!e,"Object store not part of transaction: "+t),new wi(e)},t}(),wi=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(_e("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(_e("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),_i(n)},t.prototype.add=function(t){return _e("SimpleDb","ADD",this.store.name,t,t),_i(this.store.add(t))},t.prototype.get=function(t){var e=this;return _i(this.store.get(t)).next((function(n){return void 0===n&&(n=null),_e("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return _e("SimpleDb","DELETE",this.store.name,t),_i(this.store.delete(t))},t.prototype.count=function(){return _e("SimpleDb","COUNT",this.store.name),_i(this.store.count())},t.prototype.aw=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.fw(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.lw=function(t,e){_e("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.dw=!1;var r=this.cursor(n);return this.fw(r,(function(t,e,n){return n.delete()}))},t.prototype.vw=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.fw(r,e)},t.prototype.ww=function(t){var e=this.cursor({});return new Fe((function(n,r){e.onerror=function(t){var e=Ti(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.fw=function(t,e){var n=[];return new Fe((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new yi(i),s=e(i.primaryKey,i.value,o);if(s instanceof Fe){var a=s.catch((function(t){return o.done(),Fe.reject(t)}));n.push(a)}o.fu?r():null===o.ow?i.continue():i.continue(o.ow)}else r()}})).next((function(){return Fe.pu(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(Se(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.dw?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function _i(t){return new Fe((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Ti(t.target.error);n(e)}}))}var Ei=!1;function Ti(t){var e=vi.Yv(index_cjs.getUA());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new a("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ei||(Ei=!0,setTimeout((function(){throw r}),0)),r}}return t}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ii=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Bh=n,this.Cs=r,this.mw={}}return t.pw=function(e,n,r,i){return Se(""!==e.uid,"UserID must not be an empty string."),new t(e.t()?e.uid:"",n,r,i)},t.prototype.oc=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ki(t).vw({index:zi.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.Ys=function(t,e,n){return this.bw(t).next((function(e){return e.lastStreamToken=n.toBase64(),Ni(t).put(e)}))},t.prototype.uo=function(t){return this.bw(t).next((function(t){return R.fromBase64String(t.lastStreamToken)}))},t.prototype.so=function(t,e){return this.bw(t).next((function(n){return n.lastStreamToken=e.toBase64(),Ni(t).put(n)}))},t.prototype.Ks=function(t,e,n,r){var i=this,o=xi(t),s=ki(t);return s.add({}).next((function(a){Se("number"==typeof a,"Auto-generated key is not a number");for(var u=new Ce(a,e,n,r),c=i.serializer.gw(i.userId,u),h=[],l=new S((function(t,e){return ke(t.J(),e.J())})),f=0,p=r;f<p.length;f++){var d=p[f],g=Wi.key(i.userId,d.key.path,a);l=l.add(d.key.path.L()),h.push(s.put(c)),h.push(o.put(g,Wi.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Bh.rc(t,e))})),t.Lh((function(){i.mw[a]=u.keys()})),Fe.pu(h).next((function(){return u}))}))},t.prototype.io=function(t,e){var n=this;return ki(t).get(e).next((function(t){return t?(Se(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.yw(t)):null}))},t.prototype.Hs=function(t,e){var n=this;return this.mw[e]?Fe.resolve(this.mw[e]):this.io(t,e).next((function(t){if(t){var r=t.keys();return n.mw[e]=r,r}return null}))},t.prototype._o=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ki(t).vw({index:zi.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Se(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.yw(e)),i.done()})).next((function(){return o}))},t.prototype.ro=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ki(t).vw({index:zi.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.qs=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ki(t).aw(zi.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.yw(t)}))}))},t.prototype.Qh=function(t,e){var n=this,r=Wi.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return xi(t).vw({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=mn(u);if(a===n.userId&&e.path.isEqual(h))return ki(t).get(c).next((function(t){if(!t)throw Ie("Dangling document-mutation reference found: "+r+" which points to "+c);Se(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.yw(t))}));s.done()})).next((function(){return o}))},t.prototype.zh=function(t,e){var n=this,r=new S(ke),i=[];return e.forEach((function(e){var o=Wi.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=xi(t).vw({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=mn(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),Fe.pu(i).next((function(){return n._w(t,r)}))},t.prototype.Xh=function(t,e){var n=this;Se(!e.Tn(),"Document queries shouldn't go down this path"),Se(!e.Yn(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=Wi.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new S(ke);return xi(t).vw({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=mn(u);s===n.userId&&r.G(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n._w(t,a)}))},t.prototype._w=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ki(t).get(e).next((function(t){if(null===t)throw Ie("Dangling document-mutation reference found, which points to "+e);Se(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.yw(t))})))})),Fe.pu(i).next((function(){return r}))},t.prototype.eo=function(t,e){var n=this;return Ai(t.Iw,this.userId,e).next((function(r){return t.Lh((function(){n.Uo(e.batchId)})),Fe.forEach(r,(function(e){return n.Cs.lc(t,e)}))}))},t.prototype.Uo=function(t){delete this.mw[t]},t.prototype.to=function(t){var e=this;return this.oc(t).next((function(n){if(!n)return Fe.resolve();var r=IDBKeyRange.lowerBound(Wi.prefixForUser(e.userId)),i=[];return xi(t).vw({range:r},(function(t,n,r){if(t[0]===e.userId){var o=mn(t[1]);i.push(o)}else r.done()})).next((function(){Se(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map((function(t){return t.J()})))}))}))},t.prototype.fs=function(t,e){return Si(t,this.userId,e)},t.prototype.bw=function(t){var e=this;return Ni(t).get(this.userId).next((function(t){return t||new Gi(e.userId,-1,"")}))},t}();function Si(t,e,n){var r=Wi.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return xi(t).vw({range:o,dw:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Ai(t,e,n){var r=t.store(zi.store),i=t.store(Wi.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.vw({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Se(1===a,"Dangling document-mutation reference found: Missing batch "+n.batchId)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=Wi.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return Fe.pu(o).next((function(){return c}))}function ki(t){return fo.nw(t,zi.store)}function xi(t){return fo.nw(t,Wi.store)}function Ni(t){return fo.nw(t,Gi.store)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Ri=function(){function t(t,e){this.Cs=t,this.serializer=e,this.Sc=_n.Ic()}return t.prototype.Ro=function(t){var e=this;return this.Tw(t).next((function(n){return n.highestTargetId=e.Sc.after(n.highestTargetId),e.Ew(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.oo=function(t){return this.Tw(t).next((function(t){return g.P(new d(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Ac=function(t){return Di(t.Iw)},t.prototype.wo=function(t,e,n){var r=this;return this.Tw(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.O()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Ew(t,i)}))},t.prototype.So=function(t,e){var n=this;return this.Cc(t,e).next((function(){return n.Tw(t).next((function(r){return r.targetCount+=1,n.Dw(e,r),n.Ew(t,r)}))}))},t.prototype.do=function(t,e){return this.Cc(t,e)},t.prototype.Pc=function(t,e){var n=this;return this.Vc(t,e.targetId).next((function(){return Oi(t).delete(e.targetId)})).next((function(){return n.Tw(t)})).next((function(e){return Se(e.targetCount>0,"Removing from an empty target cache"),e.targetCount-=1,n.Ew(t,e)}))},t.prototype.Ju=function(t,e,n){var r=this,i=0,o=[];return Oi(t).vw((function(s,a){var u=r.serializer.Rw(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.Pc(t,u)))})).next((function(){return Fe.pu(o)})).next((function(){return i}))},t.prototype.$i=function(t,e){var n=this;return Oi(t).vw((function(t,r){var i=n.serializer.Rw(r);e(i)}))},t.prototype.Tw=function(t){return Ci(t.Iw)},t.prototype.Ew=function(t,e){return(n=t,fo.nw(n,Zi.store)).put(Zi.key,e);var n},t.prototype.Cc=function(t,e){return Oi(t).put(this.serializer.Sw(e))},t.prototype.Dw=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.kc=function(t){return this.Tw(t).next((function(t){return t.targetCount}))},t.prototype.Do=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Oi(t).vw({range:i,index:Ji.queryTargetsIndexName},(function(t,r,i){var s=n.serializer.Rw(r);e.isEqual(s.target)&&(o=s,i.done())})).next((function(){return o}))},t.prototype.ao=function(t,e,n){var r=this,i=[],o=Li(t);return e.forEach((function(e){var s=pn(e.path);i.push(o.put(new Xi(n,s))),i.push(r.Cs.es(t,e))})),Fe.pu(i)},t.prototype.co=function(t,e,n){var r=this,i=Li(t);return Fe.forEach(e,(function(e){var o=pn(e.path);return Fe.pu([i.delete([n,o]),r.Cs.us(t,e)])}))},t.prototype.Vc=function(t,e){var n=Li(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.Po=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Li(t),i=Qt();return r.vw({range:n,dw:!0},(function(t,e,n){var r=mn(t[1]),o=new w(r);i=i.add(o)})).next((function(){return i}))},t.prototype.fs=function(t,e){var n=pn(e.path),r=IDBKeyRange.bound([n],[Ne(n)],!1,!0),i=0;return Li(t).vw({index:Xi.documentTargetsIndex,dw:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.ce=function(t,e){var n=this;return Oi(t).get(e).next((function(t){return t?n.serializer.Rw(t):null}))},t}();function Oi(t){return fo.nw(t,Ji.store)}function Ci(t){return vi.nw(t,Zi.store).get(Zi.key).next((function(t){return Se(null!==t,"Missing metadata row."),t}))}function Di(t){return Ci(t).next((function(t){return t.highestListenSequenceNumber}))}function Li(t){return fo.nw(t,Xi.store)}
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var $i=function(){function t(t,e){this.serializer=t,this.Bh=e}return t.prototype.ms=function(t,e,n){return Mi(t).put(ji(e),n)},t.prototype.bs=function(t,e){var n=Mi(t),r=ji(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Aw(t,r)}))},t.prototype.gs=function(t,e){var n=this;return Mi(t).get(ji(e)).next((function(t){return n.Cw(t)}))},t.prototype.Pw=function(t,e){var n=this;return Mi(t).get(ji(e)).next((function(t){var e=n.Cw(t);return e?{vc:e,size:Bi(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=Vt();return this.Vw(t,e,(function(t,e){var i=n.Cw(e);r=r.ut(t,i)})).next((function(){return r}))},t.prototype.kw=function(t,e){var n=this,r=Vt(),i=new _(w.F);return this.Vw(t,e,(function(t,e){var o=n.Cw(e);o?(r=r.ut(t,o),i=i.ut(t,Bi(e))):(r=r.ut(t,null),i=i.ut(t,0))})).next((function(){return{Nw:r,Ow:i}}))},t.prototype.Vw=function(t,e,n){if(e.M())return Fe.resolve();var r=IDBKeyRange.bound(e.first().path.K(),e.last().path.K()),i=e.ft(),o=i.bt();return Mi(t).vw({range:r},(function(t,e,r){for(var s=w.rt(t);o&&w.F(o,s)<0;)n(o,null),o=i.bt();o&&o.isEqual(s)&&(n(o,e),o=i.gt()?i.bt():null),o?r.hw(o.path.K()):r.done()})).next((function(){for(;o;)n(o,null),o=i.gt()?i.bt():null}))},t.prototype.Vo=function(t,e,n){var r=this;Se(!e.Yn(),"CollectionGroup queries should be handled in LocalDocumentsView");var i=zt(),o=e.path.length+1,s={};if(n.isEqual(g.MIN)){var a=e.path.K();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.K(),c=this.serializer.Fw(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Qi.collectionReadTimeIndex}return Mi(t).vw(s,(function(t,n,s){if(t.length===o){var a=r.serializer.Uw(n);e.path.G(a.key.path)?a instanceof wt&&e.matches(a)&&(i=i.ut(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.Lo=function(t,e){var n=this,r=qt(),i=this.serializer.Fw(e),o=Mi(t),s=IDBKeyRange.lowerBound(i,!0);return o.vw({index:Qi.readTimeIndex,range:s},(function(t,e){var o=n.serializer.Uw(e);r=r.ut(o.key,o),i=e.readTime})).next((function(){return{Mo:r,readTime:n.serializer.jw(i)}}))},t.prototype.qo=function(t){var e=this,n=Mi(t),r=g.MIN;return n.vw({index:Qi.readTimeIndex,reverse:!0},(function(t,n,i){n.readTime&&(r=e.serializer.jw(n.readTime)),i.done()})).next((function(){return r}))},t.prototype.Xs=function(e){return new t.mc(this,!!e&&e.$s)},t.prototype.pc=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Pi(t).get(Ki.key).next((function(t){return Se(!!t,"Missing document cache metadata"),t}))},t.prototype.Aw=function(t,e){return Pi(t).put(Ki.key,e)},t.prototype.Cw=function(t){if(t){var e=this.serializer.Uw(t);return e instanceof _t&&e.version.isEqual(g.V())?null:e}return null},t.mc=function(t){function e(e,n){var r=t.call(this)||this;return r.bc=e,r.$s=n,r.xw=new Le((function(t){return t.toString()})),r}return tslib_es6.__extends(e,t),e.prototype.Is=function(t){var e=this,n=[],r=0,i=new S((function(t,e){return ke(t.J(),e.J())}));return this.ds.forEach((function(o,s){var a=e.xw.get(o);if(Se(void 0!==a,"Cannot modify a document that wasn't read (for "+o+")"),s){Se(!e.readTime.isEqual(g.MIN),"Cannot add a document with a read time of zero");var u=e.bc.serializer.Lw(s,e.readTime);i=i.add(o.path.L());var c=Bi(u);r+=c-a,n.push(e.bc.ms(t,o,u))}else if(r-=a,e.$s){var h=e.bc.serializer.Lw(new _t(o,g.V()),e.readTime);n.push(e.bc.ms(t,o,h))}else n.push(e.bc.bs(t,o))})),i.forEach((function(r){n.push(e.bc.Bh.rc(t,r))})),n.push(this.bc.updateMetadata(t,r)),Fe.pu(n)},e.prototype.ys=function(t,e){var n=this;return this.bc.Pw(t,e).next((function(t){return null===t?(n.xw.set(e,0),null):(n.xw.set(e,t.size),t.vc)}))},e.prototype._s=function(t,e){var n=this;return this.bc.kw(t,e).next((function(t){var e=t.Nw;return t.Ow.forEach((function(t,e){n.xw.set(t,e)})),e}))},e}(Qe),t}();function Pi(t){return fo.nw(t,Ki.store)}function Mi(t){return fo.nw(t,Qi.store)}function ji(t){return t.path.K()}function Bi(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ie("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var Fi=10,Ui=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Se(n<r&&n>=0&&r<=Fi,"Unexpected schema upgrade from v"+n+" to v"+r+".");var o=new bi(e);n<1&&r>=1&&(function(t){t.createObjectStore(Vi.store)}(t),function(t){t.createObjectStore(Gi.store,{keyPath:Gi.keyPath}),t.createObjectStore(zi.store,{keyPath:zi.keyPath,autoIncrement:!0}).createIndex(zi.userMutationsIndex,zi.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Wi.store)}(t),eo(t),function(t){t.createObjectStore(Qi.store)}(t));var s=Fe.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Xi.store),t.deleteObjectStore(Ji.store),t.deleteObjectStore(Zi.store)}(t),eo(t)),s=s.next((function(){return function(t){var e=t.store(Zi.store),n=new Zi(0,0,g.MIN.O(),0);return e.put(Zi.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(zi.store).aw().next((function(n){t.deleteObjectStore(zi.store),t.createObjectStore(zi.store,{keyPath:zi.keyPath,autoIncrement:!0}).createIndex(zi.userMutationsIndex,zi.userMutationsKeyPath,{unique:!0});var r=e.store(zi.store),i=n.map((function(t){return r.put(t)}));return Fe.pu(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(no.store,{keyPath:no.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Ki.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Qi.store);e.createIndex(Qi.readTimeIndex,Qi.readTimeIndexPath,{unique:!1}),e.createIndex(Qi.collectionReadTimeIndex,Qi.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Qi.store).vw((function(t,n){e+=Bi(n)})).next((function(){var n=new Ki(e);return t.store(Ki.store).put(Ki.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Gi.store),r=t.store(zi.store);return n.aw().next((function(n){return Fe.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.aw(zi.userMutationsIndex,i).next((function(r){return Fe.forEach(r,(function(r){Se(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.yw(r);return Ai(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Xi.store),n=t.store(Qi.store);return Di(t).next((function(t){var r=[];return n.vw((function(n,i){var o=new v(n),s=function(t){return[0,pn(t)]}(o);r.push(e.get(s).next((function(n){return n?Fe.resolve():function(n){return e.put(new Xi(0,pn(n),t))}(o)})))})).next((function(){return Fe.pu(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(to.store,{keyPath:to.keyPath});var n=e.store(to.store),r=new yn,i=function(t){if(r.add(t)){var e=t.B(),i=t.L();return n.put({collectionId:e,parent:pn(i)})}};return e.store(Qi.store).vw({dw:!0},(function(t,e){var n=new v(t);return i(n.L())})).next((function(){return e.store(Wi.store).vw({dw:!0},(function(t,e){t[0];var n=t[1],r=(t[2],mn(n));return i(r.L())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Ji.store);return n.vw((function(t,r){var i=e.serializer.Rw(r),o=e.serializer.Sw(i);return n.put(o)}))},t}(),qi=function(t,e){this.seconds=t,this.nanoseconds=e},Vi=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}(),Gi=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),zi=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}(),Wi=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,pn(e)]},t.key=function(t,e,n){return[t,pn(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}(),Hi=function(t,e){this.path=t,this.readTime=e},Yi=function(t,e){this.path=t,this.version=e},Qi=function(){function t(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o}return t.store="remoteDocuments",t.readTimeIndex="readTimeIndex",t.readTimeIndexPath="readTime",t.collectionReadTimeIndex="collectionReadTimeIndex",t.collectionReadTimeIndexPath=["parentPath","readTime"],t}(),Ki=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}(),Ji=function(){function t(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Xi=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,Se(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Zi=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),to=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function eo(t){t.createObjectStore(Xi.store,{keyPath:Xi.keyPath}).createIndex(Xi.documentTargetsIndex,Xi.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ji.store,{keyPath:Ji.keyPath}).createIndex(Ji.queryTargetsIndexName,Ji.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Zi.store)}var no=function(){function t(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}return t.store="clientMetadata",t.keyPath="clientId",t}(),ro=[Gi.store,zi.store,Wi.store,Qi.store,Ji.store,Vi.store,Zi.store,Xi.store],io=tslib_es6.__spreadArrays(ro,[no.store]),oo=tslib_es6.__spreadArrays(io,[Ki.store]),so=tslib_es6.__spreadArrays(oo,[to.store]),ao=function(){function t(){this.Mw=new yn}return t.prototype.rc=function(t,e){var n=this;if(Se(e.length%2==1,"Expected a collection path."),!this.Mw.has(e)){var r=e.B(),i=e.L();t.Lh((function(){n.Mw.add(e)}));var o={collectionId:r,parent:pn(i)};return uo(t).put(o)}return Fe.resolve()},t.prototype.Yh=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Ne(e),""],!1,!0);return uo(t).aw(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(mn(o.parent))}return n}))},t}();function uo(t){return fo.nw(t,to.store)}
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */var co=function(){function t(t){this.qw=t}return t.prototype.Uw=function(t){if(t.document)return this.qw.Ae(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=w.rt(t.noDocument.path),n=this.Bw(t.noDocument.readTime);return new _t(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}return t.unknownDocument?(e=w.rt(t.unknownDocument.path),n=this.Bw(t.unknownDocument.version),new Et(e,n)):Ie("Unexpected DbRemoteDocument")},t.prototype.Lw=function(t,e){var n=this.Fw(e),r=t.key.path.L().K();if(t instanceof wt){var i=this.qw.Se(t),o=t.hasCommittedMutations;return new Qi(null,null,i,o,n,r)}if(t instanceof _t){var s=t.key.path.K(),a=this.Qw(t.version);return o=t.hasCommittedMutations,new Qi(null,new Hi(s,a),null,o,n,r)}if(t instanceof Et){s=t.key.path.K();var u=this.Qw(t.version);return new Qi(new Yi(s,u),null,null,!0,n,r)}return Ie("Unexpected MaybeDocument")},t.prototype.Fw=function(t){var e=t.O();return[e.seconds,e.nanoseconds]},t.prototype.jw=function(t){var e=new d(t[0],t[1]);return g.P(e)},t.prototype.Qw=function(t){var e=t.O();return new qi(e.seconds,e.nanoseconds)},t.prototype.Bw=function(t){var e=new d(t.seconds,t.nanoseconds);return g.P(e)},t.prototype.gw=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.qw.Fe(t)})),i=e.mutations.map((function(t){return n.qw.Fe(t)}));return new zi(t,e.batchId,e.gr.toMillis(),r,i)},t.prototype.yw=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.qw.Le(t)})),r=t.mutations.map((function(t){return e.qw.Le(t)})),i=d.fromMillis(t.localWriteTimeMs);return new Ce(t.batchId,i,n,r)},t.prototype.Gw=function(t){var e=[];return t.forEach((function(t){e.push(pn(t.path))})),e},t.prototype.Ww=function(t){for(var e=Qt(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new w(mn(i)))}return e},t.prototype.Rw=function(t){var e,n=this.Bw(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Bw(t.lastLimboFreeSnapshotVersion):g.MIN;return e=void 0!==t.query.documents?this.qw.ze(t.query):this.qw.Xe(t.query),new Mt(e,t.targetId,0,t.lastListenSequenceNumber,n,r,R.fromBase64String(t.resumeToken))},t.prototype.Sw=function(t){Se(0===t.ti,"Only queries with purpose 0 may be stored, got "+t.ti);var e,n=this.Qw(t.ni),r=this.Qw(t.lastLimboFreeSnapshotVersion);e=t.target.Tn()?this.qw.We(t.target):this.qw.Ke(t.target);var i=t.resumeToken.toBase64();return new Ji(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},t}(),ho="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",lo=function(t){function e(e,n){var r=t.call(this)||this;return r.Iw=e,r.fo=n,r}return tslib_es6.__extends(e,t),e}(hn),fo=function(){function t(e,n,r,i,o,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.zo=u,this.zw=h,this.Fc=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Kw=null,this.inForeground=!1,this.Jw=null,this.Hw=null,this.Yw=Number.NEGATIVE_INFINITY,this.Xw=function(t){return Promise.resolve()},this.Cs=new mo(this,o),this.$w=n+t.Zw,this.serializer=new co(c),this.document=i.document,this.Os=new Ri(this.Cs,this.serializer),this.Bh=new ao,this.qh=new $i(this.serializer,this.Bh),!i.window||!i.window.localStorage)throw new a(s.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=i.window,this.tm=this.window.localStorage}return t.nw=function(t,e){if(t instanceof lo)return vi.nw(t.Iw,e);throw Ie("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.nm=function(e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:if(!t.th())throw new a(s.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(n=new t(e.allowTabSynchronization,e.persistenceKey,e.clientId,e.platform,e.im,e.zo,e.serializer,e.zw)).start()];case 1:return r.sent(),[2,n]}}))}))},t.prototype.start=function(){var t=this;return Se(!this.qu,"IndexedDbPersistence double-started!"),Se(null!==this.window,"Expected 'window' to be defined"),vi.Xv(this.$w,Fi,new Ui(this.serializer)).then((function(e){return t.em=e,t.rm()})).then((function(){return t.um(),t.sm(),t.om(),t.em.runTransaction("readonly",[Zi.store],(function(t){return Di(t)}))})).then((function(e){t.Oc=new Pe(e,t.zw)})).then((function(){t.Fc=!0})).catch((function(e){return t.em&&t.em.close(),Promise.reject(e)}))},t.prototype.jc=function(t){var e=this;return this.Xw=function(n){return tslib_es6.__awaiter(e,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){return this.qu?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.xc=function(t){var e=this;this.em.iw((function(n){return tslib_es6.__awaiter(e,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.jo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.zo.Qr((function(){return tslib_es6.__awaiter(e,void 0,void 0,(function(){return tslib_es6.__generator(this,(function(t){switch(t.label){case 0:return this.qu?[4,this.rm()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.rm=function(){var t=this;return this.em.runTransaction("readwrite",so,(function(e){return go(e).put(new no(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.hm(e).next((function(e){e||(t.isPrimary=!1,t.zo.Qr((function(){return t.Xw(!1)})))}))})).next((function(){return t.cm(e)})).next((function(n){return t.isPrimary&&!n?t.am(e).next((function(){return!1})):!!n&&t.fm(e).next((function(){return!0}))}))})).catch((function(e){if(!t.allowTabSynchronization)throw e;return _e("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.zo.Qr((function(){return t.Xw(e)})),t.isPrimary=e}))},t.prototype.hm=function(t){var e=this;return po(t).get(Vi.key).next((function(t){return Fe.resolve(e.lm(t))}))},t.prototype.dm=function(t){return go(t).delete(this.clientId)},t.prototype.vm=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var e=this;return tslib_es6.__generator(this,(function(n){switch(n.label){case 0:return!this.isPrimary||this.wm(this.Yw,18e5)?[3,2]:(this.Yw=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(n){var r=t.nw(n,no.store);return r.aw().next((function(t){var n=e.mm(t,18e5),i=t.filter((function(t){return-1===n.indexOf(t)}));return Fe.forEach(i,(function(t){return r.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:n.sent().forEach((function(t){e.window.localStorage.removeItem(e.pm(t.clientId))})),n.label=2;case 2:return[2]}}))}))},t.prototype.om=function(){var t=this;this.Hw=this.zo.iu("client_metadata_refresh",4e3,(function(){return t.rm().then((function(){return t.vm()})).then((function(){return t.om()}))}))},t.prototype.lm=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.cm=function(t){var e=this;return po(t).get(Vi.key).next((function(n){if(null!==n&&e.wm(n.leaseTimestampMs,5e3)&&!e.bm(n.ownerId)){if(e.lm(n)&&e.networkEnabled)return!0;if(!e.lm(n)){if(!n.allowTabSynchronization)throw new a(s.FAILED_PRECONDITION,ho);return!1}}return!(!e.networkEnabled||!e.inForeground)||go(t).aw().next((function(t){return void 0===e.mm(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&_e("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var t=this;return tslib_es6.__generator(this,(function(e){switch(e.label){case 0:return this.Fc=!1,this.gm(),this.Hw&&(this.Hw.cancel(),this.Hw=null),this.ym(),this._m(),[4,this.em.runTransaction("readwrite",[Vi.store,no.store],(function(e){return t.am(e).next((function(){return t.dm(e)}))}))];case 1:return e.sent(),this.em.close(),this.Im(),[2]}}))}))},t.prototype.mm=function(t,e){var n=this;return t.filter((function(t){return n.wm(t.updateTimeMs,e)&&!n.bm(t.clientId)}))},t.prototype.Oo=function(){var t=this;return this.em.runTransaction("readonly",[no.store],(function(e){return go(e).aw().next((function(e){return t.mm(e,18e5).map((function(t){return t.clientId}))}))}))},t.clearPersistence=function(e){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var n;return tslib_es6.__generator(this,(function(r){switch(r.label){case 0:return t.th()?(n=e+t.Zw,[4,vi.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}}))}))},Object.defineProperty(t.prototype,"qu",{get:function(){return this.Fc},enumerable:!0,configurable:!0}),t.prototype.Vs=function(t){return Se(this.qu,"Cannot initialize MutationQueue before persistence is started."),Ii.pw(t,this.serializer,this.Bh,this.Cs)},t.prototype.Fs=function(){return Se(this.qu,"Cannot initialize TargetCache before persistence is started."),this.Os},t.prototype.Ns=function(){return Se(this.qu,"Cannot initialize RemoteDocumentCache before persistence is started."),this.qh},t.prototype.js=function(){return Se(this.qu,"Cannot initialize IndexManager before persistence is started."),this.Bh},t.prototype.runTransaction=function(t,e,n){var r=this;_e("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.em.runTransaction(o,so,(function(o){return i=new lo(o,r.Oc.next()),"readwrite-primary"===e?r.hm(o).next((function(t){return!!t||r.cm(o)})).next((function(e){if(!e)throw Ee("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.zo.Qr((function(){return r.Xw(!1)})),new a(s.FAILED_PRECONDITION,cn);return n(i)})).next((function(t){return r.fm(o).next((function(){return t}))})):r.Tm(o).next((function(){return n(i)}))})).then((function(t){return i.Mh(),t}))},t.prototype.Tm=function(t){var e=this;return po(t).get(Vi.key).next((function(t){if(null!==t&&e.wm(t.leaseTimestampMs,5e3)&&!e.bm(t.ownerId)&&!e.lm(t)&&!t.allowTabSynchronization)throw new a(s.FAILED_PRECONDITION,ho)}))},t.prototype.fm=function(t){var e=new Vi(this.clientId,this.allowTabSynchronization,Date.now());return po(t).put(Vi.key,e)},t.th=function(){return vi.th()},t.Em=function(t){var e=t.ae.projectId;return t.ae.br||(e+="."+t.ae.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.am=function(t){var e=this,n=po(t);return n.get(Vi.key).next((function(t){return e.lm(t)?(_e("IndexedDbPersistence","Releasing primary lease."),n.delete(Vi.key)):Fe.resolve()}))},t.prototype.wm=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Ee("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.um=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Jw=function(){t.zo.Qr((function(){return t.inForeground="visible"===t.document.visibilityState,t.rm()}))},this.document.addEventListener("visibilitychange",this.Jw),this.inForeground="visible"===this.document.visibilityState)},t.prototype.ym=function(){this.Jw&&(Se(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.Jw),this.Jw=null)},t.prototype.sm=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Kw=function(){t.gm(),t.zo.Qr((function(){return t.shutdown()}))},this.window.addEventListener("unload",this.Kw))},t.prototype._m=function(){this.Kw&&(Se("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.Kw),this.Kw=null)},t.prototype.bm=function(t){try{var e=null!==this.tm.getItem(this.pm(t));return _e("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Ee("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.gm=function(){try{this.tm.setItem(this.pm(this.clientId),String(Date.now()))}catch(t){Ee("Failed to set zombie client id.",t)}},t.prototype.Im=function(){try{this.tm.removeItem(this.pm(this.clientId))}catch(t){}},t.prototype.pm=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.Zw="main",t}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */function po(t){return t.store(Vi.store)}function go(t){return t.store(no.store)}var mo=function(){function t(t,e){this.db=t,this.Bc=null,this.ju=new We(this,e)}return t.prototype.Wu=function(t){var e=this.Dm(t);return this.db.Fs().kc(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.Dm=function(t){var e=0;return this.Ku(t,(function(t){e++})).next((function(){return e}))},t.prototype.$i=function(t,e){return this.db.Fs().$i(t,e)},t.prototype.Ku=function(t,e){return this.Rm(t,(function(t,n){return e(n)}))},t.prototype.As=function(t){this.Bc=t},t.prototype.es=function(t,e){return vo(t,e)},t.prototype.us=function(t,e){return vo(t,e)},t.prototype.Ju=function(t,e,n){return this.db.Fs().Ju(t,e,n)},t.prototype.lc=function(t,e){return vo(t,e)},t.prototype.Sm=function(t,e){return this.Bc.fs(e)?Fe.resolve(!0):function(t,e){var n=!1;return Ni(t).ww((function(r){return Si(t,r,e).next((function(t){return t&&(n=!0),Fe.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.Hu=function(t,e){var n=this,r=this.db.Ns().Xs(),i=[],o=0;return this.Rm(t,(function(s,a){if(a<=e){var u=n.Sm(t,s).next((function(e){if(!e)return o++,r.gs(t,s).next((function(){return r.bs(s),Li(t).delete([0,pn(s.path)])}))}));i.push(u)}})).next((function(){return Fe.pu(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.ii(t.fo);return this.db.Fs().do(t,n)},t.prototype.vo=function(t,e){return vo(t,e)},t.prototype.Rm=function(t,e){var n,r=Li(t),i=Pe.Nr;return r.vw({index:Xi.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==Pe.Nr&&e(new w(mn(n)),i),i=a,n=s):i=Pe.Nr})).next((function(){i!==Pe.Nr&&e(new w(mn(n)),i)}))},t.prototype.Xu=function(t){return this.db.Ns().pc(t)},t}();function vo(t,e){return Li(t).put(function(t,e){return new Xi(0,pn(t.path),e)}(e,t.fo))}var yo=function(){function t(){}return t.prototype.initialize=function(t,e,n,r,i,o){return tslib_es6.__awaiter(this,void 0,void 0,(function(){var u,c,h,l;return tslib_es6.__generator(this,(function(f){switch(f.label){case 0:if(Se(o.zc,"IndexedDbPersistenceProvider can only provide durable persistence"),Se(!this.persistence,"configure() already called"),u=fo.Em(e),c=new ge(e.ae,{de:ve.xt().de}),!an.th(n))throw new a(s.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return this.Ml=o.synchronizeTabs?new an(t,n,u,r,i):new un,h=this,[4,fo.nm({allowTabSynchronization:o.synchronizeTabs,persistenceKey:u,clientId:r,platform:n,zo:t,serializer:c,im:Ge.Pu(o.cacheSizeBytes),zw:this.Ml})];case 1:return h.persistence=f.sent(),l=this.persistence.Cs.ju,this.Md=new ze(l,t),[2]}}))}))},t.prototype.Jc=function(){return Se(!!this.persistence,"initialize() not called"),this.persistence},t.prototype.Hc=function(){return Se(!!this.Ml,"initialize() not called"),this.Ml},t.prototype.Kc=function(){return Se(!!this.Md,"initialize() not called"),this.Md},t.prototype.clearPersistence=function(t){var e=fo.Em(t);return fo.clearPersistence(e)},t}(),bo={Firestore:ui,GeoPoint:pr,Timestamp:d,Blob:rr,Transaction:ci,WriteBatch:hi,DocumentReference:li,DocumentSnapshot:fi,Query:di,QueryDocumentSnapshot:pi,QuerySnapshot:gi,CollectionReference:mi,FieldPath:ir,FieldValue:fr,setLogLevel:zr.setLogLevel,CACHE_SIZE_UNLIMITED:Vr},wo=function(){function t(){}return t.prototype.jf=function(t){},t.prototype.shutdown=function(){},t}(),_o=function(){function t(){var t=this;this.Am=function(){return t.Cm()},this.Pm=function(){return t.Vm()},this.km=[],this.Nm()}return t.prototype.jf=function(t){this.km.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.Am),window.removeEventListener("offline",this.Pm)},t.prototype.Nm=function(){window.addEventListener("online",this.Am),window.addEventListener("offline",this.Pm)},t.prototype.Cm=function(){_e("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.km;t<e.length;t++)(0,e[t])(0)},t.prototype.Vm=function(){_e("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.km;t<e.length;t++)(0,e[t])(1)},t.th=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Eo=function(){function t(t){this.Om=t.Om,this.Fm=t.Fm}return t.prototype.Ea=function(t){Se(!this.Um,"Called onOpen on stream twice!"),this.Um=t},t.prototype.ga=function(t){Se(!this.jm,"Called onClose on stream twice!"),this.jm=t},t.prototype.onMessage=function(t){Se(!this.xm,"Called onMessage on stream twice!"),this.xm=t},t.prototype.close=function(){this.Fm()},t.prototype.send=function(t){this.Om(t)},t.prototype.Lm=function(){Se(void 0!==this.Um,"Cannot call onOpen because no callback was set"),this.Um()},t.prototype.Mm=function(t){Se(void 0!==this.jm,"Cannot call onClose because no callback was set"),this.jm(t)},t.prototype.qm=function(t){Se(void 0!==this.xm,"Cannot call onMessage because no callback was set"),this.xm(t)},t}(),To={BatchGetDocuments:"batchGet",Commit:"commit"},Io="gl-js/ fire/"+i,So=function(){function t(t){this.ae=t.ae;var e=t.ssl?"https":"http";this.Bm=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.Qm=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=Io},t.prototype.Ua=function(t,e,n){var r=this,i=this.Gm(t);return new Promise((function(o,u){var c=new tmp.XhrIo;c.listenOnce(tmp.EventType.COMPLETE,(function(){try{switch(c.getLastErrorCode()){case tmp.ErrorCode.NO_ERROR:var e=c.getResponseJson();_e("Connection","XHR received:",JSON.stringify(e)),o(e);break;case tmp.ErrorCode.TIMEOUT:_e("Connection",'RPC "'+t+'" timed out'),u(new a(s.DEADLINE_EXCEEDED,"Request time out"));break;case tmp.ErrorCode.HTTP_ERROR:var n=c.getStatus();if(_e("Connection",'RPC "'+t+'" failed with status:',n,"response text:",c.getResponseText()),n>0){var r=c.getResponseJson().error;if(r&&r.status&&r.message){var i=(h=r.status.toLowerCase().replace("_","-"),Object.values(s).indexOf(h)>=0?h:s.UNKNOWN);u(new a(i,r.message))}else u(new a(s.UNKNOWN,"Server responded with status "+c.getStatus()))}else _e("Connection",'RPC "'+t+'" failed'),u(new a(s.UNAVAILABLE,"Connection failed."));break;default:Ie('RPC "'+t+'" failed with unanticipated webchannel error '+c.getLastErrorCode()+": "+c.getLastError()+", giving up.")}}finally{_e("Connection",'RPC "'+t+'" completed.')}var h}));var h=tslib_es6.__assign({},e);delete h.database;var l=JSON.stringify(h);_e("Connection","XHR sending: ",i+" "+l);var f={"Content-Type":"text/plain"};r.Qm(f,n),c.send(i,"POST",l,f,15)}))},t.prototype.ja=function(t,e,n){return this.Ua(t,e,n)},t.prototype.Da=function(t,e){var n=[this.Bm,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=tmp.createWebChannelTransport(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ae.projectId+"/databases/"+this.ae.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Qm(i.initMessageHeaders,e),index_cjs.isMobileCordova()||index_cjs.isReactNative()||index_cjs.isElectron()||index_cjs.isIE()||index_cjs.isUWP()||index_cjs.isBrowserExtension()||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");_e("Connection","Creating WebChannel: "+o+" "+i);var u=r.createWebChannel(o,i),c=!1,h=!1,l=new Eo({Om:function(t){h?_e("Connection","Not sending because WebChannel is closed:",t):(c||(_e("Connection","Opening WebChannel transport."),u.open(),c=!0),_e("Connection","WebChannel sending:",t),u.send(t))},Fm:function(){return u.close()}}),f=function(t,e){u.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(tmp.WebChannel.EventType.OPEN,(function(){h||_e("Connection","WebChannel transport opened.")})),f(tmp.WebChannel.EventType.CLOSE,(function(){h||(h=!0,_e("Connection","WebChannel transport closed"),l.Mm())})),f(tmp.WebChannel.EventType.ERROR,(function(t){h||(h=!0,_e("Connection","WebChannel transport errored:",t),l.Mm(new a(s.UNAVAILABLE,"The operation could not be completed")))})),f(tmp.WebChannel.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];Se(!!n,"Got a webchannel message without data.");var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){_e("Connection","WebChannel received error:",i);var o=i.status,c=function(t){var e=ot[t];if(void 0!==e)return Ft(e)}(o),f=i.message;void 0===c&&(c=s.INTERNAL,f="Unknown error status: "+o+" with message "+i.message),h=!0,l.Mm(new a(c,f)),u.close()}else _e("Connection","WebChannel received:",n),l.qm(n)}})),setTimeout((function(){l.Lm()}),0),l},t.prototype.Gm=function(t){var e=To[t];return Se(void 0!==e,"Unknown REST mapping for: "+t),this.Bm+"/v1/projects/"+this.ae.projectId+"/databases/"+this.ae.database+"/documents:"+e},t}(),Ao=window.crypto||window.__PRIVATE_msCrypto,ko=function(){function t(){this.de=!0,this.xa="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.Bd=function(t){return Promise.resolve(new So(t))},t.prototype.Qd=function(){return _o.th()?new _o:new wo},t.prototype.Gd=function(t){return new ge(t,{de:!0})},t.prototype.mr=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t.prototype.randomBytes=function(t){if(t<=0)return new Uint8Array;var e=new Uint8Array(t);return Ao.getRandomValues(e),e},t}();
/**
     * @license
     * Copyright 2017 Google LLC
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
function xo(t){!function(t,e){t.INTERNAL.registerComponent(new index_cjs$1.Component("firestore",(function(t){return function(t,e){return new zr(t,e,new yo)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(tslib_es6.__assign({},bo)))}(t),t.registerVersion("@firebase/firestore","1.13.1")
/**
     * @license
     * Copyright 2017 Google Inc.
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.
     * You may obtain a copy of the License at
     *
     *   http://www.apache.org/licenses/LICENSE-2.0
     *
     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */}ve.wr(new ko),xo(r),e.__PRIVATE_registerFirestore=xo}));unwrapExports(index_cjs$4);var index_cjs_1$3=index_cjs$4.__PRIVATE_registerFirestore;index_cjs$3.initializeApp({apiKey:"AIzaSyDriffF4c33V459hiSyEkFmUZAQaportrs",databaseURL:"not-firebase-58b83.firebaseapp.com",storageBucket:"not-firebase-58b83.appspot.com",projectId:"not-firebase-58b83"});const firestore=index_cjs$3.firestore,firestoreDb=index_cjs$3.firestore();function create_fragment$3(t){let e,n,r,i,o;return{c(){e=space(),n=element("h1"),n.textContent="This is not Meatspac.es",r=space(),i=element("button"),i.textContent="Create a New Room",document.title="NOT Meatspac.es"},m(t,s,a){insert(t,e,s),insert(t,n,s),insert(t,r,s),insert(t,i,s),a&&o(),o=listen(i,"click",handleNewRoomClick)},p:noop,i:noop,o:noop,d(t){t&&detach(e),t&&detach(n),t&&detach(r),t&&detach(i),o()}}}async function handleNewRoomClick(){const t=await firestoreDb.collection("rooms").add({});src_3(`rooms/${t.id}`)}class Routes extends SvelteComponent{constructor(t){super(),init(this,t,null,create_fragment$3,safe_not_equal,{})}}function cubicOut(t){const e=t-1;return e*e*e+1}function quintOut(t){return--t*t*t*t*t+1}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */function __rest$1(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]])}return n}function crossfade(t){var{fallback:e}=t,n=__rest$1(t,["fallback"]);const r=new Map,i=new Map;function o(t,r,i){return(o,s)=>(t.set(s.key,{rect:o.getBoundingClientRect()}),()=>{if(r.has(s.key)){const{rect:t}=r.get(s.key);return r.delete(s.key),function(t,e,r){const{delay:i=0,duration:o=(t=>30*Math.sqrt(t)),easing:s=cubicOut}=assign(assign({},n),r),a=e.getBoundingClientRect(),u=t.left-a.left,c=t.top-a.top,h=t.width/a.width,l=t.height/a.height,f=Math.sqrt(u*u+c*c),p=getComputedStyle(e),d="none"===p.transform?"":p.transform,g=+p.opacity;return{delay:i,duration:is_function(o)?o(f):o,easing:s,css:(t,e)=>`\n\t\t\t\topacity: ${t*g};\n\t\t\t\ttransform-origin: top left;\n\t\t\t\ttransform: ${d} translate(${e*u}px,${e*c}px) scale(${t+(1-t)*h}, ${t+(1-t)*l});\n\t\t\t`}}(t,o,s)}return t.delete(s.key),e&&e(o,s,i)})}return[o(i,r,!1),o(r,i,!0)]}function flip(t,e,n){const r=getComputedStyle(t),i="none"===r.transform?"":r.transform,o=e.from.width/t.clientWidth,s=e.from.height/t.clientHeight,a=(e.from.left-e.to.left)/o,u=(e.from.top-e.to.top)/s,c=Math.sqrt(a*a+u*u),{delay:h=0,duration:l=(t=>120*Math.sqrt(t)),easing:f=cubicOut}=n;return{delay:h,duration:is_function(l)?l(c):l,easing:f,css:(t,e)=>`transform: ${i} translate(${e*a}px, ${e*u}px);`}}var assign$1=make_assign(),create=make_create(),trim=make_trim(),Global="undefined"!=typeof window?window:commonjsGlobal,util={assign:assign$1,create:create,trim:trim,bind:bind,slice:slice,each:each,map:map,pluck:pluck,isList:isList,isFunction:isFunction,isObject:isObject,Global:Global};function make_assign(){return Object.assign?Object.assign:function(t,e,n,r){for(var i=1;i<arguments.length;i++)each(Object(arguments[i]),(function(e,n){t[n]=e}));return t}}function make_create(){if(Object.create)return function(t,e,n,r){var i=slice(arguments,1);return assign$1.apply(this,[Object.create(t)].concat(i))};{function t(){}return function(e,n,r,i){var o=slice(arguments,1);return t.prototype=e,assign$1.apply(this,[new t].concat(o))}}}function make_trim(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}function bind(t,e){return function(){return e.apply(t,Array.prototype.slice.call(arguments,0))}}function slice(t,e){return Array.prototype.slice.call(t,e||0)}function each(t,e){pluck(t,(function(t,n){return e(t,n),!1}))}function map(t,e){var n=isList(t)?[]:{};return pluck(t,(function(t,r){return n[r]=e(t,r),!1})),n}function pluck(t,e){if(isList(t)){for(var n=0;n<t.length;n++)if(e(t[n],n))return t[n]}else for(var r in t)if(t.hasOwnProperty(r)&&e(t[r],r))return t[r]}function isList(t){return null!=t&&"function"!=typeof t&&"number"==typeof t.length}function isFunction(t){return t&&"[object Function]"==={}.toString.call(t)}function isObject(t){return t&&"[object Object]"==={}.toString.call(t)}var slice$1=util.slice,pluck$1=util.pluck,each$1=util.each,bind$1=util.bind,create$1=util.create,isList$1=util.isList,isFunction$1=util.isFunction,isObject$1=util.isObject,storeEngine={createStore:createStore},storeAPI={version:"2.0.12",enabled:!1,get:function(t,e){var n=this.storage.read(this._namespacePrefix+t);return this._deserialize(n,e)},set:function(t,e){return void 0===e?this.remove(t):(this.storage.write(this._namespacePrefix+t,this._serialize(e)),e)},remove:function(t){this.storage.remove(this._namespacePrefix+t)},each:function(t){var e=this;this.storage.each((function(n,r){t.call(e,e._deserialize(n),(r||"").replace(e._namespaceRegexp,""))}))},clearAll:function(){this.storage.clearAll()},hasNamespace:function(t){return this._namespacePrefix=="__storejs_"+t+"_"},createStore:function(){return createStore.apply(this,arguments)},addPlugin:function(t){this._addPlugin(t)},namespace:function(t){return createStore(this.storage,this.plugins,t)}};function _warn(){var t="undefined"==typeof console?null:console;if(t){var e=t.warn?t.warn:t.log;e.apply(t,arguments)}}function createStore(t,e,n){n||(n=""),t&&!isList$1(t)&&(t=[t]),e&&!isList$1(e)&&(e=[e]);var r=n?"__storejs_"+n+"_":"",i=n?new RegExp("^"+r):null;if(!/^[a-zA-Z0-9_\-]*$/.test(n))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var o=create$1({_namespacePrefix:r,_namespaceRegexp:i,_testStorage:function(t){try{var e="__storejs__test__";t.write(e,e);var n=t.read(e)===e;return t.remove(e),n}catch(t){return!1}},_assignPluginFnProp:function(t,e){var n=this[e];this[e]=function(){var e=slice$1(arguments,0),r=this;function i(){if(n)return each$1(arguments,(function(t,n){e[n]=t})),n.apply(r,e)}var o=[i].concat(e);return t.apply(r,o)}},_serialize:function(t){return JSON.stringify(t)},_deserialize:function(t,e){if(!t)return e;var n="";try{n=JSON.parse(t)}catch(e){n=t}return void 0!==n?n:e},_addStorage:function(t){this.enabled||this._testStorage(t)&&(this.storage=t,this.enabled=!0)},_addPlugin:function(t){var e=this;if(isList$1(t))each$1(t,(function(t){e._addPlugin(t)}));else if(!pluck$1(this.plugins,(function(e){return t===e}))){if(this.plugins.push(t),!isFunction$1(t))throw new Error("Plugins must be function values that return objects");var n=t.call(this);if(!isObject$1(n))throw new Error("Plugins must return an object of function properties");each$1(n,(function(n,r){if(!isFunction$1(n))throw new Error("Bad plugin property: "+r+" from plugin "+t.name+". Plugins should only return functions.");e._assignPluginFnProp(n,r)}))}},addStorage:function(t){_warn("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(t)}},storeAPI,{plugins:[]});return o.raw={},each$1(o,(function(t,e){isFunction$1(t)&&(o.raw[e]=bind$1(o,t))})),each$1(t,(function(t){o._addStorage(t)})),each$1(e,(function(t){o._addPlugin(t)})),o}var Global$1=util.Global,localStorage_1={name:"localStorage",read:read,write:write,each:each$2,remove:remove$1,clearAll:clearAll};function localStorage(){return Global$1.localStorage}function read(t){return localStorage().getItem(t)}function write(t,e){return localStorage().setItem(t,e)}function each$2(t){for(var e=localStorage().length-1;e>=0;e--){var n=localStorage().key(e);t(read(n),n)}}function remove$1(t){return localStorage().removeItem(t)}function clearAll(){return localStorage().clear()}var Global$2=util.Global,oldFFGlobalStorage={name:"oldFF-globalStorage",read:read$1,write:write$1,each:each$3,remove:remove$2,clearAll:clearAll$1},globalStorage=Global$2.globalStorage;function read$1(t){return globalStorage[t]}function write$1(t,e){globalStorage[t]=e}function each$3(t){for(var e=globalStorage.length-1;e>=0;e--){var n=globalStorage.key(e);t(globalStorage[n],n)}}function remove$2(t){return globalStorage.removeItem(t)}function clearAll$1(){each$3((function(t,e){delete globalStorage[t]}))}var Global$3=util.Global,oldIEUserDataStorage={name:"oldIE-userDataStorage",write:write$2,read:read$2,each:each$4,remove:remove$3,clearAll:clearAll$2},storageName="storejs",doc=Global$3.document,_withStorageEl=_makeIEStorageElFunction(),disable=(Global$3.navigator?Global$3.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./);function write$2(t,e){if(!disable){var n=fixKey(t);_withStorageEl((function(t){t.setAttribute(n,e),t.save(storageName)}))}}function read$2(t){if(!disable){var e=fixKey(t),n=null;return _withStorageEl((function(t){n=t.getAttribute(e)})),n}}function each$4(t){_withStorageEl((function(e){for(var n=e.XMLDocument.documentElement.attributes,r=n.length-1;r>=0;r--){var i=n[r];t(e.getAttribute(i.name),i.name)}}))}function remove$3(t){var e=fixKey(t);_withStorageEl((function(t){t.removeAttribute(e),t.save(storageName)}))}function clearAll$2(){_withStorageEl((function(t){var e=t.XMLDocument.documentElement.attributes;t.load(storageName);for(var n=e.length-1;n>=0;n--)t.removeAttribute(e[n].name);t.save(storageName)}))}var forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function fixKey(t){return t.replace(/^\d/,"___$&").replace(forbiddenCharsRegex,"___")}function _makeIEStorageElFunction(){if(!doc||!doc.documentElement||!doc.documentElement.addBehavior)return null;var t,e,n;try{(e=new ActiveXObject("htmlfile")).open(),e.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),e.close(),t=e.w.frames[0].document,n=t.createElement("div")}catch(e){n=doc.createElement("div"),t=doc.body}return function(e){var r=[].slice.call(arguments,0);r.unshift(n),t.appendChild(n),n.addBehavior("#default#userData"),n.load(storageName),e.apply(this,r),t.removeChild(n)}}var Global$4=util.Global,trim$1=util.trim,cookieStorage={name:"cookieStorage",read:read$3,write:write$3,each:each$5,remove:remove$4,clearAll:clearAll$3},doc$1=Global$4.document;function read$3(t){if(!t||!_has(t))return null;var e="(?:^|.*;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(doc$1.cookie.replace(new RegExp(e),"$1"))}function each$5(t){for(var e=doc$1.cookie.split(/; ?/g),n=e.length-1;n>=0;n--)if(trim$1(e[n])){var r=e[n].split("="),i=unescape(r[0]);t(unescape(r[1]),i)}}function write$3(t,e){t&&(doc$1.cookie=escape(t)+"="+escape(e)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function remove$4(t){t&&_has(t)&&(doc$1.cookie=escape(t)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function clearAll$3(){each$5((function(t,e){remove$4(e)}))}function _has(t){return new RegExp("(?:^|;\\s*)"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(doc$1.cookie)}var Global$5=util.Global,sessionStorage_1={name:"sessionStorage",read:read$4,write:write$4,each:each$6,remove:remove$5,clearAll:clearAll$4};function sessionStorage(){return Global$5.sessionStorage}function read$4(t){return sessionStorage().getItem(t)}function write$4(t,e){return sessionStorage().setItem(t,e)}function each$6(t){for(var e=sessionStorage().length-1;e>=0;e--){var n=sessionStorage().key(e);t(read$4(n),n)}}function remove$5(t){return sessionStorage().removeItem(t)}function clearAll$4(){return sessionStorage().clear()}var memoryStorage_1={name:"memoryStorage",read:read$5,write:write$5,each:each$7,remove:remove$6,clearAll:clearAll$5},memoryStorage={};function read$5(t){return memoryStorage[t]}function write$5(t,e){memoryStorage[t]=e}function each$7(t){for(var e in memoryStorage)memoryStorage.hasOwnProperty(e)&&t(memoryStorage[e],e)}function remove$6(t){delete memoryStorage[t]}function clearAll$5(t){memoryStorage={}}var all=[localStorage_1,oldFFGlobalStorage,oldIEUserDataStorage,cookieStorage,sessionStorage_1,memoryStorage_1];"object"!=typeof JSON&&(JSON={}),function(){var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta,rep;function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,(function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))+'"':'"'+t+'"'}function str(t,e){var n,r,i,o,s,a=gap,u=e[t];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(t)),"function"==typeof rep&&(u=rep.call(e,t,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,n=0;n<o;n+=1)s[n]=str(n,u)||"null";return i=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,i}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;n<o;n+=1)"string"==typeof rep[n]&&(i=str(r=rep[n],u))&&s.push(quote(r)+(gap?": ":":")+i);else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(i=str(r,u))&&s.push(quote(r)+(gap?": ":":")+i);return i=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value),"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;r<n;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){var j;function walk(t,e){var n,r,i=t[e];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(void 0!==(r=walk(i,n))?i[n]=r:delete i[n]);return reviver.call(t,e,i)}if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,(function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}))),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();var json2=json2Plugin;function json2Plugin(){return{}}var plugins=[json2],store_legacy=storeEngine.createStore(all,plugins);const COLOR_PALETTES={"Black & White":["#000000","#ffffff"],Macintosh:["#333319","#e5ffff"],"IBM 5151":["#25332F","#01EB61"],"Zenith ZVM 1240":["#40291E","#FDCA55"],"Commodore 1084":["#40318F","#88D7DE"],"IBM 8503":["#2E2F36","#EBE5CE"]},STORE_COLOR_PALETTE_ID="dither:colorPaletteId",pageVisible=readable(!document.hidden,t=>{function e(){t(!document.hidden)}return document.addEventListener("visibilitychange",e,!1),()=>{document.removeEventListener("visibilitychange",e,!1)}}),mediaDeviceId=writable(null);let previousMediaStream;async function getMediaStream(t){previousMediaStream&&previousMediaStream.getVideoTracks()[0].stop();const e=await navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:{ideal:t},aspectRatio:{ideal:4/3},frameRate:{ideal:10},width:{ideal:640},height:{ideal:480}}});return previousMediaStream=e,e}const mediaStream=derived([mediaDeviceId],async([t],e)=>{try{e(await getMediaStream(t))}catch(t){console.log("Unable to activate webcam: ",t),alert("Unable to activate webcam!")}});async function getCameras(){let t=[];try{t=(await navigator.mediaDevices.enumerateDevices()).filter(t=>"videoinput"===t.kind)}catch(t){console.log("could not get the devices",t)}return t}const cameras=derived([mediaStream],async([t],e)=>{const n=await getCameras();async function r(){const t=await getCameras();e(t)}return e(n),navigator.mediaDevices.addEventListener("devicechange",r),()=>{navigator.mediaDevices.removeEventListener("devicechange",r)}},[]),colorPaletteId=writable(store_legacy.get(STORE_COLOR_PALETTE_ID)||"Black & White");colorPaletteId.subscribe(t=>store_legacy.set(STORE_COLOR_PALETTE_ID,t));const colorPalette=derived([colorPaletteId],([t],e)=>{e(COLOR_PALETTES[t])}),hexCharacters="a-f\\d",match3or4Hex=`#?[${hexCharacters}]{3}[${hexCharacters}]?`,match6or8Hex=`#?[${hexCharacters}]{6}([${hexCharacters}]{2})?`,nonHexChars=new RegExp(`[^#${hexCharacters}]`,"gi"),validHexSize=new RegExp(`^${match3or4Hex}$|^${match6or8Hex}$`,"i");var hexRgb=(t,e={})=>{if("string"!=typeof t||nonHexChars.test(t)||!validHexSize.test(t))throw new TypeError("Expected a valid hex string");let n=1;8===(t=t.replace(/^#/,"")).length&&(n=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6)),4===t.length&&(n=parseInt(t.slice(3,4).repeat(2),16)/255,t=t.slice(0,3)),3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);const r=parseInt(t,16),i=r>>16,o=r>>8&255,s=255&r;return"array"===e.format?[i,o,s,n]:{red:i,green:o,blue:s,alpha:n}},lookup=[],revLookup=[],Arr="undefined"!=typeof Uint8Array?Uint8Array:Array,inited=!1;function init$1(){inited=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e=0,n=t.length;e<n;++e)lookup[e]=t[e],revLookup[t.charCodeAt(e)]=e;revLookup["-".charCodeAt(0)]=62,revLookup["_".charCodeAt(0)]=63}function toByteArray(t){var e,n,r,i,o,s;inited||init$1();var a=t.length;if(a%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===t[a-2]?2:"="===t[a-1]?1:0,s=new Arr(3*a/4-o),r=o>0?a-4:a;var u=0;for(e=0,n=0;e<r;e+=4,n+=3)i=revLookup[t.charCodeAt(e)]<<18|revLookup[t.charCodeAt(e+1)]<<12|revLookup[t.charCodeAt(e+2)]<<6|revLookup[t.charCodeAt(e+3)],s[u++]=i>>16&255,s[u++]=i>>8&255,s[u++]=255&i;return 2===o?(i=revLookup[t.charCodeAt(e)]<<2|revLookup[t.charCodeAt(e+1)]>>4,s[u++]=255&i):1===o&&(i=revLookup[t.charCodeAt(e)]<<10|revLookup[t.charCodeAt(e+1)]<<4|revLookup[t.charCodeAt(e+2)]>>2,s[u++]=i>>8&255,s[u++]=255&i),s}function tripletToBase64(t){return lookup[t>>18&63]+lookup[t>>12&63]+lookup[t>>6&63]+lookup[63&t]}function encodeChunk(t,e,n){for(var r,i=[],o=e;o<n;o+=3)r=(t[o]<<16)+(t[o+1]<<8)+t[o+2],i.push(tripletToBase64(r));return i.join("")}function fromByteArray(t){var e;inited||init$1();for(var n=t.length,r=n%3,i="",o=[],s=0,a=n-r;s<a;s+=16383)o.push(encodeChunk(t,s,s+16383>a?a:s+16383));return 1===r?(e=t[n-1],i+=lookup[e>>2],i+=lookup[e<<4&63],i+="=="):2===r&&(e=(t[n-2]<<8)+t[n-1],i+=lookup[e>>10],i+=lookup[e>>4&63],i+=lookup[e<<2&63],i+="="),o.push(i),o.join("")}function read$6(t,e,n,r,i){var o,s,a=8*i-r-1,u=(1<<a)-1,c=u>>1,h=-7,l=n?i-1:0,f=n?-1:1,p=t[e+l];for(l+=f,o=p&(1<<-h)-1,p>>=-h,h+=a;h>0;o=256*o+t[e+l],l+=f,h-=8);for(s=o&(1<<-h)-1,o>>=-h,h+=r;h>0;s=256*s+t[e+l],l+=f,h-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=c}return(p?-1:1)*s*Math.pow(2,o-r)}function write$6(t,e,n,r,i,o){var s,a,u,c=8*o-i-1,h=(1<<c)-1,l=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=h):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+l>=1?f/u:f*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=h?(a=0,s=h):s+l>=1?(a=(e*u-1)*Math.pow(2,i),s+=l):(a=e*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&a,p+=d,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;t[n+p]=255&s,p+=d,s/=256,c-=8);t[n+p-d]|=128*g}var toString={}.toString,isArray=Array.isArray||function(t){return"[object Array]"==toString.call(t)},INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=void 0===global$1.TYPED_ARRAY_SUPPORT||global$1.TYPED_ARRAY_SUPPORT;var _kMaxLength=kMaxLength();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,n){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,n)}function from(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?fromArrayBuffer(t,e,n,r):"string"==typeof e?fromString(t,e,n):fromObject(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function alloc(t,e,n,r){return assertSize(e),e<=0?createBuffer(t,e):void 0!==n?"string"==typeof r?createBuffer(t,e).fill(n,r):createBuffer(t,e).fill(n):createBuffer(t,e)}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function fromString(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!Buffer.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|byteLength(e,n),i=(t=createBuffer(t,r)).write(e,n);return i!==r&&(t=t.slice(0,i)),t}function fromArrayLike(t,e){var n=e.length<0?0:0|checked(e.length);t=createBuffer(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function fromArrayBuffer(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e),t}function fromObject(t,e){if(internalIsBuffer(e)){var n=0|checked(e.length);return 0===(t=createBuffer(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||isnan(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&isArray(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function SlowBuffer(t){return+t!=t&&(t=0),Buffer.alloc(+t)}function internalIsBuffer(t){return!(null==t||!t._isBuffer)}function byteLength(t,e){if(internalIsBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return base64ToBytes(t).length;default:if(r)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),r=!0}}function slowToString(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,n);case"utf8":case"utf-8":return utf8Slice(this,e,n);case"ascii":return asciiSlice(this,e,n);case"latin1":case"binary":return latin1Slice(this,e,n);case"base64":return base64Slice(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function swap(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function bidirectionalIndexOf(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=Buffer.from(e,r)),internalIsBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,n,r,i);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):arrayIndexOf(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,n,r,i){var o,s=1,a=t.length,u=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i){var h=-1;for(o=n;o<a;o++)if(c(t,o)===c(e,-1===h?0:o-h)){if(-1===h&&(h=o),o-h+1===u)return h*s}else-1!==h&&(o-=o-h),h=-1}else for(n+u>a&&(n=a-u),o=n;o>=0;o--){for(var l=!0,f=0;f<u;f++)if(c(t,o+f)!==c(e,f)){l=!1;break}if(l)return o}return-1}function hexWrite(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(e.substr(2*s,2),16);if(isNaN(a))return s;t[n+s]=a}return s}function utf8Write(t,e,n,r){return blitBuffer(utf8ToBytes(e,t.length-n),t,n,r)}function asciiWrite(t,e,n,r){return blitBuffer(asciiToBytes(e),t,n,r)}function latin1Write(t,e,n,r){return asciiWrite(t,e,n,r)}function base64Write(t,e,n,r){return blitBuffer(base64ToBytes(e),t,n,r)}function ucs2Write(t,e,n,r){return blitBuffer(utf16leToBytes(e,t.length-n),t,n,r)}function base64Slice(t,e,n){return 0===e&&n===t.length?fromByteArray(t):fromByteArray(t.slice(e,n))}function utf8Slice(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,a,u,c=t[i],h=null,l=c>239?4:c>223?3:c>191?2:1;if(i+l<=n)switch(l){case 1:c<128&&(h=c);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&c)<<6|63&o)>127&&(h=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&c)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(h=u);break;case 4:o=t[i+1],s=t[i+2],a=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(h=u)}null===h?(h=65533,l=1):h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|1023&h),r.push(h),i+=l}return decodeCodePointsArray(r)}Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,n){return from(null,t,e,n)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array),Buffer.alloc=function(t,e,n){return alloc(null,t,e,n)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=isBuffer,Buffer.compare=function(t,e){if(!internalIsBuffer(t)||!internalIsBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},Buffer.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(t,e){if(!isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=Buffer.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var o=t[n];if(!internalIsBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function(t){if(!internalIsBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function(){var t="",e=INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,e).match(/.{2}/g).join(" "),this.length>e&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function(t,e,n,r,i){if(!internalIsBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(e>>>=0),a=Math.min(o,s),u=this.slice(r,i),c=t.slice(e,n),h=0;h<a;++h)if(u[h]!==c[h]){o=u[h],s=c[h];break}return o<s?-1:s<o?1:0},Buffer.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},Buffer.prototype.indexOf=function(t,e,n){return bidirectionalIndexOf(this,t,e,n,!0)},Buffer.prototype.lastIndexOf=function(t,e,n){return bidirectionalIndexOf(this,t,e,n,!1)},Buffer.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return hexWrite(this,t,e,n);case"utf8":case"utf-8":return utf8Write(this,t,e,n);case"ascii":return asciiWrite(this,t,e,n);case"latin1":case"binary":return latin1Write(this,t,e,n);case"base64":return base64Write(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(t){var e=t.length;if(e<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=MAX_ARGUMENTS_LENGTH));return n}function asciiSlice(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function latin1Slice(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function hexSlice(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=toHex(t[o]);return i}function utf16leSlice(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function checkOffset(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,n,r,i,o){if(!internalIsBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function objectWriteUInt32(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function checkIEEE754(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(t,e,n,r,i){return i||checkIEEE754(t,e,n,4),write$6(t,e,n,r,23,4),n+4}function writeDouble(t,e,n,r,i){return i||checkIEEE754(t,e,n,8),write$6(t,e,n,r,52,8),n+8}Buffer.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=Buffer.prototype;else{var i=e-t;n=new Buffer(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},Buffer.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},Buffer.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},Buffer.prototype.readUInt8=function(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},Buffer.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},Buffer.prototype.readInt8=function(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function(t,e){e||checkOffset(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt16BE=function(t,e){e||checkOffset(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt32LE=function(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function(t,e){return e||checkOffset(t,4,this.length),read$6(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function(t,e){return e||checkOffset(t,4,this.length),read$6(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function(t,e){return e||checkOffset(t,8,this.length),read$6(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function(t,e){return e||checkOffset(t,8,this.length),read$6(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||checkInt(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},Buffer.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||checkInt(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},Buffer.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);checkInt(this,t,e,n,i-1,-i)}var o=0,s=1,a=0;for(this[e]=255&t;++o<n&&(s*=256);)t<0&&0===a&&0!==this[e+o-1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},Buffer.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);checkInt(this,t,e,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[e+o]=255&t;--o>=0&&(s*=256);)t<0&&0===a&&0!==this[e+o+1]&&(a=1),this[e+o]=(t/s>>0)-a&255;return e+n},Buffer.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function(t,e,n){return writeFloat(this,t,e,!0,n)},Buffer.prototype.writeFloatBE=function(t,e,n){return writeFloat(this,t,e,!1,n)},Buffer.prototype.writeDoubleLE=function(t,e,n){return writeDouble(this,t,e,!0,n)},Buffer.prototype.writeDoubleBE=function(t,e,n){return writeDouble(this,t,e,!1,n)},Buffer.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},Buffer.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Buffer.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var s=internalIsBuffer(t)?t:utf8ToBytes(new Buffer(t,r).toString()),a=s.length;for(o=0;o<n-e;++o)this[o+e]=s[o%a]}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(t){if((t=stringtrim(t).replace(INVALID_BASE64_RE,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],s=0;s<r;++s){if((n=t.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function asciiToBytes(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function utf16leToBytes(t,e){for(var n,r,i,o=[],s=0;s<t.length&&!((e-=2)<0);++s)r=(n=t.charCodeAt(s))>>8,i=n%256,o.push(i),o.push(r);return o}function base64ToBytes(t){return toByteArray(base64clean(t))}function blitBuffer(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}function isnan(t){return t!=t}function isBuffer(t){return null!=t&&(!!t._isBuffer||isFastBuffer(t)||isSlowBuffer(t))}function isFastBuffer(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function isSlowBuffer(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&isFastBuffer(t.slice(0,0))}var bufferEs6=Object.freeze({__proto__:null,INSPECT_MAX_BYTES:INSPECT_MAX_BYTES,kMaxLength:_kMaxLength,Buffer:Buffer,SlowBuffer:SlowBuffer,isBuffer:isBuffer}),inherits;inherits="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t};var inherits$1=inherits,formatRegExp=/%[sdj%]/g;function format(t){if(!isString(t)){for(var e=[],n=0;n<arguments.length;n++)e.push(inspect(arguments[n]));return e.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(t).replace(formatRegExp,(function(t){if("%%"===t)return"%";if(n>=i)return t;switch(t){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(t){return"[Circular]"}default:return t}})),s=r[n];n<i;s=r[++n])isNull(s)||!isObject$2(s)?o+=" "+s:o+=" "+inspect(s);return o}function deprecate(t,e){if(isUndefined(global$1.process))return function(){return deprecate(t,e).apply(this,arguments)};var n=!1;return function(){return n||(console.error(e),n=!0),t.apply(this,arguments)}}var debugs={},debugEnviron;function debuglog(t){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),t=t.toUpperCase(),!debugs[t])if(new RegExp("\\b"+t+"\\b","i").test(debugEnviron)){debugs[t]=function(){var e=format.apply(null,arguments);console.error("%s %d: %s",t,0,e)}}else debugs[t]=function(){};return debugs[t]}function inspect(t,e){var n={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),isBoolean(e)?n.showHidden=e:e&&_extend(n,e),isUndefined(n.showHidden)&&(n.showHidden=!1),isUndefined(n.depth)&&(n.depth=2),isUndefined(n.colors)&&(n.colors=!1),isUndefined(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=stylizeWithColor),formatValue(n,t,n.depth)}function stylizeWithColor(t,e){var n=inspect.styles[e];return n?"["+inspect.colors[n][0]+"m"+t+"["+inspect.colors[n][1]+"m":t}function stylizeNoColor(t,e){return t}function arrayToHash(t){var e={};return t.forEach((function(t,n){e[t]=!0})),e}function formatValue(t,e,n){if(t.customInspect&&e&&isFunction$2(e.inspect)&&e.inspect!==inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(n,t);return isString(r)||(r=formatValue(t,r,n)),r}var i=formatPrimitive(t,e);if(i)return i;var o=Object.keys(e),s=arrayToHash(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(e)),isError(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return formatError(e);if(0===o.length){if(isFunction$2(e)){var a=e.name?": "+e.name:"";return t.stylize("[Function"+a+"]","special")}if(isRegExp(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(isDate(e))return t.stylize(Date.prototype.toString.call(e),"date");if(isError(e))return formatError(e)}var u,c="",h=!1,l=["{","}"];(isArray$1(e)&&(h=!0,l=["[","]"]),isFunction$2(e))&&(c=" [Function"+(e.name?": "+e.name:"")+"]");return isRegExp(e)&&(c=" "+RegExp.prototype.toString.call(e)),isDate(e)&&(c=" "+Date.prototype.toUTCString.call(e)),isError(e)&&(c=" "+formatError(e)),0!==o.length||h&&0!=e.length?n<0?isRegExp(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special"):(t.seen.push(e),u=h?formatArray(t,e,n,s,o):o.map((function(r){return formatProperty(t,e,n,s,r,h)})),t.seen.pop(),reduceToSingleString(u,c,l)):l[0]+c+l[1]}function formatPrimitive(t,e){if(isUndefined(e))return t.stylize("undefined","undefined");if(isString(e)){var n="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(n,"string")}return isNumber(e)?t.stylize(""+e,"number"):isBoolean(e)?t.stylize(""+e,"boolean"):isNull(e)?t.stylize("null","null"):void 0}function formatError(t){return"["+Error.prototype.toString.call(t)+"]"}function formatArray(t,e,n,r,i){for(var o=[],s=0,a=e.length;s<a;++s)hasOwnProperty(e,String(s))?o.push(formatProperty(t,e,n,r,String(s),!0)):o.push("");return i.forEach((function(i){i.match(/^\d+$/)||o.push(formatProperty(t,e,n,r,i,!0))})),o}function formatProperty(t,e,n,r,i,o){var s,a,u;if((u=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]}).get?a=u.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):u.set&&(a=t.stylize("[Setter]","special")),hasOwnProperty(r,i)||(s="["+i+"]"),a||(t.seen.indexOf(u.value)<0?(a=isNull(n)?formatValue(t,u.value,null):formatValue(t,u.value,n-1)).indexOf("\n")>-1&&(a=o?a.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+a.split("\n").map((function(t){return"   "+t})).join("\n")):a=t.stylize("[Circular]","special")),isUndefined(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+a}function reduceToSingleString(t,e,n){return t.reduce((function(t,e){return e.indexOf("\n"),t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+n[1]:n[0]+e+" "+t.join(", ")+" "+n[1]}function isArray$1(t){return Array.isArray(t)}function isBoolean(t){return"boolean"==typeof t}function isNull(t){return null===t}function isNullOrUndefined(t){return null==t}function isNumber(t){return"number"==typeof t}function isString(t){return"string"==typeof t}function isSymbol(t){return"symbol"==typeof t}function isUndefined(t){return void 0===t}function isRegExp(t){return isObject$2(t)&&"[object RegExp]"===objectToString(t)}function isObject$2(t){return"object"==typeof t&&null!==t}function isDate(t){return isObject$2(t)&&"[object Date]"===objectToString(t)}function isError(t){return isObject$2(t)&&("[object Error]"===objectToString(t)||t instanceof Error)}function isFunction$2(t){return"function"==typeof t}function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function isBuffer$1(t){return isBuffer(t)}function objectToString(t){return Object.prototype.toString.call(t)}function pad(t){return t<10?"0"+t.toString(10):t.toString(10)}inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var t=new Date,e=[pad(t.getHours()),pad(t.getMinutes()),pad(t.getSeconds())].join(":");return[t.getDate(),months[t.getMonth()],e].join(" ")}function log(){console.log("%s - %s",timestamp(),format.apply(null,arguments))}function _extend(t,e){if(!e||!isObject$2(e))return t;for(var n=Object.keys(e),r=n.length;r--;)t[n[r]]=e[n[r]];return t}function hasOwnProperty(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var util$1={inherits:inherits$1,_extend:_extend,log:log,isBuffer:isBuffer$1,isPrimitive:isPrimitive,isFunction:isFunction$2,isError:isError,isDate:isDate,isObject:isObject$2,isRegExp:isRegExp,isUndefined:isUndefined,isSymbol:isSymbol,isString:isString,isNumber:isNumber,isNullOrUndefined:isNullOrUndefined,isNull:isNull,isBoolean:isBoolean,isArray:isArray$1,inspect:inspect,deprecate:deprecate,format:format,debuglog:debuglog};function compare(t,e){if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0}var hasOwn=Object.prototype.hasOwnProperty,objectKeys=Object.keys||function(t){var e=[];for(var n in t)hasOwn.call(t,n)&&e.push(n);return e},pSlice=Array.prototype.slice,_functionsHaveNames;function functionsHaveNames(){return void 0!==_functionsHaveNames?_functionsHaveNames:_functionsHaveNames="foo"===function(){}.name}function pToString(t){return Object.prototype.toString.call(t)}function isView(t){return!isBuffer(t)&&("function"==typeof global$1.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):!!t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}function assert(t,e){t||fail(t,!0,e,"==",ok)}var regex=/\s*function\s+([^\(\s]*)\s*/,domain;function getName(t){if(isFunction$2(t)){if(functionsHaveNames())return t.name;var e=t.toString().match(regex);return e&&e[1]}}function AssertionError(t){this.name="AssertionError",this.actual=t.actual,this.expected=t.expected,this.operator=t.operator,t.message?(this.message=t.message,this.generatedMessage=!1):(this.message=getMessage(this),this.generatedMessage=!0);var e=t.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,e);else{var n=new Error;if(n.stack){var r=n.stack,i=getName(e),o=r.indexOf("\n"+i);if(o>=0){var s=r.indexOf("\n",o+1);r=r.substring(s+1)}this.stack=r}}}function truncate(t,e){return"string"==typeof t?t.length<e?t:t.slice(0,e):t}function inspect$1(t){if(functionsHaveNames()||!isFunction$2(t))return inspect(t);var e=getName(t);return"[Function"+(e?": "+e:"")+"]"}function getMessage(t){return truncate(inspect$1(t.actual),128)+" "+t.operator+" "+truncate(inspect$1(t.expected),128)}function fail(t,e,n,r,i){throw new AssertionError({message:n,actual:t,expected:e,operator:r,stackStartFunction:i})}function ok(t,e){t||fail(t,!0,e,"==",ok)}function equal(t,e,n){t!=e&&fail(t,e,n,"==",equal)}function notEqual(t,e,n){t==e&&fail(t,e,n,"!=",notEqual)}function deepEqual(t,e,n){_deepEqual(t,e,!1)||fail(t,e,n,"deepEqual",deepEqual)}function deepStrictEqual(t,e,n){_deepEqual(t,e,!0)||fail(t,e,n,"deepStrictEqual",deepStrictEqual)}function _deepEqual(t,e,n,r){if(t===e)return!0;if(isBuffer(t)&&isBuffer(e))return 0===compare(t,e);if(isDate(t)&&isDate(e))return t.getTime()===e.getTime();if(isRegExp(t)&&isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(isView(t)&&isView(e)&&pToString(t)===pToString(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===compare(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(isBuffer(t)!==isBuffer(e))return!1;var i=(r=r||{actual:[],expected:[]}).actual.indexOf(t);return-1!==i&&i===r.expected.indexOf(e)||(r.actual.push(t),r.expected.push(e),objEquiv(t,e,n,r))}return n?t===e:t==e}function isArguments(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function objEquiv(t,e,n,r){if(null==t||null==e)return!1;if(isPrimitive(t)||isPrimitive(e))return t===e;if(n&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=isArguments(t),o=isArguments(e);if(i&&!o||!i&&o)return!1;if(i)return _deepEqual(t=pSlice.call(t),e=pSlice.call(e),n);var s,a,u=objectKeys(t),c=objectKeys(e);if(u.length!==c.length)return!1;for(u.sort(),c.sort(),a=u.length-1;a>=0;a--)if(u[a]!==c[a])return!1;for(a=u.length-1;a>=0;a--)if(!_deepEqual(t[s=u[a]],e[s],n,r))return!1;return!0}function notDeepEqual(t,e,n){_deepEqual(t,e,!1)&&fail(t,e,n,"notDeepEqual",notDeepEqual)}function notDeepStrictEqual(t,e,n){_deepEqual(t,e,!0)&&fail(t,e,n,"notDeepStrictEqual",notDeepStrictEqual)}function strictEqual(t,e,n){t!==e&&fail(t,e,n,"===",strictEqual)}function notStrictEqual(t,e,n){t===e&&fail(t,e,n,"!==",notStrictEqual)}function expectedException(t,e){if(!t||!e)return!1;if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return!0}catch(t){}return!Error.isPrototypeOf(e)&&!0===e.call({},t)}function _tryBlock(t){var e;try{t()}catch(t){e=t}return e}function _throws(t,e,n,r){var i;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof n&&(r=n,n=null),i=_tryBlock(e),r=(n&&n.name?" ("+n.name+").":".")+(r?" "+r:"."),t&&!i&&fail(i,n,"Missing expected exception"+r);var o="string"==typeof r,s=!t&&i&&!n;if((!t&&isError(i)&&o&&expectedException(i,n)||s)&&fail(i,n,"Got unwanted exception"+r),t&&i&&n&&!expectedException(i,n)||!t&&i)throw i}function throws(t,e,n){_throws(!0,t,e,n)}function doesNotThrow(t,e,n){_throws(!1,t,e,n)}function ifError(t){if(t)throw t}function EventHandlers(){}function EventEmitter(){EventEmitter.init.call(this)}function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function emitNone(t,e,n){if(e)t.call(n);else for(var r=t.length,i=arrayClone(t,r),o=0;o<r;++o)i[o].call(n)}function emitOne(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,o=arrayClone(t,i),s=0;s<i;++s)o[s].call(n,r)}function emitTwo(t,e,n,r,i){if(e)t.call(n,r,i);else for(var o=t.length,s=arrayClone(t,o),a=0;a<o;++a)s[a].call(n,r,i)}function emitThree(t,e,n,r,i,o){if(e)t.call(n,r,i,o);else for(var s=t.length,a=arrayClone(t,s),u=0;u<s;++u)a[u].call(n,r,i,o)}function emitMany(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,o=arrayClone(t,i),s=0;s<i;++s)o[s].apply(n,r)}function _addListener(t,e,n,r){var i,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),s=o[e]):(o=t._events=new EventHandlers,t._eventsCount=0),s){if("function"==typeof s?s=o[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),!s.warned&&(i=$getMaxListeners(t))&&i>0&&s.length>i){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,emitWarning(a)}}else s=o[e]=n,++t._eventsCount;return t}function emitWarning(t){"function"==typeof console.warn?console.warn(t):console.log(t)}function _onceWrap(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}function listenerCount(t){var e=this._events;if(e){var n=e[t];if("function"==typeof n)return 1;if(n)return n.length}return 0}function spliceOne(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}function arrayClone(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}assert.AssertionError=AssertionError,inherits$1(AssertionError,Error),assert.fail=fail,assert.ok=ok,assert.equal=equal,assert.notEqual=notEqual,assert.deepEqual=deepEqual,assert.deepStrictEqual=deepStrictEqual,assert.notDeepEqual=notDeepEqual,assert.notDeepStrictEqual=notDeepStrictEqual,assert.strictEqual=strictEqual,assert.notStrictEqual=notStrictEqual,assert.throws=throws,assert.doesNotThrow=doesNotThrow,assert.ifError=ifError,EventHandlers.prototype=Object.create(null),EventEmitter.EventEmitter=EventEmitter,EventEmitter.usingDomains=!1,EventEmitter.prototype.domain=void 0,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.init=function(){this.domain=null,EventEmitter.usingDomains&&domain.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(t){var e,n,r,i,o,s,a,u="error"===t;if(s=this._events)u=u&&null==s.error;else if(!u)return!1;if(a=this.domain,u){if(e=arguments[1],!a){if(e instanceof Error)throw e;var c=new Error('Uncaught, unspecified "error" event. ('+e+")");throw c.context=e,c}return e||(e=new Error('Uncaught, unspecified "error" event')),e.domainEmitter=this,e.domain=a,e.domainThrown=!1,a.emit("error",e),!1}if(!(n=s[t]))return!1;var h="function"==typeof n;switch(r=arguments.length){case 1:emitNone(n,h,this);break;case 2:emitOne(n,h,this,arguments[1]);break;case 3:emitTwo(n,h,this,arguments[1],arguments[2]);break;case 4:emitThree(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];emitMany(n,h,this,i)}return!0},EventEmitter.prototype.addListener=function(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function(t,e){var n,r,i,o,s;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(n=r[t]))return this;if(n===e||n.listener&&n.listener===e)0==--this._eventsCount?this._events=new EventHandlers:(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length;o-- >0;)if(n[o]===e||n[o].listener&&n[o].listener===e){s=n[o].listener,i=o;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete r[t]}else spliceOne(n,i);r.removeListener&&this.emit("removeListener",t,s||e)}return this},EventEmitter.prototype.removeAllListeners=function(t){var e,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events=new EventHandlers:delete n[t]),this;if(0===arguments.length){for(var r,i=Object.keys(n),o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(e)do{this.removeListener(t,e[e.length-1])}while(e[0]);return this},EventEmitter.prototype.listeners=function(t){var e,n=this._events;return n&&(e=n[t])?"function"==typeof e?[e.listener||e]:unwrapListeners(e):[]},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var isarray=Array.isArray||function(t){return"[object Array]"==Object.prototype.toString.call(t)};function BufferList(){this.head=null,this.tail=null,this.length=0}BufferList.prototype.push=function(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},BufferList.prototype.unshift=function(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},BufferList.prototype.shift=function(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},BufferList.prototype.concat=function(t){if(0===this.length)return Buffer.alloc(0);if(1===this.length)return this.head.data;for(var e=Buffer.allocUnsafe(t>>>0),n=this.head,r=0;n;)n.data.copy(e,r),r+=n.data.length,n=n.next;return e};var isBufferEncoding=Buffer.isEncoding||function(t){switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function assertEncoding(t){if(t&&!isBufferEncoding(t))throw new Error("Unknown encoding: "+t)}function StringDecoder(t){switch(this.encoding=(t||"utf8").toLowerCase().replace(/[-_]/,""),assertEncoding(t),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=base64DetectIncompleteChar;break;default:return void(this.write=passThroughWrite)}this.charBuffer=new Buffer(6),this.charReceived=0,this.charLength=0}function passThroughWrite(t){return t.toString(this.encoding)}function utf16DetectIncompleteChar(t){this.charReceived=t.length%2,this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(t){this.charReceived=t.length%3,this.charLength=this.charReceived?3:0}StringDecoder.prototype.write=function(t){for(var e="";this.charLength;){var n=t.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:t.length;if(t.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(t=t.slice(n,t.length),!((i=(e=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(e.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===t.length)return e;break}this.charLength+=this.surrogateSize,e=""}this.detectIncompleteChar(t);var r=t.length;this.charLength&&(t.copy(this.charBuffer,0,t.length-this.charReceived,r),r-=this.charReceived);var i;r=(e+=t.toString(this.encoding,0,r)).length-1;if((i=e.charCodeAt(r))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),t.copy(this.charBuffer,0,0,o),e.substring(0,r)}return e},StringDecoder.prototype.detectIncompleteChar=function(t){for(var e=t.length>=3?3:t.length;e>0;e--){var n=t[t.length-e];if(1==e&&n>>5==6){this.charLength=2;break}if(e<=2&&n>>4==14){this.charLength=3;break}if(e<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=e},StringDecoder.prototype.end=function(t){var e="";if(t&&t.length&&(e=this.write(t)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;e+=r.slice(0,n).toString(i)}return e},Readable.ReadableState=ReadableState;var debug=debuglog("stream");function prependListener(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?Array.isArray(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}function listenerCount$1(t,e){return t.listeners(e).length}function ReadableState(t,e){t=t||{},this.objectMode=!!t.objectMode,e instanceof Duplex&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(this.decoder=new StringDecoder(t.encoding),this.encoding=t.encoding)}function Readable(t){if(!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&"function"==typeof t.read&&(this._read=t.read),EventEmitter.call(this)}function readableAddChunk(t,e,n,r,i){var o=chunkInvalid(e,n);if(o)t.emit("error",o);else if(null===n)e.reading=!1,onEofChunk(t,e);else if(e.objectMode||n&&n.length>0)if(e.ended&&!i){var s=new Error("stream.push() after EOF");t.emit("error",s)}else if(e.endEmitted&&i){var a=new Error("stream.unshift() after end event");t.emit("error",a)}else{var u;!e.decoder||i||r||(n=e.decoder.write(n),u=!e.objectMode&&0===n.length),i||(e.reading=!1),u||(e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,i?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&emitReadable(t))),maybeReadMore(t,e)}else i||(e.reading=!1);return needMoreData(e)}function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}inherits$1(Readable,EventEmitter),Readable.prototype.push=function(t,e){var n=this._readableState;return n.objectMode||"string"!=typeof t||(e=e||n.defaultEncoding)!==n.encoding&&(t=Buffer.from(t,e),e=""),readableAddChunk(this,n,t,e,!1)},Readable.prototype.unshift=function(t){return readableAddChunk(this,this._readableState,t,"",!0)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return this._readableState.decoder=new StringDecoder(t),this._readableState.encoding=t,this};var MAX_HWM=8388608;function computeNewHighWaterMark(t){return t>=MAX_HWM?t=MAX_HWM:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function howMuchToRead(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=computeNewHighWaterMark(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function chunkInvalid(t,e){var n=null;return isBuffer(e)||"string"==typeof e||null==e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function onEofChunk(t,e){if(!e.ended){if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,emitReadable(t)}}function emitReadable(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(debug("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){debug("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,e){e.readingMore||(e.readingMore=!0,nextTick(maybeReadMore_,t,e))}function maybeReadMore_(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(debug("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function pipeOnDrain(t){return function(){var e=t._readableState;debug("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&t.listeners("data").length&&(e.flowing=!0,flow(t))}}function nReadingNextTick(t){debug("readable nexttick read 0"),t.read(0)}function resume(t,e){e.resumeScheduled||(e.resumeScheduled=!0,nextTick(resume_,t,e))}function resume_(t,e){e.reading||(debug("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),flow(t),e.flowing&&!e.reading&&t.read(0)}function flow(t){var e=t._readableState;for(debug("flow",e.flowing);e.flowing&&null!==t.read(););}function fromList(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=fromListPartial(t,e.buffer,e.decoder),n);var n}function fromListPartial(t,e,n){var r;return t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?copyFromBufferString(t,e):copyFromBuffer(t,e),r}function copyFromBufferString(t,e){var n=e.head,r=1,i=n.data;for(t-=i.length;n=n.next;){var o=n.data,s=t>o.length?o.length:t;if(s===o.length?i+=o:i+=o.slice(0,t),0===(t-=s)){s===o.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(s));break}++r}return e.length-=r,i}function copyFromBuffer(t,e){var n=Buffer.allocUnsafe(t),r=e.head,i=1;for(r.data.copy(n),t-=r.data.length;r=r.next;){var o=r.data,s=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,s),0===(t-=s)){s===o.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(s));break}++i}return e.length-=i,n}function endReadable(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,nextTick(endReadableNT,e,t))}function endReadableNT(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function forEach(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}function indexOf(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function nop(){}function WriteReq(t,e,n){this.chunk=t,this.encoding=e,this.callback=n,this.next=null}function WritableState(t,e){Object.defineProperty(this,"buffer",{get:deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),t=t||{},this.objectMode=!!t.objectMode,e instanceof Duplex&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,r=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===t.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){onwrite(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(!(this instanceof Writable||this instanceof Duplex))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev)),EventEmitter.call(this)}function writeAfterEnd(t,e){var n=new Error("write after end");t.emit("error",n),nextTick(e,n)}function validChunk(t,e,n,r){var i=!0,o=!1;return null===n?o=new TypeError("May not write null values to stream"):Buffer.isBuffer(n)||"string"==typeof n||void 0===n||e.objectMode||(o=new TypeError("Invalid non-string/buffer chunk")),o&&(t.emit("error",o),nextTick(r,o),i=!1),i}function decodeChunk(t,e,n){return t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=Buffer.from(e,n)),e}function writeOrBuffer(t,e,n,r,i){n=decodeChunk(e,n,r),Buffer.isBuffer(n)&&(r="buffer");var o=e.objectMode?1:n.length;e.length+=o;var s=e.length<e.highWaterMark;if(s||(e.needDrain=!0),e.writing||e.corked){var a=e.lastBufferedRequest;e.lastBufferedRequest=new WriteReq(n,r,i),a?a.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else doWrite(t,e,!1,o,n,r,i);return s}function doWrite(t,e,n,r,i,o,s){e.writelen=r,e.writecb=s,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function onwriteError(t,e,n,r,i){--e.pendingcb,n?nextTick(i,r):i(r),t._writableState.errorEmitted=!0,t.emit("error",r)}function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function onwrite(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(onwriteStateUpdate(n),e)onwriteError(t,n,r,e,i);else{var o=needFinish(n);o||n.corked||n.bufferProcessing||!n.bufferedRequest||clearBuffer(t,n),r?nextTick(afterWrite,t,n,o,i):afterWrite(t,n,o,i)}}function afterWrite(t,e,n,r){n||onwriteDrain(t,e),e.pendingcb--,r(),finishMaybe(t,e)}function onwriteDrain(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function clearBuffer(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),o=e.corkedRequestsFree;o.entry=n;for(var s=0;n;)i[s]=n,n=n.next,s+=1;doWrite(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new CorkedRequest(e)}else{for(;n;){var a=n.chunk,u=n.encoding,c=n.callback;if(doWrite(t,e,!1,e.objectMode?1:a.length,a,u,c),n=n.next,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequestCount=0,e.bufferedRequest=n,e.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function prefinish(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function finishMaybe(t,e){var n=needFinish(e);return n&&(0===e.pendingcb?(prefinish(t,e),e.finished=!0,t.emit("finish")):prefinish(t,e)),n}function endWritable(t,e,n){e.ending=!0,finishMaybe(t,e),n&&(e.finished?nextTick(n):t.once("finish",n)),e.ended=!0,t.writable=!1}function CorkedRequest(t){var e=this;this.next=null,this.entry=null,this.finish=function(n){var r=e.entry;for(e.entry=null;r;){var i=r.callback;t.pendingcb--,i(n),r=r.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}}Readable.prototype.read=function(t){debug("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return debug("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,e))&&e.ended)return 0===e.length&&endReadable(this),null;var r,i=e.needReadable;return debug("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&debug("length less than watermark",i=!0),e.ended||e.reading?debug("reading or ended",i=!1):i&&(debug("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=howMuchToRead(n,e))),null===(r=t>0?fromList(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&endReadable(this)),null!==r&&this.emit("data",r),r},Readable.prototype._read=function(t){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,debug("pipe count=%d opts=%j",r.pipesCount,e);var i=!e||!1!==e.end?s:c;function o(t){debug("onunpipe"),t===n&&c()}function s(){debug("onend"),t.end()}r.endEmitted?nextTick(i):n.once("end",i),t.on("unpipe",o);var a=pipeOnDrain(n);t.on("drain",a);var u=!1;function c(){debug("cleanup"),t.removeListener("close",p),t.removeListener("finish",d),t.removeListener("drain",a),t.removeListener("error",f),t.removeListener("unpipe",o),n.removeListener("end",s),n.removeListener("end",c),n.removeListener("data",l),u=!0,!r.awaitDrain||t._writableState&&!t._writableState.needDrain||a()}var h=!1;function l(e){debug("ondata"),h=!1,!1!==t.write(e)||h||((1===r.pipesCount&&r.pipes===t||r.pipesCount>1&&-1!==indexOf(r.pipes,t))&&!u&&(debug("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,h=!0),n.pause())}function f(e){debug("onerror",e),g(),t.removeListener("error",f),0===listenerCount$1(t,"error")&&t.emit("error",e)}function p(){t.removeListener("finish",d),g()}function d(){debug("onfinish"),t.removeListener("close",p),g()}function g(){debug("unpipe"),n.unpipe(t)}return n.on("data",l),prependListener(t,"error",f),t.once("close",p),t.once("finish",d),t.emit("pipe",n),r.flowing||(debug("pipe resume"),n.resume()),t},Readable.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this)),this;if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}var o=indexOf(e.pipes,t);return-1===o||(e.pipes.splice(o,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this)),this},Readable.prototype.on=function(t,e){var n=EventEmitter.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&emitReadable(this):nextTick(nReadingNextTick,this))}return n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(debug("resume"),t.flowing=!0,resume(this,t)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;for(var i in t.on("end",(function(){if(debug("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)})),t.on("data",(function(i){(debug("wrapped data"),e.decoder&&(i=e.decoder.write(i)),e.objectMode&&null==i)||(e.objectMode||i&&i.length)&&(r.push(i)||(n=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return forEach(["error","close","destroy","pause","resume"],(function(e){t.on(e,r.emit.bind(r,e))})),r._read=function(e){debug("wrapped _read",e),n&&(n=!1,t.resume())},r},Readable._fromList=fromList,Writable.WritableState=WritableState,inherits$1(Writable,EventEmitter),WritableState.prototype.getBuffer=function(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,e,n){var r=this._writableState,i=!1;return"function"==typeof e&&(n=e,e=null),Buffer.isBuffer(t)?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=nop),r.ended?writeAfterEnd(this,n):validChunk(this,r,t,n)&&(r.pendingcb++,i=writeOrBuffer(this,r,t,e,n)),i},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Writable.prototype._write=function(t,e,n){n(new Error("not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||endWritable(this,r,n)},inherits$1(Duplex,Readable);for(var keys=Object.keys(Writable.prototype),v$1=0;v$1<keys.length;v$1++){var method=keys[v$1];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);Readable.call(this,t),Writable.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||nextTick(onEndNT,this)}function onEndNT(t){t.end()}function TransformState(t){this.afterTransform=function(e,n){return afterTransform(t,e,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function afterTransform(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,null!=n&&t.push(n),i(e);var o=t._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&t._read(o.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);Duplex.call(this,t),this._transformState=new TransformState(this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(t){done(e,t)})):done(e)}))}function done(t,e){if(e)return t.emit("error",e);var n=t._writableState,r=t._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(r.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);Transform.call(this,t)}function Stream(){EventEmitter.call(this)}function isArray$2(t){return Array.isArray?Array.isArray(t):"[object Array]"===objectToString$1(t)}inherits$1(Transform,Duplex),Transform.prototype.push=function(t,e){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,t,e)},Transform.prototype._transform=function(t,e,n){throw new Error("Not implemented")},Transform.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},inherits$1(PassThrough,Transform),PassThrough.prototype._transform=function(t,e,n){n(null,t)},inherits$1(Stream,EventEmitter),Stream.Readable=Readable,Stream.Writable=Writable,Stream.Duplex=Duplex,Stream.Transform=Transform,Stream.PassThrough=PassThrough,Stream.Stream=Stream,Stream.prototype.pipe=function(t,e){var n=this;function r(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function i(){n.readable&&n.resume&&n.resume()}n.on("data",r),t.on("drain",i),t._isStdio||e&&!1===e.end||(n.on("end",s),n.on("close",a));var o=!1;function s(){o||(o=!0,t.end())}function a(){o||(o=!0,"function"==typeof t.destroy&&t.destroy())}function u(t){if(c(),0===EventEmitter.listenerCount(this,"error"))throw t}function c(){n.removeListener("data",r),t.removeListener("drain",i),n.removeListener("end",s),n.removeListener("close",a),n.removeListener("error",u),t.removeListener("error",u),n.removeListener("end",c),n.removeListener("close",c),t.removeListener("close",c)}return n.on("error",u),t.on("error",u),n.on("end",c),n.on("close",c),t.on("close",c),t.emit("pipe",n),t};var isArray_1=isArray$2;function isBoolean$1(t){return"boolean"==typeof t}var isBoolean_1=isBoolean$1;function isNull$1(t){return null===t}var isNull_1=isNull$1;function isNullOrUndefined$1(t){return null==t}var isNullOrUndefined_1=isNullOrUndefined$1;function isNumber$1(t){return"number"==typeof t}var isNumber_1=isNumber$1;function isString$1(t){return"string"==typeof t}var isString_1=isString$1;function isSymbol$1(t){return"symbol"==typeof t}var isSymbol_1=isSymbol$1;function isUndefined$1(t){return void 0===t}var isUndefined_1=isUndefined$1;function isRegExp$1(t){return"[object RegExp]"===objectToString$1(t)}var isRegExp_1=isRegExp$1;function isObject$3(t){return"object"==typeof t&&null!==t}var isObject_1=isObject$3;function isDate$1(t){return"[object Date]"===objectToString$1(t)}var isDate_1=isDate$1;function isError$1(t){return"[object Error]"===objectToString$1(t)||t instanceof Error}var isError_1=isError$1;function isFunction$3(t){return"function"==typeof t}var isFunction_1=isFunction$3;function isPrimitive$1(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}var isPrimitive_1=isPrimitive$1,isBuffer$2=isBuffer;function objectToString$1(t){return Object.prototype.toString.call(t)}var util$2={isArray:isArray_1,isBoolean:isBoolean_1,isNull:isNull_1,isNullOrUndefined:isNullOrUndefined_1,isNumber:isNumber_1,isString:isString_1,isSymbol:isSymbol_1,isUndefined:isUndefined_1,isRegExp:isRegExp_1,isObject:isObject_1,isDate:isDate_1,isError:isError_1,isFunction:isFunction_1,isPrimitive:isPrimitive_1,isBuffer:isBuffer$2},inherits_browser=createCommonjsModule((function(t){"function"==typeof Object.create?t.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function(t,e){if(e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}})),_nodeResolve_empty={},_nodeResolve_empty$1=Object.freeze({__proto__:null,default:_nodeResolve_empty}),_stream_writable=Writable$1,Buffer$1=bufferEs6.Buffer;function WriteReq$1(t,e,n){this.chunk=t,this.encoding=e,this.callback=n}function WritableState$1(t,e){var n=_stream_duplex,r=(t=t||{}).highWaterMark,i=t.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.objectMode=!!t.objectMode,e instanceof n&&(this.objectMode=this.objectMode||!!t.writableObjectMode),this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var o=!1===t.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){onwrite$1(e,t)},this.writecb=null,this.writelen=0,this.buffer=[],this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1}function Writable$1(t){if(!(this instanceof Writable$1||this instanceof _stream_duplex))return new Writable$1(t);this._writableState=new WritableState$1(t,this),this.writable=!0,Stream.call(this)}function writeAfterEnd$1(t,e,n){var r=new Error("write after end");t.emit("error",r),nextTick((function(){n(r)}))}function validChunk$1(t,e,n,r){var i=!0;if(!(util$2.isBuffer(n)||util$2.isString(n)||util$2.isNullOrUndefined(n)||e.objectMode)){var o=new TypeError("Invalid non-string/buffer chunk");t.emit("error",o),nextTick((function(){r(o)})),i=!1}return i}function decodeChunk$1(t,e,n){return!t.objectMode&&!1!==t.decodeStrings&&util$2.isString(e)&&(e=new Buffer$1(e,n)),e}function writeOrBuffer$1(t,e,n,r,i){n=decodeChunk$1(e,n,r),util$2.isBuffer(n)&&(r="buffer");var o=e.objectMode?1:n.length;e.length+=o;var s=e.length<e.highWaterMark;return s||(e.needDrain=!0),e.writing||e.corked?e.buffer.push(new WriteReq$1(n,r,i)):doWrite$1(t,e,!1,o,n,r,i),s}function doWrite$1(t,e,n,r,i,o,s){e.writelen=r,e.writecb=s,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function onwriteError$1(t,e,n,r,i){n?nextTick((function(){e.pendingcb--,i(r)})):(e.pendingcb--,i(r)),t._writableState.errorEmitted=!0,t.emit("error",r)}function onwriteStateUpdate$1(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function onwrite$1(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(onwriteStateUpdate$1(n),e)onwriteError$1(t,n,r,e,i);else{var o=needFinish$1(t,n);o||n.corked||n.bufferProcessing||!n.buffer.length||clearBuffer$1(t,n),r?nextTick((function(){afterWrite$1(t,n,o,i)})):afterWrite$1(t,n,o,i)}}function afterWrite$1(t,e,n,r){n||onwriteDrain$1(t,e),e.pendingcb--,r(),finishMaybe$1(t,e)}function onwriteDrain$1(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function clearBuffer$1(t,e){if(e.bufferProcessing=!0,t._writev&&e.buffer.length>1){for(var n=[],r=0;r<e.buffer.length;r++)n.push(e.buffer[r].callback);e.pendingcb++,doWrite$1(t,e,!0,e.length,e.buffer,"",(function(t){for(var r=0;r<n.length;r++)e.pendingcb--,n[r](t)})),e.buffer=[]}else{for(r=0;r<e.buffer.length;r++){var i=e.buffer[r],o=i.chunk,s=i.encoding,a=i.callback,u=e.objectMode?1:o.length;if(doWrite$1(t,e,!1,u,o,s,a),e.writing){r++;break}}r<e.buffer.length?e.buffer=e.buffer.slice(r):e.buffer.length=0}e.bufferProcessing=!1}function needFinish$1(t,e){return e.ending&&0===e.length&&!e.finished&&!e.writing}function prefinish$1(t,e){e.prefinished||(e.prefinished=!0,t.emit("prefinish"))}function finishMaybe$1(t,e){var n=needFinish$1(t,e);return n&&(0===e.pendingcb?(prefinish$1(t,e),e.finished=!0,t.emit("finish")):prefinish$1(t,e)),n}function endWritable$1(t,e,n){e.ending=!0,finishMaybe$1(t,e),n&&(e.finished?nextTick(n):t.once("finish",n)),e.ended=!0}Writable$1.WritableState=WritableState$1,util$2.inherits=inherits_browser,util$2.inherits(Writable$1,Stream),Writable$1.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable."))},Writable$1.prototype.write=function(t,e,n){var r=this._writableState,i=!1;return util$2.isFunction(e)&&(n=e,e=null),util$2.isBuffer(t)?e="buffer":e||(e=r.defaultEncoding),util$2.isFunction(n)||(n=function(){}),r.ended?writeAfterEnd$1(this,r,n):validChunk$1(this,r,t,n)&&(r.pendingcb++,i=writeOrBuffer$1(this,r,t,e,n)),i},Writable$1.prototype.cork=function(){this._writableState.corked++},Writable$1.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.buffer.length||clearBuffer$1(this,t))},Writable$1.prototype._write=function(t,e,n){n(new Error("not implemented"))},Writable$1.prototype._writev=null,Writable$1.prototype.end=function(t,e,n){var r=this._writableState;util$2.isFunction(t)?(n=t,t=null,e=null):util$2.isFunction(e)&&(n=e,e=null),util$2.isNullOrUndefined(t)||this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||endWritable$1(this,r,n)};var _stream_duplex=Duplex$1,objectKeys$1=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};function Duplex$1(t){if(!(this instanceof Duplex$1))return new Duplex$1(t);_stream_readable.call(this,t),_stream_writable.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend$1)}function onend$1(){this.allowHalfOpen||this._writableState.ended||nextTick(this.end.bind(this))}function forEach$1(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}util$2.inherits=inherits_browser,util$2.inherits(Duplex$1,_stream_readable),forEach$1(objectKeys$1(_stream_writable.prototype),(function(t){Duplex$1.prototype[t]||(Duplex$1.prototype[t]=_stream_writable.prototype[t])}));var string_decoder=createCommonjsModule((function(t,e){var n=bufferEs6.Buffer,r=n.isEncoding||function(t){switch(t&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};var i=e.StringDecoder=function(t){switch(this.encoding=(t||"utf8").toLowerCase().replace(/[-_]/,""),function(t){if(t&&!r(t))throw new Error("Unknown encoding: "+t)}(t),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=s;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=a;break;default:return void(this.write=o)}this.charBuffer=new n(6),this.charReceived=0,this.charLength=0};function o(t){return t.toString(this.encoding)}function s(t){this.charReceived=t.length%2,this.charLength=this.charReceived?2:0}function a(t){this.charReceived=t.length%3,this.charLength=this.charReceived?3:0}i.prototype.write=function(t){for(var e="";this.charLength;){var n=t.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:t.length;if(t.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(t=t.slice(n,t.length),!((i=(e=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(e.length-1))>=55296&&i<=56319)){if(this.charReceived=this.charLength=0,0===t.length)return e;break}this.charLength+=this.surrogateSize,e=""}this.detectIncompleteChar(t);var r=t.length;this.charLength&&(t.copy(this.charBuffer,0,t.length-this.charReceived,r),r-=this.charReceived);var i;r=(e+=t.toString(this.encoding,0,r)).length-1;if((i=e.charCodeAt(r))>=55296&&i<=56319){var o=this.surrogateSize;return this.charLength+=o,this.charReceived+=o,this.charBuffer.copy(this.charBuffer,o,0,o),t.copy(this.charBuffer,0,0,o),e.substring(0,r)}return e},i.prototype.detectIncompleteChar=function(t){for(var e=t.length>=3?3:t.length;e>0;e--){var n=t[t.length-e];if(1==e&&n>>5==6){this.charLength=2;break}if(e<=2&&n>>4==14){this.charLength=3;break}if(e<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=e},i.prototype.end=function(t){var e="";if(t&&t.length&&(e=this.write(t)),this.charReceived){var n=this.charReceived,r=this.charBuffer,i=this.encoding;e+=r.slice(0,n).toString(i)}return e}})),string_decoder_1=string_decoder.StringDecoder,require$$3=getCjsExportFromNamespace(_nodeResolve_empty$1),_stream_readable=Readable$1,Buffer$2=bufferEs6.Buffer;Readable$1.ReadableState=ReadableState$1;var EE=EventEmitter.EventEmitter,StringDecoder$1;EE.listenerCount||(EE.listenerCount=function(t,e){return t.listeners(e).length}),util$2.inherits=inherits_browser;var debug$1=require$$3;function ReadableState$1(t,e){var n=_stream_duplex,r=(t=t||{}).highWaterMark,i=t.objectMode?16:16384;this.highWaterMark=r||0===r?r:i,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!t.objectMode,e instanceof n&&(this.objectMode=this.objectMode||!!t.readableObjectMode),this.defaultEncoding=t.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(StringDecoder$1||(StringDecoder$1=string_decoder.StringDecoder),this.decoder=new StringDecoder$1(t.encoding),this.encoding=t.encoding)}function Readable$1(t){if(!(this instanceof Readable$1))return new Readable$1(t);this._readableState=new ReadableState$1(t,this),this.readable=!0,Stream.call(this)}function readableAddChunk$1(t,e,n,r,i){var o=chunkInvalid$1(e,n);if(o)t.emit("error",o);else if(util$2.isNullOrUndefined(n))e.reading=!1,e.ended||onEofChunk$1(t,e);else if(e.objectMode||n&&n.length>0)if(e.ended&&!i){var s=new Error("stream.push() after EOF");t.emit("error",s)}else if(e.endEmitted&&i){s=new Error("stream.unshift() after end event");t.emit("error",s)}else!e.decoder||i||r||(n=e.decoder.write(n)),i||(e.reading=!1),e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,i?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&emitReadable$1(t)),maybeReadMore$1(t,e);else i||(e.reading=!1);return needMoreData$1(e)}function needMoreData$1(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}debug$1=debug$1&&debug$1.debuglog?debug$1.debuglog("stream"):function(){},util$2.inherits(Readable$1,Stream),Readable$1.prototype.push=function(t,e){var n=this._readableState;return util$2.isString(t)&&!n.objectMode&&(e=e||n.defaultEncoding)!==n.encoding&&(t=new Buffer$2(t,e),e=""),readableAddChunk$1(this,n,t,e,!1)},Readable$1.prototype.unshift=function(t){return readableAddChunk$1(this,this._readableState,t,"",!0)},Readable$1.prototype.setEncoding=function(t){return StringDecoder$1||(StringDecoder$1=string_decoder.StringDecoder),this._readableState.decoder=new StringDecoder$1(t),this._readableState.encoding=t,this};var MAX_HWM$1=8388608;function roundUpToNextPowerOf2(t){if(t>=MAX_HWM$1)t=MAX_HWM$1;else{t--;for(var e=1;e<32;e<<=1)t|=t>>e;t++}return t}function howMuchToRead$1(t,e){return 0===e.length&&e.ended?0:e.objectMode?0===t?0:1:isNaN(t)||util$2.isNull(t)?e.flowing&&e.buffer.length?e.buffer[0].length:e.length:t<=0?0:(t>e.highWaterMark&&(e.highWaterMark=roundUpToNextPowerOf2(t)),t>e.length?e.ended?e.length:(e.needReadable=!0,0):t)}function chunkInvalid$1(t,e){var n=null;return util$2.isBuffer(e)||util$2.isString(e)||util$2.isNullOrUndefined(e)||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n}function onEofChunk$1(t,e){if(e.decoder&&!e.ended){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,emitReadable$1(t)}function emitReadable$1(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(debug$1("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?nextTick((function(){emitReadable_$1(t)})):emitReadable_$1(t))}function emitReadable_$1(t){debug$1("emit readable"),t.emit("readable"),flow$1(t)}function maybeReadMore$1(t,e){e.readingMore||(e.readingMore=!0,nextTick((function(){maybeReadMore_$1(t,e)})))}function maybeReadMore_$1(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(debug$1("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function pipeOnDrain$1(t){return function(){var e=t._readableState;debug$1("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&EE.listenerCount(t,"data")&&(e.flowing=!0,flow$1(t))}}function resume$1(t,e){e.resumeScheduled||(e.resumeScheduled=!0,nextTick((function(){resume_$1(t,e)})))}function resume_$1(t,e){e.resumeScheduled=!1,t.emit("resume"),flow$1(t),e.flowing&&!e.reading&&t.read(0)}function flow$1(t){var e=t._readableState;if(debug$1("flow",e.flowing),e.flowing)do{var n=t.read()}while(null!==n&&e.flowing)}function fromList$1(t,e){var n,r=e.buffer,i=e.length,o=!!e.decoder,s=!!e.objectMode;if(0===r.length)return null;if(0===i)n=null;else if(s)n=r.shift();else if(!t||t>=i)n=o?r.join(""):Buffer$2.concat(r,i),r.length=0;else{if(t<r[0].length)n=(h=r[0]).slice(0,t),r[0]=h.slice(t);else if(t===r[0].length)n=r.shift();else{n=o?"":new Buffer$2(t);for(var a=0,u=0,c=r.length;u<c&&a<t;u++){var h=r[0],l=Math.min(t-a,h.length);o?n+=h.slice(0,l):h.copy(n,a,0,l),l<h.length?r[0]=h.slice(l):r.shift(),a+=l}}}return n}function endReadable$1(t){var e=t._readableState;if(e.length>0)throw new Error("endReadable called on non-empty stream");e.endEmitted||(e.ended=!0,nextTick((function(){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))})))}function forEach$2(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}function indexOf$1(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}Readable$1.prototype.read=function(t){debug$1("read",t);var e=this._readableState,n=t;if((!util$2.isNumber(t)||t>0)&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return debug$1("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?endReadable$1(this):emitReadable$1(this),null;if(0===(t=howMuchToRead$1(t,e))&&e.ended)return 0===e.length&&endReadable$1(this),null;var r,i=e.needReadable;return debug$1("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&debug$1("length less than watermark",i=!0),(e.ended||e.reading)&&debug$1("reading or ended",i=!1),i&&(debug$1("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1),i&&!e.reading&&(t=howMuchToRead$1(n,e)),r=t>0?fromList$1(t,e):null,util$2.isNull(r)&&(e.needReadable=!0,t=0),e.length-=t,0!==e.length||e.ended||(e.needReadable=!0),n!==t&&e.ended&&0===e.length&&endReadable$1(this),util$2.isNull(r)||this.emit("data",r),r},Readable$1.prototype._read=function(t){this.emit("error",new Error("not implemented"))},Readable$1.prototype.pipe=function(t,e){var n=this,r=this._readableState;switch(r.pipesCount){case 0:r.pipes=t;break;case 1:r.pipes=[r.pipes,t];break;default:r.pipes.push(t)}r.pipesCount+=1,debug$1("pipe count=%d opts=%j",r.pipesCount,e);var i=(!e||!1!==e.end)&&t!==process.stdout&&t!==process.stderr?s:u;function o(t){debug$1("onunpipe"),t===n&&u()}function s(){debug$1("onend"),t.end()}r.endEmitted?nextTick(i):n.once("end",i),t.on("unpipe",o);var a=pipeOnDrain$1(n);function u(){debug$1("cleanup"),t.removeListener("close",l),t.removeListener("finish",f),t.removeListener("drain",a),t.removeListener("error",h),t.removeListener("unpipe",o),n.removeListener("end",s),n.removeListener("end",u),n.removeListener("data",c),!r.awaitDrain||t._writableState&&!t._writableState.needDrain||a()}function c(e){debug$1("ondata"),!1===t.write(e)&&(debug$1("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,n.pause())}function h(e){debug$1("onerror",e),p(),t.removeListener("error",h),0===EE.listenerCount(t,"error")&&t.emit("error",e)}function l(){t.removeListener("finish",f),p()}function f(){debug$1("onfinish"),t.removeListener("close",l),p()}function p(){debug$1("unpipe"),n.unpipe(t)}return t.on("drain",a),n.on("data",c),t._events&&t._events.error?isarray(t._events.error)?t._events.error.unshift(h):t._events.error=[h,t._events.error]:t.on("error",h),t.once("close",l),t.once("finish",f),t.emit("pipe",n),r.flowing||(debug$1("pipe resume"),n.resume()),t},Readable$1.prototype.unpipe=function(t){var e=this._readableState;if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this)),this;if(!t){var n=e.pipes,r=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var i=0;i<r;i++)n[i].emit("unpipe",this);return this}return-1===(i=indexOf$1(e.pipes,t))||(e.pipes.splice(i,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this)),this},Readable$1.prototype.on=function(t,e){var n=Stream.prototype.on.call(this,t,e);if("data"===t&&!1!==this._readableState.flowing&&this.resume(),"readable"===t&&this.readable){var r=this._readableState;if(!r.readableListening)if(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading)r.length&&emitReadable$1(this);else{var i=this;nextTick((function(){debug$1("readable nexttick read 0"),i.read(0)}))}}return n},Readable$1.prototype.addListener=Readable$1.prototype.on,Readable$1.prototype.resume=function(){var t=this._readableState;return t.flowing||(debug$1("resume"),t.flowing=!0,t.reading||(debug$1("resume read 0"),this.read(0)),resume$1(this,t)),this},Readable$1.prototype.pause=function(){return debug$1("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug$1("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable$1.prototype.wrap=function(t){var e=this._readableState,n=!1,r=this;for(var i in t.on("end",(function(){if(debug$1("wrapped end"),e.decoder&&!e.ended){var t=e.decoder.end();t&&t.length&&r.push(t)}r.push(null)})),t.on("data",(function(i){(debug$1("wrapped data"),e.decoder&&(i=e.decoder.write(i)),i&&(e.objectMode||i.length))&&(r.push(i)||(n=!0,t.pause()))})),t)util$2.isFunction(t[i])&&util$2.isUndefined(this[i])&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));return forEach$2(["error","close","destroy","pause","resume"],(function(e){t.on(e,r.emit.bind(r,e))})),r._read=function(e){debug$1("wrapped _read",e),n&&(n=!1,t.resume())},r},Readable$1._fromList=fromList$1;var _stream_transform=Transform$1;function TransformState$1(t,e){this.afterTransform=function(t,n){return afterTransform$1(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}function afterTransform$1(t,e,n){var r=t._transformState;r.transforming=!1;var i=r.writecb;if(!i)return t.emit("error",new Error("no writecb in Transform class"));r.writechunk=null,r.writecb=null,util$2.isNullOrUndefined(n)||t.push(n),i&&i(e);var o=t._readableState;o.reading=!1,(o.needReadable||o.length<o.highWaterMark)&&t._read(o.highWaterMark)}function Transform$1(t){if(!(this instanceof Transform$1))return new Transform$1(t);_stream_duplex.call(this,t),this._transformState=new TransformState$1(t,this);var e=this;this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("prefinish",(function(){util$2.isFunction(this._flush)?this._flush((function(t){done$1(e,t)})):done$1(e)}))}function done$1(t,e){if(e)return t.emit("error",e);var n=t._writableState,r=t._transformState;if(n.length)throw new Error("calling transform done when ws.length != 0");if(r.transforming)throw new Error("calling transform done when still transforming");return t.push(null)}util$2.inherits=inherits_browser,util$2.inherits(Transform$1,_stream_duplex),Transform$1.prototype.push=function(t,e){return this._transformState.needTransform=!1,_stream_duplex.prototype.push.call(this,t,e)},Transform$1.prototype._transform=function(t,e,n){throw new Error("not implemented")},Transform$1.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform$1.prototype._read=function(t){var e=this._transformState;util$2.isNull(e.writechunk)||!e.writecb||e.transforming?e.needTransform=!0:(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform))};var _stream_passthrough=PassThrough$1;function PassThrough$1(t){if(!(this instanceof PassThrough$1))return new PassThrough$1(t);_stream_transform.call(this,t)}util$2.inherits=inherits_browser,util$2.inherits(PassThrough$1,_stream_transform),PassThrough$1.prototype._transform=function(t,e,n){n(null,t)};var readable$1=createCommonjsModule((function(t,e){(e=t.exports=_stream_readable).Stream=Stream,e.Readable=e,e.Writable=_stream_writable,e.Duplex=_stream_duplex,e.Transform=_stream_transform,e.PassThrough=_stream_passthrough})),readable_1=readable$1.Stream,readable_2=readable$1.Readable,readable_3=readable$1.Writable,readable_4=readable$1.Duplex,readable_5=readable$1.Transform,readable_6=readable$1.PassThrough,ncycles=100,netsize=256,maxnetpos=netsize-1,netbiasshift=4,intbiasshift=16,intbias=1<<intbiasshift,gammashift=10,betashift=10,beta=intbias>>betashift,betagamma=intbias<<gammashift-betashift,initrad=netsize>>3,radiusbiasshift=6,radiusbias=1<<radiusbiasshift,initradius=initrad*radiusbias,radiusdec=30,alphabiasshift=10,initalpha=1<<alphabiasshift,radbiasshift=8,radbias=1<<radbiasshift,alpharadbshift=alphabiasshift+radbiasshift,alpharadbias=1<<alpharadbshift,prime1=499,prime2=491,prime3=487,prime4=503,minpicturebytes=3*prime4;function NeuQuant(t,e){var n,r,i,o,s;function a(t,e,r,i,o){n[e][0]-=t*(n[e][0]-r)/initalpha,n[e][1]-=t*(n[e][1]-i)/initalpha,n[e][2]-=t*(n[e][2]-o)/initalpha}function u(t,e,r,i,o){for(var a,u,c=Math.abs(e-t),h=Math.min(e+t,netsize),l=e+1,f=e-1,p=1;l<h||f>c;)u=s[p++],l<h&&((a=n[l++])[0]-=u*(a[0]-r)/alpharadbias,a[1]-=u*(a[1]-i)/alpharadbias,a[2]-=u*(a[2]-o)/alpharadbias),f>c&&((a=n[f--])[0]-=u*(a[0]-r)/alpharadbias,a[1]-=u*(a[1]-i)/alpharadbias,a[2]-=u*(a[2]-o)/alpharadbias)}function c(t,e,r){var s,a,u,c,h,l=~(1<<31),f=l,p=-1,d=p;for(s=0;s<netsize;s++)a=n[s],(u=Math.abs(a[0]-t)+Math.abs(a[1]-e)+Math.abs(a[2]-r))<l&&(l=u,p=s),(c=u-(i[s]>>intbiasshift-netbiasshift))<f&&(f=c,d=s),h=o[s]>>betashift,o[s]-=h,i[s]+=h<<gammashift;return o[p]+=beta,i[p]-=betagamma,d}this.buildColormap=function(){!function(){var t,e;for(n=[],r=new Int32Array(256),i=new Int32Array(netsize),o=new Int32Array(netsize),s=new Int32Array(netsize>>3),t=0;t<netsize;t++)e=(t<<netbiasshift+8)/netsize,n[t]=new Float64Array([e,e,e,0]),o[t]=intbias/netsize,i[t]=0}(),function(){var n,r,i,o,h,l,f=t.length,p=30+(e-1)/3,d=f/(3*e),g=~~(d/ncycles),m=initalpha,v=initradius,y=v>>radiusbiasshift;for(y<=1&&(y=0),n=0;n<y;n++)s[n]=m*((y*y-n*n)*radbias/(y*y));f<minpicturebytes?(e=1,r=3):r=f%prime1!=0?3*prime1:f%prime2!=0?3*prime2:f%prime3!=0?3*prime3:3*prime4;var b=0;for(n=0;n<d;)if(a(m,l=c(i=(255&t[b])<<netbiasshift,o=(255&t[b+1])<<netbiasshift,h=(255&t[b+2])<<netbiasshift),i,o,h),0!==y&&u(y,l,i,o,h),(b+=r)>=f&&(b-=f),0===g&&(g=1),++n%g==0)for(m-=m/p,(y=(v-=v/radiusdec)>>radiusbiasshift)<=1&&(y=0),l=0;l<y;l++)s[l]=m*((y*y-l*l)*radbias/(y*y))}(),function(){for(var t=0;t<netsize;t++)n[t][0]>>=netbiasshift,n[t][1]>>=netbiasshift,n[t][2]>>=netbiasshift,n[t][3]=t}(),function(){var t,e,i,o,s,a,u=0,c=0;for(t=0;t<netsize;t++){for(s=t,a=(i=n[t])[1],e=t+1;e<netsize;e++)(o=n[e])[1]<a&&(s=e,a=o[1]);if(o=n[s],t!=s&&(e=o[0],o[0]=i[0],i[0]=e,e=o[1],o[1]=i[1],i[1]=e,e=o[2],o[2]=i[2],i[2]=e,e=o[3],o[3]=i[3],i[3]=e),a!=u){for(r[u]=c+t>>1,e=u+1;e<a;e++)r[e]=t;u=a,c=t}}for(r[u]=c+maxnetpos>>1,e=u+1;e<256;e++)r[e]=maxnetpos}()},this.getColormap=function(){for(var t=[],e=[],r=0;r<netsize;r++)e[n[r][3]]=r;for(var i=0,o=0;o<netsize;o++){var s=e[o];t[i++]=n[s][0],t[i++]=n[s][1],t[i++]=n[s][2]}return t},this.lookupRGB=function(t,e,i){for(var o,s,a,u=1e3,c=-1,h=r[e],l=h-1;h<netsize||l>=0;)h<netsize&&((a=(s=n[h])[1]-e)>=u?h=netsize:(h++,a<0&&(a=-a),(o=s[0]-t)<0&&(o=-o),(a+=o)<u&&((o=s[2]-i)<0&&(o=-o),(a+=o)<u&&(u=a,c=s[3])))),l>=0&&((a=e-(s=n[l])[1])>=u?l=-1:(l--,a<0&&(a=-a),(o=s[0]-t)<0&&(o=-o),(a+=o)<u&&((o=s[2]-i)<0&&(o=-o),(a+=o)<u&&(u=a,c=s[3]))));return c}}var TypedNeuQuant=NeuQuant,EOF=-1,BITS=12,HSIZE=5003,masks=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];function LZWEncoder(t,e,n,r){var i,o,s,a,u,c,h,l,f,p=Math.max(2,r),d=new Uint8Array(256),g=new Int32Array(HSIZE),m=new Int32Array(HSIZE),v=0,y=0,b=!1;function w(t,e){d[o++]=t,o>=254&&T(e)}function _(t){E(HSIZE),y=l+2,b=!0,A(l,t)}function E(t){for(var e=0;e<t;++e)g[e]=-1}function T(t){o>0&&(t.writeByte(o),t.writeBytes(d,0,o),o=0)}function I(t){return(1<<t)-1}function S(){return 0===a?EOF:(--a,255&n[u++])}function A(t,e){for(i&=masks[v],v>0?i|=t<<v:i=t,v+=c;v>=8;)w(255&i,e),i>>=8,v-=8;if((y>s||b)&&(b?(s=I(c=h),b=!1):(++c,s=c==BITS?1<<BITS:I(c))),t==f){for(;v>0;)w(255&i,e),i>>=8,v-=8;T(e)}}this.encode=function(n){n.writeByte(p),a=t*e,u=0,function(t,e){var n,r,i,a,u,p,d;for(b=!1,s=I(c=h=t),f=(l=1<<t-1)+1,y=l+2,o=0,a=S(),d=0,n=HSIZE;n<65536;n*=2)++d;d=8-d,E(p=HSIZE),A(l,e);t:for(;(r=S())!=EOF;)if(n=(r<<BITS)+a,g[i=r<<d^a]!==n){if(g[i]>=0){u=p-i,0===i&&(u=1);do{if((i-=u)<0&&(i+=p),g[i]===n){a=m[i];continue t}}while(g[i]>=0)}A(a,e),a=r,y<1<<BITS?(m[i]=y++,g[i]=n):_(e)}else a=m[i];A(a,e),A(f,e)}(p+1,n),n.writeByte(0)}}var LZWEncoder_1=LZWEncoder;function ByteCapacitor(t){readable$1.call(this,t),this.okayToPush=!0,this.resetData()}function GIFEncoder(t,e,n){var r=(n=n||{}).highWaterMark;ByteCapacitor.call(this,{highWaterMark:r||0===r?r:65536}),this.width=~~t,this.height=~~e,this.transparent=null,this.transIndex=0,this.repeat=-1,this.delay=0,this.pixels=null,this.indexedPixels=null,this.colorDepth=null,this.colorTab=null,this.userPalette=null,this.usedEntry=[],this.palSize=7,this.dispose=-1,this.firstFrame=!0,this.sample=10;var i=this;function o(){i.flushData()}this.on("writeHeader#stop",o),this.on("frame#stop",o),this.on("finish#stop",(function(){o(),i.push(null)}))}util$1.inherits(ByteCapacitor,readable$1),ByteCapacitor.prototype._read=function(){this.okayToPush=!0},ByteCapacitor.prototype.resetData=function(){this.data=[]},ByteCapacitor.prototype.flushData=function(){if(!this.okayToPush){var t=new Error("GIF memory limit exceeded. Please `read` from GIF before writing additional frames/information.");return this.emit("error",t)}var e=new Buffer(this.data);this.resetData(),this.okayToPush=this.push(e)},ByteCapacitor.prototype.writeByte=function(t){this.data.push(t)},ByteCapacitor.prototype.writeUTFBytes=function(t){for(var e=t.length,n=0;n<e;n++)this.writeByte(t.charCodeAt(n))},ByteCapacitor.prototype.writeBytes=function(t,e,n){for(var r=n||t.length,i=e||0;i<r;i++)this.writeByte(t[i])},util$1.inherits(GIFEncoder,ByteCapacitor),GIFEncoder.prototype.setDelay=function(t){this.delay=Math.round(t/10)},GIFEncoder.prototype.setFrameRate=function(t){this.delay=Math.round(100/t)},GIFEncoder.prototype.setDispose=function(t){t>=0&&(this.dispose=t)},GIFEncoder.prototype.setRepeat=function(t){this.repeat=t},GIFEncoder.prototype.setTransparent=function(t){this.transparent=t},GIFEncoder.prototype.analyzeImage=function(t,e){e&&e.palette&&this.setImagePalette(this.removeAlphaChannel(e.palette)),e&&!0===e.indexedPixels?(assert(e.palette,"`options.indexedPixels` requires `options.palette` to load from. Please include one`"),this.setImagePixels(t)):this.setImagePixels(this.removeAlphaChannel(t)),this.analyzePixels(e),e&&e.palette&&(this.userPalette=null)},GIFEncoder.prototype.writeImageInfo=function(){this.firstFrame&&(this.writeLSD(),this.writePalette(),this.repeat>=0&&this.writeNetscapeExt()),this.writeGraphicCtrlExt(),this.writeImageDesc(),this.firstFrame||this.writePalette(),this.firstFrame=!1},GIFEncoder.prototype.outputImage=function(){this.writePixels()},GIFEncoder.prototype.addFrame=function(t,e){this.emit("frame#start"),this.analyzeImage(t,e),this.writeImageInfo(),this.outputImage(),this.emit("frame#stop")},GIFEncoder.prototype.finish=function(){this.emit("finish#start"),this.writeByte(59),this.emit("finish#stop")},GIFEncoder.prototype.setQuality=function(t){t<1&&(t=1),this.sample=t},GIFEncoder.prototype.writeHeader=function(){this.emit("writeHeader#start"),this.writeUTFBytes("GIF89a"),this.emit("writeHeader#stop")},GIFEncoder.prototype.analyzePixels=function(t){var e,n,r;if(null!==this.userPalette){assert(t&&!0===t.indexedPixels,"`palette` can only be used with `options.indexedPixels` at the moment. Please add `{indexedPixels: true}` to `addFrame()`"),e=this.pixels.length,this.indexedPixels=new Uint8Array(e),this.colorTab=this.userPalette;for(var i=0;i<e;i++)n=this.pixels[i],this.indexedPixels[i]=n,this.usedEntry[n]=!0}else{e=this.pixels.length/3,this.indexedPixels=new Uint8Array(e),(r=new TypedNeuQuant(this.pixels,this.sample)).buildColormap(),this.colorTab=r.getColormap();for(var o=0,s=0;s<e;s++)n=r.lookupRGB(255&this.pixels[o++],255&this.pixels[o++],255&this.pixels[o++]),this.usedEntry[n]=!0,this.indexedPixels[s]=n}this.pixels=null,this.colorDepth=8,this.palSize=7,null!==this.transparent?this.transIndex=r.lookupRGB((16711680&this.transparent)>>16,(65280&this.transparent)>>8,255&this.transparent):this.transIndex=0},GIFEncoder.prototype.removeAlphaChannel=function(t){for(var e=this.width,n=this.height,r=new Uint8Array(e*n*3),i=0,o=0;o<n;o++)for(var s=0;s<e;s++){var a=o*e*4+4*s;r[i++]=t[a],r[i++]=t[a+1],r[i++]=t[a+2]}return r},GIFEncoder.prototype.setImagePixels=function(t){this.pixels=t},GIFEncoder.prototype.setImagePalette=function(t){this.userPalette=t},GIFEncoder.prototype.writeGraphicCtrlExt=function(){var t,e;this.writeByte(33),this.writeByte(249),this.writeByte(4),null===this.transparent?(t=0,e=0):(t=1,e=2),this.dispose>=0&&(e=7&this.dispose),e<<=2,this.writeByte(0|e|t),this.writeShort(this.delay),this.writeByte(this.transIndex),this.writeByte(0)},GIFEncoder.prototype.writeImageDesc=function(){this.writeByte(44),this.writeShort(0),this.writeShort(0),this.writeShort(this.width),this.writeShort(this.height),this.firstFrame?this.writeByte(0):this.writeByte(128|this.palSize)},GIFEncoder.prototype.writeLSD=function(){this.writeShort(this.width),this.writeShort(this.height),this.writeByte(240|this.palSize),this.writeByte(0),this.writeByte(0)},GIFEncoder.prototype.writeNetscapeExt=function(){this.writeByte(33),this.writeByte(255),this.writeByte(11),this.writeUTFBytes("NETSCAPE2.0"),this.writeByte(3),this.writeByte(1),this.writeShort(this.repeat),this.writeByte(0)},GIFEncoder.prototype.writePalette=function(){this.writeBytes(this.colorTab);for(var t=768-this.colorTab.length,e=0;e<t;e++)this.writeByte(0)},GIFEncoder.prototype.writeShort=function(t){this.writeByte(255&t),this.writeByte(t>>8&255)},GIFEncoder.prototype.writePixels=function(){new LZWEncoder_1(this.width,this.height,this.indexedPixels,this.colorDepth).encode(this)},GIFEncoder.prototype.stream=function(){return this},GIFEncoder.ByteCapacitor=ByteCapacitor;var GIFEncoder_1=GIFEncoder;const FRAME_HEIGHT=150,FRAME_WIDTH=200,FRAMES_PER_SECOND=10,DURATION=2e3,FRAME_DELAY=1e3/FRAMES_PER_SECOND,FRAME_TOTAL=DURATION/1e3*FRAMES_PER_SECOND;function generateImage(t){const e=document.createElement("canvas");e.width=FRAME_WIDTH,e.height=FRAME_HEIGHT*FRAME_TOTAL;const n=e.getContext("2d");return new Promise(r=>{let i=0;setTimeout((function o(){const s=i*FRAME_HEIGHT;if(n.drawImage(t,0,s,FRAME_WIDTH,FRAME_HEIGHT),i++,i<FRAME_TOTAL)setTimeout(o,FRAME_DELAY);else{const t=e.toDataURL("image/png");r(t)}}),FRAME_DELAY)})}function generateGIF(t){const e=document.createElement("canvas");e.width=FRAME_WIDTH,e.height=FRAME_HEIGHT;const n=e.getContext("2d");return new Promise(e=>{const r=new GIFEncoder_1(FRAME_WIDTH,FRAME_HEIGHT,{highWaterMark:128e3});r.writeHeader(),r.setDelay(100),r.setRepeat(0);for(let e=0;e<FRAME_TOTAL;e++){n.drawImage(t,0,e*FRAME_HEIGHT,FRAME_WIDTH,FRAME_HEIGHT,0,0,FRAME_WIDTH,FRAME_HEIGHT);const i=n.getImageData(0,0,FRAME_WIDTH,FRAME_HEIGHT);r.addFrame(i.data)}r.on("readable",(function(){const t=r.read(),e=new Blob([t],{type:"image/gif"}),n=window.URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=Date.now()+".gif";const o=new MouseEvent("click");i.dispatchEvent(o),setTimeout(()=>window.URL.revokeObjectURL(n),100)})),r.finish(),e(r)})}function convertImageDataToColorPalette(t,e){const[n,r]=e,i=hexRgb(n,{format:"array"}),o=hexRgb(r,{format:"array"});let s,a,u;for(let e=0,n=t.data.length;e<n;e+=4)s=t.data[e],a=t.data[e+1],u=t.data[e+2],0===s&&0===a&&0===u?(t.data[e]=i[0],t.data[e+1]=i[1],t.data[e+2]=i[2]):255===s&&255===a&&255===u&&(t.data[e]=o[0],t.data[e+1]=o[1],t.data[e+2]=o[2]);return t}function create_fragment$4(t){let e,n,r,i,o;return{c(){e=element("div"),n=element("canvas"),r=space(),i=element("button"),i.textContent="Save  ",attr(n,"class","canvas svelte-19sbo2j"),attr(n,"width","200"),attr(n,"height","3000"),attr(i,"class","download svelte-19sbo2j"),attr(i,"type","button"),attr(e,"class","filmstrip svelte-19sbo2j")},m(s,a,u){insert(s,e,a),append(e,n),t[5](n),append(e,r),append(e,i),u&&o(),o=listen(i,"click",t[1])},p:noop,i:noop,o:noop,d(n){n&&detach(e),t[5](null),o()}}}function instance$3(t,e,n){let r;component_subscribe(t,colorPalette,t=>n(3,r=t));let i,{src:o}=e;function s(t){const e=new Image;e.addEventListener("load",()=>{const t=i.getContext("2d");t.drawImage(e,0,0);const n=convertImageDataToColorPalette(t.getImageData(0,0,i.width,i.height),r);t.putImageData(n,0,0)}),e.setAttribute("src",t)}return onMount(()=>{s(o),colorPalette.subscribe(()=>s(o))}),t.$set=t=>{"src"in t&&n(2,o=t.src)},[i,function(){console.log("handleDownloadClick()"),generateGIF(i)},o,r,s,function(t){binding_callbacks[t?"unshift":"push"](()=>{n(0,i=t)})}]}class Filmstrip extends SvelteComponent{constructor(t){super(),init(this,t,instance$3,create_fragment$4,safe_not_equal,{src:2})}}function create_fragment$5(t){let e,n,r,i,o,s,a=(t[1]||"")+"";const u=new Filmstrip({props:{src:t[0]}});return{c(){e=element("div"),n=element("div"),create_component(u.$$.fragment),r=space(),i=element("div"),o=text(a),attr(n,"class","image svelte-u5th08"),attr(i,"class","text svelte-u5th08"),attr(e,"class","message svelte-u5th08")},m(t,a){insert(t,e,a),append(e,n),mount_component(u,n,null),append(e,r),append(e,i),append(i,o),s=!0},p(t,[e]){const n={};1&e&&(n.src=t[0]),u.$set(n),(!s||2&e)&&a!==(a=(t[1]||"")+"")&&set_data(o,a)},i(t){s||(transition_in(u.$$.fragment,t),s=!0)},o(t){transition_out(u.$$.fragment,t),s=!1},d(t){t&&detach(e),destroy_component(u)}}}function instance$4(t,e,n){let{imageBlob:r}=e,{text:i}=e;return t.$set=t=>{"imageBlob"in t&&n(0,r=t.imageBlob),"text"in t&&n(1,i=t.text)},[r,i]}class Message extends SvelteComponent{constructor(t){super(),init(this,t,instance$4,create_fragment$5,safe_not_equal,{imageBlob:0,text:1})}}class CanvasDither{grayscale(t){for(let e=0;e<t.data.length;e+=4){let n=.299*t.data[e]+.587*t.data[e+1]+.114*t.data[e+2];t.data.fill(n,e,e+3)}return t}threshold(t,e){for(let n=0;n<t.data.length;n+=4){let r=.299*t.data[n]+.587*t.data[n+1]+.114*t.data[n+2]<e?0:255;t.data.fill(r,n,n+3)}return t}bayer(t,e){let n=[[15,135,45,165],[195,75,225,105],[60,180,30,150],[240,120,210,90]];for(let r=0;r<t.data.length;r+=4){let i=.299*t.data[r]+.587*t.data[r+1]+.114*t.data[r+2],o=r/4%t.width,s=Math.floor(r/4/t.width),a=Math.floor((i+n[o%4][s%4])/2)<e?0:255;t.data.fill(a,r,r+3)}return t}floydsteinberg(t){let e=t.width,n=new Uint8ClampedArray(t.width*t.height);for(let e=0,r=0;r<t.data.length;e++,r+=4)n[e]=.299*t.data[r]+.587*t.data[r+1]+.114*t.data[r+2];for(let r=0,i=0;i<t.data.length;r++,i+=4){let o=n[r]<129?0:255,s=Math.floor((n[r]-o)/16);t.data.fill(o,i,i+3),n[r+1]+=7*s,n[r+e-1]+=3*s,n[r+e]+=5*s,n[r+e+1]+=1*s}return t}atkinson(t){let e=t.width,n=new Uint8ClampedArray(t.width*t.height);for(let e=0,r=0;r<t.data.length;e++,r+=4)n[e]=.299*t.data[r]+.587*t.data[r+1]+.114*t.data[r+2];for(let r=0,i=0;i<t.data.length;r++,i+=4){let o=n[r]<129?0:255,s=Math.floor((n[r]-o)/8);t.data.fill(o,i,i+3),n[r+1]+=s,n[r+2]+=s,n[r+e-1]+=s,n[r+e]+=s,n[r+e+1]+=s,n[r+2*e]+=s}return t}}var canvasDither=new CanvasDither,justThrottle=throttle;function throttle(t,e,n){var r=!1,i=!1;return function(){i=n&&!r;var o=this,s=arguments;if(r||(r=!0,setTimeout((function(){if(r=!1,!n)return t.apply(o,s)}),e)),i)return i=!1,t.apply(this,arguments)}}function get_each_context(t,e,n){const r=t.slice();return r[3]=e[n].deviceId,r[4]=e[n].label,r[6]=n,r}function create_each_block(t,e){let n,r,i,o,s,a=e[4]+"";return{key:t,first:null,c(){n=element("button"),r=text(a),i=space(),attr(n,"class","option svelte-9dvss7"),attr(n,"type","button"),attr(n,"data-id",o=e[3]),this.first=n},m(t,o,a){insert(t,n,o),append(n,r),append(n,i),a&&s(),s=listen(n,"click",e[1])},p(t,e){1&e&&a!==(a=t[4]+"")&&set_data(r,a),1&e&&o!==(o=t[3])&&attr(n,"data-id",o)},d(t){t&&detach(n),s()}}}function create_fragment$6(t){let e,n=[],r=new Map,i=t[0];const o=t=>t[3];for(let e=0;e<i.length;e+=1){let s=get_each_context(t,i,e),a=o(s);r.set(a,n[e]=create_each_block(a,s))}return{c(){e=element("div");for(let t=0;t<n.length;t+=1)n[t].c();attr(e,"class","webcam-selector svelte-9dvss7")},m(t,r){insert(t,e,r);for(let t=0;t<n.length;t+=1)n[t].m(e,null)},p(t,[i]){if(3&i){const s=t[0];n=update_keyed_each(n,i,o,1,t,s,r,e,destroy_block,create_each_block,null,get_each_context)}},i:noop,o:noop,d(t){t&&detach(e);for(let t=0;t<n.length;t+=1)n[t].d()}}}function instance$5(t,e,n){let r;component_subscribe(t,cameras,t=>n(0,r=t));const i=createEventDispatcher();return[r,function(t){i("select",t.target.dataset.id)}]}class Webcam_selector extends SvelteComponent{constructor(t){super(),init(this,t,instance$5,create_fragment$6,safe_not_equal,{})}}function create_if_block$1(t){let e;const n=new Webcam_selector({});return n.$on("select",t[5]),{c(){create_component(n.$$.fragment)},m(t,r){mount_component(n,t,r),e=!0},p:noop,i(t){e||(transition_in(n.$$.fragment,t),e=!0)},o(t){transition_out(n.$$.fragment,t),e=!1},d(t){destroy_component(n,t)}}}function create_fragment$7(t){let e,n,r,i,o,s,a,u,c,h=t[3]&&create_if_block$1(t);return{c(){e=element("div"),n=element("video"),r=space(),i=element("canvas"),o=space(),s=element("canvas"),a=space(),h&&h.c(),attr(n,"class","raw-webcam sekrit svelte-1huv1ra"),attr(i,"class","recording-webcam sekrit svelte-1huv1ra"),attr(i,"width",TARGET_WIDTH),attr(i,"height",TARGET_HEIGHT),attr(s,"class","display-webcam svelte-1huv1ra"),attr(s,"width",TARGET_WIDTH),attr(s,"height",TARGET_HEIGHT),attr(e,"class","stylized-webcam-feed svelte-1huv1ra")},m(l,f,p){insert(l,e,f),append(e,n),t[15](n),append(e,r),append(e,i),t[16](i),append(e,o),append(e,s),t[17](s),append(e,a),h&&h.m(e,null),u=!0,p&&c(),c=listen(e,"click",t[4])},p(t,[n]){t[3]?h?(h.p(t,n),transition_in(h,1)):(h=create_if_block$1(t),h.c(),transition_in(h,1),h.m(e,null)):h&&(group_outros(),transition_out(h,1,1,()=>{h=null}),check_outros())},i(t){u||(transition_in(h),u=!0)},o(t){transition_out(h),u=!1},d(n){n&&detach(e),t[15](null),t[16](null),t[17](null),h&&h.d(),c()}}}const TARGET_WIDTH=200,TARGET_HEIGHT=150;function instance$6(t,e,n){let r;component_subscribe(t,colorPalette,t=>n(7,r=t));const i=TARGET_WIDTH/TARGET_HEIGHT;let o,{displayCanvasElement:s}=e,{recordingCanvasElement:a}=e,{videoElement:u}=e,c=TARGET_WIDTH,h=TARGET_HEIGHT;function l(){const{videoWidth:t,videoHeight:e}=u;let n,r;return t/e>i?(r=e,n=r*i):(n=t,r=n/i),{x:t/2-n/2,y:e/2-r/2,width:n,height:r}}function f(){const t=s.getContext("2d"),e=a.getContext("2d"),{x:n,y:i,width:o,height:f}=l();t.drawImage(u,n,i,o,f,0,0,c,h);const p=t.getImageData(0,0,c,h),d=canvasDither.atkinson(p);e.putImageData(d,0,0);const g=convertImageDataToColorPalette(d,r);t.putImageData(g,0,0)}const p=justThrottle(f,100,!0);function d(){p(),o=requestAnimationFrame(d)}onMount(()=>{const t=mediaStream.subscribe(t=>{n(2,u.srcObject=null,u),n(2,u.srcObject=t,u),u.play(),cancelAnimationFrame(o),o=requestAnimationFrame(d)});return function(){cancelAnimationFrame(o),t()}});let g=!1;return t.$set=t=>{"displayCanvasElement"in t&&n(0,s=t.displayCanvasElement),"recordingCanvasElement"in t&&n(1,a=t.recordingCanvasElement),"videoElement"in t&&n(2,u=t.videoElement)},[s,a,u,g,function(){n(3,g=!g)},function(t){const e=t.detail;mediaDeviceId.set(e),n(3,g=!1)},o,r,i,c,h,l,f,p,d,function(t){binding_callbacks[t?"unshift":"push"](()=>{n(2,u=t)})},function(t){binding_callbacks[t?"unshift":"push"](()=>{n(1,a=t)})},function(t){binding_callbacks[t?"unshift":"push"](()=>{n(0,s=t)})}]}class Stylized_webcam_feed extends SvelteComponent{constructor(t){super(),init(this,t,instance$6,create_fragment$7,safe_not_equal,{displayCanvasElement:0,recordingCanvasElement:1,videoElement:2})}get displayCanvasElement(){return this.$$.ctx[0]}set displayCanvasElement(t){this.$set({displayCanvasElement:t}),flush()}get recordingCanvasElement(){return this.$$.ctx[1]}set recordingCanvasElement(t){this.$set({recordingCanvasElement:t}),flush()}get videoElement(){return this.$$.ctx[2]}set videoElement(t){this.$set({videoElement:t}),flush()}}function create_if_block$2(t){let e;return{c(){e=element("span"),attr(e,"class","recording-indicator svelte-1kjk4kh")},m(t,n){insert(t,e,n)},d(t){t&&detach(e)}}}function create_fragment$8(t){let e,n,r,i,o,s,a,u,c,h,l,f,p,d,g;const m=new Stylized_webcam_feed({props:{}});t[6](m);let v=t[2]&&create_if_block$2();return{c(){e=element("div"),n=element("form"),r=element("div"),create_component(m.$$.fragment),i=space(),v&&v.c(),o=space(),s=element("div"),a=space(),u=element("div"),c=element("textarea"),h=space(),l=element("span"),f=element("button"),p=text(""),attr(s,"class","recording-progress svelte-1kjk4kh"),attr(r,"class","recording-booth svelte-1kjk4kh"),attr(c,"class","input svelte-1kjk4kh"),attr(c,"type","text"),attr(c,"placeholder","Type to GIF"),c.disabled=t[2],attr(f,"class","submit svelte-1kjk4kh"),attr(f,"type","submit"),f.disabled=t[2],attr(l,"class","fake-input__action svelte-1kjk4kh"),attr(u,"class","fake-input svelte-1kjk4kh"),attr(n,"class","form svelte-1kjk4kh"),attr(e,"class","new-message svelte-1kjk4kh"),toggle_class(e,"recording",t[2])},m(y,b,w){insert(y,e,b),append(e,n),append(n,r),mount_component(m,r,null),append(r,i),v&&v.m(r,null),append(r,o),append(r,s),append(n,a),append(n,u),append(u,c),set_input_value(c,t[1]),append(u,h),append(u,l),append(l,f),append(f,p),d=!0,w&&run_all(g),g=[listen(c,"input",t[7]),listen(c,"keydown",t[4]),listen(n,"submit",prevent_default(t[3]))]},p(t,[n]){m.$set({}),t[2]?v||(v=create_if_block$2(),v.c(),v.m(r,o)):v&&(v.d(1),v=null),(!d||4&n)&&(c.disabled=t[2]),2&n&&set_input_value(c,t[1]),(!d||4&n)&&(f.disabled=t[2]),4&n&&toggle_class(e,"recording",t[2])},i(t){d||(transition_in(m.$$.fragment,t),d=!0)},o(t){transition_out(m.$$.fragment,t),d=!1},d(n){n&&detach(e),t[6](null),destroy_component(m),v&&v.d(),run_all(g)}}}function instance$7(t,e,n){const r=createEventDispatcher();let i,o="",s=!1;async function a(){n(2,s=!0);const t=await generateImage(i.recordingCanvasElement);n(2,s=!1),r("createMessage",{text:o,imageDataURL:t}),n(1,o="")}return[i,o,s,a,function(t){"Enter"!==t.key||t.shiftKey||a()},r,function(t){binding_callbacks[t?"unshift":"push"](()=>{n(0,i=t)})},function(){o=this.value,n(1,o)}]}class New_message extends SvelteComponent{constructor(t){super(),init(this,t,instance$7,create_fragment$8,safe_not_equal,{})}}function get_each_context$1(t,e,n){const r=t.slice();return r[5]=e[n].id,r[9]=e[n].text,r[10]=e[n].imageBlob,r[12]=n,r}function create_if_block$3(t){let e,n,r;return{c(){e=element("p"),e.textContent="Nothing has been said.",n=space(),r=element("p"),r.textContent="Click  to say something"},m(t,i){insert(t,e,i),insert(t,n,i),insert(t,r,i)},d(t){t&&detach(e),t&&detach(n),t&&detach(r)}}}function create_each_block$1(t,e){let n,r,i,o,s,a,u=noop;const c=new Message({props:{text:e[9],imageBlob:e[10]}});return{key:t,first:null,c(){n=element("li"),create_component(c.$$.fragment),r=space(),this.first=n},m(t,e){insert(t,n,e),mount_component(c,n,null),append(n,r),a=!0},p(t,e){const n={};2&e&&(n.text=t[9]),2&e&&(n.imageBlob=t[10]),c.$set(n)},r(){s=n.getBoundingClientRect()},f(){fix_position(n),u(),add_transform(n,s)},a(){u(),u=create_animation(n,s,flip,{duration:200})},i(t){a||(transition_in(c.$$.fragment,t),add_render_callback(()=>{o&&o.end(1),i||(i=create_in_transition(n,e[3],{key:e[5]})),i.start()}),a=!0)},o(t){transition_out(c.$$.fragment,t),i&&i.invalidate(),o=create_out_transition(n,e[2],{key:e[5]}),a=!1},d(t){t&&detach(n),destroy_component(c),t&&o&&o.end()}}}function create_fragment$9(t){let e,n,r,i,o,s,a,u=[],c=new Map;document.title=e=t[0]?`[${t[0]}] Dither: ${t[5]}`:`Dither: ${t[5]}`;const h=new New_message({});h.$on("createMessage",t[4]);let l=0===t[1].length&&create_if_block$3(),f=t[1];const p=t=>t[5];for(let e=0;e<f.length;e+=1){let n=get_each_context$1(t,f,e),r=p(n);c.set(r,u[e]=create_each_block$1(r,n))}return{c(){n=space(),r=element("div"),create_component(h.$$.fragment),i=space(),o=element("ul"),l&&l.c(),s=space();for(let t=0;t<u.length;t+=1)u[t].c();attr(o,"class","messages svelte-11gzv5a"),attr(r,"class","content svelte-11gzv5a")},m(t,e){insert(t,n,e),insert(t,r,e),mount_component(h,r,null),append(r,i),append(r,o),l&&l.m(o,null),append(o,s);for(let t=0;t<u.length;t+=1)u[t].m(o,null);a=!0},p(t,[n]){if((!a||33&n)&&e!==(e=t[0]?`[${t[0]}] Dither: ${t[5]}`:`Dither: ${t[5]}`)&&(document.title=e),0===t[1].length?l||(l=create_if_block$3(),l.c(),l.m(o,s)):l&&(l.d(1),l=null),2&n){const e=t[1];group_outros();for(let t=0;t<u.length;t+=1)u[t].r();u=update_keyed_each(u,n,p,1,t,e,c,o,fix_and_outro_and_destroy_block,create_each_block$1,null,get_each_context$1);for(let t=0;t<u.length;t+=1)u[t].a();check_outros()}},i(t){if(!a){transition_in(h.$$.fragment,t);for(let t=0;t<f.length;t+=1)transition_in(u[t]);a=!0}},o(t){transition_out(h.$$.fragment,t);for(let t=0;t<u.length;t+=1)transition_out(u[t]);a=!1},d(t){t&&detach(n),t&&detach(r),destroy_component(h),l&&l.d();for(let t=0;t<u.length;t+=1)u[t].d()}}}function instance$8(t,e,n){let r;component_subscribe(t,pageVisible,t=>n(7,r=t));let{currentRoute:i}=e;const{namedParams:o}=i,{id:s}=o;let a=0,u=[];const[c,h]=crossfade({duration:t=>Math.sqrt(100*t),fallback(t,e){const n=getComputedStyle(t),r="none"===n.transform?"":n.transform;return{duration:125,easing:quintOut,css:t=>`\n\t\t\t\t\ttransform: ${r} scale(${t});\n\t\t\t\t\topacity: ${t}\n\t\t\t\t`}}});return onMount(async()=>{firestoreDb.collection(`rooms/${s}/messages`).limit(10).orderBy("createdAt","desc").onSnapshot((function(t){const e=t.docs.map(t=>({id:t.id,...t.data()}));n(1,u=e),r||n(0,a++,a)}))}),pageVisible.subscribe(()=>{n(0,a=0)}),t.$set=t=>{"currentRoute"in t&&n(6,i=t.currentRoute)},[a,u,c,h,async function(t){const{text:e,imageDataURL:n}=t.detail;await firestoreDb.collection(`rooms/${s}/messages`).add({createdAt:firestore.FieldValue.serverTimestamp(),imageBlob:n,text:e})},s,i]}class U5Bidu5D extends SvelteComponent{constructor(t){super(),init(this,t,instance$8,create_fragment$9,safe_not_equal,{currentRoute:6})}}function get_each_context$2(t,e,n){const r=t.slice();return r[1]=e[n][0],r[2]=e[n][1],r}function create_each_block$2(t,e){let n,r,i,o,s=e[1]+"";return{key:t,first:null,c(){n=element("option"),r=text(s),n.__value=i=e[1],n.value=n.__value,n.selected=o=e[0]===e[1],this.first=n},m(t,e){insert(t,n,e),append(n,r)},p(t,e){1&e&&o!==(o=t[0]===t[1])&&(n.selected=o)},d(t){t&&detach(n)}}}function create_fragment$a(t){let e,n,r,i,o,s=[],a=new Map,u=Object.entries(COLOR_PALETTES);const c=t=>t[1];for(let e=0;e<u.length;e+=1){let n=get_each_context$2(t,u,e),r=c(n);a.set(r,s[e]=create_each_block$2(r,n))}return{c(){e=element("nav"),n=element("a"),n.innerHTML='Dither <span class="alpha-tag svelte-9cwu85">alpha</span>',r=space(),i=element("select");for(let t=0;t<s.length;t+=1)s[t].c();attr(n,"href","/"),attr(n,"class","app-name svelte-9cwu85"),attr(e,"class","nav svelte-9cwu85")},m(t,a,u){insert(t,e,a),append(e,n),append(e,r),append(e,i);for(let t=0;t<s.length;t+=1)s[t].m(i,null);u&&o(),o=listen(i,"change",handleColorPaletteChange)},p(t,[e]){if(1&e){const n=Object.entries(COLOR_PALETTES);s=update_keyed_each(s,e,c,1,t,n,a,i,destroy_block,create_each_block$2,null,get_each_context$2)}},i:noop,o:noop,d(t){t&&detach(e);for(let t=0;t<s.length;t+=1)s[t].d();o()}}}function handleColorPaletteChange(t){colorPaletteId.set(t.target.value)}function instance$9(t,e,n){let r;return component_subscribe(t,colorPaletteId,t=>n(0,r=t)),colorPalette.subscribe(([t,e])=>{document.documentElement.style.setProperty("--black",t),document.documentElement.style.setProperty("--white",e)}),[r]}class Nav extends SvelteComponent{constructor(t){super(),init(this,t,instance$9,create_fragment$a,safe_not_equal,{})}}function create_fragment$b(t){let e,n,r;const i=new Nav({}),o=new src_5({props:{currentRoute:t[0]}});return{c(){create_component(i.$$.fragment),e=space(),n=element("main"),create_component(o.$$.fragment),attr(n,"class","layout svelte-1x2r8vu")},m(t,s){mount_component(i,t,s),insert(t,e,s),insert(t,n,s),mount_component(o,n,null),r=!0},p(t,[e]){const n={};1&e&&(n.currentRoute=t[0]),o.$set(n)},i(t){r||(transition_in(i.$$.fragment,t),transition_in(o.$$.fragment,t),r=!0)},o(t){transition_out(i.$$.fragment,t),transition_out(o.$$.fragment,t),r=!1},d(t){destroy_component(i,t),t&&detach(e),t&&detach(n),destroy_component(o)}}}function instance$a(t,e,n){let{currentRoute:r}=e;return t.$set=t=>{"currentRoute"in t&&n(0,r=t.currentRoute)},[r]}class Layout extends SvelteComponent{constructor(t){super(),init(this,t,instance$a,create_fragment$b,safe_not_equal,{currentRoute:0})}}const routes=[{name:"/",component:Routes,layout:Layout},{name:"/rooms/:id",component:U5Bidu5D,layout:Layout}];function create_fragment$c(t){let e,n;const r=new src_6({props:{routes:routes}});return{c(){e=element("div"),create_component(r.$$.fragment),attr(e,"class","app")},m(t,i){insert(t,e,i),mount_component(r,e,null),n=!0},p:noop,i(t){n||(transition_in(r.$$.fragment,t),n=!0)},o(t){transition_out(r.$$.fragment,t),n=!1},d(t){t&&detach(e),destroy_component(r)}}}class App extends SvelteComponent{constructor(t){super(),init(this,t,null,create_fragment$c,safe_not_equal,{})}}const app=new App({target:document.body})}();
//# sourceMappingURL=client.js.map
